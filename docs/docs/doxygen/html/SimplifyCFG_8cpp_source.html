<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/Transforms/Utils/SimplifyCFG.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">17.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_a72932e0778af28115095468f6286ff8.html">Transforms</a></li><li class="navelem"><a class="el" href="dir_f75c00afeb315f44d76556a7c675e6e8.html">Utils</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">SimplifyCFG.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="SimplifyCFG_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- SimplifyCFG.cpp - Code to perform CFG simplification ---------------===//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// Peephole optimize the CFG.</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; </div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="APInt_8h.html">llvm/ADT/APInt.h</a>&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ArrayRef_8h.html">llvm/ADT/ArrayRef.h</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DenseMap_8h.html">llvm/ADT/DenseMap.h</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MapVector_8h.html">llvm/ADT/MapVector.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="STLExtras_8h.html">llvm/ADT/STLExtras.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ScopeExit_8h.html">llvm/ADT/ScopeExit.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Sequence_8h.html">llvm/ADT/Sequence.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SetOperations_8h.html">llvm/ADT/SetOperations.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SetVector_8h.html">llvm/ADT/SetVector.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallPtrSet_8h.html">llvm/ADT/SmallPtrSet.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallVector_8h.html">llvm/ADT/SmallVector.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Statistic_8h.html">llvm/ADT/Statistic.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="StringRef_8h.html">llvm/ADT/StringRef.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AssumptionCache_8h.html">llvm/Analysis/AssumptionCache.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CaptureTracking_8h.html">llvm/Analysis/CaptureTracking.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ConstantFolding_8h.html">llvm/Analysis/ConstantFolding.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DomTreeUpdater_8h.html">llvm/Analysis/DomTreeUpdater.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Analysis_2GuardUtils_8h.html">llvm/Analysis/GuardUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InstructionSimplify_8h.html">llvm/Analysis/InstructionSimplify.h</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MemorySSA_8h.html">llvm/Analysis/MemorySSA.h</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MemorySSAUpdater_8h.html">llvm/Analysis/MemorySSAUpdater.h</a>&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetTransformInfo_8h.html">llvm/Analysis/TargetTransformInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ValueTracking_8h.html">llvm/Analysis/ValueTracking.h</a>&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Attributes_8h.html">llvm/IR/Attributes.h</a>&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BasicBlock_8h.html">llvm/IR/BasicBlock.h</a>&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IR_2CFG_8h.html">llvm/IR/CFG.h</a>&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constant_8h.html">llvm/IR/Constant.h</a>&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ConstantRange_8h.html">llvm/IR/ConstantRange.h</a>&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constants_8h.html">llvm/IR/Constants.h</a>&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DataLayout_8h.html">llvm/IR/DataLayout.h</a>&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IR_2DebugInfo_8h.html">llvm/IR/DebugInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DerivedTypes_8h.html">llvm/IR/DerivedTypes.h</a>&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Function_8h.html">llvm/IR/Function.h</a>&quot;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="GlobalValue_8h.html">llvm/IR/GlobalValue.h</a>&quot;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="GlobalVariable_8h.html">llvm/IR/GlobalVariable.h</a>&quot;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IRBuilder_8h.html">llvm/IR/IRBuilder.h</a>&quot;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InstrTypes_8h.html">llvm/IR/InstrTypes.h</a>&quot;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IR_2Instruction_8h.html">llvm/IR/Instruction.h</a>&quot;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Instructions_8h.html">llvm/IR/Instructions.h</a>&quot;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IntrinsicInst_8h.html">llvm/IR/IntrinsicInst.h</a>&quot;</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="LLVMContext_8h.html">llvm/IR/LLVMContext.h</a>&quot;</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MDBuilder_8h.html">llvm/IR/MDBuilder.h</a>&quot;</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Metadata_8h.html">llvm/IR/Metadata.h</a>&quot;</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Module_8h.html">llvm/IR/Module.h</a>&quot;</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="NoFolder_8h.html">llvm/IR/NoFolder.h</a>&quot;</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Operator_8h.html">llvm/IR/Operator.h</a>&quot;</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="PatternMatch_8h.html">llvm/IR/PatternMatch.h</a>&quot;</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ProfDataUtils_8h.html">llvm/IR/ProfDataUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Type_8h.html">llvm/IR/Type.h</a>&quot;</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Use_8h.html">llvm/IR/Use.h</a>&quot;</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="User_8h.html">llvm/IR/User.h</a>&quot;</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Value_8h.html">llvm/IR/Value.h</a>&quot;</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ValueHandle_8h.html">llvm/IR/ValueHandle.h</a>&quot;</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BranchProbability_8h.html">llvm/Support/BranchProbability.h</a>&quot;</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Casting_8h.html">llvm/Support/Casting.h</a>&quot;</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CommandLine_8h.html">llvm/Support/CommandLine.h</a>&quot;</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Debug_8h.html">llvm/Support/Debug.h</a>&quot;</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Support_2ErrorHandling_8h.html">llvm/Support/ErrorHandling.h</a>&quot;</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="KnownBits_8h.html">llvm/Support/KnownBits.h</a>&quot;</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MathExtras_8h.html">llvm/Support/MathExtras.h</a>&quot;</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="raw__ostream_8h.html">llvm/Support/raw_ostream.h</a>&quot;</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BasicBlockUtils_8h.html">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Transforms_2Utils_2Local_8h.html">llvm/Transforms/Utils/Local.h</a>&quot;</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ValueMapper_8h.html">llvm/Transforms/Utils/ValueMapper.h</a>&quot;</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">#include &lt;climits&gt;</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#include &lt;cstddef&gt;</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor">#include &lt;cstdint&gt;</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">#include &lt;iterator&gt;</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="preprocessor">#include &lt;optional&gt;</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor">#include &lt;set&gt;</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor">#include &lt;tuple&gt;</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="keyword">using namespace </span>PatternMatch;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">   93</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;simplifycfg&quot;</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="namespacellvm.html#a967725b39b57414036183e1384497b22">llvm::RequireAndPreserveDomTree</a>(</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="stringliteral">&quot;simplifycfg-require-and-preserve-domtree&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160; </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Temorary development switch used to gradually uplift SimplifyCFG &quot;</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;             <span class="stringliteral">&quot;into preserving DomTree,&quot;</span>));</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160; </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">// Chosen as 2 so as to be cheap, but still to have enough power to fold</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">// a select, so the &quot;clamp&quot; idiom (of a min followed by a max) will be caught.</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">// To catch this, we need to fold a compare and a select, hence &#39;2&#39; being the</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">// minimum reasonable default.</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a> <a class="code" href="SimplifyCFG_8cpp.html#a51d993ac59a51760ec7a9c7a1738755a">PHINodeFoldingThreshold</a>(</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="stringliteral">&quot;phi-node-folding-threshold&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(2),</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="stringliteral">&quot;Control the amount of phi node folding to perform (default = 2)&quot;</span>));</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a> <a class="code" href="SimplifyCFG_8cpp.html#a2c4138bcbe89707f75ab7bc7717e377f">TwoEntryPHINodeFoldingThreshold</a>(</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="stringliteral">&quot;two-entry-phi-node-folding-threshold&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(4),</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Control the maximal total instruction cost that we are willing &quot;</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;             <span class="stringliteral">&quot;to speculatively execute to fold a 2-entry PHI node into a &quot;</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;             <span class="stringliteral">&quot;select (default = 4)&quot;</span>));</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160; </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#aa254de6a643d4e97c3a9930f360a4987">HoistCommon</a>(<span class="stringliteral">&quot;simplifycfg-hoist-common&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>),</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Hoist common instructions up to the parent block&quot;</span>));</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#a5e90675655fa07e4ac14c4c39f4c338a">HoistCommonSkipLimit</a>(<span class="stringliteral">&quot;simplifycfg-hoist-common-skip-limit&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                         <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(20),</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                         <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Allow reordering across at most this many &quot;</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                                  <span class="stringliteral">&quot;instructions when hoisting&quot;</span>));</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#ac7707bcaec113d0d136467c7b97a62f1">SinkCommon</a>(<span class="stringliteral">&quot;simplifycfg-sink-common&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>),</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;               <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Sink common instructions down to the end block&quot;</span>));</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="SimplifyCFG_8cpp.html#aef5d6c1653f6d85c8ee596904289fd94">HoistCondStores</a>(</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="stringliteral">&quot;simplifycfg-hoist-cond-stores&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>),</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Hoist conditional stores if an unconditional store precedes&quot;</span>));</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="SimplifyCFG_8cpp.html#aeb1d8a382ce658ab7dbbbbcd06def17a">MergeCondStores</a>(</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="stringliteral">&quot;simplifycfg-merge-cond-stores&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>),</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Hoist conditional stores even if an unconditional store does not &quot;</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;             <span class="stringliteral">&quot;precede - hoist multiple conditional stores into a single &quot;</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;             <span class="stringliteral">&quot;predicated store&quot;</span>));</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="SimplifyCFG_8cpp.html#a79048da023cea1bb91bc651c36ed6e32">MergeCondStoresAggressively</a>(</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="stringliteral">&quot;simplifycfg-merge-cond-stores-aggressively&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;When merging conditional stores, do so even if the resultant &quot;</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;             <span class="stringliteral">&quot;basic blocks are unlikely to be if-converted as a result&quot;</span>));</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="SimplifyCFG_8cpp.html#af5ef3bceb3edbbdfe5fd25a42d5f3643">SpeculateOneExpensiveInst</a>(</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="stringliteral">&quot;speculate-one-expensive-inst&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>),</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Allow exactly one expensive instruction to be speculatively &quot;</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;             <span class="stringliteral">&quot;executed&quot;</span>));</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a> <a class="code" href="SimplifyCFG_8cpp.html#ad3975afbd39328614959fbada1ae5648">MaxSpeculationDepth</a>(</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="stringliteral">&quot;max-speculation-depth&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(10),</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Limit maximum recursion depth when calculating costs of &quot;</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;             <span class="stringliteral">&quot;speculatively executed instructions&quot;</span>));</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;int&gt;</a></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#abd2252fac0a4e2ca5270c2ecbfcd3de2">MaxSmallBlockSize</a>(<span class="stringliteral">&quot;simplifycfg-max-small-block-size&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                      <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(10),</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                      <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Max size of a block which is still considered &quot;</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                               <span class="stringliteral">&quot;small enough to thread through&quot;</span>));</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">// Two is chosen to allow one negation and a logical combine.</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#aa997f186d431ca191833917f6f8a7dd1">BranchFoldThreshold</a>(<span class="stringliteral">&quot;simplifycfg-branch-fold-threshold&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                        <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(2),</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                        <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Maximum cost of combining conditions when &quot;</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                                 <span class="stringliteral">&quot;folding branches&quot;</span>));</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160; </div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a> <a class="code" href="SimplifyCFG_8cpp.html#ab5a77dae433054cd06665aee83107ab3">BranchFoldToCommonDestVectorMultiplier</a>(</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="stringliteral">&quot;simplifycfg-branch-fold-common-dest-vector-multiplier&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(2),</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Multiplier to apply to threshold when determining whether or not &quot;</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;             <span class="stringliteral">&quot;to fold branch to common destination when vector operations are &quot;</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;             <span class="stringliteral">&quot;present&quot;</span>));</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160; </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="SimplifyCFG_8cpp.html#ae4337c482999ffe46512754ba3a077c7">EnableMergeCompatibleInvokes</a>(</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="stringliteral">&quot;simplifycfg-merge-compatible-invokes&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>),</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Allow SimplifyCFG to merge invokes together when appropriate&quot;</span>));</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a> <a class="code" href="SimplifyCFG_8cpp.html#a95d324dd1b821acc61ba55ec642796c4">MaxSwitchCasesPerResult</a>(</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="stringliteral">&quot;max-switch-cases-per-result&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(16),</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Limit cases to analyze when converting a switch to select&quot;</span>));</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumBitMaps, <span class="stringliteral">&quot;Number of switch instructions turned into bitmaps&quot;</span>);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumLinearMaps,</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;          <span class="stringliteral">&quot;Number of switch instructions turned into linear mapping&quot;</span>);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumLookupTables,</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;          <span class="stringliteral">&quot;Number of switch instructions turned into lookup tables&quot;</span>);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    NumLookupTablesHoles,</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="stringliteral">&quot;Number of switch instructions turned into lookup tables (holes checked)&quot;</span>);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumTableCmpReuses, <span class="stringliteral">&quot;Number of reused switch table lookup compares&quot;</span>);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumFoldValueComparisonIntoPredecessors,</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;          <span class="stringliteral">&quot;Number of value comparisons folded into predecessor basic blocks&quot;</span>);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumFoldBranchToCommonDest,</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;          <span class="stringliteral">&quot;Number of branches folded into predecessor basic block&quot;</span>);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    NumHoistCommonCode,</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="stringliteral">&quot;Number of common instruction &#39;blocks&#39; hoisted up to the begin block&quot;</span>);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumHoistCommonInstrs,</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;          <span class="stringliteral">&quot;Number of common instructions hoisted up to the begin block&quot;</span>);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumSinkCommonCode,</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;          <span class="stringliteral">&quot;Number of common instruction &#39;blocks&#39; sunk down to the end block&quot;</span>);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumSinkCommonInstrs,</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;          <span class="stringliteral">&quot;Number of common instructions sunk down to the end block&quot;</span>);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumSpeculations, <span class="stringliteral">&quot;Number of speculative executed instructions&quot;</span>);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumInvokes,</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;          <span class="stringliteral">&quot;Number of invokes with empty resume blocks simplified into calls&quot;</span>);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumInvokesMerged, <span class="stringliteral">&quot;Number of invokes that were merged together&quot;</span>);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumInvokeSetsFormed, <span class="stringliteral">&quot;Number of invoke sets that were formed&quot;</span>);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160; </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">// The first field contains the value that the switch produces when a certain</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">// case group is selected, and the second field is a vector containing the</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">// cases composing the case group.</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="keyword">using</span> SwitchCaseResultVectorTy =</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;Constant *, SmallVector&lt;ConstantInt *, 4&gt;</a>&gt;, 2&gt;;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160; </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">// The first field contains the phi node that generates a result of the switch</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">// and the second field contains the value generated for a certain case in the</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">// switch for that PHI.</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="keyword">using</span> SwitchCaseResultsTy = <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;PHINode *, Constant *&gt;</a>, 4&gt;;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">/// ValueEqualityComparisonCase - Represents a case of a switch.</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment"></span><span class="keyword">struct </span>ValueEqualityComparisonCase {</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="namespacellvm_1_1TargetStackID.html#a71392100eb15ba746b1f898986f5d8a5">Value</a>;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Dest;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  ValueEqualityComparisonCase(<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="classllvm_1_1Value.html">Value</a>, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Dest)</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      : <a class="code" href="classllvm_1_1Value.html">Value</a>(<a class="code" href="classllvm_1_1Value.html">Value</a>), Dest(Dest) {}</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160; </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#a061b224a1a3c3486fd854e5009a858c9">operator&lt;</a>(ValueEqualityComparisonCase <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">// Comparing pointers is ok as we only rely on the order for uniquing.</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1Value.html">Value</a> &lt; <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>.<a class="code" href="classllvm_1_1Value.html#a18dbfcb332af7515599ee795cf462843">Value</a>;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#a4d812a2dd18aa186c164447e20e348e7">operator==</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *RHSDest)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> Dest == RHSDest; }</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;};</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="keyword">class </span>SimplifyCFGOpt {</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="namespacellvm.html#aa0d69e81725c10fa5407f0bf34462068">TTI</a>;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> *DTU;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;WeakVH&gt;</a> LoopHeaders;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keyword">const</span> <a class="code" href="structllvm_1_1SimplifyCFGOptions.html">SimplifyCFGOptions</a> &amp;<a class="code" href="PassBuilderBindings_8cpp.html#a47c521bf7ba0bb2147b96d068af30d04">Options</a>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="keywordtype">bool</span> Resimplify;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160; </div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *isValueEqualityComparison(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TI);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *GetValueEqualityComparisonCases(</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TI, std::vector&lt;ValueEqualityComparisonCase&gt; &amp;Cases);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <span class="keywordtype">bool</span> SimplifyEqualityComparisonWithOnlyPredecessor(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TI,</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                                                     <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred,</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                                                     <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keywordtype">bool</span> PerformValueComparisonIntoPredecessorFolding(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TI, <a class="code" href="classllvm_1_1Value.html">Value</a> *&amp;CV,</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                                                    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *PTI,</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                                                    <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="keywordtype">bool</span> FoldValueComparisonIntoPredecessors(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TI,</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                                           <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160; </div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="keywordtype">bool</span> simplifyResume(<a class="code" href="classllvm_1_1ResumeInst.html">ResumeInst</a> *RI, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="keywordtype">bool</span> simplifySingleResume(<a class="code" href="classllvm_1_1ResumeInst.html">ResumeInst</a> *RI);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keywordtype">bool</span> simplifyCommonResume(<a class="code" href="classllvm_1_1ResumeInst.html">ResumeInst</a> *RI);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keywordtype">bool</span> simplifyCleanupReturn(<a class="code" href="classllvm_1_1CleanupReturnInst.html">CleanupReturnInst</a> *RI);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keywordtype">bool</span> simplifyUnreachable(<a class="code" href="classllvm_1_1UnreachableInst.html">UnreachableInst</a> *UI);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keywordtype">bool</span> simplifySwitch(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="keywordtype">bool</span> simplifyIndirectBr(<a class="code" href="classllvm_1_1IndirectBrInst.html">IndirectBrInst</a> *IBI);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keywordtype">bool</span> simplifyBranch(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a>, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keywordtype">bool</span> simplifyUncondBranch(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="keywordtype">bool</span> simplifyCondBranch(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="keywordtype">bool</span> tryToSimplifyUncondBranchWithICmpInIt(<a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *ICI,</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                                             <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <span class="keywordtype">bool</span> HoistThenElseCodeToIf(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>,</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                             <span class="keywordtype">bool</span> EqTermsOnly);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <span class="keywordtype">bool</span> SpeculativelyExecuteBB(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *ThenBB,</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                              <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keywordtype">bool</span> SimplifyTerminatorOnSelect(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *OldTerm, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>,</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                                  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *TrueBB, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *FalseBB,</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                                  <a class="code" href="classuint32__t.html">uint32_t</a> TrueWeight, <a class="code" href="classuint32__t.html">uint32_t</a> FalseWeight);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keywordtype">bool</span> SimplifyBranchOnICmpChain(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>,</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                                 <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keywordtype">bool</span> SimplifySwitchOnSelect(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a>);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="keywordtype">bool</span> SimplifyIndirectBrOnSelect(<a class="code" href="classllvm_1_1IndirectBrInst.html">IndirectBrInst</a> *IBI, <a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="keywordtype">bool</span> TurnSwitchRangeIntoICmp(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  SimplifyCFGOpt(<span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> *DTU,</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                 <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;WeakVH&gt;</a> LoopHeaders,</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                 <span class="keyword">const</span> <a class="code" href="structllvm_1_1SimplifyCFGOptions.html">SimplifyCFGOptions</a> &amp;Opts)</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      : <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>), DTU(DTU), <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>), LoopHeaders(LoopHeaders), <a class="code" href="PassBuilderBindings_8cpp.html#a47c521bf7ba0bb2147b96d068af30d04">Options</a>(Opts) {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!DTU || !DTU-&gt;<a class="code" href="classllvm_1_1DomTreeUpdater.html#a3bcb0f3fbf8288edc31eb9d80c2770ae">hasPostDomTree</a>()) &amp;&amp;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;           <span class="stringliteral">&quot;SimplifyCFG is not yet capable of maintaining validity of a &quot;</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;           <span class="stringliteral">&quot;PostDomTree, so don&#39;t ask for it.&quot;</span>);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  }</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="keywordtype">bool</span> simplifyOnce(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="namespacellvm_1_1dxil_1_1PointerTypeAnalysis.html#ae574a4c1d84b9e67bc94489f356805b4">run</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160; </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="comment">// Helper to set Resimplify and return change indication.</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="keywordtype">bool</span> requestResimplify() {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    Resimplify = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  }</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;};</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160; </div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">/// Return true if all the PHI nodes in the basic block \p BB</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">/// receive compatible (identical) incoming values when coming from</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">/// all of the predecessor blocks that are specified in \p IncomingBlocks.</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">/// Note that if the values aren&#39;t exactly identical, but \p EquivalenceSet</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">/// is provided, and *both* of the values are present in the set,</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">/// then they are considered equal.</span></div>
<div class="line"><a name="l00316"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a650b03916ebf8e695751b1246cd6de0e">  316</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a650b03916ebf8e695751b1246cd6de0e">IncomingValuesAreCompatible</a>(</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;BasicBlock *&gt;</a> IncomingBlocks,</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSetImpl.html">SmallPtrSetImpl&lt;Value *&gt;</a> *EquivalenceSet = <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IncomingBlocks.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == 2 &amp;&amp;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;         <span class="stringliteral">&quot;Only for a pair of incoming blocks at the time!&quot;</span>);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160; </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="comment">// FIXME: it is okay if one of the incoming values is an `undef` value,</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <span class="comment">//        iff the other incoming value is guaranteed to be a non-poison value.</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="comment">// FIXME: it is okay if one of the incoming values is a `poison` value.</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;phis(), [IncomingBlocks, EquivalenceSet](<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> &amp;PN) {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    Value *IV0 = PN.getIncomingValueForBlock(IncomingBlocks[0]);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    Value *IV1 = PN.getIncomingValueForBlock(IncomingBlocks[1]);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    if (IV0 == IV1)</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      return true;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    if (EquivalenceSet &amp;&amp; EquivalenceSet-&gt;contains(IV0) &amp;&amp;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        EquivalenceSet-&gt;contains(IV1))</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      return true;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    return false;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  });</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;}</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">/// Return true if it is safe to merge these two</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">/// terminator instructions together.</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="line"><a name="l00340"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a176b027b36f2084a7d30439522a86b79">  340</a></span>&#160;<a class="code" href="SimplifyCFG_8cpp.html#a176b027b36f2084a7d30439522a86b79">SafeToMergeTerminators</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *SI1, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *SI2,</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                       <a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;BasicBlock *, 4&gt;</a> *FailBlocks = <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="keywordflow">if</span> (SI1 == SI2)</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Can&#39;t merge with self!</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160; </div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="comment">// It is not safe to merge these two switch instructions if they have a common</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="comment">// successor, and if that successor has a PHI node, and if *that* PHI node has</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="comment">// conflicting incoming values from the two switch blocks.</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *SI1BB = SI1-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *SI2BB = SI2-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160; </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BasicBlock *, 16&gt;</a> SI1Succs(<a class="code" href="namespacellvm.html#a3720211f6e6389ab53734b989bfb6fce">succ_begin</a>(SI1BB), <a class="code" href="namespacellvm.html#a069c4ae2290101bde0f8d6a5074dc72b">succ_end</a>(SI1BB));</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="AArch64Disassembler_8cpp.html#aae15979c93f7f0929116b975b5c46cd6">Fail</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ : <a class="code" href="namespacellvm.html#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(SI2BB)) {</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">if</span> (!SI1Succs.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(Succ))</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a650b03916ebf8e695751b1246cd6de0e">IncomingValuesAreCompatible</a>(Succ, {SI1BB, SI2BB}))</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <a class="code" href="AArch64Disassembler_8cpp.html#aae15979c93f7f0929116b975b5c46cd6">Fail</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordflow">if</span> (FailBlocks)</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      FailBlocks-&gt;insert(Succ);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  }</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="keywordflow">return</span> !<a class="code" href="AArch64Disassembler_8cpp.html#aae15979c93f7f0929116b975b5c46cd6">Fail</a>;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;}</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">/// Update PHI nodes in Succ to indicate that there will now be entries in it</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">/// from the &#39;NewPred&#39; block. The values that will be flowing into the PHI nodes</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">/// will be the same as those coming in from ExistPred, an existing predecessor</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">/// of Succ.</span></div>
<div class="line"><a name="l00372"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a41a075ef4b76f72591e86e1fe13f096d">  372</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="SimplifyCFG_8cpp.html#a41a075ef4b76f72591e86e1fe13f096d">AddPredecessorToBlock</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *NewPred,</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                                  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *ExistPred,</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                                  <a class="code" href="classllvm_1_1MemorySSAUpdater.html">MemorySSAUpdater</a> *MSSAU = <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> &amp;PN : Succ-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a72516971c5734dc0f7546e64affca425">phis</a>())</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    PN.addIncoming(PN.getIncomingValueForBlock(ExistPred), NewPred);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keywordflow">if</span> (MSSAU)</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *MPhi = MSSAU-&gt;getMemorySSA()-&gt;getMemoryAccess(Succ))</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      MPhi-&gt;addIncoming(MPhi-&gt;getIncomingValueForBlock(ExistPred), NewPred);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;}</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">/// Compute an abstract &quot;cost&quot; of speculating the given instruction,</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">/// which is assumed to be safe to speculate. TCC_Free means cheap,</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">/// TCC_Basic means less cheap, and TCC_Expensive means prohibitively</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">/// expensive.</span></div>
<div class="line"><a name="l00386"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a9ac94808486f1c47e5cc9ba62dcc6fae">  386</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="SimplifyCFG_8cpp.html#a9ac94808486f1c47e5cc9ba62dcc6fae">computeSpeculationCost</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1User.html">User</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                                              <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) {</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!isa&lt;Instruction&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;          <a class="code" href="namespacellvm.html#abe76d72cda6b2b4562c72accb510040b">isSafeToSpeculativelyExecute</a>(cast&lt;Instruction&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))) &amp;&amp;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;         <span class="stringliteral">&quot;Instruction is not safe to speculatively execute!&quot;</span>);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>.<a class="code" href="classllvm_1_1TargetTransformInfo.html#ac77dbedcfd916a5c9b58e753b2678a98">getInstructionCost</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8">TargetTransformInfo::TCK_SizeAndLatency</a>);</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;}</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">/// If we have a merge point of an &quot;if condition&quot; as accepted above,</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">/// return true if the specified value dominates the block.  We</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">/// don&#39;t handle the true generality of domination here, just a special case</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">/// which works well enough for us.</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment">/// If AggressiveInsts is non-null, and if V does not dominate BB, we check to</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">/// see if V (which must be an instruction) and its recursive operands</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">/// that do not dominate BB have a combined cost lower than Budget and</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">/// are non-trapping.  If both are true, the instruction is inserted into the</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">/// set and true is returned.</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">/// The cost for most non-trapping instructions is defined as 1 except for</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">/// Select whose cost is 2.</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">/// After this function returns, Cost is increased by the cost of</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">/// V plus its non-dominating operands.  If that cost is greater than</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">/// Budget, false is returned and Cost is undefined.</span></div>
<div class="line"><a name="l00411"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#affd7c19ab0474d817d8cf0bd94f5ccad">  411</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#affd7c19ab0474d817d8cf0bd94f5ccad">dominatesMergePoint</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>,</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                                <a class="code" href="classllvm_1_1SmallPtrSetImpl.html">SmallPtrSetImpl&lt;Instruction *&gt;</a> &amp;AggressiveInsts,</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                                <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> &amp;Cost,</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                                <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> Budget,</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                                <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>,</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                                <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> = 0) {</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="comment">// It is possible to hit a zero-cost cycle (phi/gep instructions for example),</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="comment">// so limit the recursion depth.</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="comment">// TODO: While this recursion limit does prevent pathological behavior, it</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="comment">// would be better to track visited instructions to avoid cycles.</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> == <a class="code" href="SimplifyCFG_8cpp.html#ad3975afbd39328614959fbada1ae5648">MaxSpeculationDepth</a>)</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160; </div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="comment">// Non-instructions dominate all instructions and can be executed</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="comment">// unconditionally.</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  }</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PBB = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160; </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="comment">// We don&#39;t want to allow weird loops that might have the &quot;if condition&quot; in</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="comment">// the bottom of this block.</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="keywordflow">if</span> (PBB == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="comment">// If this instruction is defined in a block that contains an unconditional</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  <span class="comment">// branch to BB, then it must be in the &#39;conditional&#39; part of the &quot;if</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <span class="comment">// statement&quot;.  If not, it definitely dominates the region.</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = dyn_cast&lt;BranchInst&gt;(PBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>());</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  <span class="keywordflow">if</span> (!BI || BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() || BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0) != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160; </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="comment">// If we have seen this instruction before, don&#39;t count it again.</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="keywordflow">if</span> (AggressiveInsts.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160; </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  <span class="comment">// Okay, it looks like the instruction IS in the &quot;condition&quot;.  Check to</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="comment">// see if it&#39;s a cheap instruction to unconditionally compute, and if it</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="comment">// only uses stuff defined outside of the condition.  If so, hoist it out.</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#abe76d72cda6b2b4562c72accb510040b">isSafeToSpeculativelyExecute</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> += <a class="code" href="SimplifyCFG_8cpp.html#a9ac94808486f1c47e5cc9ba62dcc6fae">computeSpeculationCost</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160; </div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="comment">// Allow exactly one instruction to be speculated regardless of its cost</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="comment">// (as long as it is safe to do so).</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="comment">// This is intended to flatten the CFG even if the instruction is a division</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="comment">// or other expensive operation. The speculation of an expensive instruction</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="comment">// is expected to be undone in CodeGenPrepare if the speculation has not</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="comment">// enabled further IR optimizations.</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> &gt; Budget &amp;&amp;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      (!<a class="code" href="SimplifyCFG_8cpp.html#af5ef3bceb3edbbdfe5fd25a42d5f3643">SpeculateOneExpensiveInst</a> || !AggressiveInsts.<a class="code" href="classllvm_1_1SmallPtrSetImplBase.html#af8a50544090e81ac83601aff8f4b0142">empty</a>() || <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> &gt; 0 ||</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;       !<a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>.isValid()))</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160; </div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="comment">// Okay, we can only really hoist these out if their operands do</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="comment">// not take us over the cost threshold.</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> : <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands())</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#affd7c19ab0474d817d8cf0bd94f5ccad">dominatesMergePoint</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, AggressiveInsts, <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>, Budget, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>,</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                             <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1))</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="comment">// Okay, it&#39;s safe to do this!  Remember this instruction.</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  AggressiveInsts.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;}</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">/// Extract ConstantInt from value, looking through IntToPtr</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">/// and PointerNullValue. Return NULL if value is not a constant int.</span></div>
<div class="line"><a name="l00480"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a94ec041c0e8d06efb0bd1998bcedec9f">  480</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="SimplifyCFG_8cpp.html#a94ec041c0e8d06efb0bd1998bcedec9f">GetConstantInt</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>) {</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="comment">// Normal constant int.</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CI = dyn_cast&lt;ConstantInt&gt;(V);</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="keywordflow">if</span> (CI || !isa&lt;Constant&gt;(V) || !V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>() ||</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.isNonIntegralPointerType(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()))</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keywordflow">return</span> CI;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160; </div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="comment">// This is some kind of pointer constant. Turn it into a pointer-sized</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="comment">// ConstantInt if possible.</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <a class="code" href="classllvm_1_1IntegerType.html">IntegerType</a> *PtrTy = cast&lt;IntegerType&gt;(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIntPtrType(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()));</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="comment">// Null pointer means 0, see SelectionDAGBuilder::getValue(const Value*).</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <span class="keywordflow">if</span> (isa&lt;ConstantPointerNull&gt;(V))</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(PtrTy, 0);</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160; </div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <span class="comment">// IntToPtr const int.</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE = dyn_cast&lt;ConstantExpr&gt;(V))</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keywordflow">if</span> (CE-&gt;getOpcode() == Instruction::IntToPtr)</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CI = dyn_cast&lt;ConstantInt&gt;(CE-&gt;getOperand(0))) {</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        <span class="comment">// The constant is very likely to have the right type already.</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="keywordflow">if</span> (CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#afe3ce7fc89f36474eb0369cbb792c05a">getType</a>() == PtrTy)</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;          <span class="keywordflow">return</span> CI;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;          <span class="keywordflow">return</span> cast&lt;ConstantInt&gt;(</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;              <a class="code" href="classllvm_1_1ConstantExpr.html#a90d84324b6b6aa2a60077a79b31a49e7">ConstantExpr::getIntegerCast</a>(CI, PtrTy, <span class="comment">/*isSigned=*/</span><span class="keyword">false</span>));</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;}</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160; </div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">/// Given a chain of or (||) or and (&amp;&amp;) comparison of a value against a</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment">/// constant, this will try to recover the information required for a switch</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">/// structure.</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">/// It will depth-first traverse the chain of comparison, seeking for patterns</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">/// like %a == 12 or %a &lt; 4 and combine them to produce a set of integer</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">/// representing the different cases for the switch.</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">/// Note that if the chain is composed of &#39;||&#39; it will build the set of elements</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">/// that matches the comparisons (i.e. any of this value validate the chain)</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">/// while for a chain of &#39;&amp;&amp;&#39; it will build the set elements that make the test</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">/// fail.</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment"></span><span class="keyword">struct </span>ConstantComparesGatherer {</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">  /// Value found for the switch comparison</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Value.html">Value</a> *CompValue = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">  /// Extra clause to be checked before the switch</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Value.html">Value</a> *Extra = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">  /// Set of integers to match in switch</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;ConstantInt *, 8&gt;</a> Vals;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment">  /// Number of comparisons matched in the and/or chain</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment"></span>  <span class="keywordtype">unsigned</span> UsedICmps = 0;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment">  /// Construct and compute the result for the comparison instruction Cond</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment"></span>  ConstantComparesGatherer(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>) : <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>) {</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    gather(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  }</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  ConstantComparesGatherer(<span class="keyword">const</span> ConstantComparesGatherer &amp;) = <span class="keyword">delete</span>;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  ConstantComparesGatherer &amp;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  operator=(<span class="keyword">const</span> ConstantComparesGatherer &amp;) = <span class="keyword">delete</span>;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160; </div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="keyword">private</span>:<span class="comment"></span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">  /// Try to set the current value used for the comparison, it succeeds only if</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">  /// it wasn&#39;t set before or if the new value is the same as the old one</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> setValueOnce(<a class="code" href="classllvm_1_1Value.html">Value</a> *NewVal) {</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordflow">if</span> (CompValue &amp;&amp; CompValue != NewVal)</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    CompValue = NewVal;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">return</span> (CompValue != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  }</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">  /// Try to match Instruction &quot;I&quot; as a comparison against a constant and</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">  /// populates the array Vals with the set of values that match (or do not</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment">  /// match depending on isEQ).</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment">  /// Return false on failure. On success, the Value the comparison matched</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment">  /// against is placed in CompValue.</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment">  /// If CompValue is already set, the function is expected to fail if a match</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">  /// is found but the value compared to is different.</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> matchInstruction(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="keywordtype">bool</span> isEQ) {</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="comment">// If this is an icmp against a constant, handle this as one of the cases.</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *ICI;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordflow">if</span> (!((ICI = dyn_cast&lt;ICmpInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;          (<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = <a class="code" href="SimplifyCFG_8cpp.html#a94ec041c0e8d06efb0bd1998bcedec9f">GetConstantInt</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>)))) {</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    }</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160; </div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *RHSVal;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> *RHSC;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160; </div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="comment">// Pattern match a special case</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="comment">// (x &amp; ~2^z) == y --&gt; x == y || x == y|2^z</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="comment">// This undoes a transformation done by instcombine to fuse 2 compares.</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">if</span> (ICI-&gt;<a class="code" href="classllvm_1_1CmpInst.html#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>() == (isEQ ? <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP_EQ</a> : <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP_NE</a>)) {</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      <span class="comment">// It&#39;s a little bit hard to see why the following transformations are</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <span class="comment">// correct. Here is a CVC3 program to verify them for 64-bit values:</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160; </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      <span class="comment">/*</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">         ONE  : BITVECTOR(64) = BVZEROEXTEND(0bin1, 63);</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">         x    : BITVECTOR(64);</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment">         y    : BITVECTOR(64);</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">         z    : BITVECTOR(64);</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="comment">         mask : BITVECTOR(64) = BVSHL(ONE, z);</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment">         QUERY( (y &amp; ~mask = y) =&gt;</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment">                ((x &amp; ~mask = y) &lt;=&gt; (x = y OR x = (y |  mask)))</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">         );</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment">         QUERY( (y |  mask = y) =&gt;</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">                ((x |  mask = y) &lt;=&gt; (x = y OR x = (y &amp; ~mask)))</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">         );</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">      */</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160; </div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      <span class="comment">// Please note that each pattern must be a dual implication (&lt;--&gt; or</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      <span class="comment">// iff). One directional implication can create spurious matches. If the</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      <span class="comment">// implication is only one-way, an unsatisfiable condition on the left</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      <span class="comment">// side can imply a satisfiable condition on the right side. Dual</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      <span class="comment">// implication ensures that satisfiable conditions are transformed to</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      <span class="comment">// other satisfiable conditions and unsatisfiable conditions are</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      <span class="comment">// transformed to other unsatisfiable conditions.</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160; </div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      <span class="comment">// Here is a concrete example of a unsatisfiable condition on the left</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <span class="comment">// implying a satisfiable condition on the right:</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      <span class="comment">// mask = (1 &lt;&lt; z)</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      <span class="comment">// (x &amp; ~mask) == y  --&gt; (x == y || x == (y | mask))</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      <span class="comment">// Substituting y = 3, z = 0 yields:</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      <span class="comment">// (x &amp; -2) == 3 --&gt; (x == 3 || x == 2)</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160; </div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <span class="comment">// Pattern match a special case:</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      <span class="comment">/*</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="comment">        QUERY( (y &amp; ~mask = y) =&gt;</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="comment">               ((x &amp; ~mask = y) &lt;=&gt; (x = y OR x = (y |  mask)))</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment">        );</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment">      */</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ICI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0),</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                <a class="code" href="namespacellvm_1_1PatternMatch.html#a427435d4da769ae680a8e77ef89520aa">m_And</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(RHSVal), <a class="code" href="namespacellvm_1_1PatternMatch.html#aac9e78b3aa02ec087c4621358f506718">m_APInt</a>(RHSC)))) {</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <a class="code" href="classllvm_1_1APInt.html">APInt</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a> = ~*RHSC;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.isPowerOf2() &amp;&amp; (<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getValue() &amp; ~<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) == <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getValue()) {</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;          <span class="comment">// If we already have a value for the switch, it has to match!</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;          <span class="keywordflow">if</span> (!setValueOnce(RHSVal))</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;          Vals.push_back(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;          Vals.push_back(</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;              <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getContext(),</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                               <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getValue() | <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>));</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;          UsedICmps++;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        }</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      }</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160; </div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      <span class="comment">// Pattern match a special case:</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      <span class="comment">/*</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment">        QUERY( (y |  mask = y) =&gt;</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="comment">               ((x |  mask = y) &lt;=&gt; (x = y OR x = (y &amp; ~mask)))</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="comment">        );</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="comment">      */</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ICI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0),</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                <a class="code" href="namespacellvm_1_1PatternMatch.html#a42569041ddafba7d40243e126af07f42">m_Or</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(RHSVal), <a class="code" href="namespacellvm_1_1PatternMatch.html#aac9e78b3aa02ec087c4621358f506718">m_APInt</a>(RHSC)))) {</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        <a class="code" href="classllvm_1_1APInt.html">APInt</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a> = *RHSC;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.isPowerOf2() &amp;&amp; (<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getValue() | <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) == <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getValue()) {</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;          <span class="comment">// If we already have a value for the switch, it has to match!</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;          <span class="keywordflow">if</span> (!setValueOnce(RHSVal))</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160; </div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;          Vals.push_back(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>);</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;          Vals.push_back(<a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getContext(),</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                                          <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getValue() &amp; ~<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>));</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;          UsedICmps++;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        }</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      }</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160; </div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      <span class="comment">// If we already have a value for the switch, it has to match!</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <span class="keywordflow">if</span> (!setValueOnce(ICI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)))</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160; </div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      UsedICmps++;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      Vals.push_back(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>);</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      <span class="keywordflow">return</span> ICI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    }</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160; </div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="comment">// If we have &quot;x ult 3&quot;, for example, then we can add 0,1,2 to the set.</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <a class="code" href="classllvm_1_1ConstantRange.html">ConstantRange</a> Span =</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        <a class="code" href="classllvm_1_1ConstantRange.html#aa89e9cec92a0b38d2f47a077bf12cc98">ConstantRange::makeExactICmpRegion</a>(ICI-&gt;<a class="code" href="classllvm_1_1CmpInst.html#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>(), <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getValue());</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160; </div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="comment">// Shift the range if the compare is fed by an add. This is the range</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="comment">// compare idiom as emitted by instcombine.</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *CandidateVal = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0);</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), <a class="code" href="namespacellvm_1_1PatternMatch.html#a944c25ac9b73b02a17a20a08a25b9b21">m_Add</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(RHSVal), <a class="code" href="namespacellvm_1_1PatternMatch.html#aac9e78b3aa02ec087c4621358f506718">m_APInt</a>(RHSC)))) {</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      Span = Span.<a class="code" href="classllvm_1_1ConstantRange.html#a1d29074c7a610816d4f328b7cd9b783d">subtract</a>(*RHSC);</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      CandidateVal = RHSVal;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    }</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160; </div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="comment">// If this is an and/!= check, then we are looking to build the set of</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="comment">// value that *don&#39;t* pass the and chain. I.e. to turn &quot;x ugt 2&quot; into</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="comment">// x != 0 &amp;&amp; x != 1.</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="keywordflow">if</span> (!isEQ)</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      Span = Span.<a class="code" href="classllvm_1_1ConstantRange.html#aaaa2f5e2c6c3122d2b484f9e50950e18">inverse</a>();</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160; </div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="comment">// If there are a ton of values, we don&#39;t want to make a ginormous switch.</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keywordflow">if</span> (Span.<a class="code" href="classllvm_1_1ConstantRange.html#a688f2c4ca99eb7f935cab42c4f6398e7">isSizeLargerThan</a>(8) || Span.<a class="code" href="classllvm_1_1ConstantRange.html#a5bd6d98b4a7ecc1dcdc571e4352fcc52">isEmptySet</a>()) {</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    }</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160; </div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="comment">// If we already have a value for the switch, it has to match!</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="keywordflow">if</span> (!setValueOnce(CandidateVal))</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160; </div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="comment">// Add all values from the range to the set</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1APInt.html">APInt</a> Tmp = Span.<a class="code" href="classllvm_1_1ConstantRange.html#a4c57cff33f93411b9c32991f3c5336ad">getLower</a>(); Tmp != Span.<a class="code" href="classllvm_1_1ConstantRange.html#a04459fa7cb4eeda3238a0f7d554ad3be">getUpper</a>(); ++Tmp)</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;      Vals.push_back(<a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getContext(), Tmp));</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160; </div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    UsedICmps++;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  }</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="comment">  /// Given a potentially &#39;or&#39;d or &#39;and&#39;d together collection of icmp</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="comment">  /// eq/ne/lt/gt instructions that compare a value against a constant, extract</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="comment">  /// the value being compared, and stick the list constants into the Vals</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="comment">  /// vector.</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="comment">  /// One &quot;Extra&quot; case is allowed to differ from the other.</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> gather(<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="keywordtype">bool</span> isEQ = <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a class="code" href="namespacellvm_1_1PatternMatch.html#a1a06b1cff93069d7403ea03e6150e386">m_LogicalOr</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>()));</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160; </div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="comment">// Keep a stack (SmallVector for efficiency) for depth-first traversal</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 8&gt;</a> DFT;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value *, 8&gt;</a> Visited;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160; </div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="comment">// Initialize</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    Visited.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(V);</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    DFT.push_back(V);</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160; </div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="keywordflow">while</span> (!DFT.empty()) {</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      V = DFT.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a0c8ffe664a36e30d49c84d0aded2fe08">pop_back_val</a>();</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160; </div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V)) {</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <span class="comment">// If it is a || (or &amp;&amp; depending on isEQ), process the operands.</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Op0, *Op1;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <span class="keywordflow">if</span> (isEQ ? <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#a1a06b1cff93069d7403ea03e6150e386">m_LogicalOr</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(Op0), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(Op1)))</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                 : <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#a213e6c0ca6e838157373b9a6018c0769">m_LogicalAnd</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(Op0), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(Op1)))) {</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;          <span class="keywordflow">if</span> (Visited.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(Op1).second)</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;            DFT.push_back(Op1);</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;          <span class="keywordflow">if</span> (Visited.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(Op0).second)</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;            DFT.push_back(Op0);</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160; </div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        }</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160; </div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        <span class="comment">// Try to match the current instruction</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        <span class="keywordflow">if</span> (matchInstruction(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, isEQ))</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;          <span class="comment">// Match succeed, continue the loop</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      }</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160; </div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      <span class="comment">// One element of the sequence of || (or &amp;&amp;) could not be match as a</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      <span class="comment">// comparison against the same value as the others.</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      <span class="comment">// We allow only one &quot;Extra&quot; case to be checked before the switch</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      <span class="keywordflow">if</span> (!Extra) {</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        Extra = V;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      }</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      <span class="comment">// Failed to parse a proper sequence, abort now</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      CompValue = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    }</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  }</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;};</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160; </div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160; </div>
<div class="line"><a name="l00755"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#aa4641512b28a6e42a40bda7576fe43cb">  755</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="SimplifyCFG_8cpp.html#aa4641512b28a6e42a40bda7576fe43cb">EraseTerminatorAndDCECond</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TI,</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                                      <a class="code" href="classllvm_1_1MemorySSAUpdater.html">MemorySSAUpdater</a> *MSSAU = <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;SwitchInst&gt;(TI)) {</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a> = dyn_cast&lt;Instruction&gt;(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition());</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = dyn_cast&lt;BranchInst&gt;(TI)) {</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="keywordflow">if</span> (BI-&gt;isConditional())</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      <a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a> = dyn_cast&lt;Instruction&gt;(BI-&gt;getCondition());</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1IndirectBrInst.html">IndirectBrInst</a> *IBI = dyn_cast&lt;IndirectBrInst&gt;(TI)) {</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a> = dyn_cast&lt;Instruction&gt;(IBI-&gt;getAddress());</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  }</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160; </div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>)</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <a class="code" href="namespacellvm.html#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>, <span class="keyword">nullptr</span>, MSSAU);</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;}</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="comment">/// Return true if the specified terminator checks</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="comment">/// to see if a value is equal to constant integer value.</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1Value.html">Value</a> *SimplifyCFGOpt::isValueEqualityComparison(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TI) {</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *CV = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;SwitchInst&gt;(TI)) {</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="comment">// Do not permit merging of large switch instructions into their</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="comment">// predecessors unless there is only one predecessor.</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getParent()-&gt;hasNPredecessorsOrMore(128 / <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getNumSuccessors()))</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      CV = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition();</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = dyn_cast&lt;BranchInst&gt;(TI))</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="keywordflow">if</span> (BI-&gt;isConditional() &amp;&amp; BI-&gt;getCondition()-&gt;hasOneUse())</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *ICI = dyn_cast&lt;ICmpInst&gt;(BI-&gt;getCondition())) {</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <span class="keywordflow">if</span> (ICI-&gt;<a class="code" href="classllvm_1_1ICmpInst.html#abe8988eef2e6fc2baba032cb22afedd7">isEquality</a>() &amp;&amp; <a class="code" href="SimplifyCFG_8cpp.html#a94ec041c0e8d06efb0bd1998bcedec9f">GetConstantInt</a>(ICI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1), <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;          CV = ICI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      }</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160; </div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  <span class="comment">// Unwrap any lossless ptrtoint cast.</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;  <span class="keywordflow">if</span> (CV) {</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PtrToIntInst.html">PtrToIntInst</a> *PTII = dyn_cast&lt;PtrToIntInst&gt;(CV)) {</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = PTII-&gt;getPointerOperand();</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;      <span class="keywordflow">if</span> (PTII-&gt;getType() == <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIntPtrType(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getType()))</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        CV = <a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    }</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  }</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <span class="keywordflow">return</span> CV;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;}</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment">/// Given a value comparison instruction,</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment">/// decode all of the &#39;cases&#39; that it represents and return the &#39;default&#39; block.</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *SimplifyCFGOpt::GetValueEqualityComparisonCases(</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TI, std::vector&lt;ValueEqualityComparisonCase&gt; &amp;Cases) {</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;SwitchInst&gt;(TI)) {</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    Cases.reserve(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getNumCases());</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> Case : <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;cases())</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;      Cases.push_back(ValueEqualityComparisonCase(Case.getCaseValue(),</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;                                                  Case.getCaseSuccessor()));</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDefaultDest();</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  }</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160; </div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = cast&lt;BranchInst&gt;(TI);</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *ICI = cast&lt;ICmpInst&gt;(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>());</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(ICI-&gt;<a class="code" href="classllvm_1_1CmpInst.html#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>() == <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP_NE</a>);</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  Cases.push_back(ValueEqualityComparisonCase(</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;      <a class="code" href="SimplifyCFG_8cpp.html#a94ec041c0e8d06efb0bd1998bcedec9f">GetConstantInt</a>(ICI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1), <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>), Succ));</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  <span class="keywordflow">return</span> BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(ICI-&gt;<a class="code" href="classllvm_1_1CmpInst.html#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>() == <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP_EQ</a>);</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;}</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="comment">/// Given a vector of bb/value pairs, remove any entries</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="comment">/// in the list that match the specified block.</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00822"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a38517d96538b847c6c3dbe58965c8053">  822</a></span>&#160;<a class="code" href="SimplifyCFG_8cpp.html#a38517d96538b847c6c3dbe58965c8053">EliminateBlockCases</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>,</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                    std::vector&lt;ValueEqualityComparisonCase&gt; &amp;Cases) {</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  <a class="code" href="namespacellvm.html#aa82bb12b2879425012b3742487e10964">llvm::erase_value</a>(Cases, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;}</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="comment">/// Return true if there are any keys in C1 that exist in C2 as well.</span></div>
<div class="line"><a name="l00828"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#aaba6ba9e89bea12994fa7a7a6ade4d38">  828</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#aaba6ba9e89bea12994fa7a7a6ade4d38">ValuesOverlap</a>(std::vector&lt;ValueEqualityComparisonCase&gt; &amp;<a class="code" href="lib_2Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a>,</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                          std::vector&lt;ValueEqualityComparisonCase&gt; &amp;C2) {</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  std::vector&lt;ValueEqualityComparisonCase&gt; *V1 = &amp;<a class="code" href="lib_2Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a>, *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a> = &amp;C2;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160; </div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  <span class="comment">// Make V1 be smaller than V2.</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  <span class="keywordflow">if</span> (V1-&gt;size() &gt; <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;size())</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(V1, <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>);</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160; </div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  <span class="keywordflow">if</span> (V1-&gt;empty())</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  <span class="keywordflow">if</span> (V1-&gt;size() == 1) {</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="comment">// Just scan V2.</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *TheVal = (*V1)[0].<a class="code" href="classllvm_1_1Value.html#a18dbfcb332af7515599ee795cf462843">Value</a>;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> ValueEqualityComparisonCase &amp;VECC : *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>)</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      <span class="keywordflow">if</span> (TheVal == VECC.<a class="code" href="classllvm_1_1Value.html#a18dbfcb332af7515599ee795cf462843">Value</a>)</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  }</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160; </div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  <span class="comment">// Otherwise, just sort both lists and compare element by element.</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  <a class="code" href="namespacellvm.html#add1eb5637dd671428b6f138ed3db6428">array_pod_sort</a>(V1-&gt;begin(), V1-&gt;end());</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  <a class="code" href="namespacellvm.html#add1eb5637dd671428b6f138ed3db6428">array_pod_sort</a>(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;begin(), <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;end());</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="README__P9_8txt.html#a9679eda65da04e63b0fc49644be06685">i1</a> = 0, i2 = 0, e1 = V1-&gt;size(), e2 = <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;size();</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="README__P9_8txt.html#a9679eda65da04e63b0fc49644be06685">i1</a> != e1 &amp;&amp; i2 != e2) {</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <span class="keywordflow">if</span> ((*V1)[<a class="code" href="README__P9_8txt.html#a9679eda65da04e63b0fc49644be06685">i1</a>].<a class="code" href="classllvm_1_1Value.html">Value</a> == (*<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>)[i2].<a class="code" href="classllvm_1_1Value.html">Value</a>)</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <span class="keywordflow">if</span> ((*V1)[<a class="code" href="README__P9_8txt.html#a9679eda65da04e63b0fc49644be06685">i1</a>].<a class="code" href="classllvm_1_1Value.html">Value</a> &lt; (*<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>)[i2].<a class="code" href="classllvm_1_1Value.html">Value</a>)</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      ++<a class="code" href="README__P9_8txt.html#a9679eda65da04e63b0fc49644be06685">i1</a>;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      ++i2;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  }</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;}</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160; </div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;<span class="comment">// Set branch weights on SwitchInst. This sets the metadata if there is at</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="comment">// least one non-zero weight.</span></div>
<div class="line"><a name="l00863"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a4953dfe289f5d9ad59a7964c4c63c2a9">  863</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="SimplifyCFG_8cpp.html#a4953dfe289f5d9ad59a7964c4c63c2a9">setBranchWeights</a>(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;uint32_t&gt;</a> Weights) {</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  <span class="comment">// Check that there is at least one non-zero weight. Otherwise, pass</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  <span class="comment">// nullptr to setMetadata which will erase the existing metadata.</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  <a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *<a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">llvm::any_of</a>(Weights, [](<a class="code" href="classuint32__t.html">uint32_t</a> <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa05c79fbfc58d9dd2851c467a1ef166bf">W</a>) { <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa05c79fbfc58d9dd2851c467a1ef166bf">W</a> != 0; }))</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = <a class="code" href="classllvm_1_1MDBuilder.html">MDBuilder</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getParent()-&gt;getContext()).<a class="code" href="classllvm_1_1MDBuilder.html#ad910125a9cfd76aaad7f69469df22f66">createBranchWeights</a>(Weights);</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;setMetadata(LLVMContext::MD_prof, <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;}</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160; </div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="comment">// Similar to the above, but for branch and select instructions that take</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="comment">// exactly 2 weights.</span></div>
<div class="line"><a name="l00874"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a159f5c287a6255358445739e61cef6af">  874</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="SimplifyCFG_8cpp.html#a4953dfe289f5d9ad59a7964c4c63c2a9">setBranchWeights</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="classuint32__t.html">uint32_t</a> TrueWeight,</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                             <a class="code" href="classuint32__t.html">uint32_t</a> FalseWeight) {</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isa&lt;BranchInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || isa&lt;SelectInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  <span class="comment">// Check that there is at least one non-zero weight. Otherwise, pass</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  <span class="comment">// nullptr to setMetadata which will erase the existing metadata.</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *<a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="keywordflow">if</span> (TrueWeight || FalseWeight)</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = <a class="code" href="classllvm_1_1MDBuilder.html">MDBuilder</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()-&gt;getContext())</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;            .<a class="code" href="classllvm_1_1MDBuilder.html#ad910125a9cfd76aaad7f69469df22f66">createBranchWeights</a>(TrueWeight, FalseWeight);</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;setMetadata(LLVMContext::MD_prof, <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;}</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="comment">/// If TI is known to be a terminator instruction and its block is known to</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="comment">/// only have a single predecessor block, check to see if that predecessor is</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="comment">/// also a value comparison with the same value, and if that comparison</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="comment">/// determines the outcome of this comparison. If so, simplify TI. This does a</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="comment">/// very limited form of jump threading.</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> SimplifyCFGOpt::SimplifyEqualityComparisonWithOnlyPredecessor(</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TI, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>) {</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *PredVal = isValueEqualityComparison(Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>());</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  <span class="keywordflow">if</span> (!PredVal)</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Not a value comparison in predecessor.</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160; </div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ThisVal = isValueEqualityComparison(TI);</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ThisVal &amp;&amp; <span class="stringliteral">&quot;This isn&#39;t a value comparison!!&quot;</span>);</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  <span class="keywordflow">if</span> (ThisVal != PredVal)</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Different predicates.</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160; </div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <span class="comment">// TODO: Preserve branch weight metadata, similarly to how</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  <span class="comment">// FoldValueComparisonIntoPredecessors preserves it.</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160; </div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  <span class="comment">// Find out information about when control will move from Pred to TI&#39;s block.</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  std::vector&lt;ValueEqualityComparisonCase&gt; PredCases;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PredDef =</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      GetValueEqualityComparisonCases(Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>(), PredCases);</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  <a class="code" href="SimplifyCFG_8cpp.html#a38517d96538b847c6c3dbe58965c8053">EliminateBlockCases</a>(PredDef, PredCases); <span class="comment">// Remove default from cases.</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160; </div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  <span class="comment">// Find information about how control leaves this block.</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  std::vector&lt;ValueEqualityComparisonCase&gt; ThisCases;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *ThisDef = GetValueEqualityComparisonCases(TI, ThisCases);</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  <a class="code" href="SimplifyCFG_8cpp.html#a38517d96538b847c6c3dbe58965c8053">EliminateBlockCases</a>(ThisDef, ThisCases); <span class="comment">// Remove default from cases.</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160; </div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <span class="comment">// If TI&#39;s block is the default block from Pred&#39;s comparison, potentially</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  <span class="comment">// simplify TI based on this knowledge.</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  <span class="keywordflow">if</span> (PredDef == TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()) {</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <span class="comment">// If we are here, we know that the value is none of those cases listed in</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    <span class="comment">// PredCases.  If there are any cases in ThisCases that are in PredCases, we</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    <span class="comment">// can simplify TI.</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#aaba6ba9e89bea12994fa7a7a6ade4d38">ValuesOverlap</a>(PredCases, ThisCases))</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160; </div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    <span class="keywordflow">if</span> (isa&lt;BranchInst&gt;(TI)) {</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      <span class="comment">// Okay, one of the successors of this condbr is dead.  Convert it to a</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      <span class="comment">// uncond br.</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ThisCases.size() == 1 &amp;&amp; <span class="stringliteral">&quot;Branch can only have one case!&quot;</span>);</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;      <span class="comment">// Insert the new branch.</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NI = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBr(ThisDef);</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      (void)NI;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160; </div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      <span class="comment">// Remove PHI node entries for the dead edge.</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;      ThisCases[0].Dest-&gt;removePredecessor(PredDef);</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160; </div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Threading pred instr: &quot;</span> &lt;&lt; *Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>()</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;Through successor TI: &quot;</span> &lt;&lt; *TI &lt;&lt; <span class="stringliteral">&quot;Leaving: &quot;</span> &lt;&lt; *NI</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160; </div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;      <a class="code" href="SimplifyCFG_8cpp.html#aa4641512b28a6e42a40bda7576fe43cb">EraseTerminatorAndDCECond</a>(TI);</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160; </div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;      <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        DTU-&gt;applyUpdates(</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;            {{<a class="code" href="classllvm_1_1DominatorTreeBase.html#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, PredDef, ThisCases[0].Dest}});</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160; </div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    }</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160; </div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <a class="code" href="classllvm_1_1SwitchInstProfUpdateWrapper.html">SwitchInstProfUpdateWrapper</a> <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = *cast&lt;SwitchInst&gt;(TI);</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    <span class="comment">// Okay, TI has cases that are statically dead, prune them away.</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Constant *, 16&gt;</a> DeadCases;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = PredCases.size(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;      DeadCases.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(PredCases[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="classllvm_1_1Value.html">Value</a>);</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160; </div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Threading pred instr: &quot;</span> &lt;&lt; *Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>()</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;Through successor TI: &quot;</span> &lt;&lt; *TI);</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160; </div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;BasicBlock *, int, 8&gt;</a> NumPerSuccessorCases;</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SwitchInst_1_1CaseIteratorImpl.html">SwitchInst::CaseIt</a> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;case_end(), <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;case_begin(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>;) {</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      --<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a> = <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>-&gt;getCaseSuccessor();</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;      <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        ++NumPerSuccessorCases[<a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a>];</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;      <span class="keywordflow">if</span> (DeadCases.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>-&gt;getCaseValue())) {</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a>-&gt;removePredecessor(PredDef);</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;        <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>.removeCase(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;          --NumPerSuccessorCases[<a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a>];</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;      }</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    }</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160; </div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="keywordflow">if</span> (DTU) {</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      std::vector&lt;DominatorTree::UpdateType&gt; Updates;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> std::pair&lt;BasicBlock *, int&gt; &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : NumPerSuccessorCases)</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.second == 0)</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;          Updates.push_back({<a class="code" href="classllvm_1_1DominatorTreeBase.html#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, PredDef, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.first});</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;      DTU-&gt;applyUpdates(Updates);</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    }</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160; </div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Leaving: &quot;</span> &lt;&lt; *TI &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  }</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160; </div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <span class="comment">// Otherwise, TI&#39;s block must correspond to some matched value.  Find out</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="comment">// which value (or set of values) this is.</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *TIV = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *TIBB = TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = PredCases.size(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="keywordflow">if</span> (PredCases[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Dest == TIBB) {</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;      <span class="keywordflow">if</span> (TIV)</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Cannot handle multiple values coming to this block.</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;      TIV = PredCases[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="classllvm_1_1Value.html#a18dbfcb332af7515599ee795cf462843">Value</a>;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    }</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TIV &amp;&amp; <span class="stringliteral">&quot;No edge from pred to succ?&quot;</span>);</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160; </div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  <span class="comment">// Okay, we found the one constant that our value can be if we get into TI&#39;s</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="comment">// BB.  Find out which successor will unconditionally be branched to.</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *TheRealDest = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = ThisCases.size(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="keywordflow">if</span> (ThisCases[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="classllvm_1_1Value.html">Value</a> == TIV) {</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      TheRealDest = ThisCases[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Dest;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    }</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160; </div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  <span class="comment">// If not handled by any explicit cases, it is handled by the default case.</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <span class="keywordflow">if</span> (!TheRealDest)</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    TheRealDest = ThisDef;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160; </div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BasicBlock *, 2&gt;</a> RemovedSuccs;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160; </div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <span class="comment">// Remove PHI node entries for dead edges.</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *CheckEdge = TheRealDest;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ : <a class="code" href="namespacellvm.html#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(TIBB))</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <span class="keywordflow">if</span> (Succ != CheckEdge) {</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;      <span class="keywordflow">if</span> (Succ != TheRealDest)</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        RemovedSuccs.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(Succ);</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;      Succ-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(TIBB);</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    } <span class="keywordflow">else</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      CheckEdge = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160; </div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;  <span class="comment">// Insert the new branch.</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NI = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBr(TheRealDest);</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  (void)NI;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160; </div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Threading pred instr: &quot;</span> &lt;&lt; *Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>()</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;Through successor TI: &quot;</span> &lt;&lt; *TI &lt;&lt; <span class="stringliteral">&quot;Leaving: &quot;</span> &lt;&lt; *NI</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160; </div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;  <a class="code" href="SimplifyCFG_8cpp.html#aa4641512b28a6e42a40bda7576fe43cb">EraseTerminatorAndDCECond</a>(TI);</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <span class="keywordflow">if</span> (DTU) {</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;DominatorTree::UpdateType, 2&gt;</a> Updates;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    Updates.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(RemovedSuccs.<a class="code" href="classllvm_1_1SmallPtrSetImplBase.html#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>());</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *RemovedSucc : RemovedSuccs)</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;      Updates.push_back({<a class="code" href="classllvm_1_1DominatorTreeBase.html#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, TIBB, RemovedSucc});</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    DTU-&gt;applyUpdates(Updates);</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  }</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;}</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160; </div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="comment">/// This class implements a stable ordering of constant</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="comment">/// integers that does not depend on their address.  This is important for</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="comment">/// applications that sort ConstantInt&#39;s to ensure uniqueness.</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="comment"></span><span class="keyword">struct </span>ConstantIntOrdering {</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  <span class="keywordtype">bool</span> operator()(<span class="keyword">const</span> <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;getValue().ult(<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getValue());</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  }</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;};</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160; </div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160; </div>
<div class="line"><a name="l01053"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a8a7f7d7aa56a6449ae814f48b6a8ce6f"> 1053</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="SimplifyCFG_8cpp.html#a8a7f7d7aa56a6449ae814f48b6a8ce6f">ConstantIntSortPredicate</a>(<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<span class="keyword">const</span> *P1,</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                                    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<span class="keyword">const</span> *<a class="code" href="README-SSE_8txt.html#ae7fc2fb0e2d536219c1193f1a178e7db">P2</a>) {</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = *P1;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = *<a class="code" href="README-SSE_8txt.html#ae7fc2fb0e2d536219c1193f1a178e7db">P2</a>;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> == <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>)</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;getValue().ult(<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getValue()) ? 1 : -1;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;}</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="comment">/// Get Weights of a given terminator, the default weight is at the front</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment">/// of the vector. If TI is a conditional eq, we need to swap the branch-weight</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment">/// metadata.</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a23f9dbda493b589bf024813b2c7e8c41"> 1065</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="SimplifyCFG_8cpp.html#a23f9dbda493b589bf024813b2c7e8c41">GetBranchWeights</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TI,</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;                             <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;uint64_t&gt;</a> &amp;Weights) {</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;  <a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *MD = TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae22f493ba8327ce92e87d3b96bce7017">getMetadata</a>(LLVMContext::MD_prof);</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MD);</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = MD-&gt;<a class="code" href="classllvm_1_1MDNode.html#aa4068e37ec583962685e3567dc102ae5">getNumOperands</a>(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CI = mdconst::extract&lt;ConstantInt&gt;(MD-&gt;<a class="code" href="classllvm_1_1MDNode.html#a6cbc0453586a25c057a32161b38b8ce4">getOperand</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    Weights.push_back(CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#a217e0207d9cc8e046c2dccbf0e4bb198">getZExtValue</a>());</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  }</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160; </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  <span class="comment">// If TI is a conditional eq, the default case is the false case,</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  <span class="comment">// and the corresponding branch-weight data is at index 2. We swap the</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  <span class="comment">// default weight to be the first entry.</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = dyn_cast&lt;BranchInst&gt;(TI)) {</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Weights.size() == 2);</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *ICI = cast&lt;ICmpInst&gt;(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>());</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="keywordflow">if</span> (ICI-&gt;<a class="code" href="classllvm_1_1CmpInst.html#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>() == <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP_EQ</a>)</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;      <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(Weights.front(), Weights.back());</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;  }</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;}</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="comment">/// Keep halving the weights until all can fit in uint32_t.</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a95ec32778f2bb913dc4cc45ac7a66e42"> 1086</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="SimplifyCFG_8cpp.html#a95ec32778f2bb913dc4cc45ac7a66e42">FitWeights</a>(<a class="code" href="classllvm_1_1MutableArrayRef.html">MutableArrayRef&lt;uint64_t&gt;</a> Weights) {</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Max = *std::max_element(Weights.<a class="code" href="classllvm_1_1MutableArrayRef.html#aae2bf8b46988a2fc0589e95903930c19">begin</a>(), Weights.<a class="code" href="classllvm_1_1MutableArrayRef.html#a9d959094f4544749c129c46034cbed67">end</a>());</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;  <span class="keywordflow">if</span> (Max &gt; UINT_MAX) {</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="keywordtype">unsigned</span> Offset = 32 - <a class="code" href="namespacellvm.html#a66191f0bcc8c62b784819e9e96ceeba2">llvm::countl_zero</a>(Max);</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Weights)</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &gt;&gt;= Offset;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  }</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;}</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160; </div>
<div class="line"><a name="l01095"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a1a4df60f6ee2e2103d1d4e2752d5192d"> 1095</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="SimplifyCFG_8cpp.html#a1a4df60f6ee2e2103d1d4e2752d5192d">CloneInstructionsIntoPredecessorBlockAndUpdateSSAUses</a>(</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PredBlock, <a class="code" href="classllvm_1_1ValueMap.html">ValueToValueMapTy</a> &amp;VMap) {</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *PTI = PredBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>();</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160; </div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  <span class="comment">// If we have bonus instructions, clone them into the predecessor block.</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  <span class="comment">// Note that there may be multiple predecessor blocks, so we cannot move</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  <span class="comment">// bonus instructions to a predecessor block.</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;BonusInst : *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <span class="keywordflow">if</span> (isa&lt;DbgInfoIntrinsic&gt;(BonusInst) || BonusInst.isTerminator())</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160; </div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NewBonusInst = BonusInst.<a class="code" href="classllvm_1_1Instruction.html#a0a4d51e372293abe5e5f6dac133e80a6">clone</a>();</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160; </div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="keywordflow">if</span> (PTI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4f3bf98b5054831b608852e33427814">getDebugLoc</a>() != NewBonusInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4f3bf98b5054831b608852e33427814">getDebugLoc</a>()) {</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      <span class="comment">// Unless the instruction has the same !dbg location as the original</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      <span class="comment">// branch, drop it. When we fold the bonus instructions we want to make</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      <span class="comment">// sure we reset their debug locations in order to avoid stepping on</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      <span class="comment">// dead code caused by folding dead branches.</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      NewBonusInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a>());</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    }</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160; </div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    <a class="code" href="namespacellvm.html#a8f2893ab869a806d78af17691eb97be3">RemapInstruction</a>(NewBonusInst, VMap,</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;                     <a class="code" href="namespacellvm.html#a77724415203930efd07d7098cb1e437da9a24bd8dba1bef2753bc3f087435ae7f">RF_NoModuleLevelChanges</a> | <a class="code" href="namespacellvm.html#a77724415203930efd07d7098cb1e437da5633028bc27ffa8eab39cc5de65b3108">RF_IgnoreMissingLocals</a>);</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    VMap[&amp;BonusInst] = NewBonusInst;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160; </div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <span class="comment">// If we moved a load, we cannot any longer claim any knowledge about</span></div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <span class="comment">// its potential value. The previous information might have been valid</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <span class="comment">// only given the branch precondition.</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <span class="comment">// For an analogous reason, we must also drop all the metadata whose</span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <span class="comment">// semantics we don&#39;t understand. We *can* preserve !annotation, because</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <span class="comment">// it is tied to the instruction itself, not the value or position.</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    <span class="comment">// Similarly strip attributes on call parameters that may cause UB in</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="comment">// location the call is moved to.</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    NewBonusInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#af5e7905012a683fe2ec8c51c2cd26ca9">dropUndefImplyingAttrsAndUnknownMetadata</a>(</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;        LLVMContext::MD_annotation);</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160; </div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    NewBonusInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#ad8c5093a18a40f863d4fc5fa6eefefa8">insertInto</a>(PredBlock, PTI-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>());</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    NewBonusInst-&gt;<a class="code" href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(&amp;BonusInst);</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    BonusInst.setName(NewBonusInst-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + <span class="stringliteral">&quot;.old&quot;</span>);</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160; </div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="comment">// Update (liveout) uses of bonus instructions,</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <span class="comment">// now that the bonus instruction has been cloned into predecessor.</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <span class="comment">// Note that we expect to be in a block-closed SSA form for this to work!</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U : <a class="code" href="namespacellvm.html#a8154638df88e4eaa568b67b23d463dac">make_early_inc_range</a>(BonusInst.uses())) {</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;      <span class="keyword">auto</span> *UI = cast&lt;Instruction&gt;(U.getUser());</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;      <span class="keyword">auto</span> *PN = dyn_cast&lt;PHINode&gt;(UI);</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;      <span class="keywordflow">if</span> (!PN) {</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(UI-&gt;getParent() == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> &amp;&amp; BonusInst.comesBefore(UI) &amp;&amp;</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;               <span class="stringliteral">&quot;If the user is not a PHI node, then it should be in the same &quot;</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;               <span class="stringliteral">&quot;block as, and come after, the original bonus instruction.&quot;</span>);</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;        <span class="keywordflow">continue</span>; <span class="comment">// Keep using the original bonus instruction.</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      }</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      <span class="comment">// Is this the block-closed SSA form PHI node?</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;      <span class="keywordflow">if</span> (PN-&gt;getIncomingBlock(U) == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        <span class="keywordflow">continue</span>; <span class="comment">// Great, keep using the original bonus instruction.</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;      <span class="comment">// The only other alternative is an &quot;use&quot; when coming from</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;      <span class="comment">// the predecessor block - here we should refer to the cloned bonus instr.</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PN-&gt;getIncomingBlock(U) == PredBlock &amp;&amp;</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;             <span class="stringliteral">&quot;Not in block-closed SSA form?&quot;</span>);</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;      U.set(NewBonusInst);</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    }</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  }</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;}</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160; </div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;<span class="keywordtype">bool</span> SimplifyCFGOpt::PerformValueComparisonIntoPredecessorFolding(</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TI, <a class="code" href="classllvm_1_1Value.html">Value</a> *&amp;CV, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *PTI, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>) {</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred = PTI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160; </div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;DominatorTree::UpdateType, 32&gt;</a> Updates;</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160; </div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  <span class="comment">// Figure out which &#39;cases&#39; to copy from SI to PSI.</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  std::vector&lt;ValueEqualityComparisonCase&gt; BBCases;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BBDefault = GetValueEqualityComparisonCases(TI, BBCases);</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160; </div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  std::vector&lt;ValueEqualityComparisonCase&gt; PredCases;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PredDefault = GetValueEqualityComparisonCases(PTI, PredCases);</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160; </div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  <span class="comment">// Based on whether the default edge from PTI goes to BB or not, fill in</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  <span class="comment">// PredCases and PredDefault with the new switch cases we would like to</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;  <span class="comment">// build.</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;  <a class="code" href="structllvm_1_1SmallMapVector.html">SmallMapVector&lt;BasicBlock *, int, 8&gt;</a> NewSuccessors;</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160; </div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  <span class="comment">// Update the branch weight metadata along the way</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint64_t, 8&gt;</a> Weights;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  <span class="keywordtype">bool</span> PredHasWeights = <a class="code" href="namespacellvm.html#add2fce2ce0e32b20e41b0aa9f8ca70c2">hasBranchWeightMD</a>(*PTI);</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  <span class="keywordtype">bool</span> SuccHasWeights = <a class="code" href="namespacellvm.html#add2fce2ce0e32b20e41b0aa9f8ca70c2">hasBranchWeightMD</a>(*TI);</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160; </div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;  <span class="keywordflow">if</span> (PredHasWeights) {</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#a23f9dbda493b589bf024813b2c7e8c41">GetBranchWeights</a>(PTI, Weights);</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="comment">// branch-weight metadata is inconsistent here.</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <span class="keywordflow">if</span> (Weights.size() != 1 + PredCases.size())</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;      PredHasWeights = SuccHasWeights = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SuccHasWeights)</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="comment">// If there are no predecessor weights but there are successor weights,</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <span class="comment">// populate Weights with 1, which will later be scaled to the sum of</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    <span class="comment">// successor&#39;s weights</span></div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    Weights.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a38c50aa8e3e9588f4f968c2e03a0cee0">assign</a>(1 + PredCases.size(), 1);</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160; </div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint64_t, 8&gt;</a> SuccWeights;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  <span class="keywordflow">if</span> (SuccHasWeights) {</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#a23f9dbda493b589bf024813b2c7e8c41">GetBranchWeights</a>(TI, SuccWeights);</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    <span class="comment">// branch-weight metadata is inconsistent here.</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <span class="keywordflow">if</span> (SuccWeights.size() != 1 + BBCases.size())</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;      PredHasWeights = SuccHasWeights = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PredHasWeights)</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    SuccWeights.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a38c50aa8e3e9588f4f968c2e03a0cee0">assign</a>(1 + BBCases.size(), 1);</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160; </div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;  <span class="keywordflow">if</span> (PredDefault == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    <span class="comment">// If this is the default destination from PTI, only the edges in TI</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    <span class="comment">// that don&#39;t occur in PTI, or that branch to BB will be activated.</span></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    std::set&lt;ConstantInt *, ConstantIntOrdering&gt; PTIHandled;</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = PredCases.size(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;      <span class="keywordflow">if</span> (PredCases[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Dest != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;        PTIHandled.insert(PredCases[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="classllvm_1_1Value.html">Value</a>);</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;        <span class="comment">// The default destination is BB, we don&#39;t need explicit targets.</span></div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(PredCases[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>], PredCases.back());</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160; </div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;        <span class="keywordflow">if</span> (PredHasWeights || SuccHasWeights) {</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;          <span class="comment">// Increase weight for the default case.</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;          Weights[0] += Weights[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1];</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;          <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(Weights[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1], Weights.back());</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;          Weights.pop_back();</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;        }</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160; </div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;        PredCases.pop_back();</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;        --<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;        --<a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>;</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;      }</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160; </div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    <span class="comment">// Reconstruct the new switch statement we will be building.</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <span class="keywordflow">if</span> (PredDefault != BBDefault) {</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;      PredDefault-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(Pred);</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;      <span class="keywordflow">if</span> (DTU &amp;&amp; PredDefault != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;        Updates.push_back({<a class="code" href="classllvm_1_1DominatorTreeBase.html#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, Pred, PredDefault});</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;      PredDefault = BBDefault;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;      ++NewSuccessors[BBDefault];</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    }</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160; </div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    <span class="keywordtype">unsigned</span> CasesFromPred = Weights.size();</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> ValidTotalSuccWeight = 0;</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = BBCases.size(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;      <span class="keywordflow">if</span> (!PTIHandled.count(BBCases[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Value) &amp;&amp; BBCases[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Dest != BBDefault) {</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;        PredCases.push_back(BBCases[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        ++NewSuccessors[BBCases[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Dest];</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;        <span class="keywordflow">if</span> (SuccHasWeights || PredHasWeights) {</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;          <span class="comment">// The default weight is at index 0, so weight for the ith case</span></div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;          <span class="comment">// should be at index i+1. Scale the cases from successor by</span></div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;          <span class="comment">// PredDefaultWeight (Weights[0]).</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;          Weights.push_back(Weights[0] * SuccWeights[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1]);</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;          ValidTotalSuccWeight += SuccWeights[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1];</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;        }</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;      }</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160; </div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    <span class="keywordflow">if</span> (SuccHasWeights || PredHasWeights) {</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;      ValidTotalSuccWeight += SuccWeights[0];</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;      <span class="comment">// Scale the cases from predecessor by ValidTotalSuccWeight.</span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; CasesFromPred; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;        Weights[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] *= ValidTotalSuccWeight;</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;      <span class="comment">// Scale the default weight by SuccDefaultWeight (SuccWeights[0]).</span></div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;      Weights[0] *= SuccWeights[0];</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    }</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    <span class="comment">// If this is not the default destination from PSI, only the edges</span></div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    <span class="comment">// in SI that occur in PSI with a destination of BB will be</span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    <span class="comment">// activated.</span></div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    std::set&lt;ConstantInt *, ConstantIntOrdering&gt; PTIHandled;</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    std::map&lt;ConstantInt *, uint64_t&gt; WeightsForHandled;</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = PredCases.size(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;      <span class="keywordflow">if</span> (PredCases[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Dest == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;        PTIHandled.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a94d23373106467003722f7d6c17b1528">insert</a>(PredCases[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="classllvm_1_1Value.html">Value</a>);</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160; </div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;        <span class="keywordflow">if</span> (PredHasWeights || SuccHasWeights) {</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;          WeightsForHandled[PredCases[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Value] = Weights[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1];</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;          <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(Weights[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1], Weights.back());</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;          Weights.pop_back();</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;        }</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160; </div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;        <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(PredCases[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>], PredCases.back());</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;        PredCases.pop_back();</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;        --<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;        --<a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>;</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;      }</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160; </div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    <span class="comment">// Okay, now we know which constants were sent to BB from the</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    <span class="comment">// predecessor.  Figure out where they will all go now.</span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = BBCases.size(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;      <span class="keywordflow">if</span> (PTIHandled.count(BBCases[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Value)) {</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;        <span class="comment">// If this is one we are capable of getting...</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;        <span class="keywordflow">if</span> (PredHasWeights || SuccHasWeights)</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;          Weights.push_back(WeightsForHandled[BBCases[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="classllvm_1_1Value.html">Value</a>]);</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;        PredCases.push_back(BBCases[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;        ++NewSuccessors[BBCases[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Dest];</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;        PTIHandled.<a class="code" href="classllvm_1_1MapVector.html#a3a8171298a7d19a309d599de01906703">erase</a>(BBCases[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="classllvm_1_1Value.html">Value</a>); <span class="comment">// This constant is taken care of</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;      }</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160; </div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    <span class="comment">// If there are any constants vectored to BB that TI doesn&#39;t handle,</span></div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <span class="comment">// they must go to the default destination of TI.</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : PTIHandled) {</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;      <span class="keywordflow">if</span> (PredHasWeights || SuccHasWeights)</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;        Weights.push_back(WeightsForHandled[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]);</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;      PredCases.push_back(ValueEqualityComparisonCase(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, BBDefault));</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;      ++NewSuccessors[BBDefault];</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    }</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;  }</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160; </div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;  <span class="comment">// Okay, at this point, we know which new successor Pred will get.  Make</span></div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;  <span class="comment">// sure we update the number of entries in the PHI nodes for these</span></div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;  <span class="comment">// successors.</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BasicBlock *, 2&gt;</a> SuccsOfPred;</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;  <span class="keywordflow">if</span> (DTU) {</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    SuccsOfPred = {<a class="code" href="namespacellvm.html#a3720211f6e6389ab53734b989bfb6fce">succ_begin</a>(Pred), <a class="code" href="namespacellvm.html#a069c4ae2290101bde0f8d6a5074dc72b">succ_end</a>(Pred)};</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    Updates.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(Updates.size() + NewSuccessors.<a class="code" href="classllvm_1_1MapVector.html#acf4c09e1f30cdd4e0b5b1b8a236ead34">size</a>());</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;  }</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> std::pair&lt;BasicBlock *, int /*Num*/&gt; &amp;NewSuccessor :</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;       NewSuccessors) {</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="namespacellvm.html#adc4eb8be6f7a12ede962987fb9cabb47">seq</a>(0, NewSuccessor.second)) {</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;      (void)<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;      <a class="code" href="SimplifyCFG_8cpp.html#a41a075ef4b76f72591e86e1fe13f096d">AddPredecessorToBlock</a>(NewSuccessor.first, Pred, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    }</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    <span class="keywordflow">if</span> (DTU &amp;&amp; !SuccsOfPred.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#af74676a3c7447be34bd2c1da76ec0c48">contains</a>(NewSuccessor.first))</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;      Updates.push_back({<a class="code" href="classllvm_1_1DominatorTreeBase.html#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, Pred, NewSuccessor.first});</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  }</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160; </div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(PTI);</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;  <span class="comment">// Convert pointer to int before we switch.</span></div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;  <span class="keywordflow">if</span> (CV-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>()) {</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    CV =</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePtrToInt(CV, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIntPtrType(CV-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()), <span class="stringliteral">&quot;magicptr&quot;</span>);</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;  }</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160; </div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  <span class="comment">// Now that the successors are updated, create the new Switch instruction.</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;  <a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *NewSI = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSwitch(CV, PredDefault, PredCases.size());</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;  NewSI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(PTI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4f3bf98b5054831b608852e33427814">getDebugLoc</a>());</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;  <span class="keywordflow">for</span> (ValueEqualityComparisonCase &amp;V : PredCases)</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    NewSI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a62abc2475d09c01d583ba24a487898fd">addCase</a>(V.<a class="code" href="classllvm_1_1Value.html#a18dbfcb332af7515599ee795cf462843">Value</a>, V.Dest);</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160; </div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;  <span class="keywordflow">if</span> (PredHasWeights || SuccHasWeights) {</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    <span class="comment">// Halve the weights if any of them cannot fit in an uint32_t</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#a95ec32778f2bb913dc4cc45ac7a66e42">FitWeights</a>(Weights);</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160; </div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint32_t, 8&gt;</a> MDWeights(Weights.begin(), Weights.end());</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160; </div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#a4953dfe289f5d9ad59a7964c4c63c2a9">setBranchWeights</a>(NewSI, MDWeights);</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;  }</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160; </div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;  <a class="code" href="SimplifyCFG_8cpp.html#aa4641512b28a6e42a40bda7576fe43cb">EraseTerminatorAndDCECond</a>(PTI);</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160; </div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;  <span class="comment">// Okay, last check.  If BB is still a successor of PSI, then we must</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  <span class="comment">// have an infinite loop case.  If so, add an infinitely looping block</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;  <span class="comment">// to handle the case to preserve the behavior of the code.</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *InfLoopBlock = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = NewSI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a90d8c814f871c58dbda5dccce5c4110e">getNumSuccessors</a>(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    <span class="keywordflow">if</span> (NewSI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a7e4fa2ce7bf583ac03ea538642067fe9">getSuccessor</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;      <span class="keywordflow">if</span> (!InfLoopBlock) {</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;        <span class="comment">// Insert it at the end of the function, because it&#39;s either code,</span></div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        <span class="comment">// or it won&#39;t matter if it&#39;s hot. :)</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        InfLoopBlock =</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;            <a class="code" href="classllvm_1_1BasicBlock.html#ace940beeee97c222f836fe0ac70f6cf5">BasicBlock::Create</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getContext(), <span class="stringliteral">&quot;infloop&quot;</span>, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getParent());</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;        <a class="code" href="classllvm_1_1BranchInst.html#a38df51256d4b415b6a817b5e1c6d4d36">BranchInst::Create</a>(InfLoopBlock, InfLoopBlock);</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;        <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;          Updates.push_back(</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;              {<a class="code" href="classllvm_1_1DominatorTreeBase.html#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, InfLoopBlock, InfLoopBlock});</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;      }</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;      NewSI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a7fc7899c254935205ca29b6bd7baa926">setSuccessor</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>, InfLoopBlock);</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    }</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160; </div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  <span class="keywordflow">if</span> (DTU) {</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    <span class="keywordflow">if</span> (InfLoopBlock)</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;      Updates.push_back({<a class="code" href="classllvm_1_1DominatorTreeBase.html#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, Pred, InfLoopBlock});</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160; </div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    Updates.push_back({<a class="code" href="classllvm_1_1DominatorTreeBase.html#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, Pred, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>});</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160; </div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    DTU-&gt;applyUpdates(Updates);</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;  }</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160; </div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;  ++NumFoldValueComparisonIntoPredecessors;</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;}</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;<span class="comment">/// The specified terminator is a value equality comparison instruction</span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="comment">/// (either a switch or a branch on &quot;X == c&quot;).</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;<span class="comment">/// See if any of the predecessors of the terminator block are value comparisons</span></div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;<span class="comment">/// on the same value.  If so, and if safe to do so, fold them together.</span></div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> SimplifyCFGOpt::FoldValueComparisonIntoPredecessors(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TI,</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;                                                         <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>) {</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *CV = isValueEqualityComparison(TI); <span class="comment">// CondVal</span></div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CV &amp;&amp; <span class="stringliteral">&quot;Not a comparison?&quot;</span>);</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160; </div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160; </div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;  <a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;BasicBlock *, 16&gt;</a> Preds(<a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>), <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>));</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;  <span class="keywordflow">while</span> (!Preds.empty()) {</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred = Preds.pop_back_val();</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *PTI = Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>();</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160; </div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    <span class="comment">// Don&#39;t try to fold into itself.</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    <span class="keywordflow">if</span> (Pred == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160; </div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    <span class="comment">// See if the predecessor is a comparison with the same value.</span></div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *PCV = isValueEqualityComparison(PTI); <span class="comment">// PredCondVal</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    <span class="keywordflow">if</span> (PCV != CV)</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160; </div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    <a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;BasicBlock *, 4&gt;</a> FailBlocks;</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#a176b027b36f2084a7d30439522a86b79">SafeToMergeTerminators</a>(TI, PTI, &amp;FailBlocks)) {</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Succ : FailBlocks) {</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a9d391b6acc6d90c9b8a8442324b1aa6f">SplitBlockPredecessors</a>(Succ, TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>(), <span class="stringliteral">&quot;.fold.split&quot;</span>, DTU))</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;      }</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    }</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160; </div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    PerformValueComparisonIntoPredecessorFolding(TI, CV, PTI, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;  }</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;}</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160; </div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;<span class="comment">// If we would need to insert a select that uses the value of this invoke</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;<span class="comment">// (comments in HoistThenElseCodeToIf explain why we would need to do this), we</span></div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="comment">// can&#39;t hoist the invoke, as there is nowhere to put the select in this case.</span></div>
<div class="line"><a name="l01419"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a3aaba0277f5dd5636e099fa81c20c533"> 1419</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a3aaba0277f5dd5636e099fa81c20c533">isSafeToHoistInvoke</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB1, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB2,</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;                                <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I1, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I2) {</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ : <a class="code" href="namespacellvm.html#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB1)) {</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> &amp;PN : Succ-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a72516971c5734dc0f7546e64affca425">phis</a>()) {</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *BB1V = PN.getIncomingValueForBlock(BB1);</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *BB2V = PN.getIncomingValueForBlock(BB2);</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;      <span class="keywordflow">if</span> (BB1V != BB2V &amp;&amp; (BB1V == I1 || BB2V == I2)) {</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;      }</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    }</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;  }</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;}</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160; </div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="comment">// Get interesting characteristics of instructions that `HoistThenElseCodeToIf`</span></div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="comment">// didn&#39;t hoist. They restrict what kind of instructions can be reordered</span></div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="comment">// across.</span></div>
<div class="line"><a name="l01436"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a72d0db08ead54facf3e1e90aaae435ba"> 1436</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="SimplifyCFG_8cpp.html#a72d0db08ead54facf3e1e90aaae435ba">SkipFlags</a> {</div>
<div class="line"><a name="l01437"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a72d0db08ead54facf3e1e90aaae435baa45adf13243e382f733c98877e11c1e92"> 1437</a></span>&#160;  <a class="code" href="SimplifyCFG_8cpp.html#a72d0db08ead54facf3e1e90aaae435baa45adf13243e382f733c98877e11c1e92">SkipReadMem</a> = 1,</div>
<div class="line"><a name="l01438"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a72d0db08ead54facf3e1e90aaae435baa9b3138aebe4b75a1d2cf58ca3b2aaa9e"> 1438</a></span>&#160;  <a class="code" href="SimplifyCFG_8cpp.html#a72d0db08ead54facf3e1e90aaae435baa9b3138aebe4b75a1d2cf58ca3b2aaa9e">SkipSideEffect</a> = 2,</div>
<div class="line"><a name="l01439"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a72d0db08ead54facf3e1e90aaae435baae768be164a586335f583dbafeecc1ea7"> 1439</a></span>&#160;  <a class="code" href="SimplifyCFG_8cpp.html#a72d0db08ead54facf3e1e90aaae435baae768be164a586335f583dbafeecc1ea7">SkipImplicitControlFlow</a> = 4</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;};</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160; </div>
<div class="line"><a name="l01442"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#aa67a8bc0841ad57e26ed447bb99ea15d"> 1442</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code" href="SimplifyCFG_8cpp.html#aa67a8bc0841ad57e26ed447bb99ea15d">skippedInstrFlags</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;  <span class="keywordtype">unsigned</span> Flags = 0;</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayReadFromMemory())</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;    Flags |= <a class="code" href="SimplifyCFG_8cpp.html#a72d0db08ead54facf3e1e90aaae435baa45adf13243e382f733c98877e11c1e92">SkipReadMem</a>;</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  <span class="comment">// We can&#39;t arbitrarily move around allocas, e.g. moving allocas (especially</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  <span class="comment">// inalloca) across stacksave/stackrestore boundaries.</span></div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayHaveSideEffects() || isa&lt;AllocaInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    Flags |= <a class="code" href="SimplifyCFG_8cpp.html#a72d0db08ead54facf3e1e90aaae435baa9b3138aebe4b75a1d2cf58ca3b2aaa9e">SkipSideEffect</a>;</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#abff5a423c1f45e23958dde8ee695c9a9">isGuaranteedToTransferExecutionToSuccessor</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    Flags |= <a class="code" href="SimplifyCFG_8cpp.html#a72d0db08ead54facf3e1e90aaae435baae768be164a586335f583dbafeecc1ea7">SkipImplicitControlFlow</a>;</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;  <span class="keywordflow">return</span> Flags;</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;}</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160; </div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="comment">// Returns true if it is safe to reorder an instruction across preceding</span></div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;<span class="comment">// instructions in a basic block.</span></div>
<div class="line"><a name="l01457"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a396eac919c9ac7907275e770a8cd37cf"> 1457</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a396eac919c9ac7907275e770a8cd37cf">isSafeToHoistInstr</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="keywordtype">unsigned</span> Flags) {</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;  <span class="comment">// Don&#39;t reorder a store over a load.</span></div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;  <span class="keywordflow">if</span> ((Flags &amp; <a class="code" href="SimplifyCFG_8cpp.html#a72d0db08ead54facf3e1e90aaae435baa45adf13243e382f733c98877e11c1e92">SkipReadMem</a>) &amp;&amp; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayWriteToMemory())</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160; </div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;  <span class="comment">// If we have seen an instruction with side effects, it&#39;s unsafe to reorder an</span></div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;  <span class="comment">// instruction which reads memory or itself has side effects.</span></div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;  <span class="keywordflow">if</span> ((Flags &amp; <a class="code" href="SimplifyCFG_8cpp.html#a72d0db08ead54facf3e1e90aaae435baa9b3138aebe4b75a1d2cf58ca3b2aaa9e">SkipSideEffect</a>) &amp;&amp;</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;      (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayReadFromMemory() || <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayHaveSideEffects()))</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160; </div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;  <span class="comment">// Reordering across an instruction which does not necessarily transfer</span></div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;  <span class="comment">// control to the next instruction is speculation.</span></div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;  <span class="keywordflow">if</span> ((Flags &amp; <a class="code" href="SimplifyCFG_8cpp.html#a72d0db08ead54facf3e1e90aaae435baae768be164a586335f583dbafeecc1ea7">SkipImplicitControlFlow</a>) &amp;&amp; !<a class="code" href="namespacellvm.html#abe76d72cda6b2b4562c72accb510040b">isSafeToSpeculativelyExecute</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160; </div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;  <span class="comment">// Hoisting of llvm.deoptimize is only legal together with the next return</span></div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;  <span class="comment">// instruction, which this pass is not always able to do.</span></div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *CB = dyn_cast&lt;CallBase&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    <span class="keywordflow">if</span> (CB-&gt;getIntrinsicID() == Intrinsic::experimental_deoptimize)</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160; </div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;  <span class="comment">// It&#39;s also unsafe/illegal to hoist an instruction above its instruction</span></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;  <span class="comment">// operands</span></div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> : <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands()) {</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *J = dyn_cast&lt;Instruction&gt;(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>))</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;      <span class="keywordflow">if</span> (J-&gt;getParent() == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;  }</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160; </div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;}</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160; </div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a32c2973fa0babdd440d3ab7dd160664a">passingValueIsAlwaysUndefined</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="keywordtype">bool</span> PtrValueMayBeModified = <span class="keyword">false</span>);</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;<span class="comment">/// Given a conditional branch that goes to BB1 and BB2, hoist any common code</span></div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;<span class="comment">/// in the two blocks up into the branch block. The caller of this function</span></div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;<span class="comment">/// guarantees that BI&#39;s block dominates BB1 and BB2. If EqTermsOnly is given,</span></div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;<span class="comment">/// only perform hoisting in case both blocks only contain a terminator. In that</span></div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;<span class="comment">/// case, only the original BI will be replaced and selects for PHIs are added.</span></div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> SimplifyCFGOpt::HoistThenElseCodeToIf(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI,</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;                                           <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>,</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;                                           <span class="keywordtype">bool</span> EqTermsOnly) {</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;  <span class="comment">// This does very trivial matching, with limited scanning, to find identical</span></div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;  <span class="comment">// instructions in the two blocks.  In particular, we don&#39;t want to get into</span></div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;  <span class="comment">// O(M*N) situations here where M and N are the sizes of BB1 and BB2.  As</span></div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;  <span class="comment">// such, we currently just scan for obviously identical instructions in an</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;  <span class="comment">// identical order, possibly separated by the same number of non-identical</span></div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;  <span class="comment">// instructions.</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB1 = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0); <span class="comment">// The true destination.</span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB2 = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1); <span class="comment">// The false destination</span></div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160; </div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;  <span class="comment">// If either of the blocks has it&#39;s address taken, then we can&#39;t do this fold,</span></div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;  <span class="comment">// because the code we&#39;d hoist would no longer run when we jump into the block</span></div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;  <span class="comment">// by it&#39;s address.</span></div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;  <span class="keywordflow">if</span> (BB1-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a315f26c899f5ea8a780db4740ba95ef4">hasAddressTaken</a>() || BB2-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a315f26c899f5ea8a780db4740ba95ef4">hasAddressTaken</a>())</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160; </div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BB1_Itr = BB1-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BB2_Itr = BB2-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160; </div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a> = &amp;*BB1_Itr++, *I2 = &amp;*BB2_Itr++;</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;  <span class="comment">// Skip debug info if it is not identical.</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;  <a class="code" href="classllvm_1_1DbgInfoIntrinsic.html">DbgInfoIntrinsic</a> *DBI1 = dyn_cast&lt;DbgInfoIntrinsic&gt;(I1);</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;  <a class="code" href="classllvm_1_1DbgInfoIntrinsic.html">DbgInfoIntrinsic</a> *DBI2 = dyn_cast&lt;DbgInfoIntrinsic&gt;(I2);</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;  <span class="keywordflow">if</span> (!DBI1 || !DBI2 || !DBI1-&gt;<a class="code" href="classllvm_1_1Instruction.html#a69c17ef87a64dfcb3e5795b870cf69fa">isIdenticalToWhenDefined</a>(DBI2)) {</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    <span class="keywordflow">while</span> (isa&lt;DbgInfoIntrinsic&gt;(I1))</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;      <a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a> = &amp;*BB1_Itr++;</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    <span class="keywordflow">while</span> (isa&lt;DbgInfoIntrinsic&gt;(I2))</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;      I2 = &amp;*BB2_Itr++;</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;  }</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;  <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(I1))</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160; </div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BIParent = BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160; </div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160; </div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  <span class="keyword">auto</span> <a class="code" href="HexagonMCCodeEmitter_8cpp.html#ae4dfd7b0d66121016d6466d2ff10e8ba">_</a> = <a class="code" href="namespacellvm.html#ab2e3dbebd68e69d77c227682fc8e3ba2">make_scope_exit</a>([&amp;]() {</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    <span class="keywordflow">if</span> (Changed)</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;      ++NumHoistCommonCode;</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;  });</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160; </div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;  <span class="comment">// Check if only hoisting terminators is allowed. This does not add new</span></div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;  <span class="comment">// instructions to the hoist location.</span></div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;  <span class="keywordflow">if</span> (EqTermsOnly) {</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    <span class="comment">// Skip any debug intrinsics, as they are free to hoist.</span></div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    <span class="keyword">auto</span> *I1NonDbg = &amp;*<a class="code" href="namespacellvm.html#a6577ad74b2f1a18729c71543850d8616">skipDebugIntrinsics</a>(<a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>-&gt;getIterator());</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    <span class="keyword">auto</span> *I2NonDbg = &amp;*<a class="code" href="namespacellvm.html#a6577ad74b2f1a18729c71543850d8616">skipDebugIntrinsics</a>(I2-&gt;getIterator());</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    <span class="keywordflow">if</span> (!I1NonDbg-&gt;isIdenticalToWhenDefined(I2NonDbg))</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    <span class="keywordflow">if</span> (!I1NonDbg-&gt;isTerminator())</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    <span class="comment">// Now we know that we only need to hoist debug intrinsics and the</span></div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    <span class="comment">// terminator. Let the loop below handle those 2 cases.</span></div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  }</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160; </div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;  <span class="comment">// Count how many instructions were not hoisted so far. There&#39;s a limit on how</span></div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;  <span class="comment">// many instructions we skip, serving as a compilation time control as well as</span></div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;  <span class="comment">// preventing excessive increase of life ranges.</span></div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;  <span class="keywordtype">unsigned</span> NumSkipped = 0;</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160; </div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;  <span class="comment">// Record any skipped instuctions that may read memory, write memory or have</span></div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  <span class="comment">// side effects, or have implicit control flow.</span></div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;  <span class="keywordtype">unsigned</span> SkipFlagsBB1 = 0;</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;  <span class="keywordtype">unsigned</span> SkipFlagsBB2 = 0;</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160; </div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;  <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    <span class="comment">// If we are hoisting the terminator instruction, don&#39;t move one (making a</span></div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    <span class="comment">// broken BB), instead clone it, and remove BI.</span></div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>-&gt;isTerminator() || I2-&gt;isTerminator()) {</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;      <span class="comment">// If any instructions remain in the block, we cannot hoist terminators.</span></div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;      <span class="keywordflow">if</span> (NumSkipped || !<a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>-&gt;isIdenticalToWhenDefined(I2))</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;        <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;      <span class="keywordflow">goto</span> HoistTerminator;</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    }</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160; </div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>-&gt;isIdenticalToWhenDefined(I2)) {</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;      <span class="comment">// Even if the instructions are identical, it may not be safe to hoist</span></div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;      <span class="comment">// them if we have skipped over instructions with side effects or their</span></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;      <span class="comment">// operands weren&#39;t hoisted.</span></div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#a396eac919c9ac7907275e770a8cd37cf">isSafeToHoistInstr</a>(I1, SkipFlagsBB1) ||</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;          !<a class="code" href="SimplifyCFG_8cpp.html#a396eac919c9ac7907275e770a8cd37cf">isSafeToHoistInstr</a>(I2, SkipFlagsBB2))</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;        <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160; </div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;      <span class="comment">// If we&#39;re going to hoist a call, make sure that the two instructions</span></div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;      <span class="comment">// we&#39;re commoning/hoisting are both marked with musttail, or neither of</span></div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;      <span class="comment">// them is marked as such. Otherwise, we might end up in a situation where</span></div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      <span class="comment">// we hoist from a block where the terminator is a `ret` to a block where</span></div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;      <span class="comment">// the terminator is a `br`, and `musttail` calls expect to be followed by</span></div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;      <span class="comment">// a return.</span></div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="lib_2Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a> = dyn_cast&lt;CallInst&gt;(I1);</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;      <span class="keyword">auto</span> *C2 = dyn_cast&lt;CallInst&gt;(I2);</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="lib_2Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a> &amp;&amp; C2)</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="lib_2Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a>-&gt;isMustTailCall() != C2-&gt;isMustTailCall())</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;          <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160; </div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>.<a class="code" href="classllvm_1_1TargetTransformInfo.html#aafcbf4e3010950dd8ea0be1c4b0d3281">isProfitableToHoist</a>(I1) || !<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>.<a class="code" href="classllvm_1_1TargetTransformInfo.html#aafcbf4e3010950dd8ea0be1c4b0d3281">isProfitableToHoist</a>(I2))</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;        <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160; </div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;      <span class="comment">// If any of the two call sites has nomerge attribute, stop hoisting.</span></div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> *CB1 = dyn_cast&lt;CallBase&gt;(I1))</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;        <span class="keywordflow">if</span> (CB1-&gt;cannotMerge())</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;          <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> *CB2 = dyn_cast&lt;CallBase&gt;(I2))</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;        <span class="keywordflow">if</span> (CB2-&gt;cannotMerge())</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;          <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160; </div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;      <span class="keywordflow">if</span> (isa&lt;DbgInfoIntrinsic&gt;(I1) || isa&lt;DbgInfoIntrinsic&gt;(I2)) {</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isa&lt;DbgInfoIntrinsic&gt;(I1) &amp;&amp; isa&lt;DbgInfoIntrinsic&gt;(I2));</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;        <span class="comment">// The debug location is an integral part of a debug info intrinsic</span></div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;        <span class="comment">// and can&#39;t be separated from it or replaced.  Instead of attempting</span></div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;        <span class="comment">// to merge locations, simply hoist both copies of the intrinsic.</span></div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;        BIParent-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#af29f89e91dfd0ae90950f0b1bf49798d">splice</a>(BI-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>(), BB1, <a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>-&gt;getIterator());</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;        BIParent-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#af29f89e91dfd0ae90950f0b1bf49798d">splice</a>(BI-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>(), BB2, I2-&gt;getIterator());</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;        <span class="comment">// For a normal instruction, we just move one to right before the</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;        <span class="comment">// branch, then replace all uses of the other with the first.  Finally,</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;        <span class="comment">// we remove the now redundant second instruction.</span></div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;        BIParent-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#af29f89e91dfd0ae90950f0b1bf49798d">splice</a>(BI-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>(), BB1, <a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>-&gt;getIterator());</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;        <span class="keywordflow">if</span> (!I2-&gt;use_empty())</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;          I2-&gt;replaceAllUsesWith(I1);</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;        <a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>-&gt;andIRFlags(I2);</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;        <span class="keywordtype">unsigned</span> KnownIDs[] = {LLVMContext::MD_tbaa,</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;                               LLVMContext::MD_range,</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;                               LLVMContext::MD_fpmath,</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;                               LLVMContext::MD_invariant_load,</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;                               LLVMContext::MD_nonnull,</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;                               LLVMContext::MD_invariant_group,</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;                               LLVMContext::MD_align,</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;                               LLVMContext::MD_dereferenceable,</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;                               LLVMContext::MD_dereferenceable_or_null,</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;                               LLVMContext::MD_mem_parallel_loop_access,</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;                               LLVMContext::MD_access_group,</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;                               LLVMContext::MD_preserve_access_index};</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;        <a class="code" href="namespacellvm.html#a929b458d1b5080256b6f6c8141bbdfea">combineMetadata</a>(I1, I2, KnownIDs, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160; </div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;        <span class="comment">// I1 and I2 are being combined into a single instruction.  Its debug</span></div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;        <span class="comment">// location is the merged locations of the original instructions.</span></div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;        <a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>-&gt;applyMergedLocation(<a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>-&gt;getDebugLoc(), I2-&gt;getDebugLoc());</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160; </div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;        I2-&gt;eraseFromParent();</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;      }</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;      Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;      ++NumHoistCommonInstrs;</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;      <span class="keywordflow">if</span> (NumSkipped &gt;= <a class="code" href="SimplifyCFG_8cpp.html#a5e90675655fa07e4ac14c4c39f4c338a">HoistCommonSkipLimit</a>)</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;        <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;      <span class="comment">// We are about to skip over a pair of non-identical instructions. Record</span></div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;      <span class="comment">// if any have characteristics that would prevent reordering instructions</span></div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;      <span class="comment">// across them.</span></div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;      SkipFlagsBB1 |= <a class="code" href="SimplifyCFG_8cpp.html#aa67a8bc0841ad57e26ed447bb99ea15d">skippedInstrFlags</a>(I1);</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;      SkipFlagsBB2 |= <a class="code" href="SimplifyCFG_8cpp.html#aa67a8bc0841ad57e26ed447bb99ea15d">skippedInstrFlags</a>(I2);</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;      ++NumSkipped;</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    }</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160; </div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    <a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a> = &amp;*BB1_Itr++;</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;    I2 = &amp;*BB2_Itr++;</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    <span class="comment">// Skip debug info if it is not identical.</span></div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    <a class="code" href="classllvm_1_1DbgInfoIntrinsic.html">DbgInfoIntrinsic</a> *DBI1 = dyn_cast&lt;DbgInfoIntrinsic&gt;(I1);</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;    <a class="code" href="classllvm_1_1DbgInfoIntrinsic.html">DbgInfoIntrinsic</a> *DBI2 = dyn_cast&lt;DbgInfoIntrinsic&gt;(I2);</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    <span class="keywordflow">if</span> (!DBI1 || !DBI2 || !DBI1-&gt;<a class="code" href="classllvm_1_1Instruction.html#a69c17ef87a64dfcb3e5795b870cf69fa">isIdenticalToWhenDefined</a>(DBI2)) {</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;      <span class="keywordflow">while</span> (isa&lt;DbgInfoIntrinsic&gt;(I1))</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;        <a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a> = &amp;*BB1_Itr++;</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;      <span class="keywordflow">while</span> (isa&lt;DbgInfoIntrinsic&gt;(I2))</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;        I2 = &amp;*BB2_Itr++;</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;    }</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;  }</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160; </div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160; </div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;HoistTerminator:</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;  <span class="comment">// It may not be possible to hoist an invoke.</span></div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;  <span class="comment">// FIXME: Can we define a safety predicate for CallBr?</span></div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;  <span class="keywordflow">if</span> (isa&lt;InvokeInst&gt;(I1) &amp;&amp; !<a class="code" href="SimplifyCFG_8cpp.html#a3aaba0277f5dd5636e099fa81c20c533">isSafeToHoistInvoke</a>(BB1, BB2, I1, I2))</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160; </div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;  <span class="comment">// TODO: callbr hoisting currently disabled pending further study.</span></div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;  <span class="keywordflow">if</span> (isa&lt;CallBrInst&gt;(I1))</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;    <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160; </div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ : <a class="code" href="namespacellvm.html#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB1)) {</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> &amp;PN : Succ-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a72516971c5734dc0f7546e64affca425">phis</a>()) {</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *BB1V = PN.getIncomingValueForBlock(BB1);</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *BB2V = PN.getIncomingValueForBlock(BB2);</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;      <span class="keywordflow">if</span> (BB1V == BB2V)</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160; </div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;      <span class="comment">// Check for passingValueIsAlwaysUndefined here because we would rather</span></div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;      <span class="comment">// eliminate undefined control flow then converting it to a select.</span></div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a32c2973fa0babdd440d3ab7dd160664a">passingValueIsAlwaysUndefined</a>(BB1V, &amp;PN) ||</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;          <a class="code" href="SimplifyCFG_8cpp.html#a32c2973fa0babdd440d3ab7dd160664a">passingValueIsAlwaysUndefined</a>(BB2V, &amp;PN))</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;        <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    }</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;  }</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160; </div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;  <span class="comment">// Okay, it is safe to hoist the terminator.</span></div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1CPol.html#a7d79a4b341da8ac60b91c1f4b1ea42c4a3795a38ac6eb8cb14191aaba99205a87">NT</a> = <a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>-&gt;clone();</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;  <a class="code" href="namespacellvm_1_1AMDGPU_1_1CPol.html#a7d79a4b341da8ac60b91c1f4b1ea42c4a3795a38ac6eb8cb14191aaba99205a87">NT</a>-&gt;insertInto(BIParent, BI-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>());</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1AMDGPU_1_1CPol.html#a7d79a4b341da8ac60b91c1f4b1ea42c4a3795a38ac6eb8cb14191aaba99205a87">NT</a>-&gt;getType()-&gt;isVoidTy()) {</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;    <a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>-&gt;replaceAllUsesWith(<a class="code" href="namespacellvm_1_1AMDGPU_1_1CPol.html#a7d79a4b341da8ac60b91c1f4b1ea42c4a3795a38ac6eb8cb14191aaba99205a87">NT</a>);</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    I2-&gt;replaceAllUsesWith(<a class="code" href="namespacellvm_1_1AMDGPU_1_1CPol.html#a7d79a4b341da8ac60b91c1f4b1ea42c4a3795a38ac6eb8cb14191aaba99205a87">NT</a>);</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;    <a class="code" href="namespacellvm_1_1AMDGPU_1_1CPol.html#a7d79a4b341da8ac60b91c1f4b1ea42c4a3795a38ac6eb8cb14191aaba99205a87">NT</a>-&gt;takeName(I1);</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;  }</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;  Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;  ++NumHoistCommonInstrs;</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160; </div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;  <span class="comment">// Ensure terminator gets a debug location, even an unknown one, in case</span></div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;  <span class="comment">// it involves inlinable calls.</span></div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;  <a class="code" href="namespacellvm_1_1AMDGPU_1_1CPol.html#a7d79a4b341da8ac60b91c1f4b1ea42c4a3795a38ac6eb8cb14191aaba99205a87">NT</a>-&gt;applyMergedLocation(<a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>-&gt;getDebugLoc(), I2-&gt;getDebugLoc());</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160; </div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;  <span class="comment">// PHIs created below will adopt NT&#39;s merged DebugLoc.</span></div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;NoFolder&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1CPol.html#a7d79a4b341da8ac60b91c1f4b1ea42c4a3795a38ac6eb8cb14191aaba99205a87">NT</a>);</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160; </div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;  <span class="comment">// Hoisting one of the terminators from our successor is a great thing.</span></div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;  <span class="comment">// Unfortunately, the successors of the if/else blocks may have PHI nodes in</span></div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;  <span class="comment">// them.  If they do, all PHI entries for BB1/BB2 must agree for all PHI</span></div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;  <span class="comment">// nodes, so we insert select instruction to compute the final result.</span></div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;  std::map&lt;std::pair&lt;Value *, Value *&gt;, <a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *&gt; InsertedSelects;</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ : <a class="code" href="namespacellvm.html#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB1)) {</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> &amp;PN : Succ-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a72516971c5734dc0f7546e64affca425">phis</a>()) {</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *BB1V = PN.getIncomingValueForBlock(BB1);</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *BB2V = PN.getIncomingValueForBlock(BB2);</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;      <span class="keywordflow">if</span> (BB1V == BB2V)</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160; </div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;      <span class="comment">// These values do not agree.  Insert a select instruction before NT</span></div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;      <span class="comment">// that determines the right value.</span></div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;      <a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *&amp;<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = InsertedSelects[std::make_pair(BB1V, BB2V)];</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>) {</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;        <span class="comment">// Propagate fast-math-flags from phi node to its replacement select.</span></div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;        <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;::FastMathFlagGuard</a> FMFGuard(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;        <span class="keywordflow">if</span> (isa&lt;FPMathOperator&gt;(PN))</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.setFastMathFlags(PN.getFastMathFlags());</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160; </div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;        <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = cast&lt;SelectInst&gt;(</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;            <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSelect(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>(), BB1V, BB2V,</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;                                 BB1V-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + <span class="stringliteral">&quot;.&quot;</span> + BB2V-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>(), BI));</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;      }</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160; </div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;      <span class="comment">// Make the PHI node use the select for all incoming values for BB1/BB2</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = PN.getNumIncomingValues(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;        <span class="keywordflow">if</span> (PN.getIncomingBlock(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) == BB1 || PN.getIncomingBlock(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) == BB2)</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;          PN.setIncomingValue(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;    }</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;  }</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160; </div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;DominatorTree::UpdateType, 4&gt;</a> Updates;</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160; </div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;  <span class="comment">// Update any PHI nodes in our new successors.</span></div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ : <a class="code" href="namespacellvm.html#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB1)) {</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#a41a075ef4b76f72591e86e1fe13f096d">AddPredecessorToBlock</a>(Succ, BIParent, BB1);</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;    <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;      Updates.push_back({<a class="code" href="classllvm_1_1DominatorTreeBase.html#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, BIParent, Succ});</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;  }</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160; </div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;  <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ : <a class="code" href="namespacellvm.html#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BI))</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;      Updates.push_back({<a class="code" href="classllvm_1_1DominatorTreeBase.html#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, BIParent, Succ});</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160; </div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;  <a class="code" href="SimplifyCFG_8cpp.html#aa4641512b28a6e42a40bda7576fe43cb">EraseTerminatorAndDCECond</a>(BI);</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;  <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;    DTU-&gt;applyUpdates(Updates);</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;}</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160; </div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;<span class="comment">// Check lifetime markers.</span></div>
<div class="line"><a name="l01765"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#ae97521436759fc2489301a34e621bbcd"> 1765</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#ae97521436759fc2489301a34e621bbcd">isLifeTimeMarker</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> II = dyn_cast&lt;IntrinsicInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    <span class="keywordflow">switch</span> (II-&gt;getIntrinsicID()) {</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    <span class="keywordflow">case</span> Intrinsic::lifetime_start:</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    <span class="keywordflow">case</span> Intrinsic::lifetime_end:</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;    }</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;  }</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;}</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160; </div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;<span class="comment">// TODO: Refine this. This should avoid cases like turning constant memcpy sizes</span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;<span class="comment">// into variables.</span></div>
<div class="line"><a name="l01780"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#aa85a3c04f64695265702d0b3c3d6ea1c"> 1780</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#aa85a3c04f64695265702d0b3c3d6ea1c">replacingOperandWithVariableIsCheap</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;                                                <span class="keywordtype">int</span> OpIdx) {</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;  <span class="keywordflow">return</span> !isa&lt;IntrinsicInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;}</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160; </div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;<span class="comment">// All instructions in Insts belong to different blocks that all unconditionally</span></div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;<span class="comment">// branch to a common successor. Analyze each instruction and return true if it</span></div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;<span class="comment">// would be possible to sink them into their successor, creating one common</span></div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;<span class="comment">// instruction instead. For every value that would be required to be provided by</span></div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;<span class="comment">// PHI node (because an operand varies in each input block), add to PHIOperands.</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#ab9f16e33daaafda2df2c0c79afe72e3e"> 1790</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#ab9f16e33daaafda2df2c0c79afe72e3e">canSinkInstructions</a>(</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;    <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Instruction *&gt;</a> Insts,</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap</a>&lt;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *, <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 4&gt;</a>&gt; &amp;PHIOperands) {</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;  <span class="comment">// Prune out obviously bad instructions to move. Each instruction must have</span></div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;  <span class="comment">// exactly zero or one use, and we check later that use is by a single, common</span></div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;  <span class="comment">// PHI instruction in the successor.</span></div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;  <span class="keywordtype">bool</span> HasUse = !Insts.<a class="code" href="classllvm_1_1ArrayRef.html#a6bc2b53fce3b1d8975eea027d8a8eb90">front</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#af21f61086e696a788f549768fdc26a93">user_empty</a>();</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Insts) {</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;    <span class="comment">// These instructions may change or break semantics if moved.</span></div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;    <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isEHPad() || isa&lt;AllocaInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;        <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;isTokenTy())</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160; </div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;    <span class="comment">// Do not try to sink an instruction in an infinite loop - it can cause</span></div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    <span class="comment">// this algorithm to infinite loop.</span></div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()-&gt;getSingleSuccessor() == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent())</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160; </div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;    <span class="comment">// Conservatively return false if I is an inline-asm instruction. Sinking</span></div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;    <span class="comment">// and merging inline-asm instructions can potentially create arguments</span></div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;    <span class="comment">// that cannot satisfy the inline-asm constraints.</span></div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    <span class="comment">// If the instruction has nomerge attribute, return false.</span></div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;CallBase&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;isInlineAsm() || <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;cannotMerge())</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160; </div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;    <span class="comment">// Each instruction must have zero or one use.</span></div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    <span class="keywordflow">if</span> (HasUse &amp;&amp; !<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUse())</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;    <span class="keywordflow">if</span> (!HasUse &amp;&amp; !<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;user_empty())</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;  }</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160; </div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I0 = Insts.front();</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Insts)</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isSameOperationAs(I0))</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160; </div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;  <span class="comment">// All instructions in Insts are known to be the same opcode. If they have a</span></div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;  <span class="comment">// use, check that the only user is a PHI or in the same block as the</span></div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;  <span class="comment">// instruction, because if a user is in the same block as an instruction we&#39;re</span></div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;  <span class="comment">// contemplating sinking, it must already be determined to be sinkable.</span></div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;  <span class="keywordflow">if</span> (HasUse) {</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;    <span class="keyword">auto</span> *PNUse = dyn_cast&lt;PHINode&gt;(*I0-&gt;<a class="code" href="classllvm_1_1Value.html#a158da2b6d3d938aaa15b6acd00150e2c">user_begin</a>());</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;    <span class="keyword">auto</span> *Succ = I0-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>()-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6e5d2e18c81baaeec7dadc81a0dea993">getSuccessor</a>(0);</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(Insts, [&amp;PNUse,&amp;Succ](<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) -&gt; <span class="keywordtype">bool</span> {</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;          <span class="keyword">auto</span> *U = cast&lt;Instruction&gt;(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;user_begin());</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;          <span class="keywordflow">return</span> (PNUse &amp;&amp;</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;                  PNUse-&gt;getParent() == Succ &amp;&amp;</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;                  PNUse-&gt;getIncomingValueForBlock(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()) == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;                 U-&gt;getParent() == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;        }))</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;  }</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160; </div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;  <span class="comment">// Because SROA can&#39;t handle speculating stores of selects, try not to sink</span></div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;  <span class="comment">// loads, stores or lifetime markers of allocas when we&#39;d have to create a</span></div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;  <span class="comment">// PHI for the address operand. Also, because it is likely that loads or</span></div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;  <span class="comment">// stores of allocas will disappear when Mem2Reg/SROA is run, don&#39;t sink</span></div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;  <span class="comment">// them.</span></div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;  <span class="comment">// This can cause code churn which can have unintended consequences down</span></div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;  <span class="comment">// the line - see https://llvm.org/bugs/show_bug.cgi?id=30244.</span></div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;  <span class="comment">// FIXME: This is a workaround for a deficiency in SROA - see</span></div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;  <span class="comment">// https://llvm.org/bugs/show_bug.cgi?id=30188</span></div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;  <span class="keywordflow">if</span> (isa&lt;StoreInst&gt;(I0) &amp;&amp; <a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(Insts, [](<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;        <span class="keywordflow">return</span> isa&lt;AllocaInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1)-&gt;stripPointerCasts());</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;      }))</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;  <span class="keywordflow">if</span> (isa&lt;LoadInst&gt;(I0) &amp;&amp; <a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(Insts, [](<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;        <span class="keywordflow">return</span> isa&lt;AllocaInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)-&gt;stripPointerCasts());</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;      }))</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#ae97521436759fc2489301a34e621bbcd">isLifeTimeMarker</a>(I0) &amp;&amp; <a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(Insts, [](<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;        <span class="keywordflow">return</span> isa&lt;AllocaInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1)-&gt;stripPointerCasts());</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;      }))</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160; </div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;  <span class="comment">// For calls to be sinkable, they must all be indirect, or have same callee.</span></div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;  <span class="comment">// I.e. if we have two direct calls to different callees, we don&#39;t want to</span></div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;  <span class="comment">// turn that into an indirect call. Likewise, if we have an indirect call,</span></div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;  <span class="comment">// and a direct call, we don&#39;t actually want to have a single indirect call.</span></div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;  <span class="keywordflow">if</span> (isa&lt;CallBase&gt;(I0)) {</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;    <span class="keyword">auto</span> IsIndirectCall = [](<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;      <span class="keywordflow">return</span> cast&lt;CallBase&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;isIndirectCall();</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    };</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    <span class="keywordtype">bool</span> HaveIndirectCalls = <a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(Insts, IsIndirectCall);</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    <span class="keywordtype">bool</span> AllCallsAreIndirect = <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(Insts, IsIndirectCall);</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;    <span class="keywordflow">if</span> (HaveIndirectCalls) {</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;      <span class="keywordflow">if</span> (!AllCallsAreIndirect)</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;      <span class="comment">// All callees must be identical.</span></div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Insts) {</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *CurrCallee = cast&lt;CallBase&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getCalledOperand();</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a>)</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;          <a class="code" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a> = CurrCallee;</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a> != CurrCallee)</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;      }</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;    }</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;  }</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160; </div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> OI = 0, OE = I0-&gt;<a class="code" href="classllvm_1_1User.html#addec638786f763d967811b45cb662f1f">getNumOperands</a>(); OI != OE; ++OI) {</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = I0-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(OI);</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>-&gt;getType()-&gt;isTokenTy())</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;      <span class="comment">// Don&#39;t touch any operand of token type.</span></div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160; </div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;    <span class="keyword">auto</span> SameAsI0 = [&amp;I0, OI](<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNumOperands() == I0-&gt;<a class="code" href="classllvm_1_1User.html#addec638786f763d967811b45cb662f1f">getNumOperands</a>());</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(OI) == I0-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(OI);</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;    };</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(Insts, SameAsI0)) {</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;      <span class="keywordflow">if</span> ((isa&lt;Constant&gt;(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>) &amp;&amp; !<a class="code" href="SimplifyCFG_8cpp.html#aa85a3c04f64695265702d0b3c3d6ea1c">replacingOperandWithVariableIsCheap</a>(I0, OI)) ||</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;          !<a class="code" href="namespacellvm.html#ab42e397923eec18d3ab8ea88d280b63c">canReplaceOperandWithVariable</a>(I0, OI))</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;        <span class="comment">// We can&#39;t create a PHI from this GEP.</span></div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Insts)</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;        PHIOperands[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].push_back(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(OI));</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;    }</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;  }</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;}</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160; </div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;<span class="comment">// Assuming canSinkInstructions(Blocks) has returned true, sink the last</span></div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;<span class="comment">// instruction of every block in Blocks to their common successor, commoning</span></div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;<span class="comment">// into one instruction.</span></div>
<div class="line"><a name="l01918"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#ac4fdfa685be0e2568187936221316c47"> 1918</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#ac4fdfa685be0e2568187936221316c47">sinkLastInstruction</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;BasicBlock*&gt;</a> Blocks) {</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;  <span class="keyword">auto</span> *BBEnd = Blocks[0]-&gt;getTerminator()-&gt;getSuccessor(0);</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160; </div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;  <span class="comment">// canSinkInstructions returning true guarantees that every block has at</span></div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;  <span class="comment">// least one non-terminator instruction.</span></div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction*,4&gt;</a> Insts;</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : Blocks) {</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getTerminator();</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getPrevNode();</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;    } <span class="keywordflow">while</span> (isa&lt;DbgInfoIntrinsic&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;front());</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;    <span class="keywordflow">if</span> (!isa&lt;DbgInfoIntrinsic&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;      Insts.push_back(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;  }</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160; </div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;  <span class="comment">// The only checking we need to do now is that all users of all instructions</span></div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;  <span class="comment">// are the same PHI node. canSinkInstructions should have checked this but</span></div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;  <span class="comment">// it is slightly over-aggressive - it gets confused by commutative</span></div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;  <span class="comment">// instructions so double-check it here.</span></div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I0 = Insts.front();</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;  <span class="keywordflow">if</span> (!I0-&gt;<a class="code" href="classllvm_1_1Value.html#af21f61086e696a788f549768fdc26a93">user_empty</a>()) {</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;    <span class="keyword">auto</span> *PNUse = dyn_cast&lt;PHINode&gt;(*I0-&gt;<a class="code" href="classllvm_1_1Value.html#a158da2b6d3d938aaa15b6acd00150e2c">user_begin</a>());</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(Insts, [&amp;PNUse](<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) -&gt; <span class="keywordtype">bool</span> {</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;          <span class="keyword">auto</span> *U = cast&lt;Instruction&gt;(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;user_begin());</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;          <span class="keywordflow">return</span> U == PNUse;</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;        }))</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;  }</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160; </div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;  <span class="comment">// We don&#39;t need to do any more checking here; canSinkInstructions should</span></div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;  <span class="comment">// have done it all for us.</span></div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value*, 4&gt;</a> NewOperands;</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = I0-&gt;<a class="code" href="classllvm_1_1User.html#addec638786f763d967811b45cb662f1f">getNumOperands</a>(); <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a>) {</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;    <span class="comment">// This check is different to that in canSinkInstructions. There, we</span></div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;    <span class="comment">// cared about the global view once simplifycfg (and instcombine) have</span></div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;    <span class="comment">// completed - it takes into account PHIs that become trivially</span></div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;    <span class="comment">// simplifiable.  However here we need a more local view; if an operand</span></div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;    <span class="comment">// differs we create a PHI and rely on instcombine to clean up the very</span></div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;    <span class="comment">// small mess we may make.</span></div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;    <span class="keywordtype">bool</span> NeedPHI = <a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(Insts, [&amp;I0, <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a>](<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a>) != I0-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a>);</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;    });</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;    <span class="keywordflow">if</span> (!NeedPHI) {</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;      NewOperands.push_back(I0-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a>));</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;    }</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160; </div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;    <span class="comment">// Create a new PHI in the successor block and populate it.</span></div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;    <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = I0-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a>);</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>-&gt;getType()-&gt;isTokenTy() &amp;&amp; <span class="stringliteral">&quot;Can&#39;t PHI tokens!&quot;</span>);</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;    <span class="keyword">auto</span> *PN = <a class="code" href="classllvm_1_1PHINode.html#ab0ff669b12c20c07137705c38872ec63">PHINode::Create</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>-&gt;getType(), Insts.size(),</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;                               <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>-&gt;getName() + <span class="stringliteral">&quot;.sink&quot;</span>, &amp;BBEnd-&gt;front());</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Insts)</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;      PN-&gt;addIncoming(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a>), <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent());</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;    NewOperands.push_back(PN);</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;  }</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160; </div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;  <span class="comment">// Arbitrarily use I0 as the new &quot;common&quot; instruction; remap its operands</span></div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;  <span class="comment">// and move it to the start of the successor block.</span></div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = I0-&gt;<a class="code" href="classllvm_1_1User.html#addec638786f763d967811b45cb662f1f">getNumOperands</a>(); <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a>)</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;    I0-&gt;<a class="code" href="classllvm_1_1User.html#a53d4e14158c5056fd1ed8f7b3da82f8a">getOperandUse</a>(<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a>).<a class="code" href="classllvm_1_1Use.html#a40360b4fa7b8e6920a68e5a8a0814f1f">set</a>(NewOperands[<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a>]);</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;  I0-&gt;<a class="code" href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(&amp;*BBEnd-&gt;getFirstInsertionPt());</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160; </div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;  <span class="comment">// Update metadata and IR flags, and merge debug locations.</span></div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Insts)</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != I0) {</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;      <span class="comment">// The debug location for the &quot;common&quot; instruction is the merged locations</span></div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;      <span class="comment">// of all the commoned instructions.  We start with the original location</span></div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;      <span class="comment">// of the &quot;common&quot; instruction and iteratively merge each location in the</span></div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;      <span class="comment">// loop below.</span></div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;      <span class="comment">// This is an N-way merge, which will be inefficient if I0 is a CallInst.</span></div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;      <span class="comment">// However, as N-way merge for CallInst is rare, so we use simplified API</span></div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;      <span class="comment">// instead of using complex API for N-way merge.</span></div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;      I0-&gt;<a class="code" href="classllvm_1_1Instruction.html#a7279ed8b15d2a6dc8d246a7de2e08604">applyMergedLocation</a>(I0-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4f3bf98b5054831b608852e33427814">getDebugLoc</a>(), <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc());</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;      <a class="code" href="namespacellvm.html#a9b43098c569ea8289ed1ab70ee9a00af">combineMetadataForCSE</a>(I0, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;      I0-&gt;<a class="code" href="classllvm_1_1Instruction.html#a4ea9acbe7fd20332ea6ccdb0183d6395">andIRFlags</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;    }</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160; </div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;  <span class="keywordflow">if</span> (!I0-&gt;<a class="code" href="classllvm_1_1Value.html#af21f61086e696a788f549768fdc26a93">user_empty</a>()) {</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;    <span class="comment">// canSinkLastInstruction checked that all instructions were used by</span></div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;    <span class="comment">// one and only one PHI node. Find that now, RAUW it to our common</span></div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;    <span class="comment">// instruction and nuke it.</span></div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;    <span class="keyword">auto</span> *PN = cast&lt;PHINode&gt;(*I0-&gt;<a class="code" href="classllvm_1_1Value.html#a158da2b6d3d938aaa15b6acd00150e2c">user_begin</a>());</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;    PN-&gt;replaceAllUsesWith(I0);</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;    PN-&gt;eraseFromParent();</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;  }</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160; </div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;  <span class="comment">// Finally nuke all instructions apart from the common instruction.</span></div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Insts) {</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> == I0)</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;    <span class="comment">// The remaining uses are debug users, replace those with the common inst.</span></div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;    <span class="comment">// In most (all?) cases this just introduces a use-before-def.</span></div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;user_empty() &amp;&amp; <span class="stringliteral">&quot;Inst unexpectedly still has non-dbg users&quot;</span>);</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;    <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(I0);</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;    <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;  }</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160; </div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;}</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160; </div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160; </div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;  <span class="comment">// LockstepReverseIterator - Iterates through instructions</span></div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;  <span class="comment">// in a set of blocks in reverse order from the first non-terminator.</span></div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;  <span class="comment">// For example (assume all blocks have size n):</span></div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;  <span class="comment">//   LockstepReverseIterator I([B1, B2, B3]);</span></div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;  <span class="comment">//   *I-- = [B1[n], B2[n], B3[n]];</span></div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;  <span class="comment">//   *I-- = [B1[n-1], B2[n-1], B3[n-1]];</span></div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;  <span class="comment">//   *I-- = [B1[n-2], B2[n-2], B3[n-2]];</span></div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;  <span class="comment">//   ...</span></div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;  <span class="keyword">class </span>LockstepReverseIterator {</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;    <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;BasicBlock*&gt;</a> Blocks;</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction*,4&gt;</a> Insts;</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="AArch64Disassembler_8cpp.html#aae15979c93f7f0929116b975b5c46cd6">Fail</a>;</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160; </div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;  <span class="keyword">public</span>:</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;    LockstepReverseIterator(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;BasicBlock*&gt;</a> Blocks) : Blocks(Blocks) {</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;      reset();</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;    }</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160; </div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;    <span class="keywordtype">void</span> reset() {</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;      <a class="code" href="AArch64Disassembler_8cpp.html#aae15979c93f7f0929116b975b5c46cd6">Fail</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;      Insts.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : Blocks) {</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;        <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getTerminator();</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;        <span class="keywordflow">for</span> (Inst = Inst-&gt;<a class="code" href="classllvm_1_1ilist__node__with__parent.html#ae451867ac0034a201153b54cc466386d">getPrevNode</a>(); Inst &amp;&amp; isa&lt;DbgInfoIntrinsic&gt;(Inst);)</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;          Inst = Inst-&gt;<a class="code" href="classllvm_1_1ilist__node__with__parent.html#ae451867ac0034a201153b54cc466386d">getPrevNode</a>();</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;        <span class="keywordflow">if</span> (!Inst) {</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;          <span class="comment">// Block wasn&#39;t big enough.</span></div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;          <a class="code" href="AArch64Disassembler_8cpp.html#aae15979c93f7f0929116b975b5c46cd6">Fail</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;          <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;        }</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;        Insts.push_back(Inst);</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;      }</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;    }</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160; </div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="RustDemangle_8cpp.html#a103d8cfe62c1651cd70e181746f8a840">isValid</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;      <span class="keywordflow">return</span> !<a class="code" href="AArch64Disassembler_8cpp.html#aae15979c93f7f0929116b975b5c46cd6">Fail</a>;</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;    }</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160; </div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="namespacellvm_1_1ARM.html#ab9b10a990ed66fe22b902e50f13382ec">operator--</a>() {</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="AArch64Disassembler_8cpp.html#aae15979c93f7f0929116b975b5c46cd6">Fail</a>)</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *&amp;Inst : Insts) {</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;        <span class="keywordflow">for</span> (Inst = Inst-&gt;<a class="code" href="classllvm_1_1ilist__node__with__parent.html#ae451867ac0034a201153b54cc466386d">getPrevNode</a>(); Inst &amp;&amp; isa&lt;DbgInfoIntrinsic&gt;(Inst);)</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;          Inst = Inst-&gt;<a class="code" href="classllvm_1_1ilist__node__with__parent.html#ae451867ac0034a201153b54cc466386d">getPrevNode</a>();</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;        <span class="comment">// Already at beginning of block.</span></div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;        <span class="keywordflow">if</span> (!Inst) {</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;          <a class="code" href="AArch64Disassembler_8cpp.html#aae15979c93f7f0929116b975b5c46cd6">Fail</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;          <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;        }</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;      }</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;    }</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160; </div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;    <span class="keywordtype">void</span> operator++() {</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="AArch64Disassembler_8cpp.html#aae15979c93f7f0929116b975b5c46cd6">Fail</a>)</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *&amp;Inst : Insts) {</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;        <span class="keywordflow">for</span> (Inst = Inst-&gt;<a class="code" href="classllvm_1_1ilist__node__with__parent.html#a26708685cc8b94fe3d7092ee080dbb34">getNextNode</a>(); Inst &amp;&amp; isa&lt;DbgInfoIntrinsic&gt;(Inst);)</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;          Inst = Inst-&gt;<a class="code" href="classllvm_1_1ilist__node__with__parent.html#a26708685cc8b94fe3d7092ee080dbb34">getNextNode</a>();</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;        <span class="comment">// Already at end of block.</span></div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;        <span class="keywordflow">if</span> (!Inst) {</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;          <a class="code" href="AArch64Disassembler_8cpp.html#aae15979c93f7f0929116b975b5c46cd6">Fail</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;          <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;        }</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;      }</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;    }</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160; </div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;    <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Instruction*&gt;</a> <a class="code" href="namespacellvm.html#a2366b4a30c90d2207626fb717dfb778d">operator * </a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;      <span class="keywordflow">return</span> Insts;</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;    }</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;  };</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160; </div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;<span class="comment">/// Check whether BB&#39;s predecessors end with unconditional branches. If it is</span></div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;<span class="comment">/// true, sink any common code from the predecessors to BB.</span></div>
<div class="line"><a name="l02096"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a483d3fcb928be402adb5c42809db8e58"> 2096</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a483d3fcb928be402adb5c42809db8e58">SinkCommonCodeFromPredecessors</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>,</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;                                           <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> *DTU) {</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;  <span class="comment">// We support two situations:</span></div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;  <span class="comment">//   (1) all incoming arcs are unconditional</span></div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;  <span class="comment">//   (2) there are non-unconditional incoming arcs</span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;  <span class="comment">// (2) is very common in switch defaults and</span></div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;  <span class="comment">// else-if patterns;</span></div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;  <span class="comment">//   if (a) f(1);</span></div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;  <span class="comment">//   else if (b) f(2);</span></div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;  <span class="comment">// produces:</span></div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;  <span class="comment">//       [if]</span></div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;  <span class="comment">//      /    \</span></div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;<span class="comment">  //    [f(1)] [if]</span></div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;  <span class="comment">//      |     | \</span></div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;<span class="comment">  //      |     |  |</span></div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;  <span class="comment">//      |  [f(2)]|</span></div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;  <span class="comment">//       \    | /</span></div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;  <span class="comment">//        [ end ]</span></div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;  <span class="comment">// [end] has two unconditional predecessor arcs and one conditional. The</span></div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;  <span class="comment">// conditional refers to the implicit empty &#39;else&#39; arc. This conditional</span></div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;  <span class="comment">// arc can also be caused by an empty default block in a switch.</span></div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;  <span class="comment">// In this case, we attempt to sink code from all *unconditional* arcs.</span></div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;  <span class="comment">// If we can sink instructions from these arcs (determined during the scan</span></div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;  <span class="comment">// phase below) we insert a common successor for all unconditional arcs and</span></div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;  <span class="comment">// connect that to [end], to enable sinking:</span></div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;  <span class="comment">//       [if]</span></div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;  <span class="comment">//      /    \</span></div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;<span class="comment">  //    [x(1)] [if]</span></div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;  <span class="comment">//      |     | \</span></div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;<span class="comment">  //      |     |  \</span></div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;<span class="comment">  //      |  [x(2)] |</span></div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;  <span class="comment">//       \   /    |</span></div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;  <span class="comment">//   [sink.split] |</span></div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;  <span class="comment">//         \     /</span></div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;  <span class="comment">//         [ end ]</span></div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock*,4&gt;</a> UnconditionalPreds;</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;  <span class="keywordtype">bool</span> HaveNonUnconditionalPredecessors = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *PredBB : <a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)) {</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;    <span class="keyword">auto</span> *PredBr = dyn_cast&lt;BranchInst&gt;(PredBB-&gt;getTerminator());</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;    <span class="keywordflow">if</span> (PredBr &amp;&amp; PredBr-&gt;isUnconditional())</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;      UnconditionalPreds.push_back(PredBB);</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;      HaveNonUnconditionalPredecessors = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;  }</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;  <span class="keywordflow">if</span> (UnconditionalPreds.size() &lt; 2)</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160; </div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;  <span class="comment">// We take a two-step approach to tail sinking. First we scan from the end of</span></div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;  <span class="comment">// each block upwards in lockstep. If the n&#39;th instruction from the end of each</span></div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;  <span class="comment">// block can be sunk, those instructions are added to ValuesToSink and we</span></div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;  <span class="comment">// carry on. If we can sink an instruction but need to PHI-merge some operands</span></div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;  <span class="comment">// (because they&#39;re not identical in each instruction) we add these to</span></div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;  <span class="comment">// PHIOperands.</span></div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;  <span class="keywordtype">int</span> ScanIdx = 0;</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value*,4&gt;</a> InstructionsToSink;</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Instruction*, SmallVector&lt;Value*,4&gt;</a>&gt; PHIOperands;</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;  LockstepReverseIterator LRI(UnconditionalPreds);</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;  <span class="keywordflow">while</span> (LRI.isValid() &amp;&amp;</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;         <a class="code" href="SimplifyCFG_8cpp.html#ab9f16e33daaafda2df2c0c79afe72e3e">canSinkInstructions</a>(*LRI, PHIOperands)) {</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SINK: instruction can be sunk: &quot;</span> &lt;&lt; *(*LRI)[0]</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;    InstructionsToSink.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>((*LRI).begin(), (*LRI).end());</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;    ++ScanIdx;</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;    --LRI;</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;  }</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160; </div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;  <span class="comment">// If no instructions can be sunk, early-return.</span></div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;  <span class="keywordflow">if</span> (ScanIdx == 0)</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160; </div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;  <span class="keywordtype">bool</span> followedByDeoptOrUnreachable = <a class="code" href="namespacellvm.html#a15055c7e3a33b44c293df24e4ba7bc5e">IsBlockFollowedByDeoptOrUnreachable</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160; </div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;  <span class="keywordflow">if</span> (!followedByDeoptOrUnreachable) {</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;    <span class="comment">// Okay, we *could* sink last ScanIdx instructions. But how many can we</span></div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;    <span class="comment">// actually sink before encountering instruction that is unprofitable to</span></div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;    <span class="comment">// sink?</span></div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;    <span class="keyword">auto</span> ProfitableToSinkInstruction = [&amp;](LockstepReverseIterator &amp;LRI) {</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;      <span class="keywordtype">unsigned</span> NumPHIdValues = 0;</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : *LRI)</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> *V : PHIOperands[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]) {</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;          <span class="keywordflow">if</span> (!InstructionsToSink.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#af74676a3c7447be34bd2c1da76ec0c48">contains</a>(V))</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;            ++NumPHIdValues;</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;          <span class="comment">// FIXME: this check is overly optimistic. We may end up not sinking</span></div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;          <span class="comment">// said instruction, due to the very same profitability check.</span></div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;          <span class="comment">// See @creating_too_many_phis in sink-common-code.ll.</span></div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;        }</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SINK: #phid values: &quot;</span> &lt;&lt; NumPHIdValues &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;      <span class="keywordtype">unsigned</span> NumPHIInsts = NumPHIdValues / UnconditionalPreds.size();</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;      <span class="keywordflow">if</span> ((NumPHIdValues % UnconditionalPreds.size()) != 0)</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;        NumPHIInsts++;</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160; </div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;      <span class="keywordflow">return</span> NumPHIInsts &lt;= 1;</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;    };</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160; </div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;    <span class="comment">// We&#39;ve determined that we are going to sink last ScanIdx instructions,</span></div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;    <span class="comment">// and recorded them in InstructionsToSink. Now, some instructions may be</span></div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;    <span class="comment">// unprofitable to sink. But that determination depends on the instructions</span></div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;    <span class="comment">// that we are going to sink.</span></div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160; </div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;    <span class="comment">// First, forward scan: find the first instruction unprofitable to sink,</span></div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;    <span class="comment">// recording all the ones that are profitable to sink.</span></div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;    <span class="comment">// FIXME: would it be better, after we detect that not all are profitable.</span></div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;    <span class="comment">// to either record the profitable ones, or erase the unprofitable ones?</span></div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;    <span class="comment">// Maybe we need to choose (at runtime) the one that will touch least</span></div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;    <span class="comment">// instrs?</span></div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;    LRI.reset();</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;    <span class="keywordtype">int</span> Idx = 0;</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value *, 4&gt;</a> InstructionsProfitableToSink;</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;    <span class="keywordflow">while</span> (Idx &lt; ScanIdx) {</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;      <span class="keywordflow">if</span> (!ProfitableToSinkInstruction(LRI)) {</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;        <span class="comment">// Too many PHIs would be created.</span></div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;            <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SINK: stopping here, too many PHIs would be created!\n&quot;</span>);</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;      }</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;      InstructionsProfitableToSink.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>((*LRI).begin(), (*LRI).end());</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;      --LRI;</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;      ++Idx;</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;    }</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160; </div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;    <span class="comment">// If no instructions can be sunk, early-return.</span></div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;    <span class="keywordflow">if</span> (Idx == 0)</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160; </div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;    <span class="comment">// Did we determine that (only) some instructions are unprofitable to sink?</span></div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;    <span class="keywordflow">if</span> (Idx &lt; ScanIdx) {</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;      <span class="comment">// Okay, some instructions are unprofitable.</span></div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;      ScanIdx = Idx;</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;      InstructionsToSink = InstructionsProfitableToSink;</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160; </div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;      <span class="comment">// But, that may make other instructions unprofitable, too.</span></div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;      <span class="comment">// So, do a backward scan, do any earlier instructions become</span></div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;      <span class="comment">// unprofitable?</span></div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;          !ProfitableToSinkInstruction(LRI) &amp;&amp;</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;          <span class="stringliteral">&quot;We already know that the last instruction is unprofitable to sink&quot;</span>);</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;      ++LRI;</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;      --Idx;</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;      <span class="keywordflow">while</span> (Idx &gt;= 0) {</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;        <span class="comment">// If we detect that an instruction becomes unprofitable to sink,</span></div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;        <span class="comment">// all earlier instructions won&#39;t be sunk either,</span></div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;        <span class="comment">// so preemptively keep InstructionsProfitableToSink in sync.</span></div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;        <span class="comment">// FIXME: is this the most performant approach?</span></div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : *LRI)</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;          InstructionsProfitableToSink.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a11045c7973ab24a8d6315b61fa337d4e">erase</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;        <span class="keywordflow">if</span> (!ProfitableToSinkInstruction(LRI)) {</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;          <span class="comment">// Everything starting with this instruction won&#39;t be sunk.</span></div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;          ScanIdx = Idx;</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;          InstructionsToSink = InstructionsProfitableToSink;</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;        }</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;        ++LRI;</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;        --Idx;</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;      }</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;    }</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160; </div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;    <span class="comment">// If no instructions can be sunk, early-return.</span></div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;    <span class="keywordflow">if</span> (ScanIdx == 0)</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;  }</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160; </div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160; </div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;  <span class="keywordflow">if</span> (HaveNonUnconditionalPredecessors) {</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;    <span class="keywordflow">if</span> (!followedByDeoptOrUnreachable) {</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;      <span class="comment">// It is always legal to sink common instructions from unconditional</span></div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;      <span class="comment">// predecessors. However, if not all predecessors are unconditional,</span></div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;      <span class="comment">// this transformation might be pessimizing. So as a rule of thumb,</span></div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;      <span class="comment">// don&#39;t do it unless we&#39;d sink at least one non-speculatable instruction.</span></div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;      <span class="comment">// See https://bugs.llvm.org/show_bug.cgi?id=30244</span></div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;      LRI.reset();</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;      <span class="keywordtype">int</span> Idx = 0;</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;      <span class="keywordtype">bool</span> Profitable = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;      <span class="keywordflow">while</span> (Idx &lt; ScanIdx) {</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#abe76d72cda6b2b4562c72accb510040b">isSafeToSpeculativelyExecute</a>((*LRI)[0])) {</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;          Profitable = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;        }</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;        --LRI;</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;        ++Idx;</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;      }</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;      <span class="keywordflow">if</span> (!Profitable)</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;    }</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160; </div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SINK: Splitting edge\n&quot;</span>);</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;    <span class="comment">// We have a conditional edge and we&#39;re going to sink some instructions.</span></div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;    <span class="comment">// Insert a new block postdominating all blocks we&#39;re going to sink from.</span></div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a9d391b6acc6d90c9b8a8442324b1aa6f">SplitBlockPredecessors</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, UnconditionalPreds, <span class="stringliteral">&quot;.sink.split&quot;</span>, DTU))</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;      <span class="comment">// Edges couldn&#39;t be split.</span></div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;    Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;  }</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160; </div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;  <span class="comment">// Now that we&#39;ve analyzed all potential sinking candidates, perform the</span></div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;  <span class="comment">// actual sink. We iteratively sink the last non-terminator of the source</span></div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;  <span class="comment">// blocks into their common successor unless doing so would require too</span></div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;  <span class="comment">// many PHI instructions to be generated (currently only one PHI is allowed</span></div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;  <span class="comment">// per sunk instruction).</span></div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;  <span class="comment">// We can use InstructionsToSink to discount values needing PHI-merging that will</span></div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;  <span class="comment">// actually be sunk in a later iteration. This allows us to be more</span></div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;  <span class="comment">// aggressive in what we sink. This does allow a false positive where we</span></div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;  <span class="comment">// sink presuming a later value will also be sunk, but stop half way through</span></div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;  <span class="comment">// and never actually sink it which means we produce more PHIs than intended.</span></div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;  <span class="comment">// This is unlikely in practice though.</span></div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;  <span class="keywordtype">int</span> SinkIdx = 0;</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;  <span class="keywordflow">for</span> (; SinkIdx != ScanIdx; ++SinkIdx) {</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SINK: Sink: &quot;</span></div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;                      &lt;&lt; *UnconditionalPreds[0]-&gt;getTerminator()-&gt;getPrevNode()</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160; </div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;    <span class="comment">// Because we&#39;ve sunk every instruction in turn, the current instruction to</span></div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;    <span class="comment">// sink is always at index 0.</span></div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;    LRI.reset();</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160; </div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#ac4fdfa685be0e2568187936221316c47">sinkLastInstruction</a>(UnconditionalPreds)) {</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;          <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;SINK: stopping here, failed to actually sink instruction!\n&quot;</span>);</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;    }</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160; </div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;    NumSinkCommonInstrs++;</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;    Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;  }</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;  <span class="keywordflow">if</span> (SinkIdx != 0)</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;    ++NumSinkCommonCode;</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;}</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160; </div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160; </div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;<span class="keyword">struct </span>CompatibleSets {</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;  <span class="keyword">using</span> SetTy = <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;InvokeInst *, 2&gt;</a>;</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160; </div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;SetTy, 1&gt;</a> Sets;</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160; </div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> shouldBelongToSameSet(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;InvokeInst *&gt;</a> Invokes);</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160; </div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;  SetTy &amp;getCompatibleSet(<a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II);</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160; </div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;  <span class="keywordtype">void</span> insert(<a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II);</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;};</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160; </div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;<a class="code" href="classllvm_1_1SmallVector.html">CompatibleSets::SetTy</a> &amp;CompatibleSets::getCompatibleSet(<a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II) {</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;  <span class="comment">// Perform a linear scan over all the existing sets, see if the new `invoke`</span></div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;  <span class="comment">// is compatible with any particular set. Since we know that all the `invokes`</span></div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;  <span class="comment">// within a set are compatible, only check the first `invoke` in each set.</span></div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;  <span class="comment">// WARNING: at worst, this has quadratic complexity.</span></div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVector.html">CompatibleSets::SetTy</a> &amp;Set : Sets) {</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;    <span class="keywordflow">if</span> (CompatibleSets::shouldBelongToSameSet({Set.front(), II}))</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;      <span class="keywordflow">return</span> Set;</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;  }</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160; </div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;  <span class="comment">// Otherwise, we either had no sets yet, or this invoke forms a new set.</span></div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;  <span class="keywordflow">return</span> Sets.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>();</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;}</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160; </div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;<span class="keywordtype">void</span> CompatibleSets::insert(<a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II) {</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;  getCompatibleSet(II).emplace_back(II);</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;}</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160; </div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;<span class="keywordtype">bool</span> CompatibleSets::shouldBelongToSameSet(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;InvokeInst *&gt;</a> Invokes) {</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Invokes.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == 2 &amp;&amp; <span class="stringliteral">&quot;Always called with exactly two candidates.&quot;</span>);</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160; </div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;  <span class="comment">// Can we theoretically merge these `invoke`s?</span></div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;  <span class="keyword">auto</span> IsIllegalToMerge = [](<a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II) {</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;    <span class="keywordflow">return</span> II-&gt;<a class="code" href="classllvm_1_1CallBase.html#a08daddd36adb2d47a22de9b6177c7110">cannotMerge</a>() || II-&gt;<a class="code" href="classllvm_1_1CallBase.html#a018f0394a375233d538109968b76a05a">isInlineAsm</a>();</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;  };</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(Invokes, IsIllegalToMerge))</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160; </div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;  <span class="comment">// Either both `invoke`s must be   direct,</span></div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;  <span class="comment">// or     both `invoke`s must be indirect.</span></div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;  <span class="keyword">auto</span> IsIndirectCall = [](<a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II) { <span class="keywordflow">return</span> II-&gt;<a class="code" href="classllvm_1_1CallBase.html#a574efc7d85ff014d5f15e077f3c82e6b">isIndirectCall</a>(); };</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;  <span class="keywordtype">bool</span> HaveIndirectCalls = <a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(Invokes, IsIndirectCall);</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;  <span class="keywordtype">bool</span> AllCallsAreIndirect = <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(Invokes, IsIndirectCall);</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;  <span class="keywordflow">if</span> (HaveIndirectCalls) {</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;    <span class="keywordflow">if</span> (!AllCallsAreIndirect)</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;    <span class="comment">// All callees must be identical.</span></div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II : Invokes) {</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *CurrCallee = II-&gt;<a class="code" href="classllvm_1_1CallBase.html#a7ac9329ef7292ee640d87f45ce7ae05c">getCalledOperand</a>();</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CurrCallee &amp;&amp; <span class="stringliteral">&quot;There is always a called operand.&quot;</span>);</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;      <span class="keywordflow">if</span> (!Callee)</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;        <a class="code" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a> = CurrCallee;</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Callee != CurrCallee)</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;    }</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;  }</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160; </div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;  <span class="comment">// Either both `invoke`s must not have a normal destination,</span></div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;  <span class="comment">// or     both `invoke`s must     have a normal destination,</span></div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;  <span class="keyword">auto</span> HasNormalDest = [](<a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II) {</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;    <span class="keywordflow">return</span> !isa&lt;UnreachableInst&gt;(II-&gt;<a class="code" href="classllvm_1_1InvokeInst.html#a100bd3005ea84bf47f3b4021e8022633">getNormalDest</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a94c9bd7b123be808934be99e1bcedd24">getFirstNonPHIOrDbg</a>());</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;  };</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(Invokes, HasNormalDest)) {</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;    <span class="comment">// Do not merge `invoke` that does not have a normal destination with one</span></div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;    <span class="comment">// that does have a normal destination, even though doing so would be legal.</span></div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(Invokes, HasNormalDest))</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160; </div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;    <span class="comment">// All normal destinations must be identical.</span></div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *NormalBB = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II : Invokes) {</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *CurrNormalBB = II-&gt;<a class="code" href="classllvm_1_1InvokeInst.html#a100bd3005ea84bf47f3b4021e8022633">getNormalDest</a>();</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CurrNormalBB &amp;&amp; <span class="stringliteral">&quot;There is always a &#39;continue to&#39; basic block.&quot;</span>);</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;      <span class="keywordflow">if</span> (!NormalBB)</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;        NormalBB = CurrNormalBB;</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NormalBB != CurrNormalBB)</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;    }</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160; </div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;    <span class="comment">// In the normal destination, the incoming values for these two `invoke`s</span></div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;    <span class="comment">// must be compatible.</span></div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value *, 16&gt;</a> EquivalenceSet(Invokes.begin(), Invokes.end());</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#a650b03916ebf8e695751b1246cd6de0e">IncomingValuesAreCompatible</a>(</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;            NormalBB, {Invokes[0]-&gt;getParent(), Invokes[1]-&gt;<a class="code" href="BasicAliasAnalysis_8cpp.html#a2675de1d8479c7b00387979714da43f7">getParent</a>()},</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;            &amp;EquivalenceSet))</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;  }</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160; </div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;  <span class="comment">// All unwind destinations must be identical.</span></div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;  <span class="comment">// We know that because we have started from said unwind destination.</span></div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *UnwindBB = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II : Invokes) {</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *CurrUnwindBB = II-&gt;<a class="code" href="classllvm_1_1InvokeInst.html#a5ba379c3251d99b4c23c8f2e6abe4a6c">getUnwindDest</a>();</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CurrUnwindBB &amp;&amp; <span class="stringliteral">&quot;There is always an &#39;unwind to&#39; basic block.&quot;</span>);</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;    <span class="keywordflow">if</span> (!UnwindBB)</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;      UnwindBB = CurrUnwindBB;</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(UnwindBB == CurrUnwindBB &amp;&amp; <span class="stringliteral">&quot;Unexpected unwind destination.&quot;</span>);</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;  }</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160; </div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;  <span class="comment">// In the unwind destination, the incoming values for these two `invoke`s</span></div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;  <span class="comment">// must be compatible.</span></div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#a650b03916ebf8e695751b1246cd6de0e">IncomingValuesAreCompatible</a>(</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;          Invokes.front()-&gt;getUnwindDest(),</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;          {Invokes[0]-&gt;getParent(), Invokes[1]-&gt;getParent()}))</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160; </div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;  <span class="comment">// Ignoring arguments, these `invoke`s must be identical,</span></div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;  <span class="comment">// including operand bundles.</span></div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II0 = Invokes.front();</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *II : Invokes.drop_front())</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;    <span class="keywordflow">if</span> (!II-&gt;<a class="code" href="classllvm_1_1Instruction.html#a25175390eaee0646bcb8b30990ab723b">isSameOperationAs</a>(II0))</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160; </div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;  <span class="comment">// Can we theoretically form the data operands for the merged `invoke`?</span></div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;  <span class="keyword">auto</span> IsIllegalToMergeArguments = [](<span class="keyword">auto</span> Ops) {</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = std::get&lt;0&gt;(Ops)-&gt;getType();</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Ty == std::get&lt;1&gt;(Ops)-&gt;<a class="code" href="M68kELFObjectWriter_8cpp.html#ae4a8bc3879d2282eefd72b16b12c2a37">getType</a>() &amp;&amp; <span class="stringliteral">&quot;Incompatible types?&quot;</span>);</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;    <span class="keywordflow">return</span> Ty-&gt;<a class="code" href="classllvm_1_1Type.html#ac9542ee3a689ae9574b7807c96107d89">isTokenTy</a>() &amp;&amp; std::get&lt;0&gt;(Ops) != std::get&lt;1&gt;(Ops);</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;  };</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Invokes.size() == 2 &amp;&amp; <span class="stringliteral">&quot;Always called with exactly two candidates.&quot;</span>);</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(<a class="code" href="namespacellvm.html#a2edb650de7b28add81349f5abf7ed7aa">zip</a>(Invokes[0]-&gt;data_ops(), Invokes[1]-&gt;data_ops()),</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;             IsIllegalToMergeArguments))</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160; </div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;}</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160; </div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;} <span class="comment">// namespace</span></div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160; </div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;<span class="comment">// Merge all invokes in the provided set, all of which are compatible</span></div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;<span class="comment">// as per the `CompatibleSets::shouldBelongToSameSet()`.</span></div>
<div class="line"><a name="l02474"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#ad2e3d83724bf6fb52cb43e94a467e0c6"> 2474</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="SimplifyCFG_8cpp.html#ad2e3d83724bf6fb52cb43e94a467e0c6">MergeCompatibleInvokesImpl</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;InvokeInst *&gt;</a> Invokes,</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;                                       <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> *DTU) {</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Invokes.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() &gt;= 2 &amp;&amp; <span class="stringliteral">&quot;Must have at least two invokes to merge.&quot;</span>);</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160; </div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;DominatorTree::UpdateType, 8&gt;</a> Updates;</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;  <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;    Updates.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(2 + 3 * Invokes.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160; </div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;  <span class="keywordtype">bool</span> HasNormalDest =</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;      !isa&lt;UnreachableInst&gt;(Invokes[0]-&gt;getNormalDest()-&gt;getFirstNonPHIOrDbg());</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160; </div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;  <span class="comment">// Clone one of the invokes into a new basic block.</span></div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;  <span class="comment">// Since they are all compatible, it doesn&#39;t matter which invoke is cloned.</span></div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;  <a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *MergedInvoke = [&amp;Invokes, HasNormalDest]() {</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;    <a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II0 = Invokes.<a class="code" href="classllvm_1_1ArrayRef.html#a6bc2b53fce3b1d8975eea027d8a8eb90">front</a>();</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *II0BB = II0-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *InsertBeforeBlock =</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;        II0-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>()-&gt;getNextNode();</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;    <a class="code" href="classllvm_1_1Function.html">Function</a> *Func = II0BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">getParent</a>();</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;    <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = II0-&gt;<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>();</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160; </div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *MergedInvokeBB = <a class="code" href="classllvm_1_1BasicBlock.html#ace940beeee97c222f836fe0ac70f6cf5">BasicBlock::Create</a>(</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;        Ctx, II0BB-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + <span class="stringliteral">&quot;.invoke&quot;</span>, Func, InsertBeforeBlock);</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160; </div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;    <span class="keyword">auto</span> *MergedInvoke = cast&lt;InvokeInst&gt;(II0-&gt;<a class="code" href="classllvm_1_1Instruction.html#a0a4d51e372293abe5e5f6dac133e80a6">clone</a>());</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;    <span class="comment">// NOTE: all invokes have the same attributes, so no handling needed.</span></div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;    MergedInvoke-&gt;<a class="code" href="classllvm_1_1Instruction.html#ad8c5093a18a40f863d4fc5fa6eefefa8">insertInto</a>(MergedInvokeBB, MergedInvokeBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160; </div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;    <span class="keywordflow">if</span> (!HasNormalDest) {</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;      <span class="comment">// This set does not have a normal destination,</span></div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;      <span class="comment">// so just form a new block with unreachable terminator.</span></div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *MergedNormalDest = <a class="code" href="classllvm_1_1BasicBlock.html#ace940beeee97c222f836fe0ac70f6cf5">BasicBlock::Create</a>(</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;          Ctx, II0BB-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + <span class="stringliteral">&quot;.cont&quot;</span>, Func, InsertBeforeBlock);</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;      <span class="keyword">new</span> <a class="code" href="classllvm_1_1UnreachableInst.html">UnreachableInst</a>(Ctx, MergedNormalDest);</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;      MergedInvoke-&gt;<a class="code" href="classllvm_1_1InvokeInst.html#a2d3bf0d61fe883d8ceb95c68e03db669">setNormalDest</a>(MergedNormalDest);</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;    }</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160; </div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;    <span class="comment">// The unwind destination, however, remainds identical for all invokes here.</span></div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160; </div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;    <span class="keywordflow">return</span> MergedInvoke;</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;  }();</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160; </div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;  <span class="keywordflow">if</span> (DTU) {</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;    <span class="comment">// Predecessor blocks that contained these invokes will now branch to</span></div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;    <span class="comment">// the new block that contains the merged invoke, ...</span></div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II : Invokes)</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;      Updates.push_back(</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;          {<a class="code" href="classllvm_1_1DominatorTreeBase.html#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, II-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>(), MergedInvoke-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()});</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160; </div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;    <span class="comment">// ... which has the new `unreachable` block as normal destination,</span></div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;    <span class="comment">// or unwinds to the (same for all `invoke`s in this set) `landingpad`,</span></div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *SuccBBOfMergedInvoke : <a class="code" href="namespacellvm.html#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(MergedInvoke))</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;      Updates.push_back({<a class="code" href="classllvm_1_1DominatorTreeBase.html#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, MergedInvoke-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>(),</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;                         SuccBBOfMergedInvoke});</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160; </div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;    <span class="comment">// Since predecessor blocks now unconditionally branch to a new block,</span></div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;    <span class="comment">// they no longer branch to their original successors.</span></div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II : Invokes)</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *SuccOfPredBB : <a class="code" href="namespacellvm.html#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(II-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()))</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;        Updates.push_back(</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;            {<a class="code" href="classllvm_1_1DominatorTreeBase.html#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, II-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>(), SuccOfPredBB});</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;  }</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160; </div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;  <span class="keywordtype">bool</span> IsIndirectCall = Invokes[0]-&gt;isIndirectCall();</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160; </div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;  <span class="comment">// Form the merged operands for the merged invoke.</span></div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U : MergedInvoke-&gt;operands()) {</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;    <span class="comment">// Only PHI together the indirect callees and data operands.</span></div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;    <span class="keywordflow">if</span> (MergedInvoke-&gt;isCallee(&amp;U)) {</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;      <span class="keywordflow">if</span> (!IsIndirectCall)</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!MergedInvoke-&gt;isDataOperand(&amp;U))</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160; </div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;    <span class="comment">// Don&#39;t create trivial PHI&#39;s with all-identical incoming values.</span></div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;    <span class="keywordtype">bool</span> NeedPHI = <a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(Invokes, [&amp;U](<a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II) {</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;      <span class="keywordflow">return</span> II-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(U.getOperandNo()) != U.get();</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;    });</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;    <span class="keywordflow">if</span> (!NeedPHI)</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160; </div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;    <span class="comment">// Form a PHI out of all the data ops under this index.</span></div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = <a class="code" href="classllvm_1_1PHINode.html#ab0ff669b12c20c07137705c38872ec63">PHINode::Create</a>(</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;        U-&gt;getType(), <span class="comment">/*NumReservedValues=*/</span>Invokes.size(), <span class="stringliteral">&quot;&quot;</span>, MergedInvoke);</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II : Invokes)</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;      PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(II-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(U.getOperandNo()), II-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>());</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160; </div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;    U.set(PN);</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;  }</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160; </div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;  <span class="comment">// We&#39;ve ensured that each PHI node has compatible (identical) incoming values</span></div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;  <span class="comment">// when coming from each of the `invoke`s in the current merge set,</span></div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;  <span class="comment">// so update the PHI nodes accordingly.</span></div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ : <a class="code" href="namespacellvm.html#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(MergedInvoke))</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#a41a075ef4b76f72591e86e1fe13f096d">AddPredecessorToBlock</a>(Succ, <span class="comment">/*NewPred=*/</span>MergedInvoke-&gt;getParent(),</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;                          <span class="comment">/*ExistPred=*/</span>Invokes.front()-&gt;getParent());</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160; </div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;  <span class="comment">// And finally, replace the original `invoke`s with an unconditional branch</span></div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;  <span class="comment">// to the block with the merged `invoke`. Also, give that merged `invoke`</span></div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;  <span class="comment">// the merged debugloc of all the original `invoke`s.</span></div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DILocation.html">DILocation</a> *MergedDebugLoc = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II : Invokes) {</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;    <span class="comment">// Compute the debug location common to all the original `invoke`s.</span></div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;    <span class="keywordflow">if</span> (!MergedDebugLoc)</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;      MergedDebugLoc = II-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4f3bf98b5054831b608852e33427814">getDebugLoc</a>();</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;      MergedDebugLoc =</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;          <a class="code" href="classllvm_1_1DILocation.html#accc5dccb020fb7b324fcfb2d221c1a19">DILocation::getMergedLocation</a>(MergedDebugLoc, II-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4f3bf98b5054831b608852e33427814">getDebugLoc</a>());</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160; </div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;    <span class="comment">// And replace the old `invoke` with an unconditionally branch</span></div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;    <span class="comment">// to the block with the merged `invoke`.</span></div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *OrigSuccBB : <a class="code" href="namespacellvm.html#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(II-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()))</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;      OrigSuccBB-&gt;removePredecessor(II-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>());</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;    <a class="code" href="classllvm_1_1BranchInst.html#a38df51256d4b415b6a817b5e1c6d4d36">BranchInst::Create</a>(MergedInvoke-&gt;getParent(), II-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>());</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;    II-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(MergedInvoke);</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;    II-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;    ++NumInvokesMerged;</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;  }</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;  MergedInvoke-&gt;setDebugLoc(MergedDebugLoc);</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;  ++NumInvokeSetsFormed;</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160; </div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;  <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;    DTU-&gt;applyUpdates(Updates);</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;}</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;<span class="comment">/// If this block is a `landingpad` exception handling block, categorize all</span></div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;<span class="comment">/// the predecessor `invoke`s into sets, with all `invoke`s in each set</span></div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;<span class="comment">/// being &quot;mergeable&quot; together, and then merge invokes in each set together.</span></div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;<span class="comment">/// This is a weird mix of hoisting and sinking. Visually, it goes from:</span></div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;<span class="comment">///          [...]        [...]</span></div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;<span class="comment">///            |            |</span></div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;<span class="comment">///        [invoke0]    [invoke1]</span></div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;<span class="comment">///           / \          / \</span></div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;<span class="comment">///     [cont0] [landingpad] [cont1]</span></div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;<span class="comment">/// to:</span></div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;<span class="comment">///      [...] [...]</span></div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;<span class="comment">///          \ /</span></div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;<span class="comment">///       [invoke]</span></div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;<span class="comment">///          / \</span></div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;<span class="comment">///     [cont] [landingpad]</span></div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;<span class="comment">/// But of course we can only do that if the invokes share the `landingpad`,</span></div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;<span class="comment">/// edges invoke0-&gt;cont0 and invoke1-&gt;cont1 are &quot;compatible&quot;,</span></div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;<span class="comment">/// and the invoked functions are &quot;compatible&quot;.</span></div>
<div class="line"><a name="l02619"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#aead732ab028930952db3ce9c38165276"> 2619</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#aead732ab028930952db3ce9c38165276">MergeCompatibleInvokes</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> *DTU) {</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#ae4337c482999ffe46512754ba3a077c7">EnableMergeCompatibleInvokes</a>)</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160; </div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160; </div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;  <span class="comment">// FIXME: generalize to all exception handling blocks?</span></div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;isLandingPad())</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;    <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160; </div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;  CompatibleSets Grouper;</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160; </div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;  <span class="comment">// Record all the predecessors of this `landingpad`. As per verifier,</span></div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;  <span class="comment">// the only allowed predecessor is the unwind edge of an `invoke`.</span></div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;  <span class="comment">// We want to group &quot;compatible&quot; `invokes` into the same set to be merged.</span></div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PredBB : <a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>))</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;    Grouper.insert(cast&lt;InvokeInst&gt;(PredBB-&gt;getTerminator()));</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160; </div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;  <span class="comment">// And now, merge `invoke`s that were grouped togeter.</span></div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;InvokeInst *&gt;</a> Invokes : Grouper.Sets) {</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;    <span class="keywordflow">if</span> (Invokes.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() &lt; 2)</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;    Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#ad2e3d83724bf6fb52cb43e94a467e0c6">MergeCompatibleInvokesImpl</a>(Invokes, DTU);</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;  }</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160; </div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;}</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160; </div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;<span class="comment">/// Track ephemeral values, which should be ignored for cost-modelling</span></div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;<span class="comment">/// purposes. Requires walking instructions in reverse order.</span></div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;<span class="comment"></span><span class="keyword">class </span>EphemeralValueTracker {</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const Instruction *, 32&gt;</a> EphValues;</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160; </div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;  <span class="keywordtype">bool</span> isEphemeral(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;    <span class="keywordflow">if</span> (isa&lt;AssumeInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;    <span class="keywordflow">return</span> !<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayHaveSideEffects() &amp;&amp; !<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isTerminator() &amp;&amp;</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;           <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;users(), [&amp;](<span class="keyword">const</span> <a class="code" href="classllvm_1_1User.html">User</a> *U) {</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;             return EphValues.count(cast&lt;Instruction&gt;(U));</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;           });</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;  }</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160; </div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;  <span class="keywordtype">bool</span> track(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;    <span class="keywordflow">if</span> (isEphemeral(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;      EphValues.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;    }</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;  }</div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160; </div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#a1112b818386ec01ddfdf3a5d0024eb17">contains</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> EphValues.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#af74676a3c7447be34bd2c1da76ec0c48">contains</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>); }</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;};</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;} <span class="comment">// namespace</span></div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;<span class="comment">/// Determine if we can hoist sink a sole store instruction out of a</span></div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;<span class="comment">/// conditional block.</span></div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;<span class="comment">/// We are looking for code like the following:</span></div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;<span class="comment">///   BrBB:</span></div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;<span class="comment">///     store i32 %add, i32* %arrayidx2</span></div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;<span class="comment">///     ... // No other stores or function calls (we could be calling a memory</span></div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;<span class="comment">///     ... // function).</span></div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;<span class="comment">///     %cmp = icmp ult %x, %y</span></div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;<span class="comment">///     br i1 %cmp, label %EndBB, label %ThenBB</span></div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;<span class="comment">///   ThenBB:</span></div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;<span class="comment">///     store i32 %add5, i32* %arrayidx2</span></div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;<span class="comment">///     br label EndBB</span></div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;<span class="comment">///   EndBB:</span></div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;<span class="comment">///     ...</span></div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;<span class="comment">///   We are going to transform this into:</span></div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;<span class="comment">///   BrBB:</span></div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;<span class="comment">///     store i32 %add, i32* %arrayidx2</span></div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;<span class="comment">///     ... //</span></div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;<span class="comment">///     %cmp = icmp ult %x, %y</span></div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;<span class="comment">///     %add.add5 = select i1 %cmp, i32 %add, %add5</span></div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;<span class="comment">///     store i32 %add.add5, i32* %arrayidx2</span></div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;<span class="comment">///     ...</span></div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;<span class="comment">/// \return The pointer to the value of the previous store if the store can be</span></div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;<span class="comment">///         hoisted into the predecessor block. 0 otherwise.</span></div>
<div class="line"><a name="l02702"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a2ced9ed2427730cd9b6903f00cd22e4d"> 2702</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="SimplifyCFG_8cpp.html#a2ced9ed2427730cd9b6903f00cd22e4d">isSafeToSpeculateStore</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BrBB,</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;                                     <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *StoreBB, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *EndBB) {</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;  <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *StoreToHoist = dyn_cast&lt;StoreInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;  <span class="keywordflow">if</span> (!StoreToHoist)</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160; </div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;  <span class="comment">// Volatile or atomic.</span></div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;  <span class="keywordflow">if</span> (!StoreToHoist-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a70f38e046a2d6f8d9b40e092eda2c919">isSimple</a>())</div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160; </div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *StorePtr = StoreToHoist-&gt;<a class="code" href="classllvm_1_1StoreInst.html#ac03c1c093059ea000216af8dd6f2dbf4">getPointerOperand</a>();</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *StoreTy = StoreToHoist-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a14298313bdf734e2db5a921cc6e861a0">getValueOperand</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160; </div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;  <span class="comment">// Look for a store to the same pointer in BrBB.</span></div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;  <span class="keywordtype">unsigned</span> MaxNumInstToLookAt = 9;</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;  <span class="comment">// Skip pseudo probe intrinsic calls which are not really killing any memory</span></div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;  <span class="comment">// accesses.</span></div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;CurI : <a class="code" href="namespacellvm.html#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(BrBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a2069641f358ef416658a2f321ca19d74">instructionsWithoutDebug</a>(<span class="keyword">true</span>))) {</div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;    <span class="keywordflow">if</span> (!MaxNumInstToLookAt)</div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;    --MaxNumInstToLookAt;</div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160; </div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;    <span class="comment">// Could be calling an instruction that affects memory like free().</span></div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;    <span class="keywordflow">if</span> (CurI.mayWriteToMemory() &amp;&amp; !isa&lt;StoreInst&gt;(CurI))</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160; </div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;StoreInst&gt;(&amp;CurI)) {</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;      <span class="comment">// Found the previous store to same location and type. Make sure it is</span></div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;      <span class="comment">// simple, to avoid introducing a spurious non-atomic write after an</span></div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;      <span class="comment">// atomic write.</span></div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getPointerOperand() == StorePtr &amp;&amp;</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;          <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getValueOperand()-&gt;getType() == StoreTy &amp;&amp; <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;isSimple())</div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;        <span class="comment">// Found the previous store, return its value operand.</span></div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getValueOperand();</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>; <span class="comment">// Unknown store.</span></div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;    }</div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160; </div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *LI = dyn_cast&lt;LoadInst&gt;(&amp;CurI)) {</div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;      <span class="keywordflow">if</span> (LI-&gt;getPointerOperand() == StorePtr &amp;&amp; LI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() == StoreTy &amp;&amp;</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;          LI-&gt;isSimple()) {</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;        <span class="comment">// Local objects (created by an `alloca` instruction) are always</span></div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;        <span class="comment">// writable, so once we are past a read from a location it is valid to</span></div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;        <span class="comment">// also write to that same location.</span></div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;        <span class="comment">// If the address of the local object never escapes the function, that</span></div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;        <span class="comment">// means it&#39;s never concurrently read or written, hence moving the store</span></div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;        <span class="comment">// from under the condition will not introduce a data race.</span></div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;        <span class="keyword">auto</span> *AI = dyn_cast&lt;AllocaInst&gt;(<a class="code" href="namespacellvm.html#a3b1c5788b85ffa254be0e834edf5cf8f">getUnderlyingObject</a>(StorePtr));</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;        <span class="keywordflow">if</span> (AI &amp;&amp; !<a class="code" href="namespacellvm.html#a7912b6c9e7843ca9fd5a11e199bef617">PointerMayBeCaptured</a>(AI, <span class="keyword">false</span>, <span class="keyword">true</span>))</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;          <span class="comment">// Found a previous load, return it.</span></div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;          <span class="keywordflow">return</span> LI;</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;      }</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;      <span class="comment">// The load didn&#39;t work out, but we may still find a store.</span></div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;    }</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;  }</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160; </div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;}</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;<span class="comment">/// Estimate the cost of the insertion(s) and check that the PHI nodes can be</span></div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;<span class="comment">/// converted to selects.</span></div>
<div class="line"><a name="l02762"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a0b4c48d53ab1ddc5bf009cd4ddffdc5a"> 2762</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a0b4c48d53ab1ddc5bf009cd4ddffdc5a">validateAndCostRequiredSelects</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *ThenBB,</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;                                           <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *EndBB,</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;                                           <span class="keywordtype">unsigned</span> &amp;SpeculatedInstructions,</div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;                                           <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> &amp;Cost,</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;                                           <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) {</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;  <a class="code" href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bb">TargetTransformInfo::TargetCostKind</a> <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a> =</div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;    <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getParent()-&gt;hasMinSize()</div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;    ? TargetTransformInfo::TCK_CodeSize</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;    : TargetTransformInfo::TCK_SizeAndLatency;</div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160; </div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;  <span class="keywordtype">bool</span> HaveRewritablePHIs = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> &amp;PN : EndBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a72516971c5734dc0f7546e64affca425">phis</a>()) {</div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *OrigV = PN.<a class="code" href="classllvm_1_1PHINode.html#adfb61ffe25c950c75c86310245b3ef39">getIncomingValueForBlock</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *ThenV = PN.<a class="code" href="classllvm_1_1PHINode.html#adfb61ffe25c950c75c86310245b3ef39">getIncomingValueForBlock</a>(ThenBB);</div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160; </div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;    <span class="comment">// FIXME: Try to remove some of the duplication with HoistThenElseCodeToIf.</span></div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;    <span class="comment">// Skip PHIs which are trivial.</span></div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;    <span class="keywordflow">if</span> (ThenV == OrigV)</div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160; </div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;    <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> += <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>.<a class="code" href="classllvm_1_1TargetTransformInfo.html#af89277d8bd76d6348291e29b6076796a">getCmpSelInstrCost</a>(<a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Instruction::Select</a>, PN.<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), <span class="keyword">nullptr</span>,</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;                                   CmpInst::BAD_ICMP_PREDICATE, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>);</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160; </div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;    <span class="comment">// Don&#39;t convert to selects if we could remove undefined behavior instead.</span></div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a32c2973fa0babdd440d3ab7dd160664a">passingValueIsAlwaysUndefined</a>(OrigV, &amp;PN) ||</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;        <a class="code" href="SimplifyCFG_8cpp.html#a32c2973fa0babdd440d3ab7dd160664a">passingValueIsAlwaysUndefined</a>(ThenV, &amp;PN))</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160; </div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;    HaveRewritablePHIs = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;    <a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *OrigCE = dyn_cast&lt;ConstantExpr&gt;(OrigV);</div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;    <a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *ThenCE = dyn_cast&lt;ConstantExpr&gt;(ThenV);</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;    <span class="keywordflow">if</span> (!OrigCE &amp;&amp; !ThenCE)</div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;      <span class="keywordflow">continue</span>; <span class="comment">// Known cheap (FIXME: Maybe not true for aggregates).</span></div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160; </div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;    <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> OrigCost = OrigCE ? <a class="code" href="SimplifyCFG_8cpp.html#a9ac94808486f1c47e5cc9ba62dcc6fae">computeSpeculationCost</a>(OrigCE, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) : 0;</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;    <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> ThenCost = ThenCE ? <a class="code" href="SimplifyCFG_8cpp.html#a9ac94808486f1c47e5cc9ba62dcc6fae">computeSpeculationCost</a>(ThenCE, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) : 0;</div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;    <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> MaxCost =</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;        2 * <a class="code" href="SimplifyCFG_8cpp.html#a51d993ac59a51760ec7a9c7a1738755a">PHINodeFoldingThreshold</a> * TargetTransformInfo::TCC_Basic;</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;    <span class="keywordflow">if</span> (OrigCost + ThenCost &gt; MaxCost)</div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160; </div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;    <span class="comment">// Account for the cost of an unfolded ConstantExpr which could end up</span></div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;    <span class="comment">// getting expanded into Instructions.</span></div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;    <span class="comment">// FIXME: This doesn&#39;t account for how many operations are combined in the</span></div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;    <span class="comment">// constant expression.</span></div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;    ++SpeculatedInstructions;</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;    <span class="keywordflow">if</span> (SpeculatedInstructions &gt; 1)</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;  }</div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160; </div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;  <span class="keywordflow">return</span> HaveRewritablePHIs;</div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;}</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;<span class="comment">/// Speculate a conditional basic block flattening the CFG.</span></div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;<span class="comment">/// Note that this is a very risky transform currently. Speculating</span></div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;<span class="comment">/// instructions like this is most often not desirable. Instead, there is an MI</span></div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;<span class="comment">/// pass which can do it with full awareness of the resource constraints.</span></div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;<span class="comment">/// However, some cases are &quot;obvious&quot; and we should do directly. An example of</span></div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;<span class="comment">/// this is speculating a single, reasonably cheap instruction.</span></div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;<span class="comment">/// There is only one distinct advantage to flattening the CFG at the IR level:</span></div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;<span class="comment">/// it makes very common but simplistic optimizations such as are common in</span></div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;<span class="comment">/// instcombine and the DAG combiner more powerful by removing CFG edges and</span></div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;<span class="comment">/// modeling their effects with easier to reason about SSA value graphs.</span></div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;<span class="comment">/// An illustration of this transform is turning this IR:</span></div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;<span class="comment">/// \code</span></div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;<span class="comment">///   BB:</span></div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;<span class="comment">///     %cmp = icmp ult %x, %y</span></div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;<span class="comment">///     br i1 %cmp, label %EndBB, label %ThenBB</span></div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;<span class="comment">///   ThenBB:</span></div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;<span class="comment">///     %sub = sub %x, %y</span></div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;<span class="comment">///     br label BB2</span></div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;<span class="comment">///   EndBB:</span></div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;<span class="comment">///     %phi = phi [ %sub, %ThenBB ], [ 0, %EndBB ]</span></div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;<span class="comment">///     ...</span></div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;<span class="comment">/// \endcode</span></div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;<span class="comment">/// Into this IR:</span></div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;<span class="comment">/// \code</span></div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;<span class="comment">///   BB:</span></div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;<span class="comment">///     %cmp = icmp ult %x, %y</span></div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;<span class="comment">///     %sub = sub %x, %y</span></div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;<span class="comment">///     %cond = select i1 %cmp, 0, %sub</span></div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;<span class="comment">///     ...</span></div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;<span class="comment">/// \endcode</span></div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;<span class="comment">/// \returns true if the conditional block is removed.</span></div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> SimplifyCFGOpt::SpeculativelyExecuteBB(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *ThenBB,</div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;                                            <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) {</div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;  <span class="comment">// Be conservative for now. FP select instruction can often be expensive.</span></div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *BrCond = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>();</div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;  <span class="keywordflow">if</span> (isa&lt;FCmpInst&gt;(BrCond))</div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160; </div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *EndBB = ThenBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>()-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6e5d2e18c81baaeec7dadc81a0dea993">getSuccessor</a>(0);</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;  <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> Budget =</div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;      <a class="code" href="SimplifyCFG_8cpp.html#a51d993ac59a51760ec7a9c7a1738755a">PHINodeFoldingThreshold</a> * TargetTransformInfo::TCC_Basic;</div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160; </div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;  <span class="comment">// If ThenBB is actually on the false edge of the conditional branch, remember</span></div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;  <span class="comment">// to swap the select operands later.</span></div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;  <span class="keywordtype">bool</span> Invert = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;  <span class="keywordflow">if</span> (ThenBB != BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0)) {</div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ThenBB == BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1) &amp;&amp; <span class="stringliteral">&quot;No edge from &#39;if&#39; block?&quot;</span>);</div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;    Invert = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;  }</div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EndBB == BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(!Invert) &amp;&amp; <span class="stringliteral">&quot;No edge from to end block&quot;</span>);</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160; </div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;  <span class="comment">// If the branch is non-unpredictable, and is predicted to *not* branch to</span></div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;  <span class="comment">// the `then` block, then avoid speculating it.</span></div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;  <span class="keywordflow">if</span> (!BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae22f493ba8327ce92e87d3b96bce7017">getMetadata</a>(LLVMContext::MD_unpredictable)) {</div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> TWeight, FWeight;</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(*BI, TWeight, FWeight) &amp;&amp;</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;        (TWeight + FWeight) != 0) {</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;      <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> EndWeight = Invert ? TWeight : FWeight;</div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;      <a class="code" href="classllvm_1_1BranchProbability.html">BranchProbability</a> BIEndProb =</div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;          BranchProbability::getBranchProbability(EndWeight, TWeight + FWeight);</div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;      <a class="code" href="classllvm_1_1BranchProbability.html">BranchProbability</a> Likely = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a99b320fd35acaf648a0a7826a0bdd777">getPredictableBranchThreshold</a>();</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;      <span class="keywordflow">if</span> (BIEndProb &gt;= Likely)</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;    }</div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;  }</div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160; </div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;  <span class="comment">// Keep a count of how many times instructions are used within ThenBB when</span></div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;  <span class="comment">// they are candidates for sinking into ThenBB. Specifically:</span></div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;  <span class="comment">// - They are defined in BB, and</span></div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;  <span class="comment">// - They have no side effects, and</span></div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;  <span class="comment">// - All of their uses are in ThenBB.</span></div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;  <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;Instruction *, unsigned, 4&gt;</a> SinkCandidateUseCounts;</div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160; </div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 4&gt;</a> SpeculatedDbgIntrinsics;</div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160; </div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;  <span class="keywordtype">unsigned</span> SpeculatedInstructions = 0;</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *SpeculatedStoreValue = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;  <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SpeculatedStore = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;  EphemeralValueTracker EphTracker;</div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="namespacellvm.html#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(<a class="code" href="namespacellvm.html#a9b64313b5c1907066b7bab1c60a2ea08">drop_end</a>(*ThenBB))) {</div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;    <span class="comment">// Skip debug info.</span></div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;    <span class="keywordflow">if</span> (isa&lt;DbgInfoIntrinsic&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;      SpeculatedDbgIntrinsics.push_back(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;    }</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160; </div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;    <span class="comment">// Skip pseudo probes. The consequence is we lose track of the branch</span></div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;    <span class="comment">// probability for ThenBB, which is fine since the optimization here takes</span></div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;    <span class="comment">// place regardless of the branch probability.</span></div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;    <span class="keywordflow">if</span> (isa&lt;PseudoProbeInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;      <span class="comment">// The probe should be deleted so that it will not be over-counted when</span></div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;      <span class="comment">// the samples collected on the non-conditional path are counted towards</span></div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;      <span class="comment">// the conditional path. We leave it for the counts inference algorithm to</span></div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;      <span class="comment">// figure out a proper count for an unknown probe.</span></div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;      SpeculatedDbgIntrinsics.push_back(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;    }</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160; </div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;    <span class="comment">// Ignore ephemeral values, they will be dropped by the transform.</span></div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;    <span class="keywordflow">if</span> (EphTracker.track(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160; </div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;    <span class="comment">// Only speculatively execute a single instruction (not counting the</span></div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;    <span class="comment">// terminator) for now.</span></div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;    ++SpeculatedInstructions;</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;    <span class="keywordflow">if</span> (SpeculatedInstructions &gt; 1)</div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160; </div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;    <span class="comment">// Don&#39;t hoist the instruction if it&#39;s unsafe or expensive.</span></div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#abe76d72cda6b2b4562c72accb510040b">isSafeToSpeculativelyExecute</a>(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;        !(<a class="code" href="SimplifyCFG_8cpp.html#aef5d6c1653f6d85c8ee596904289fd94">HoistCondStores</a> &amp;&amp; (SpeculatedStoreValue = <a class="code" href="SimplifyCFG_8cpp.html#a2ced9ed2427730cd9b6903f00cd22e4d">isSafeToSpeculateStore</a>(</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;                                  &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, ThenBB, EndBB))))</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;    <span class="keywordflow">if</span> (!SpeculatedStoreValue &amp;&amp;</div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;        <a class="code" href="SimplifyCFG_8cpp.html#a9ac94808486f1c47e5cc9ba62dcc6fae">computeSpeculationCost</a>(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) &gt;</div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;            <a class="code" href="SimplifyCFG_8cpp.html#a51d993ac59a51760ec7a9c7a1738755a">PHINodeFoldingThreshold</a> * TargetTransformInfo::TCC_Basic)</div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160; </div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;    <span class="comment">// Store the store speculation candidate.</span></div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;    <span class="keywordflow">if</span> (SpeculatedStoreValue)</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;      SpeculatedStore = cast&lt;StoreInst&gt;(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160; </div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;    <span class="comment">// Do not hoist the instruction if any of its operands are defined but not</span></div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;    <span class="comment">// used in BB. The transformation will prevent the operand from</span></div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;    <span class="comment">// being sunk into the use block.</span></div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> : <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.operands()) {</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *OpI = dyn_cast&lt;Instruction&gt;(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>);</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;      <span class="keywordflow">if</span> (!OpI || OpI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> || OpI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6ea260be710ac7b61309534308da3147">mayHaveSideEffects</a>())</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;        <span class="keywordflow">continue</span>; <span class="comment">// Not a candidate for sinking.</span></div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160; </div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;      ++SinkCandidateUseCounts[OpI];</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;    }</div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;  }</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160; </div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;  <span class="comment">// Consider any sink candidates which are only used in ThenBB as costs for</span></div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;  <span class="comment">// speculation. Note, while we iterate over a DenseMap here, we are summing</span></div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;  <span class="comment">// and so iteration order isn&#39;t significant.</span></div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;[Inst, Count] : SinkCandidateUseCounts)</div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;    <span class="keywordflow">if</span> (Inst-&gt;<a class="code" href="classllvm_1_1Value.html#a7c779ce2ba55bc94f52014fc25f3d520">hasNUses</a>(Count)) {</div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;      ++SpeculatedInstructions;</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;      <span class="keywordflow">if</span> (SpeculatedInstructions &gt; 1)</div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;    }</div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160; </div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;  <span class="comment">// Check that we can insert the selects and that it&#39;s not too expensive to do</span></div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;  <span class="comment">// so.</span></div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;  <span class="keywordtype">bool</span> Convert = SpeculatedStore != <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;  <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> = 0;</div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;  Convert |= <a class="code" href="SimplifyCFG_8cpp.html#a0b4c48d53ab1ddc5bf009cd4ddffdc5a">validateAndCostRequiredSelects</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, ThenBB, EndBB,</div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;                                            SpeculatedInstructions,</div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;                                            Cost, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>);</div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;  <span class="keywordflow">if</span> (!Convert || Cost &gt; Budget)</div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160; </div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;  <span class="comment">// If we get here, we can hoist the instruction and if-convert.</span></div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SPECULATIVELY EXECUTING BB&quot;</span> &lt;&lt; *ThenBB &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;);</div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160; </div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;  <span class="comment">// Insert a select of the value of the speculated store.</span></div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;  <span class="keywordflow">if</span> (SpeculatedStoreValue) {</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;    <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;NoFolder&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(BI);</div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *OrigV = SpeculatedStore-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a14298313bdf734e2db5a921cc6e861a0">getValueOperand</a>();</div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *TrueV = SpeculatedStore-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a14298313bdf734e2db5a921cc6e861a0">getValueOperand</a>();</div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *FalseV = SpeculatedStoreValue;</div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;    <span class="keywordflow">if</span> (Invert)</div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;      <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(TrueV, FalseV);</div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSelect(</div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;        BrCond, TrueV, FalseV, <span class="stringliteral">&quot;spec.store.select&quot;</span>, BI);</div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;    SpeculatedStore-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>);</div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;    SpeculatedStore-&gt;<a class="code" href="classllvm_1_1Instruction.html#a7279ed8b15d2a6dc8d246a7de2e08604">applyMergedLocation</a>(BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4f3bf98b5054831b608852e33427814">getDebugLoc</a>(),</div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;                                         SpeculatedStore-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4f3bf98b5054831b608852e33427814">getDebugLoc</a>());</div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;    <span class="comment">// The value stored is still conditional, but the store itself is now</span></div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;    <span class="comment">// unconditonally executed, so we must be sure that any linked dbg.assign</span></div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;    <span class="comment">// intrinsics are tracking the new stored value (the result of the</span></div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;    <span class="comment">// select). If we don&#39;t, and the store were to be removed by another pass</span></div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;    <span class="comment">// (e.g. DSE), then we&#39;d eventually end up emitting a location describing</span></div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;    <span class="comment">// the conditional value, unconditionally.</span></div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;    <span class="comment">// === Before this transformation ===</span></div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;    <span class="comment">// pred:</span></div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;    <span class="comment">//   store %one, %x.dest, !DIAssignID !1</span></div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;    <span class="comment">//   dbg.assign %one, &quot;x&quot;, ..., !1, ...</span></div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;    <span class="comment">//   br %cond if.then</span></div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;    <span class="comment">// if.then:</span></div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;    <span class="comment">//   store %two, %x.dest, !DIAssignID !2</span></div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;    <span class="comment">//   dbg.assign %two, &quot;x&quot;, ..., !2, ...</span></div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;    <span class="comment">// === After this transformation ===</span></div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;    <span class="comment">// pred:</span></div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;    <span class="comment">//   store %one, %x.dest, !DIAssignID !1</span></div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;    <span class="comment">//   dbg.assign %one, &quot;x&quot;, ..., !1</span><span class="comment"></span></div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;<span class="comment">    ///  ...</span></div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;<span class="comment"></span>    <span class="comment">//   %merge = select %cond, %two, %one</span></div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;    <span class="comment">//   store %merge, %x.dest, !DIAssignID !2</span></div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;    <span class="comment">//   dbg.assign %merge, &quot;x&quot;, ..., !2</span></div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *DAI : <a class="code" href="namespacellvm_1_1at.html#a3c90899e8f022656e511630de42b916c">at::getAssignmentMarkers</a>(SpeculatedStore)) {</div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(DAI-&gt;location_ops(), [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) { return V == OrigV; }))</div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;        DAI-&gt;replaceVariableLocationOp(OrigV, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>);</div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;    }</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;  }</div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160; </div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;  <span class="comment">// Metadata can be dependent on the condition we are hoisting above.</span></div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;  <span class="comment">// Conservatively strip all metadata on the instruction. Drop the debug loc</span></div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;  <span class="comment">// to avoid making it appear as if the condition is a constant, which would</span></div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;  <span class="comment">// be misleading while debugging.</span></div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;  <span class="comment">// Similarly strip attributes that maybe dependent on condition we are</span></div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;  <span class="comment">// hoisting above.</span></div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="namespacellvm.html#a8154638df88e4eaa568b67b23d463dac">make_early_inc_range</a>(*ThenBB)) {</div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;    <span class="keywordflow">if</span> (!SpeculatedStoreValue || &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != SpeculatedStore) {</div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;      <span class="comment">// Don&#39;t update the DILocation of dbg.assign intrinsics.</span></div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;      <span class="keywordflow">if</span> (!isa&lt;DbgAssignIntrinsic&gt;(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;        <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.setDebugLoc(<a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a>());</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;    }</div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;    <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.dropUndefImplyingAttrsAndUnknownMetadata();</div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160; </div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;    <span class="comment">// Drop ephemeral values.</span></div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;    <span class="keywordflow">if</span> (EphTracker.contains(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.replaceAllUsesWith(<a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">PoisonValue::get</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType()));</div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.eraseFromParent();</div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;    }</div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;  }</div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160; </div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;  <span class="comment">// Hoist the instructions.</span></div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;  <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;splice(BI-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>(), ThenBB, ThenBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(),</div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;             std::prev(ThenBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>()));</div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160; </div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;  <span class="comment">// Insert selects and rewrite the PHI operands.</span></div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;NoFolder&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(BI);</div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> &amp;PN : EndBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a72516971c5734dc0f7546e64affca425">phis</a>()) {</div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;    <span class="keywordtype">unsigned</span> OrigI = PN.<a class="code" href="classllvm_1_1PHINode.html#ae9562b96f6f3fa41bd36538c080035ee">getBasicBlockIndex</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;    <span class="keywordtype">unsigned</span> ThenI = PN.<a class="code" href="classllvm_1_1PHINode.html#ae9562b96f6f3fa41bd36538c080035ee">getBasicBlockIndex</a>(ThenBB);</div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *OrigV = PN.<a class="code" href="classllvm_1_1PHINode.html#a16c39eb6e60b42a40c399d8d65347bb6">getIncomingValue</a>(OrigI);</div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *ThenV = PN.<a class="code" href="classllvm_1_1PHINode.html#a16c39eb6e60b42a40c399d8d65347bb6">getIncomingValue</a>(ThenI);</div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160; </div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;    <span class="comment">// Skip PHIs which are trivial.</span></div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;    <span class="keywordflow">if</span> (OrigV == ThenV)</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160; </div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;    <span class="comment">// Create a select whose true value is the speculatively executed value and</span></div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;    <span class="comment">// false value is the pre-existing value. Swap them if the branch</span></div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;    <span class="comment">// destinations were inverted.</span></div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *TrueV = ThenV, *FalseV = OrigV;</div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;    <span class="keywordflow">if</span> (Invert)</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;      <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(TrueV, FalseV);</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSelect(BrCond, TrueV, FalseV, <span class="stringliteral">&quot;spec.select&quot;</span>, BI);</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;    PN.<a class="code" href="classllvm_1_1PHINode.html#a88cdefb709309eddc6e5daca0be6a7b4">setIncomingValue</a>(OrigI, V);</div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;    PN.<a class="code" href="classllvm_1_1PHINode.html#a88cdefb709309eddc6e5daca0be6a7b4">setIncomingValue</a>(ThenI, V);</div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;  }</div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160; </div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;  <span class="comment">// Remove speculated dbg intrinsics.</span></div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;  <span class="comment">// FIXME: Is it possible to do this in a more elegant way? Moving/merging the</span></div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;  <span class="comment">// dbg value for the different flows and inserting it after the select.</span></div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : SpeculatedDbgIntrinsics) {</div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;    <span class="comment">// We still want to know that an assignment took place so don&#39;t remove</span></div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;    <span class="comment">// dbg.assign intrinsics.</span></div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;    <span class="keywordflow">if</span> (!isa&lt;DbgAssignIntrinsic&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;  }</div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160; </div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;  ++NumSpeculations;</div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;}</div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;<span class="comment">/// Return true if we can thread a branch across this block.</span></div>
<div class="line"><a name="l03086"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a03a2d451a241c934af3405a7cfc8adb4"> 3086</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a03a2d451a241c934af3405a7cfc8adb4">BlockIsSimpleEnoughToThreadThrough</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">Size</a> = 0;</div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;  EphemeralValueTracker EphTracker;</div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160; </div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;  <span class="comment">// Walk the loop in reverse so that we can identify ephemeral values properly</span></div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;  <span class="comment">// (values only feeding assumes).</span></div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="namespacellvm.html#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;instructionsWithoutDebug(<span class="keyword">false</span>))) {</div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;    <span class="comment">// Can&#39;t fold blocks that contain noduplicate or convergent calls.</span></div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI = dyn_cast&lt;CallInst&gt;(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;      <span class="keywordflow">if</span> (CI-&gt;cannotDuplicate() || CI-&gt;isConvergent())</div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160; </div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;    <span class="comment">// Ignore ephemeral values which are deleted during codegen.</span></div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;    <span class="comment">// We will delete Phis while threading, so Phis should not be accounted in</span></div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;    <span class="comment">// block&#39;s size.</span></div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;    <span class="keywordflow">if</span> (!EphTracker.track(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !isa&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">Size</a>++ &gt; <a class="code" href="SimplifyCFG_8cpp.html#abd2252fac0a4e2ca5270c2ecbfcd3de2">MaxSmallBlockSize</a>)</div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Don&#39;t clone large BB&#39;s.</span></div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;    }</div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160; </div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;    <span class="comment">// We can only support instructions that do not define values that are</span></div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;    <span class="comment">// live outside of the current basic block.</span></div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *U : <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.users()) {</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UI = cast&lt;Instruction&gt;(U);</div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;      <span class="keywordflow">if</span> (UI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> || isa&lt;PHINode&gt;(UI))</div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;    }</div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160; </div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;    <span class="comment">// Looks ok, continue checking.</span></div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;  }</div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160; </div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;}</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160; </div>
<div class="line"><a name="l03120"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a6c682701ac0e49b730cc572959875d14"> 3120</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="SimplifyCFG_8cpp.html#a6c682701ac0e49b730cc572959875d14">getKnownValueOnEdge</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="BlockVerifier_8cpp.html#ae45c7d73c0ff5d177b59153ffae77f84">From</a>,</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;                                        <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *To) {</div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;  <span class="comment">// Don&#39;t look past the block defining the value, we might get the value from</span></div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;  <span class="comment">// a previous loop iteration.</span></div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() == To)</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160; </div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;  <span class="comment">// We know the value if the From block branches on it.</span></div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;  <span class="keyword">auto</span> *BI = dyn_cast&lt;BranchInst&gt;(<a class="code" href="BlockVerifier_8cpp.html#ae45c7d73c0ff5d177b59153ffae77f84">From</a>-&gt;getTerminator());</div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;  <span class="keywordflow">if</span> (BI &amp;&amp; BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() &amp;&amp; BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>() == V &amp;&amp;</div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;      BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0) != BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1))</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;    <span class="keywordflow">return</span> BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0) == To ? <a class="code" href="InstructionSimplify_8cpp.html#a565dd825f238fa0a8c4bbfe562635f7c">ConstantInt::getTrue</a>(BI-&gt;<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>())</div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;                                     : <a class="code" href="InstructionSimplify_8cpp.html#adb39181b87dffcd61082d08e02bf314e">ConstantInt::getFalse</a>(BI-&gt;<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160; </div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;}</div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;<span class="comment">/// If we have a conditional branch on something for which we know the constant</span></div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;<span class="comment">/// value in predecessors (e.g. a phi node in the current block), thread edges</span></div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;<span class="comment">/// from the predecessor to their ultimate destination.</span></div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;<span class="comment"></span><span class="keyword">static</span> std::optional&lt;bool&gt;</div>
<div class="line"><a name="l03142"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a8750c95762a282001cd60e0e922b2c67"> 3142</a></span>&#160;<a class="code" href="SimplifyCFG_8cpp.html#a8750c95762a282001cd60e0e922b2c67">FoldCondBranchOnValueKnownInPredecessorImpl</a>(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI, <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> *DTU,</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;                                            <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;                                            <a class="code" href="classllvm_1_1AssumptionCache.html">AssumptionCache</a> *AC) {</div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;  <a class="code" href="structllvm_1_1SmallMapVector.html">SmallMapVector&lt;ConstantInt *, SmallSetVector&lt;BasicBlock *, 2&gt;</a>, 2&gt; KnownValues;</div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a> = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>();</div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;  <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;PHINode&gt;(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>);</div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;  <span class="keywordflow">if</span> (PN &amp;&amp; PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;    <span class="comment">// Degenerate case of a single entry PHI.</span></div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;    <span class="keywordflow">if</span> (PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>() == 1) {</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;      <a class="code" href="namespacellvm.html#ab7e8be1d1ae7e526ea156b60c51c10e5">FoldSingleEntryPHINodes</a>(PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>());</div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;    }</div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160; </div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U : PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a1f0ff79b64a40d383b891f1baba89c6b">incoming_values</a>())</div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *CB = dyn_cast&lt;ConstantInt&gt;(U))</div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;        KnownValues[CB].<a class="code" href="classllvm_1_1MapVector.html#a9318649185cfc66ba4b4eb66d5968e00">insert</a>(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a8ce0c4746a1ec805e66409d20ae93922">getIncomingBlock</a>(U));</div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred : <a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)) {</div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CB = <a class="code" href="SimplifyCFG_8cpp.html#a6c682701ac0e49b730cc572959875d14">getKnownValueOnEdge</a>(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>, Pred, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>))</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;        KnownValues[CB].<a class="code" href="classllvm_1_1MapVector.html#a9318649185cfc66ba4b4eb66d5968e00">insert</a>(Pred);</div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;    }</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;  }</div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160; </div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;  <span class="keywordflow">if</span> (KnownValues.<a class="code" href="classllvm_1_1MapVector.html#a8da97c44f514ad1ae9ccf4518b0f88aa">empty</a>())</div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160; </div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;  <span class="comment">// Now we know that this block has multiple preds and two succs.</span></div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;  <span class="comment">// Check that the block is small enough and values defined in the block are</span></div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;  <span class="comment">// not used outside of it.</span></div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#a03a2d451a241c934af3405a7cfc8adb4">BlockIsSimpleEnoughToThreadThrough</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>))</div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160; </div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;Pair : KnownValues) {</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;    <span class="comment">// Okay, we now know that all edges from PredBB should be revectored to</span></div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;    <span class="comment">// branch to RealDest.</span></div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CB = Pair.first;</div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;    <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;BasicBlock *&gt;</a> PredBBs = Pair.second.getArrayRef();</div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *RealDest = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(!CB-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#ac09a21c371a9c535cbc13e8f82503aec">getZExtValue</a>());</div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160; </div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;    <span class="keywordflow">if</span> (RealDest == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;      <span class="keywordflow">continue</span>; <span class="comment">// Skip self loops.</span></div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160; </div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;    <span class="comment">// Skip if the predecessor&#39;s terminator is an indirect branch.</span></div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(PredBBs, [](<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PredBB) {</div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;          <span class="keywordflow">return</span> isa&lt;IndirectBrInst&gt;(PredBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>());</div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;        }))</div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160; </div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>({</div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;      <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Condition &quot;</span> &lt;&lt; *<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a> &lt;&lt; <span class="stringliteral">&quot; in &quot;</span> &lt;&lt; <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getName()</div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;             &lt;&lt; <span class="stringliteral">&quot; has value &quot;</span> &lt;&lt; *Pair.first &lt;&lt; <span class="stringliteral">&quot; in predecessors:\n&quot;</span>;</div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PredBB : Pair.second)</div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; PredBB-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;      <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Threading to destination &quot;</span> &lt;&lt; RealDest-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>;</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;    });</div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160; </div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;    <span class="comment">// Split the predecessors we are threading into a new edge block. We&#39;ll</span></div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;    <span class="comment">// clone the instructions into this block, and then redirect it to RealDest.</span></div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *EdgeBB = <a class="code" href="namespacellvm.html#a9d391b6acc6d90c9b8a8442324b1aa6f">SplitBlockPredecessors</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, PredBBs, <span class="stringliteral">&quot;.critedge&quot;</span>, DTU);</div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160; </div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;    <span class="comment">// TODO: These just exist to reduce test diff, we can drop them if we like.</span></div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;    EdgeBB-&gt;setName(RealDest-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + <span class="stringliteral">&quot;.critedge&quot;</span>);</div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;    EdgeBB-&gt;moveBefore(RealDest);</div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160; </div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;    <span class="comment">// Update PHI nodes.</span></div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#a41a075ef4b76f72591e86e1fe13f096d">AddPredecessorToBlock</a>(RealDest, EdgeBB, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160; </div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;    <span class="comment">// BB may have instructions that are being threaded over.  Clone these</span></div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;    <span class="comment">// instructions into EdgeBB.  We know that there will be no uses of the</span></div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;    <span class="comment">// cloned instructions outside of EdgeBB.</span></div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPt = EdgeBB-&gt;getFirstInsertionPt();</div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, Value *&gt;</a> TranslateMap; <span class="comment">// Track translated values.</span></div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;    TranslateMap[<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>] = CB;</div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BBI = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;begin(); &amp;*BBI != BI; ++BBI) {</div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;PHINode&gt;(BBI)) {</div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;        TranslateMap[PN] = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#adfb61ffe25c950c75c86310245b3ef39">getIncomingValueForBlock</a>(EdgeBB);</div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;      }</div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;      <span class="comment">// Clone the instruction.</span></div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = BBI-&gt;clone();</div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;      <span class="keywordflow">if</span> (BBI-&gt;hasName())</div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;        <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>-&gt;setName(BBI-&gt;getName() + <span class="stringliteral">&quot;.c&quot;</span>);</div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160; </div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;      <span class="comment">// Update operands due to translation.</span></div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> : <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>-&gt;operands()) {</div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;        <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, Value *&gt;::iterator</a> PI = TranslateMap.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>);</div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;        <span class="keywordflow">if</span> (PI != TranslateMap.<a class="code" href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;          <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = PI-&gt;second;</div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;      }</div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160; </div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;      <span class="comment">// Check for trivial simplification.</span></div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="namespacellvm.html#aab02db480f387fca92956ef1c9a01941">simplifyInstruction</a>(<a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, {<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, AC})) {</div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;        <span class="keywordflow">if</span> (!BBI-&gt;use_empty())</div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;          TranslateMap[&amp;*BBI] = V;</div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>-&gt;mayHaveSideEffects()) {</div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;          <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>-&gt;deleteValue(); <span class="comment">// Instruction folded away, don&#39;t need actual inst</span></div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;          <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;        }</div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;        <span class="keywordflow">if</span> (!BBI-&gt;use_empty())</div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;          TranslateMap[&amp;*BBI] = <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>;</div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;      }</div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>) {</div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;        <span class="comment">// Insert the new instruction into its new home.</span></div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;        <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>-&gt;insertInto(EdgeBB, InsertPt);</div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160; </div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;        <span class="comment">// Register the new instruction with the assumption cache if necessary.</span></div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Assume = dyn_cast&lt;AssumeInst&gt;(<a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>))</div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;          <span class="keywordflow">if</span> (AC)</div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;            AC-&gt;<a class="code" href="classllvm_1_1AssumptionCache.html#a7f02822253b078960693acc2f30d4817">registerAssumption</a>(Assume);</div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;      }</div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;    }</div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160; </div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;    <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;removePredecessor(EdgeBB);</div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;    <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *EdgeBI = cast&lt;BranchInst&gt;(EdgeBB-&gt;getTerminator());</div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;    EdgeBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#adc5e7f9c460c68455e826783d77f9a99">setSuccessor</a>(0, RealDest);</div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;    EdgeBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4f3bf98b5054831b608852e33427814">getDebugLoc</a>());</div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160; </div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;    <span class="keywordflow">if</span> (DTU) {</div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;DominatorTree::UpdateType, 2&gt;</a> Updates;</div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;      Updates.push_back({DominatorTree::Delete, EdgeBB, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>});</div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;      Updates.push_back({<a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">DominatorTree::Insert</a>, EdgeBB, RealDest});</div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;      DTU-&gt;<a class="code" href="classllvm_1_1DomTreeUpdater.html#aae522cd1928cfac6850b50c7a3e22185">applyUpdates</a>(Updates);</div>
<div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;    }</div>
<div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160; </div>
<div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;    <span class="comment">// For simplicity, we created a separate basic block for the edge. Merge</span></div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;    <span class="comment">// it back into the predecessor if possible. This not only avoids</span></div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;    <span class="comment">// unnecessary SimplifyCFG iterations, but also makes sure that we don&#39;t</span></div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;    <span class="comment">// bypass the check for trivial cycles above.</span></div>
<div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;    <a class="code" href="namespacellvm.html#aa76a2cf19b821f320ab439d5659ef4b9">MergeBlockIntoPredecessor</a>(EdgeBB, DTU);</div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160; </div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;    <span class="comment">// Signal repeat, simplifying any other constants.</span></div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;    <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;  }</div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160; </div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;}</div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160; </div>
<div class="line"><a name="l03281"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a77b36b0c3d9cdfab87304f5181154f9b"> 3281</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a77b36b0c3d9cdfab87304f5181154f9b">FoldCondBranchOnValueKnownInPredecessor</a>(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI,</div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;                                                    <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> *DTU,</div>
<div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;                                                    <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;                                                    <a class="code" href="classllvm_1_1AssumptionCache.html">AssumptionCache</a> *AC) {</div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;  std::optional&lt;bool&gt; Result;</div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;  <span class="keywordtype">bool</span> EverChanged = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;  <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;    <span class="comment">// Note that None means &quot;we changed things, but recurse further.&quot;</span></div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;    Result = <a class="code" href="SimplifyCFG_8cpp.html#a8750c95762a282001cd60e0e922b2c67">FoldCondBranchOnValueKnownInPredecessorImpl</a>(BI, DTU, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, AC);</div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;    EverChanged |= Result == std::nullopt || *Result;</div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;  } <span class="keywordflow">while</span> (Result == std::nullopt);</div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;  <span class="keywordflow">return</span> EverChanged;</div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;}</div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;<span class="comment">/// Given a BB that starts with the specified two-entry PHI node,</span></div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;<span class="comment">/// see if we can eliminate it.</span></div>
<div class="line"><a name="l03297"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#adf89b508645e361807eecee2e70a4852"> 3297</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#adf89b508645e361807eecee2e70a4852">FoldTwoEntryPHINode</a>(<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>,</div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;                                <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> *DTU, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>) {</div>
<div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;  <span class="comment">// Ok, this is a two entry PHI node.  Check to see if this is a simple &quot;if</span></div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;  <span class="comment">// statement&quot;, which has a very simple dominance structure.  Basically, we</span></div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;  <span class="comment">// are trying to find the condition that is being branched on, which</span></div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;  <span class="comment">// subsequently causes this merge to happen.  We really want control</span></div>
<div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;  <span class="comment">// dependence information for this check, but simplifycfg can&#39;t keep it up</span></div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;  <span class="comment">// to date, and this catches most of the cases we care about anyway.</span></div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160; </div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *IfTrue, *IfFalse;</div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;  <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *DomBI = <a class="code" href="namespacellvm.html#a1a5751a2dd7306ff9a59eae6c1de8925">GetIfCondition</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, IfTrue, IfFalse);</div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;  <span class="keywordflow">if</span> (!DomBI)</div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *IfCond = DomBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>();</div>
<div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;  <span class="comment">// Don&#39;t bother if the branch will be constant folded trivially.</span></div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;  <span class="keywordflow">if</span> (isa&lt;ConstantInt&gt;(IfCond))</div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160; </div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *DomBlock = DomBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock *, 2&gt;</a> IfBlocks;</div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;  <a class="code" href="namespacellvm.html#a4d13fd05401d8eb0c97b9864a0eb6028">llvm::copy_if</a>(</div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;      PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a88c1c3dd33d232dc889a5d29c75b75f3">blocks</a>(), std::back_inserter(IfBlocks), [](<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *IfBlock) {</div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;        return cast&lt;BranchInst&gt;(IfBlock-&gt;getTerminator())-&gt;isUnconditional();</div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;      });</div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((IfBlocks.size() == 1 || IfBlocks.size() == 2) &amp;&amp;</div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;         <span class="stringliteral">&quot;Will have either one or two blocks to speculate.&quot;</span>);</div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160; </div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;  <span class="comment">// If the branch is non-unpredictable, see if we either predictably jump to</span></div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;  <span class="comment">// the merge bb (if we have only a single &#39;then&#39; block), or if we predictably</span></div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;  <span class="comment">// jump to one specific &#39;then&#39; block (if we have two of them).</span></div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;  <span class="comment">// It isn&#39;t beneficial to speculatively execute the code</span></div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;  <span class="comment">// from the block that we know is predictably not entered.</span></div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;  <span class="keywordflow">if</span> (!DomBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae22f493ba8327ce92e87d3b96bce7017">getMetadata</a>(LLVMContext::MD_unpredictable)) {</div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> TWeight, FWeight;</div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(*DomBI, TWeight, FWeight) &amp;&amp;</div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;        (TWeight + FWeight) != 0) {</div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;      <a class="code" href="classllvm_1_1BranchProbability.html">BranchProbability</a> BITrueProb =</div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;          BranchProbability::getBranchProbability(TWeight, TWeight + FWeight);</div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;      <a class="code" href="classllvm_1_1BranchProbability.html">BranchProbability</a> Likely = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a99b320fd35acaf648a0a7826a0bdd777">getPredictableBranchThreshold</a>();</div>
<div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;      <a class="code" href="classllvm_1_1BranchProbability.html">BranchProbability</a> BIFalseProb = BITrueProb.<a class="code" href="classllvm_1_1BranchProbability.html#aaee6034264d5d0782e5d1489360730d9">getCompl</a>();</div>
<div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;      <span class="keywordflow">if</span> (IfBlocks.size() == 1) {</div>
<div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;        <a class="code" href="classllvm_1_1BranchProbability.html">BranchProbability</a> BIBBProb =</div>
<div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;            DomBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0) == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> ? BITrueProb : BIFalseProb;</div>
<div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;        <span class="keywordflow">if</span> (BIBBProb &gt;= Likely)</div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;        <span class="keywordflow">if</span> (BITrueProb &gt;= Likely || BIFalseProb &gt;= Likely)</div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;      }</div>
<div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;    }</div>
<div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;  }</div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160; </div>
<div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;  <span class="comment">// Don&#39;t try to fold an unreachable block. For example, the phi node itself</span></div>
<div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;  <span class="comment">// can&#39;t be the candidate if-condition for a select that we want to form.</span></div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *IfCondPhiInst = dyn_cast&lt;PHINode&gt;(IfCond))</div>
<div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;    <span class="keywordflow">if</span> (IfCondPhiInst-&gt;getParent() == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160; </div>
<div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;  <span class="comment">// Okay, we found that we can merge this two-entry phi node into a select.</span></div>
<div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;  <span class="comment">// Doing so would require us to fold *all* two entry phi nodes in this block.</span></div>
<div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;  <span class="comment">// At some point this becomes non-profitable (particularly if the target</span></div>
<div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;  <span class="comment">// doesn&#39;t support cmov&#39;s).  Only do this transformation if there are two or</span></div>
<div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;  <span class="comment">// fewer PHI nodes in this block.</span></div>
<div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;  <span class="keywordtype">unsigned</span> NumPhis = 0;</div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;begin(); isa&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>); ++NumPhis, ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;    <span class="keywordflow">if</span> (NumPhis &gt; 2)</div>
<div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160; </div>
<div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;  <span class="comment">// Loop over the PHI&#39;s seeing if we can promote them all to select</span></div>
<div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;  <span class="comment">// instructions.  While we are at it, keep track of the instructions</span></div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;  <span class="comment">// that need to be moved to the dominating block.</span></div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction *, 4&gt;</a> AggressiveInsts;</div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;  <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> = 0;</div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;  <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> Budget =</div>
<div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;      <a class="code" href="SimplifyCFG_8cpp.html#a2c4138bcbe89707f75ab7bc7717e377f">TwoEntryPHINodeFoldingThreshold</a> * TargetTransformInfo::TCC_Basic;</div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160; </div>
<div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> II = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;begin(); isa&lt;PHINode&gt;(II);) {</div>
<div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = cast&lt;PHINode&gt;(II++);</div>
<div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="namespacellvm.html#aab02db480f387fca92956ef1c9a01941">simplifyInstruction</a>(PN, {<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, PN})) {</div>
<div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;      PN-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(V);</div>
<div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;      PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;      Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;    }</div>
<div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160; </div>
<div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#affd7c19ab0474d817d8cf0bd94f5ccad">dominatesMergePoint</a>(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a16c39eb6e60b42a40c399d8d65347bb6">getIncomingValue</a>(0), <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, AggressiveInsts,</div>
<div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;                             <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>, Budget, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) ||</div>
<div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;        !<a class="code" href="SimplifyCFG_8cpp.html#affd7c19ab0474d817d8cf0bd94f5ccad">dominatesMergePoint</a>(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a16c39eb6e60b42a40c399d8d65347bb6">getIncomingValue</a>(1), <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, AggressiveInsts,</div>
<div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;                             <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>, Budget, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>))</div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;      <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;  }</div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160; </div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;  <span class="comment">// If we folded the first phi, PN dangles at this point.  Refresh it.  If</span></div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;  <span class="comment">// we ran out of PHIs then we simplified them all.</span></div>
<div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;  PN = dyn_cast&lt;PHINode&gt;(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;begin());</div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;  <span class="keywordflow">if</span> (!PN)</div>
<div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160; </div>
<div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;  <span class="comment">// Return true if at least one of these is a &#39;not&#39;, and another is either</span></div>
<div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;  <span class="comment">// a &#39;not&#39; too, or a constant.</span></div>
<div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;  <span class="keyword">auto</span> CanHoistNotFromBothValues = [](<a class="code" href="classllvm_1_1Value.html">Value</a> *V0, <a class="code" href="classllvm_1_1Value.html">Value</a> *V1) {</div>
<div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V0, <a class="code" href="namespacellvm_1_1MIPatternMatch.html#abeed97c145aefd8b8974bb1947a19439">m_Not</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())))</div>
<div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;      <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(V0, V1);</div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;    <span class="keyword">auto</span> Invertible = <a class="code" href="namespacellvm_1_1PatternMatch.html#af4feec45578e32fe65d8efc59112bc8e">m_CombineOr</a>(<a class="code" href="namespacellvm_1_1MIPatternMatch.html#abeed97c145aefd8b8974bb1947a19439">m_Not</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>()), <a class="code" href="namespacellvm_1_1PatternMatch.html#a1955ef05e08a44c7e45ea15eedf7a33e">m_AnyIntegralConstant</a>());</div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V0, <a class="code" href="namespacellvm_1_1MIPatternMatch.html#abeed97c145aefd8b8974bb1947a19439">m_Not</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())) &amp;&amp; <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V1, Invertible);</div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;  };</div>
<div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160; </div>
<div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;  <span class="comment">// Don&#39;t fold i1 branches on PHIs which contain binary operators or</span></div>
<div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;  <span class="comment">// (possibly inverted) select form of or/ands,  unless one of</span></div>
<div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;  <span class="comment">// the incoming values is an &#39;not&#39; and another one is freely invertible.</span></div>
<div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;  <span class="comment">// These can often be turned into switches and other things.</span></div>
<div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;  <span class="keyword">auto</span> IsBinOpOrAnd = [](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(</div>
<div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;        V, <a class="code" href="namespacellvm_1_1PatternMatch.html#af4feec45578e32fe65d8efc59112bc8e">m_CombineOr</a>(</div>
<div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;               <a class="code" href="namespacellvm_1_1MIPatternMatch.html#a5e211e92e7c34390512a7c2ff9dc60be">m_BinOp</a>(),</div>
<div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;               <a class="code" href="namespacellvm_1_1PatternMatch.html#af4feec45578e32fe65d8efc59112bc8e">m_CombineOr</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#addb87fe3f509b7803d3f5933ee24b560">m_Select</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#aec0ccdbde0581b3aae7f001634a34d8e">m_ImmConstant</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>()),</div>
<div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;                           <a class="code" href="namespacellvm_1_1PatternMatch.html#addb87fe3f509b7803d3f5933ee24b560">m_Select</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#aec0ccdbde0581b3aae7f001634a34d8e">m_ImmConstant</a>()))));</div>
<div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;  };</div>
<div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;  <span class="keywordflow">if</span> (PN-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>(1) &amp;&amp;</div>
<div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;      (IsBinOpOrAnd(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a16c39eb6e60b42a40c399d8d65347bb6">getIncomingValue</a>(0)) ||</div>
<div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;       IsBinOpOrAnd(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a16c39eb6e60b42a40c399d8d65347bb6">getIncomingValue</a>(1)) || IsBinOpOrAnd(IfCond)) &amp;&amp;</div>
<div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;      !CanHoistNotFromBothValues(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a16c39eb6e60b42a40c399d8d65347bb6">getIncomingValue</a>(0),</div>
<div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;                                 PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a16c39eb6e60b42a40c399d8d65347bb6">getIncomingValue</a>(1)))</div>
<div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;    <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160; </div>
<div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;  <span class="comment">// If all PHI nodes are promotable, check to make sure that all instructions</span></div>
<div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;  <span class="comment">// in the predecessor blocks can be promoted as well. If not, we won&#39;t be able</span></div>
<div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;  <span class="comment">// to get rid of the control flow, so it&#39;s not worth promoting to select</span></div>
<div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;  <span class="comment">// instructions.</span></div>
<div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *IfBlock : IfBlocks)</div>
<div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = IfBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); !<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isTerminator(); ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;      <span class="keywordflow">if</span> (!AggressiveInsts.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(&amp;*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isDebugOrPseudoInst()) {</div>
<div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;        <span class="comment">// This is not an aggressive instruction that we can promote.</span></div>
<div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;        <span class="comment">// Because of this, we won&#39;t be able to get rid of the control flow, so</span></div>
<div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;        <span class="comment">// the xform is not worth it.</span></div>
<div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;        <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;      }</div>
<div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160; </div>
<div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;  <span class="comment">// If either of the blocks has it&#39;s address taken, we can&#39;t do this fold.</span></div>
<div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(IfBlocks,</div>
<div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;             [](<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *IfBlock) { <span class="keywordflow">return</span> IfBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a315f26c899f5ea8a780db4740ba95ef4">hasAddressTaken</a>(); }))</div>
<div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;    <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160; </div>
<div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;FOUND IF CONDITION!  &quot;</span> &lt;&lt; *IfCond</div>
<div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;  T: &quot;</span> &lt;&lt; IfTrue-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</div>
<div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;  F: &quot;</span> &lt;&lt; IfFalse-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160; </div>
<div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;  <span class="comment">// If we can still promote the PHI nodes after this gauntlet of tests,</span></div>
<div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;  <span class="comment">// do all of the PHI&#39;s now.</span></div>
<div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160; </div>
<div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;  <span class="comment">// Move all &#39;aggressive&#39; instructions, which are defined in the</span></div>
<div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;  <span class="comment">// conditional parts of the if&#39;s up to the dominating block.</span></div>
<div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *IfBlock : IfBlocks)</div>
<div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;      <a class="code" href="namespacellvm.html#aab4d6b37c7f97bad2b1f441dc3fd43e0">hoistAllInstructionsInto</a>(DomBlock, DomBI, IfBlock);</div>
<div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160; </div>
<div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;NoFolder&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(DomBI);</div>
<div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;  <span class="comment">// Propagate fast-math-flags from phi nodes to replacement selects.</span></div>
<div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;::FastMathFlagGuard</a> FMFGuard(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;PHINode&gt;(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;begin())) {</div>
<div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;    <span class="keywordflow">if</span> (isa&lt;FPMathOperator&gt;(PN))</div>
<div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.setFastMathFlags(PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9a167f91db810097d281b1ed627f4575">getFastMathFlags</a>());</div>
<div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160; </div>
<div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;    <span class="comment">// Change the PHI node into a select instruction.</span></div>
<div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a58b95af1ca96e109f85a0646a05fceb7">TrueVal</a> = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#adfb61ffe25c950c75c86310245b3ef39">getIncomingValueForBlock</a>(IfTrue);</div>
<div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aeb5a2908109c763377832cbb4726b6d4">FalseVal</a> = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#adfb61ffe25c950c75c86310245b3ef39">getIncomingValueForBlock</a>(IfFalse);</div>
<div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160; </div>
<div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Sel = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSelect(IfCond, <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a58b95af1ca96e109f85a0646a05fceb7">TrueVal</a>, <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aeb5a2908109c763377832cbb4726b6d4">FalseVal</a>, <span class="stringliteral">&quot;&quot;</span>, DomBI);</div>
<div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;    PN-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Sel);</div>
<div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;    Sel-&gt;<a class="code" href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(PN);</div>
<div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;    PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;  }</div>
<div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160; </div>
<div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;  <span class="comment">// At this point, all IfBlocks are empty, so our if statement</span></div>
<div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;  <span class="comment">// has been flattened.  Change DomBlock to jump directly to our new block to</span></div>
<div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;  <span class="comment">// avoid other simplifycfg&#39;s kicking in on the diamond.</span></div>
<div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBr(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160; </div>
<div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;DominatorTree::UpdateType, 3&gt;</a> Updates;</div>
<div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;  <span class="keywordflow">if</span> (DTU) {</div>
<div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;    Updates.push_back({<a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">DominatorTree::Insert</a>, DomBlock, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>});</div>
<div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a> : <a class="code" href="namespacellvm.html#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(DomBlock))</div>
<div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;      Updates.push_back({DominatorTree::Delete, DomBlock, <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a>});</div>
<div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;  }</div>
<div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160; </div>
<div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;  DomBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;  <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;    DTU-&gt;<a class="code" href="classllvm_1_1DomTreeUpdater.html#aae522cd1928cfac6850b50c7a3e22185">applyUpdates</a>(Updates);</div>
<div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160; </div>
<div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;}</div>
<div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160; </div>
<div class="line"><a name="l03490"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a5f162160c57fca10cd58c00b439414cb"> 3490</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="SimplifyCFG_8cpp.html#a5f162160c57fca10cd58c00b439414cb">createLogicalOp</a>(<a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>,</div>
<div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;                              <a class="code" href="classllvm_1_1Instruction.html#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> Opc, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>,</div>
<div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;                              <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1Twine.html">Twine</a> &amp;<a class="code" href="namespacellvm_1_1GraphProgram.html#a0ad4685976f8c4d4a697a53fbe05d10b">Name</a> = <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;  <span class="comment">// Try to relax logical op to binary op.</span></div>
<div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a71a4a4e0f6178682ef05a0d85891e5a9">impliesPoison</a>(<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>))</div>
<div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBinOp(Opc, <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <a class="code" href="namespacellvm_1_1GraphProgram.html#a0ad4685976f8c4d4a697a53fbe05d10b">Name</a>);</div>
<div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;  <span class="keywordflow">if</span> (Opc == Instruction::And)</div>
<div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateLogicalAnd(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <a class="code" href="namespacellvm_1_1GraphProgram.html#a0ad4685976f8c4d4a697a53fbe05d10b">Name</a>);</div>
<div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;  <span class="keywordflow">if</span> (Opc == Instruction::Or)</div>
<div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateLogicalOr(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <a class="code" href="namespacellvm_1_1GraphProgram.html#a0ad4685976f8c4d4a697a53fbe05d10b">Name</a>);</div>
<div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;  <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Invalid logical opcode&quot;</span>);</div>
<div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;}</div>
<div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;<span class="comment">/// Return true if either PBI or BI has branch weight available, and store</span></div>
<div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;<span class="comment">/// the weights in {Pred|Succ}{True|False}Weight. If one of PBI and BI does</span></div>
<div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;<span class="comment">/// not have branch weight, use 1:1 as its weight.</span></div>
<div class="line"><a name="l03506"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a404f7a1827e4eb8c5ded5ce6dafecf07"> 3506</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a404f7a1827e4eb8c5ded5ce6dafecf07">extractPredSuccWeights</a>(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *PBI, <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI,</div>
<div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;                                   <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> &amp;PredTrueWeight,</div>
<div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;                                   <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> &amp;PredFalseWeight,</div>
<div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;                                   <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> &amp;SuccTrueWeight,</div>
<div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;                                   <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> &amp;SuccFalseWeight) {</div>
<div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;  <span class="keywordtype">bool</span> PredHasWeights =</div>
<div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;      <a class="code" href="namespacellvm.html#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(*PBI, PredTrueWeight, PredFalseWeight);</div>
<div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;  <span class="keywordtype">bool</span> SuccHasWeights =</div>
<div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;      <a class="code" href="namespacellvm.html#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(*BI, SuccTrueWeight, SuccFalseWeight);</div>
<div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;  <span class="keywordflow">if</span> (PredHasWeights || SuccHasWeights) {</div>
<div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;    <span class="keywordflow">if</span> (!PredHasWeights)</div>
<div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;      PredTrueWeight = PredFalseWeight = 1;</div>
<div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;    <span class="keywordflow">if</span> (!SuccHasWeights)</div>
<div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;      SuccTrueWeight = SuccFalseWeight = 1;</div>
<div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;  }</div>
<div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;}</div>
<div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;<span class="comment">/// Determine if the two branches share a common destination and deduce a glue</span></div>
<div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;<span class="comment">/// that joins the branches&#39; conditions to arrive at the common destination if</span></div>
<div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;<span class="comment">/// that would be profitable.</span></div>
<div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;<span class="comment"></span><span class="keyword">static</span> std::optional&lt;std::tuple&lt;BasicBlock *, Instruction::BinaryOps, bool&gt;&gt;</div>
<div class="line"><a name="l03530"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a15c2db73fd73b04753cd1ffb2126acb6"> 3530</a></span>&#160;<a class="code" href="SimplifyCFG_8cpp.html#a15c2db73fd73b04753cd1ffb2126acb6">shouldFoldCondBranchesToCommonDestination</a>(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI, <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *PBI,</div>
<div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;                                          <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> *<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) {</div>
<div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI &amp;&amp; PBI &amp;&amp; BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() &amp;&amp; PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() &amp;&amp;</div>
<div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;         <span class="stringliteral">&quot;Both blocks must end with a conditional branches.&quot;</span>);</div>
<div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">is_contained</a>(<a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()), PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()) &amp;&amp;</div>
<div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;         <span class="stringliteral">&quot;PredBB must be a predecessor of BB.&quot;</span>);</div>
<div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160; </div>
<div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;  <span class="comment">// We have the potential to fold the conditions together, but if the</span></div>
<div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;  <span class="comment">// predecessor branch is predictable, we may not want to merge them.</span></div>
<div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> PTWeight, PFWeight;</div>
<div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;  <a class="code" href="classllvm_1_1BranchProbability.html">BranchProbability</a> PBITrueProb, Likely;</div>
<div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a> &amp;&amp; !PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae22f493ba8327ce92e87d3b96bce7017">getMetadata</a>(LLVMContext::MD_unpredictable) &amp;&amp;</div>
<div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;      <a class="code" href="namespacellvm.html#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(*PBI, PTWeight, PFWeight) &amp;&amp;</div>
<div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;      (PTWeight + PFWeight) != 0) {</div>
<div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;    PBITrueProb =</div>
<div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;        BranchProbability::getBranchProbability(PTWeight, PTWeight + PFWeight);</div>
<div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;    Likely = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a99b320fd35acaf648a0a7826a0bdd777">getPredictableBranchThreshold</a>();</div>
<div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;  }</div>
<div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160; </div>
<div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;  <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0) == BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0)) {</div>
<div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;    <span class="comment">// Speculate the 2nd condition unless the 1st is probably true.</span></div>
<div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;    <span class="keywordflow">if</span> (PBITrueProb.<a class="code" href="classllvm_1_1BranchProbability.html#a7f41716b68c197b7cd7582d7a66201a3">isUnknown</a>() || PBITrueProb &lt; Likely)</div>
<div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;      <span class="keywordflow">return</span> {{BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0), Instruction::Or, <span class="keyword">false</span>}};</div>
<div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1) == BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1)) {</div>
<div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;    <span class="comment">// Speculate the 2nd condition unless the 1st is probably false.</span></div>
<div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;    <span class="keywordflow">if</span> (PBITrueProb.<a class="code" href="classllvm_1_1BranchProbability.html#a7f41716b68c197b7cd7582d7a66201a3">isUnknown</a>() || PBITrueProb.<a class="code" href="classllvm_1_1BranchProbability.html#aaee6034264d5d0782e5d1489360730d9">getCompl</a>() &lt; Likely)</div>
<div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;      <span class="keywordflow">return</span> {{BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1), Instruction::And, <span class="keyword">false</span>}};</div>
<div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0) == BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1)) {</div>
<div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;    <span class="comment">// Speculate the 2nd condition unless the 1st is probably true.</span></div>
<div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;    <span class="keywordflow">if</span> (PBITrueProb.<a class="code" href="classllvm_1_1BranchProbability.html#a7f41716b68c197b7cd7582d7a66201a3">isUnknown</a>() || PBITrueProb &lt; Likely)</div>
<div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;      <span class="keywordflow">return</span> {{BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1), Instruction::And, <span class="keyword">true</span>}};</div>
<div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1) == BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0)) {</div>
<div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;    <span class="comment">// Speculate the 2nd condition unless the 1st is probably false.</span></div>
<div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;    <span class="keywordflow">if</span> (PBITrueProb.<a class="code" href="classllvm_1_1BranchProbability.html#a7f41716b68c197b7cd7582d7a66201a3">isUnknown</a>() || PBITrueProb.<a class="code" href="classllvm_1_1BranchProbability.html#aaee6034264d5d0782e5d1489360730d9">getCompl</a>() &lt; Likely)</div>
<div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;      <span class="keywordflow">return</span> {{BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0), Instruction::Or, <span class="keyword">true</span>}};</div>
<div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;  }</div>
<div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;  <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;}</div>
<div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160; </div>
<div class="line"><a name="l03569"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a31a4e5663521fd6944605496cbc32bbb"> 3569</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a31a4e5663521fd6944605496cbc32bbb">performBranchToCommonDestFolding</a>(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI, <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *PBI,</div>
<div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;                                             <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> *DTU,</div>
<div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;                                             <a class="code" href="classllvm_1_1MemorySSAUpdater.html">MemorySSAUpdater</a> *MSSAU,</div>
<div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;                                             <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> *<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) {</div>
<div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PredBlock = PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160; </div>
<div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;  <span class="comment">// Determine if the two branches share a common destination.</span></div>
<div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *CommonSucc;</div>
<div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> Opc;</div>
<div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;  <span class="keywordtype">bool</span> InvertPredCond;</div>
<div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;  std::tie(CommonSucc, Opc, InvertPredCond) =</div>
<div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;      *<a class="code" href="SimplifyCFG_8cpp.html#a15c2db73fd73b04753cd1ffb2126acb6">shouldFoldCondBranchesToCommonDestination</a>(BI, PBI, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>);</div>
<div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160; </div>
<div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;FOLDING BRANCH TO COMMON DEST:\n&quot;</span> &lt;&lt; *PBI &lt;&lt; *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160; </div>
<div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(PBI);</div>
<div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;  <span class="comment">// The builder is used to create instructions to eliminate the branch in BB.</span></div>
<div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;  <span class="comment">// If BB&#39;s terminator has !annotation metadata, add it to the new</span></div>
<div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;  <span class="comment">// instructions.</span></div>
<div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CollectMetadataToCopy(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getTerminator(),</div>
<div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;                                {LLVMContext::MD_annotation});</div>
<div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160; </div>
<div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;  <span class="comment">// If we need to invert the condition in the pred block to match, do so now.</span></div>
<div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;  <span class="keywordflow">if</span> (InvertPredCond) {</div>
<div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *NewCond = PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>();</div>
<div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;    <span class="keywordflow">if</span> (NewCond-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; isa&lt;CmpInst&gt;(NewCond)) {</div>
<div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;      <a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a> *CI = cast&lt;CmpInst&gt;(NewCond);</div>
<div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;      CI-&gt;<a class="code" href="classllvm_1_1CmpInst.html#a126a12b67fa620ad28ec0c919ca7a3e8">setPredicate</a>(CI-&gt;<a class="code" href="classllvm_1_1CmpInst.html#aa2a54b545d237ecfe450fd1292f7675e">getInversePredicate</a>());</div>
<div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;      NewCond =</div>
<div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateNot(NewCond, PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + <span class="stringliteral">&quot;.not&quot;</span>);</div>
<div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;    }</div>
<div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160; </div>
<div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;    PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a3505dab06f59c36142a234321cdc3411">setCondition</a>(NewCond);</div>
<div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;    PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a6550fe5bd437c1c3c6e237d726e36b90">swapSuccessors</a>();</div>
<div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;  }</div>
<div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160; </div>
<div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *UniqueSucc =</div>
<div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;      PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0) == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> ? BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0) : BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1);</div>
<div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160; </div>
<div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;  <span class="comment">// Before cloning instructions, notify the successor basic block that it</span></div>
<div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;  <span class="comment">// is about to have a new predecessor. This will update PHI nodes,</span></div>
<div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;  <span class="comment">// which will allow us to update live-out uses of bonus instructions.</span></div>
<div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;  <a class="code" href="SimplifyCFG_8cpp.html#a41a075ef4b76f72591e86e1fe13f096d">AddPredecessorToBlock</a>(UniqueSucc, PredBlock, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, MSSAU);</div>
<div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160; </div>
<div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;  <span class="comment">// Try to update branch weights.</span></div>
<div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> PredTrueWeight, PredFalseWeight, SuccTrueWeight, SuccFalseWeight;</div>
<div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a404f7a1827e4eb8c5ded5ce6dafecf07">extractPredSuccWeights</a>(PBI, BI, PredTrueWeight, PredFalseWeight,</div>
<div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;                             SuccTrueWeight, SuccFalseWeight)) {</div>
<div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint64_t, 8&gt;</a> NewWeights;</div>
<div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160; </div>
<div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;    <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0) == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;      <span class="comment">// PBI: br i1 %x, BB, FalseDest</span></div>
<div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;      <span class="comment">// BI:  br i1 %y, UniqueSucc, FalseDest</span></div>
<div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;      <span class="comment">// TrueWeight is TrueWeight for PBI * TrueWeight for BI.</span></div>
<div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;      NewWeights.push_back(PredTrueWeight * SuccTrueWeight);</div>
<div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;      <span class="comment">// FalseWeight is FalseWeight for PBI * TotalWeight for BI +</span></div>
<div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;      <span class="comment">//               TrueWeight for PBI * FalseWeight for BI.</span></div>
<div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;      <span class="comment">// We assume that total weights of a BranchInst can fit into 32 bits.</span></div>
<div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;      <span class="comment">// Therefore, we will not have overflow using 64-bit arithmetic.</span></div>
<div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;      NewWeights.push_back(PredFalseWeight *</div>
<div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;                               (SuccFalseWeight + SuccTrueWeight) +</div>
<div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;                           PredTrueWeight * SuccFalseWeight);</div>
<div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;      <span class="comment">// PBI: br i1 %x, TrueDest, BB</span></div>
<div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;      <span class="comment">// BI:  br i1 %y, TrueDest, UniqueSucc</span></div>
<div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;      <span class="comment">// TrueWeight is TrueWeight for PBI * TotalWeight for BI +</span></div>
<div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;      <span class="comment">//              FalseWeight for PBI * TrueWeight for BI.</span></div>
<div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;      NewWeights.push_back(PredTrueWeight * (SuccFalseWeight + SuccTrueWeight) +</div>
<div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;                           PredFalseWeight * SuccTrueWeight);</div>
<div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;      <span class="comment">// FalseWeight is FalseWeight for PBI * FalseWeight for BI.</span></div>
<div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;      NewWeights.push_back(PredFalseWeight * SuccFalseWeight);</div>
<div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;    }</div>
<div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160; </div>
<div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;    <span class="comment">// Halve the weights if any of them cannot fit in an uint32_t</span></div>
<div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#a95ec32778f2bb913dc4cc45ac7a66e42">FitWeights</a>(NewWeights);</div>
<div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160; </div>
<div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint32_t, 8&gt;</a> MDWeights(NewWeights.begin(), NewWeights.end());</div>
<div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#a4953dfe289f5d9ad59a7964c4c63c2a9">setBranchWeights</a>(PBI, MDWeights[0], MDWeights[1]);</div>
<div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160; </div>
<div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;    <span class="comment">// TODO: If BB is reachable from all paths through PredBlock, then we</span></div>
<div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;    <span class="comment">// could replace PBI&#39;s branch probabilities with BI&#39;s.</span></div>
<div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;  } <span class="keywordflow">else</span></div>
<div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;    PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(LLVMContext::MD_prof, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160; </div>
<div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;  <span class="comment">// Now, update the CFG.</span></div>
<div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;  PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#adc5e7f9c460c68455e826783d77f9a99">setSuccessor</a>(PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0) != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, UniqueSucc);</div>
<div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160; </div>
<div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;  <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;    DTU-&gt;<a class="code" href="classllvm_1_1DomTreeUpdater.html#aae522cd1928cfac6850b50c7a3e22185">applyUpdates</a>({{<a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">DominatorTree::Insert</a>, PredBlock, UniqueSucc},</div>
<div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;                       {DominatorTree::Delete, PredBlock, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>}});</div>
<div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160; </div>
<div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;  <span class="comment">// If BI was a loop latch, it may have had associated loop metadata.</span></div>
<div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;  <span class="comment">// We need to copy it to the new latch, that is, PBI.</span></div>
<div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *LoopMD = BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae22f493ba8327ce92e87d3b96bce7017">getMetadata</a>(LLVMContext::MD_loop))</div>
<div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;    PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(LLVMContext::MD_loop, LoopMD);</div>
<div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160; </div>
<div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;  <a class="code" href="classllvm_1_1ValueMap.html">ValueToValueMapTy</a> VMap; <span class="comment">// maps original values to cloned values</span></div>
<div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;  <a class="code" href="SimplifyCFG_8cpp.html#a1a4df60f6ee2e2103d1d4e2752d5192d">CloneInstructionsIntoPredecessorBlockAndUpdateSSAUses</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, PredBlock, VMap);</div>
<div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160; </div>
<div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;  <span class="comment">// Now that the Cond was cloned into the predecessor basic block,</span></div>
<div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;  <span class="comment">// or/and the two conditions together.</span></div>
<div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *BICond = VMap[BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>()];</div>
<div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;  PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a3505dab06f59c36142a234321cdc3411">setCondition</a>(</div>
<div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;      <a class="code" href="SimplifyCFG_8cpp.html#a5f162160c57fca10cd58c00b439414cb">createLogicalOp</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, Opc, PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>(), BICond, <span class="stringliteral">&quot;or.cond&quot;</span>));</div>
<div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160; </div>
<div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;  <span class="comment">// Copy any debug value intrinsics into the end of PredBlock.</span></div>
<div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;    <span class="keywordflow">if</span> (isa&lt;DbgInfoIntrinsic&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NewI = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.clone();</div>
<div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;      <a class="code" href="namespacellvm.html#a8f2893ab869a806d78af17691eb97be3">RemapInstruction</a>(NewI, VMap,</div>
<div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;                       <a class="code" href="namespacellvm.html#a77724415203930efd07d7098cb1e437da9a24bd8dba1bef2753bc3f087435ae7f">RF_NoModuleLevelChanges</a> | <a class="code" href="namespacellvm.html#a77724415203930efd07d7098cb1e437da5633028bc27ffa8eab39cc5de65b3108">RF_IgnoreMissingLocals</a>);</div>
<div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;      NewI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(PBI);</div>
<div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;    }</div>
<div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;  }</div>
<div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160; </div>
<div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;  ++NumFoldBranchToCommonDest;</div>
<div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;}</div>
<div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;<span class="comment">/// Return if an instruction&#39;s type or any of its operands&#39; types are a vector</span></div>
<div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;<span class="comment">/// type.</span></div>
<div class="line"><a name="l03692"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a227525ceb37837d0076479b272b50aec"> 3692</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a227525ceb37837d0076479b272b50aec">isVectorOp</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType()-&gt;isVectorTy() || <a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.operands(), [](<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U) {</div>
<div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;           return U-&gt;getType()-&gt;isVectorTy();</div>
<div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;         });</div>
<div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;}</div>
<div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;<span class="comment">/// If this basic block is simple enough, and if a predecessor branches to us</span></div>
<div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;<span class="comment">/// and one of our successors, fold the block into the predecessor and use</span></div>
<div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;<span class="comment">/// logical operations to pick the right destination.</span></div>
<div class="line"><a name="l03701"></a><span class="lineno"><a class="line" href="namespacellvm.html#a6713fe2f5fca7c6e1109392b28c21c17"> 3701</a></span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#a6713fe2f5fca7c6e1109392b28c21c17">llvm::FoldBranchToCommonDest</a>(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI, <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> *DTU,</div>
<div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;                                  <a class="code" href="classllvm_1_1MemorySSAUpdater.html">MemorySSAUpdater</a> *MSSAU,</div>
<div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;                                  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> *<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>,</div>
<div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;                                  <span class="keywordtype">unsigned</span> BonusInstThreshold) {</div>
<div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;  <span class="comment">// If this block ends with an unconditional branch,</span></div>
<div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;  <span class="comment">// let SpeculativelyExecuteBB() deal with it.</span></div>
<div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;  <span class="keywordflow">if</span> (!BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>())</div>
<div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160; </div>
<div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;  <a class="code" href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bb">TargetTransformInfo::TargetCostKind</a> <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a> =</div>
<div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;    <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getParent()-&gt;hasMinSize() ? TargetTransformInfo::TCK_CodeSize</div>
<div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;                                  : TargetTransformInfo::TCK_SizeAndLatency;</div>
<div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160; </div>
<div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a> = dyn_cast&lt;Instruction&gt;(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>());</div>
<div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160; </div>
<div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a> ||</div>
<div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;      (!isa&lt;CmpInst&gt;(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>) &amp;&amp; !isa&lt;BinaryOperator&gt;(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>) &amp;&amp;</div>
<div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;       !isa&lt;SelectInst&gt;(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>)) ||</div>
<div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;      <a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>-&gt;getParent() != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> || !<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>-&gt;hasOneUse())</div>
<div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160; </div>
<div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;  <span class="comment">// Finally, don&#39;t infinitely unroll conditional loops.</span></div>
<div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">is_contained</a>(<a class="code" href="namespacellvm.html#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>), <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>))</div>
<div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160; </div>
<div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;  <span class="comment">// With which predecessors will we want to deal with?</span></div>
<div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock *, 8&gt;</a> Preds;</div>
<div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PredBlock : <a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)) {</div>
<div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;    <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *PBI = dyn_cast&lt;BranchInst&gt;(PredBlock-&gt;getTerminator());</div>
<div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160; </div>
<div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;    <span class="comment">// Check that we have two conditional branches.  If there is a PHI node in</span></div>
<div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;    <span class="comment">// the common successor, verify that the same value flows in from both</span></div>
<div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;    <span class="comment">// blocks.</span></div>
<div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;    <span class="keywordflow">if</span> (!PBI || PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad56f6a9b5cd05940017c4544df48bc30">isUnconditional</a>() || !<a class="code" href="SimplifyCFG_8cpp.html#a176b027b36f2084a7d30439522a86b79">SafeToMergeTerminators</a>(BI, PBI))</div>
<div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160; </div>
<div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;    <span class="comment">// Determine if the two branches share a common destination.</span></div>
<div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *CommonSucc;</div>
<div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> Opc;</div>
<div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;    <span class="keywordtype">bool</span> InvertPredCond;</div>
<div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> Recipe = <a class="code" href="SimplifyCFG_8cpp.html#a15c2db73fd73b04753cd1ffb2126acb6">shouldFoldCondBranchesToCommonDestination</a>(BI, PBI, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>))</div>
<div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;      std::tie(CommonSucc, Opc, InvertPredCond) = *Recipe;</div>
<div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160; </div>
<div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;    <span class="comment">// Check the cost of inserting the necessary logic before performing the</span></div>
<div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;    <span class="comment">// transformation.</span></div>
<div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) {</div>
<div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;      <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a9679969ae87f8a08d5f6948be6cf7210">getArithmeticInstrCost</a>(Opc, Ty, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>);</div>
<div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;      <span class="keywordflow">if</span> (InvertPredCond &amp;&amp; (!PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() ||</div>
<div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;                             !isa&lt;CmpInst&gt;(PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>())))</div>
<div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;        <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> += <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a9679969ae87f8a08d5f6948be6cf7210">getArithmeticInstrCost</a>(Instruction::Xor, Ty, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>);</div>
<div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160; </div>
<div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> &gt; <a class="code" href="SimplifyCFG_8cpp.html#aa997f186d431ca191833917f6f8a7dd1">BranchFoldThreshold</a>)</div>
<div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;    }</div>
<div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160; </div>
<div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;    <span class="comment">// Ok, we do want to deal with this predecessor. Record it.</span></div>
<div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;    Preds.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>(PredBlock);</div>
<div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;  }</div>
<div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160; </div>
<div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;  <span class="comment">// If there aren&#39;t any predecessors into which we can fold,</span></div>
<div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;  <span class="comment">// don&#39;t bother checking the cost.</span></div>
<div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;  <span class="keywordflow">if</span> (Preds.empty())</div>
<div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160; </div>
<div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;  <span class="comment">// Only allow this transformation if computing the condition doesn&#39;t involve</span></div>
<div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;  <span class="comment">// too many instructions and these involved instructions can be executed</span></div>
<div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;  <span class="comment">// unconditionally. We denote all involved instructions except the condition</span></div>
<div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;  <span class="comment">// as &quot;bonus instructions&quot;, and only allow this transformation when the</span></div>
<div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;  <span class="comment">// number of the bonus instructions we&#39;ll need to create when cloning into</span></div>
<div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;  <span class="comment">// each predecessor does not exceed a certain threshold.</span></div>
<div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;  <span class="keywordtype">unsigned</span> NumBonusInsts = 0;</div>
<div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;  <span class="keywordtype">bool</span> SawVectorOp = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> PredCount = Preds.size();</div>
<div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;    <span class="comment">// Don&#39;t check the branch condition comparison itself.</span></div>
<div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;    <span class="keywordflow">if</span> (&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> == <a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>)</div>
<div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;    <span class="comment">// Ignore dbg intrinsics, and the terminator.</span></div>
<div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;    <span class="keywordflow">if</span> (isa&lt;DbgInfoIntrinsic&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || isa&lt;BranchInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;    <span class="comment">// I must be safe to execute unconditionally.</span></div>
<div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#abe76d72cda6b2b4562c72accb510040b">isSafeToSpeculativelyExecute</a>(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;    SawVectorOp |= <a class="code" href="SimplifyCFG_8cpp.html#a227525ceb37837d0076479b272b50aec">isVectorOp</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160; </div>
<div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;    <span class="comment">// Account for the cost of duplicating this instruction into each</span></div>
<div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;    <span class="comment">// predecessor. Ignore free instructions.</span></div>
<div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a> || <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#ac77dbedcfd916a5c9b58e753b2678a98">getInstructionCost</a>(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>) !=</div>
<div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;                    TargetTransformInfo::TCC_Free) {</div>
<div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;      NumBonusInsts += PredCount;</div>
<div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160; </div>
<div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;      <span class="comment">// Early exits once we reach the limit.</span></div>
<div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;      <span class="keywordflow">if</span> (NumBonusInsts &gt;</div>
<div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;          BonusInstThreshold * <a class="code" href="SimplifyCFG_8cpp.html#ab5a77dae433054cd06665aee83107ab3">BranchFoldToCommonDestVectorMultiplier</a>)</div>
<div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;    }</div>
<div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160; </div>
<div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;    <span class="keyword">auto</span> IsBCSSAUse = [<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>](<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U) {</div>
<div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;      <span class="keyword">auto</span> *UI = cast&lt;Instruction&gt;(U.getUser());</div>
<div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *PN = dyn_cast&lt;PHINode&gt;(UI))</div>
<div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;        <span class="keywordflow">return</span> PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a8ce0c4746a1ec805e66409d20ae93922">getIncomingBlock</a>(U) == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>;</div>
<div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;      <span class="keywordflow">return</span> UI-&gt;getParent() == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> &amp;&amp; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.comesBefore(UI);</div>
<div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;    };</div>
<div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160; </div>
<div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;    <span class="comment">// Does this instruction require rewriting of uses?</span></div>
<div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.uses(), IsBCSSAUse))</div>
<div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;  }</div>
<div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;  <span class="keywordflow">if</span> (NumBonusInsts &gt;</div>
<div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;      BonusInstThreshold *</div>
<div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;          (SawVectorOp ? <a class="code" href="SimplifyCFG_8cpp.html#ab5a77dae433054cd06665aee83107ab3">BranchFoldToCommonDestVectorMultiplier</a> : 1))</div>
<div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160; </div>
<div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;  <span class="comment">// Ok, we have the budget. Perform the transformation.</span></div>
<div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PredBlock : Preds) {</div>
<div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;    <span class="keyword">auto</span> *PBI = cast&lt;BranchInst&gt;(PredBlock-&gt;getTerminator());</div>
<div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="SimplifyCFG_8cpp.html#a31a4e5663521fd6944605496cbc32bbb">performBranchToCommonDestFolding</a>(BI, PBI, DTU, MSSAU, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>);</div>
<div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;  }</div>
<div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;}</div>
<div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160; </div>
<div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;<span class="comment">// If there is only one store in BB1 and BB2, return it, otherwise return</span></div>
<div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;<span class="comment">// nullptr.</span></div>
<div class="line"><a name="l03828"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#aad3186d040aca408a1f8cbbd55aece95"> 3828</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="SimplifyCFG_8cpp.html#aad3186d040aca408a1f8cbbd55aece95">findUniqueStoreInBlocks</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB1, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB2) {</div>
<div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;  <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : {BB1, BB2}) {</div>
<div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;StoreInst&gt;(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>)</div>
<div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;          <span class="comment">// Multiple stores seen.</span></div>
<div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;          <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>;</div>
<div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;      }</div>
<div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;  }</div>
<div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>;</div>
<div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;}</div>
<div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160; </div>
<div class="line"><a name="l03845"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#ab0f1f74f779f0c7d4247276585eb8eca"> 3845</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="SimplifyCFG_8cpp.html#ab0f1f74f779f0c7d4247276585eb8eca">ensureValueAvailableInSuccessor</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>,</div>
<div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;                                              <a class="code" href="classllvm_1_1Value.html">Value</a> *AlternativeV = <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;  <span class="comment">// PHI is going to be a PHI node that allows the value V that is defined in</span></div>
<div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;  <span class="comment">// BB to be referenced in BB&#39;s only successor.</span></div>
<div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;  <span class="comment">// If AlternativeV is nullptr, the only value we care about in PHI is V. It</span></div>
<div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;  <span class="comment">// doesn&#39;t matter to us what the other operand is (it&#39;ll never get used). We</span></div>
<div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;  <span class="comment">// could just create a new PHI with an undef incoming value, but that could</span></div>
<div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;  <span class="comment">// increase register pressure if EarlyCSE/InstCombine can&#39;t fold it with some</span></div>
<div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;  <span class="comment">// other PHI. So here we directly look for some PHI in BB&#39;s successor with V</span></div>
<div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;  <span class="comment">// as an incoming operand. If we find one, we use it, else we create a new</span></div>
<div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;  <span class="comment">// one.</span></div>
<div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;  <span class="comment">// If AlternativeV is not nullptr, we care about both incoming values in PHI.</span></div>
<div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;  <span class="comment">// PHI must be exactly: phi &lt;ty&gt; [ %BB, %V ], [ %OtherBB, %AlternativeV]</span></div>
<div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;  <span class="comment">// where OtherBB is the single other predecessor of BB&#39;s only successor.</span></div>
<div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;  <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getSingleSuccessor();</div>
<div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160; </div>
<div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Succ-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); isa&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>); ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;    <span class="keywordflow">if</span> (cast&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getIncomingValueForBlock(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) == V) {</div>
<div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;      <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = cast&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;      <span class="keywordflow">if</span> (!AlternativeV)</div>
<div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160; </div>
<div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Succ-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a526630ff85b48f29ac5b4c519c6c2243">hasNPredecessors</a>(2));</div>
<div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;      <span class="keyword">auto</span> PredI = <a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(Succ);</div>
<div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *OtherPredBB = *PredI == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> ? *++PredI : *PredI;</div>
<div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getIncomingValueForBlock(OtherPredBB) == AlternativeV)</div>
<div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;      <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;    }</div>
<div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>)</div>
<div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>;</div>
<div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160; </div>
<div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;  <span class="comment">// If V is not an instruction defined in BB, just return it.</span></div>
<div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;  <span class="keywordflow">if</span> (!AlternativeV &amp;&amp;</div>
<div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;      (!isa&lt;Instruction&gt;(V) || cast&lt;Instruction&gt;(V)-&gt;<a class="code" href="BasicAliasAnalysis_8cpp.html#a2675de1d8479c7b00387979714da43f7">getParent</a>() != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>))</div>
<div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;    <span class="keywordflow">return</span> V;</div>
<div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160; </div>
<div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;  <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = PHINode::Create(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), 2, <span class="stringliteral">&quot;simplifycfg.merge&quot;</span>, &amp;Succ-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#ab706e7ebb1969c5e34f28bfcf2ff719e">front</a>());</div>
<div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;  <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;addIncoming(V, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PredBB : <a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(Succ))</div>
<div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;    <span class="keywordflow">if</span> (PredBB != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;      <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;addIncoming(</div>
<div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;          AlternativeV ? AlternativeV : <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">UndefValue::get</a>(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()), PredBB);</div>
<div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>;</div>
<div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;}</div>
<div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160; </div>
<div class="line"><a name="l03894"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a1a5189be752e56bf8343fd72f45720ee"> 3894</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a1a5189be752e56bf8343fd72f45720ee">mergeConditionalStoreToAddress</a>(</div>
<div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PTB, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PFB, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *QTB, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *QFB,</div>
<div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PostBB, <a class="code" href="classllvm_1_1Value.html">Value</a> *Address, <span class="keywordtype">bool</span> InvertPCond, <span class="keywordtype">bool</span> InvertQCond,</div>
<div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;    <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> *DTU, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) {</div>
<div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;  <span class="comment">// For every pointer, there must be exactly two stores, one coming from</span></div>
<div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;  <span class="comment">// PTB or PFB, and the other from QTB or QFB. We don&#39;t support more than one</span></div>
<div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;  <span class="comment">// store (to any address) in PTB,PFB or QTB,QFB.</span></div>
<div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;  <span class="comment">// FIXME: We could relax this restriction with a bit more work and performance</span></div>
<div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;  <span class="comment">// testing.</span></div>
<div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;  <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *PStore = <a class="code" href="SimplifyCFG_8cpp.html#aad3186d040aca408a1f8cbbd55aece95">findUniqueStoreInBlocks</a>(PTB, PFB);</div>
<div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;  <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *QStore = <a class="code" href="SimplifyCFG_8cpp.html#aad3186d040aca408a1f8cbbd55aece95">findUniqueStoreInBlocks</a>(QTB, QFB);</div>
<div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;  <span class="keywordflow">if</span> (!PStore || !QStore)</div>
<div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160; </div>
<div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;  <span class="comment">// Now check the stores are compatible.</span></div>
<div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;  <span class="keywordflow">if</span> (!QStore-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a8e2e13588202d0d79ceff0f1d8d35d86">isUnordered</a>() || !PStore-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a8e2e13588202d0d79ceff0f1d8d35d86">isUnordered</a>() ||</div>
<div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;      PStore-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a14298313bdf734e2db5a921cc6e861a0">getValueOperand</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() !=</div>
<div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;          QStore-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a14298313bdf734e2db5a921cc6e861a0">getValueOperand</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())</div>
<div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160; </div>
<div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;  <span class="comment">// Check that sinking the store won&#39;t cause program behavior changes. Sinking</span></div>
<div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;  <span class="comment">// the store out of the Q blocks won&#39;t change any behavior as we&#39;re sinking</span></div>
<div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;  <span class="comment">// from a block to its unconditional successor. But we&#39;re moving a store from</span></div>
<div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;  <span class="comment">// the P blocks down through the middle block (QBI) and past both QFB and QTB.</span></div>
<div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;  <span class="comment">// So we need to check that there are no aliasing loads or stores in</span></div>
<div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;  <span class="comment">// QBI, QTB and QFB. We also need to check there are no conflicting memory</span></div>
<div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;  <span class="comment">// operations between PStore and the end of its parent block.</span></div>
<div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;  <span class="comment">// The ideal way to do this is to query AliasAnalysis, but we don&#39;t</span></div>
<div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;  <span class="comment">// preserve AA currently so that is dangerous. Be super safe and just</span></div>
<div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;  <span class="comment">// check there are no other memory operations at all.</span></div>
<div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : *QFB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>())</div>
<div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayReadOrWriteMemory())</div>
<div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : *QFB)</div>
<div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;    <span class="keywordflow">if</span> (&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != QStore &amp;&amp; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayReadOrWriteMemory())</div>
<div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;  <span class="keywordflow">if</span> (QTB)</div>
<div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : *QTB)</div>
<div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;      <span class="keywordflow">if</span> (&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != QStore &amp;&amp; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayReadOrWriteMemory())</div>
<div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a>(PStore), <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = PStore-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>();</div>
<div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;       <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;    <span class="keywordflow">if</span> (&amp;*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != PStore &amp;&amp; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayReadOrWriteMemory())</div>
<div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160; </div>
<div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;  <span class="comment">// If we&#39;re not in aggressive mode, we only optimize if we have some</span></div>
<div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;  <span class="comment">// confidence that by optimizing we&#39;ll allow P and/or Q to be if-converted.</span></div>
<div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;  <span class="keyword">auto</span> IsWorthwhile = [&amp;](<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;StoreInst *&gt;</a> FreeStores) {</div>
<div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;    <span class="comment">// Heuristic: if the block can be if-converted/phi-folded and the</span></div>
<div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;    <span class="comment">// instructions inside are all cheap (arithmetic/GEPs), it&#39;s worthwhile to</span></div>
<div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;    <span class="comment">// thread this store.</span></div>
<div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;    <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> = 0;</div>
<div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;    <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> Budget =</div>
<div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;        <a class="code" href="SimplifyCFG_8cpp.html#a51d993ac59a51760ec7a9c7a1738755a">PHINodeFoldingThreshold</a> * TargetTransformInfo::TCC_Basic;</div>
<div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;instructionsWithoutDebug(<span class="keyword">false</span>)) {</div>
<div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;      <span class="comment">// Consider terminator instruction to be free.</span></div>
<div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isTerminator())</div>
<div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;      <span class="comment">// If this is one the stores that we want to speculate out of this BB,</span></div>
<div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;      <span class="comment">// then don&#39;t count it&#39;s cost, consider it to be free.</span></div>
<div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = dyn_cast&lt;StoreInst&gt;(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a086e9fbdb06276db7753101a08a63adf">llvm::find</a>(FreeStores, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>))</div>
<div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;      <span class="comment">// Else, we have a white-list of instructions that we are ak speculating.</span></div>
<div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;      <span class="keywordflow">if</span> (!isa&lt;BinaryOperator&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !isa&lt;GetElementPtrInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Not in white-list - not worthwhile folding.</span></div>
<div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;      <span class="comment">// And finally, if this is a non-free instruction that we are okay</span></div>
<div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;      <span class="comment">// speculating, ensure that we consider the speculation budget.</span></div>
<div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;      <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> +=</div>
<div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;          <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>.<a class="code" href="classllvm_1_1TargetTransformInfo.html#ac77dbedcfd916a5c9b58e753b2678a98">getInstructionCost</a>(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, TargetTransformInfo::TCK_SizeAndLatency);</div>
<div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> &gt; Budget)</div>
<div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Eagerly refuse to fold as soon as we&#39;re out of budget.</span></div>
<div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;    }</div>
<div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> &lt;= Budget &amp;&amp;</div>
<div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;           <span class="stringliteral">&quot;When we run out of budget we will eagerly return from within the &quot;</span></div>
<div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;           <span class="stringliteral">&quot;per-instruction loop.&quot;</span>);</div>
<div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;  };</div>
<div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160; </div>
<div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;  <span class="keyword">const</span> std::array&lt;StoreInst *, 2&gt; FreeStores = {PStore, QStore};</div>
<div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#a79048da023cea1bb91bc651c36ed6e32">MergeCondStoresAggressively</a> &amp;&amp;</div>
<div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;      (!IsWorthwhile(PTB, FreeStores) || !IsWorthwhile(PFB, FreeStores) ||</div>
<div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;       !IsWorthwhile(QTB, FreeStores) || !IsWorthwhile(QFB, FreeStores)))</div>
<div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160; </div>
<div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;  <span class="comment">// If PostBB has more than two predecessors, we need to split it so we can</span></div>
<div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;  <span class="comment">// sink the store.</span></div>
<div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;  <span class="keywordflow">if</span> (std::next(<a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(PostBB), 2) != <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(PostBB)) {</div>
<div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;    <span class="comment">// We know that QFB&#39;s only successor is PostBB. And QFB has a single</span></div>
<div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;    <span class="comment">// predecessor. If QTB exists, then its only successor is also PostBB.</span></div>
<div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;    <span class="comment">// If QTB does not exist, then QFB&#39;s only predecessor has a conditional</span></div>
<div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;    <span class="comment">// branch to QFB and PostBB.</span></div>
<div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *TruePred = QTB ? QTB : QFB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</div>
<div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *NewBB =</div>
<div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;        <a class="code" href="namespacellvm.html#a9d391b6acc6d90c9b8a8442324b1aa6f">SplitBlockPredecessors</a>(PostBB, {QFB, TruePred}, <span class="stringliteral">&quot;condstore.split&quot;</span>, DTU);</div>
<div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;    <span class="keywordflow">if</span> (!NewBB)</div>
<div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;    PostBB = NewBB;</div>
<div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;  }</div>
<div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160; </div>
<div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;  <span class="comment">// OK, we&#39;re going to sink the stores to PostBB. The store has to be</span></div>
<div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;  <span class="comment">// conditional though, so first create the predicate.</span></div>
<div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *PCond = cast&lt;BranchInst&gt;(PFB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>())</div>
<div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;                     -&gt;getCondition();</div>
<div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *QCond = cast&lt;BranchInst&gt;(QFB-&gt;getSinglePredecessor()-&gt;getTerminator())</div>
<div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;                     -&gt;getCondition();</div>
<div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160; </div>
<div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *PPHI = <a class="code" href="SimplifyCFG_8cpp.html#ab0f1f74f779f0c7d4247276585eb8eca">ensureValueAvailableInSuccessor</a>(PStore-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a14298313bdf734e2db5a921cc6e861a0">getValueOperand</a>(),</div>
<div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;                                                PStore-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>());</div>
<div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *QPHI = <a class="code" href="SimplifyCFG_8cpp.html#ab0f1f74f779f0c7d4247276585eb8eca">ensureValueAvailableInSuccessor</a>(QStore-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a14298313bdf734e2db5a921cc6e861a0">getValueOperand</a>(),</div>
<div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;                                                QStore-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>(), PPHI);</div>
<div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160; </div>
<div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> QB(&amp;*PostBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</div>
<div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160; </div>
<div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *PPred = PStore-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() == PTB ? PCond : QB.<a class="code" href="classllvm_1_1IRBuilderBase.html#a4b2c1cc89c04d885ab3036597446f0cd">CreateNot</a>(PCond);</div>
<div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *QPred = QStore-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() == QTB ? QCond : QB.<a class="code" href="classllvm_1_1IRBuilderBase.html#a4b2c1cc89c04d885ab3036597446f0cd">CreateNot</a>(QCond);</div>
<div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160; </div>
<div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;  <span class="keywordflow">if</span> (InvertPCond)</div>
<div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;    PPred = QB.<a class="code" href="classllvm_1_1IRBuilderBase.html#a4b2c1cc89c04d885ab3036597446f0cd">CreateNot</a>(PPred);</div>
<div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;  <span class="keywordflow">if</span> (InvertQCond)</div>
<div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;    QPred = QB.<a class="code" href="classllvm_1_1IRBuilderBase.html#a4b2c1cc89c04d885ab3036597446f0cd">CreateNot</a>(QPred);</div>
<div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *CombinedPred = QB.<a class="code" href="classllvm_1_1IRBuilderBase.html#ad31917a381a26d6857d63e9f4bf4e1fa">CreateOr</a>(PPred, QPred);</div>
<div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160; </div>
<div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="classT.html">T</a> = <a class="code" href="namespacellvm.html#ae2aea60aed775d05692317bf4855c291">SplitBlockAndInsertIfThen</a>(CombinedPred, &amp;*QB.<a class="code" href="classllvm_1_1IRBuilderBase.html#a4e5c1b91bf5e2860398e3fa35c96b5af">GetInsertPoint</a>(),</div>
<div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;                                      <span class="comment">/*Unreachable=*/</span><span class="keyword">false</span>,</div>
<div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;                                      <span class="comment">/*BranchWeights=*/</span><span class="keyword">nullptr</span>, DTU);</div>
<div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;  QB.<a class="code" href="classllvm_1_1IRBuilderBase.html#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(<a class="code" href="classT.html">T</a>);</div>
<div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;  <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = cast&lt;StoreInst&gt;(QB.<a class="code" href="classllvm_1_1IRBuilderBase.html#a7d1a18dc150da601587ccc716e0e4b41">CreateStore</a>(QPHI, Address));</div>
<div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;  <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;setAAMetadata(PStore-&gt;<a class="code" href="classllvm_1_1Instruction.html#aade703948f2fdabdc65868bdf42d3141">getAAMetadata</a>().<a class="code" href="structllvm_1_1AAMDNodes.html#a6b173e97523275314f3f2b433a5f71a9">merge</a>(QStore-&gt;<a class="code" href="classllvm_1_1Instruction.html#aade703948f2fdabdc65868bdf42d3141">getAAMetadata</a>()));</div>
<div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;  <span class="comment">// Choose the minimum alignment. If we could prove both stores execute, we</span></div>
<div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;  <span class="comment">// could use biggest one.  In this case, though, we only know that one of the</span></div>
<div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;  <span class="comment">// stores executes.  And we don&#39;t know it&#39;s safe to take the alignment from a</span></div>
<div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;  <span class="comment">// store that doesn&#39;t execute.</span></div>
<div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;  <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;setAlignment(<a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(PStore-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a3b47950858d6ed72efd1010a35b81caa">getAlign</a>(), QStore-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a3b47950858d6ed72efd1010a35b81caa">getAlign</a>()));</div>
<div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160; </div>
<div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;  QStore-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;  PStore-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160; </div>
<div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;}</div>
<div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160; </div>
<div class="line"><a name="l04038"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a6a58dfc629e1b208cdd7b2bd76203184"> 4038</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a6a58dfc629e1b208cdd7b2bd76203184">mergeConditionalStores</a>(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *PBI, <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *QBI,</div>
<div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;                                   <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> *DTU, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</div>
<div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;                                   <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) {</div>
<div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;  <span class="comment">// The intention here is to find diamonds or triangles (see below) where each</span></div>
<div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;  <span class="comment">// conditional block contains a store to the same address. Both of these</span></div>
<div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;  <span class="comment">// stores are conditional, so they can&#39;t be unconditionally sunk. But it may</span></div>
<div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;  <span class="comment">// be profitable to speculatively sink the stores into one merged store at the</span></div>
<div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;  <span class="comment">// end, and predicate the merged store on the union of the two conditions of</span></div>
<div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;  <span class="comment">// PBI and QBI.</span></div>
<div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;  <span class="comment">// This can reduce the number of stores executed if both of the conditions are</span></div>
<div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;  <span class="comment">// true, and can allow the blocks to become small enough to be if-converted.</span></div>
<div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;  <span class="comment">// This optimization will also chain, so that ladders of test-and-set</span></div>
<div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;  <span class="comment">// sequences can be if-converted away.</span></div>
<div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;  <span class="comment">// We only deal with simple diamonds or triangles:</span></div>
<div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;  <span class="comment">//     PBI       or      PBI        or a combination of the two</span></div>
<div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;  <span class="comment">//    /   \               | \</span></div>
<div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;<span class="comment">  //   PTB  PFB             |  PFB</span></div>
<div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;  <span class="comment">//    \   /               | /</span></div>
<div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;  <span class="comment">//     QBI                QBI</span></div>
<div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;  <span class="comment">//    /  \                | \</span></div>
<div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;<span class="comment">  //   QTB  QFB             |  QFB</span></div>
<div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;  <span class="comment">//    \  /                | /</span></div>
<div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;  <span class="comment">//    PostBB            PostBB</span></div>
<div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;  <span class="comment">// We model triangles as a type of diamond with a nullptr &quot;true&quot; block.</span></div>
<div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;  <span class="comment">// Triangles are canonicalized so that the fallthrough edge is represented by</span></div>
<div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;  <span class="comment">// a true condition, as in the diagram above.</span></div>
<div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PTB = PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0);</div>
<div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PFB = PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1);</div>
<div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *QTB = QBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0);</div>
<div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *QFB = QBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1);</div>
<div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PostBB = QFB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a79c007dcf9fff57e1569e778d7885b5e">getSingleSuccessor</a>();</div>
<div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160; </div>
<div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;  <span class="comment">// Make sure we have a good guess for PostBB. If QTB&#39;s only successor is</span></div>
<div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;  <span class="comment">// QFB, then QFB is a better PostBB.</span></div>
<div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;  <span class="keywordflow">if</span> (QTB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a79c007dcf9fff57e1569e778d7885b5e">getSingleSuccessor</a>() == QFB)</div>
<div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;    PostBB = QFB;</div>
<div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160; </div>
<div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;  <span class="comment">// If we couldn&#39;t find a good PostBB, stop.</span></div>
<div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;  <span class="keywordflow">if</span> (!PostBB)</div>
<div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160; </div>
<div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;  <span class="keywordtype">bool</span> InvertPCond = <span class="keyword">false</span>, InvertQCond = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;  <span class="comment">// Canonicalize fallthroughs to the true branches.</span></div>
<div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;  <span class="keywordflow">if</span> (PFB == QBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()) {</div>
<div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;    <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(PFB, PTB);</div>
<div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;    InvertPCond = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;  }</div>
<div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;  <span class="keywordflow">if</span> (QFB == PostBB) {</div>
<div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;    <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(QFB, QTB);</div>
<div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;    InvertQCond = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;  }</div>
<div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160; </div>
<div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;  <span class="comment">// From this point on we can assume PTB or QTB may be fallthroughs but PFB</span></div>
<div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;  <span class="comment">// and QFB may not. Model fallthroughs as a nullptr block.</span></div>
<div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;  <span class="keywordflow">if</span> (PTB == QBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>())</div>
<div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;    PTB = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;  <span class="keywordflow">if</span> (QTB == PostBB)</div>
<div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;    QTB = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160; </div>
<div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;  <span class="comment">// Legality bailouts. We must have at least the non-fallthrough blocks and</span></div>
<div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;  <span class="comment">// the post-dominating block, and the non-fallthroughs must only have one</span></div>
<div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;  <span class="comment">// predecessor.</span></div>
<div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;  <span class="keyword">auto</span> HasOnePredAndOneSucc = [](<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>) {</div>
<div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getSinglePredecessor() == <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> &amp;&amp; <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getSingleSuccessor() == <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>;</div>
<div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;  };</div>
<div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;  <span class="keywordflow">if</span> (!HasOnePredAndOneSucc(PFB, PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>(), QBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()) ||</div>
<div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;      !HasOnePredAndOneSucc(QFB, QBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>(), PostBB))</div>
<div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;  <span class="keywordflow">if</span> ((PTB &amp;&amp; !HasOnePredAndOneSucc(PTB, PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>(), QBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>())) ||</div>
<div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;      (QTB &amp;&amp; !HasOnePredAndOneSucc(QTB, QBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>(), PostBB)))</div>
<div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;  <span class="keywordflow">if</span> (!QBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#a7c779ce2ba55bc94f52014fc25f3d520">hasNUses</a>(2))</div>
<div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160; </div>
<div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;  <span class="comment">// OK, this is a sequence of two diamonds or triangles.</span></div>
<div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;  <span class="comment">// Check if there are stores in PTB or PFB that are repeated in QTB or QFB.</span></div>
<div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value *, 4&gt;</a> PStoreAddresses, QStoreAddresses;</div>
<div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : {PTB, PFB}) {</div>
<div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;StoreInst&gt;(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;        PStoreAddresses.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getPointerOperand());</div>
<div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;  }</div>
<div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : {QTB, QFB}) {</div>
<div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;StoreInst&gt;(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;        QStoreAddresses.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getPointerOperand());</div>
<div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;  }</div>
<div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160; </div>
<div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;  <a class="code" href="namespacellvm.html#a2162d123f222998300d308bdefdb38b9">set_intersect</a>(PStoreAddresses, QStoreAddresses);</div>
<div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;  <span class="comment">// set_intersect mutates PStoreAddresses in place. Rename it here to make it</span></div>
<div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;  <span class="comment">// clear what it contains.</span></div>
<div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;  <span class="keyword">auto</span> &amp;CommonAddresses = PStoreAddresses;</div>
<div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160; </div>
<div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Address : CommonAddresses)</div>
<div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;    Changed |=</div>
<div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;        <a class="code" href="SimplifyCFG_8cpp.html#a1a5189be752e56bf8343fd72f45720ee">mergeConditionalStoreToAddress</a>(PTB, PFB, QTB, QFB, PostBB, Address,</div>
<div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;                                       InvertPCond, InvertQCond, DTU, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>);</div>
<div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;}</div>
<div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;<span class="comment">/// If the previous block ended with a widenable branch, determine if reusing</span></div>
<div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;<span class="comment">/// the target block is profitable and legal.  This will have the effect of</span></div>
<div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;<span class="comment">/// &quot;widening&quot; PBI, but doesn&#39;t require us to reason about hosting safety.</span></div>
<div class="line"><a name="l04150"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#ad98f06eded5a01ee8704f7d7d9ca4c5b"> 4150</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#ad98f06eded5a01ee8704f7d7d9ca4c5b">tryWidenCondBranchToCondBranch</a>(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *PBI, <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI,</div>
<div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;                                           <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> *DTU) {</div>
<div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;  <span class="comment">// TODO: This can be generalized in two important ways:</span></div>
<div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;  <span class="comment">// 1) We can allow phi nodes in IfFalseBB and simply reuse all the input</span></div>
<div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;  <span class="comment">//    values from the PBI edge.</span></div>
<div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;  <span class="comment">// 2) We can sink side effecting instructions into BI&#39;s fallthrough</span></div>
<div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;  <span class="comment">//    successor provided they doesn&#39;t contribute to computation of</span></div>
<div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;  <span class="comment">//    BI&#39;s condition.</span></div>
<div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *CondWB, *WC;</div>
<div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *IfTrueBB, *IfFalseBB;</div>
<div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a745200db7bc2a7a3c17fa379fb1b56c3">parseWidenableBranch</a>(PBI, CondWB, WC, IfTrueBB, IfFalseBB) ||</div>
<div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;      IfTrueBB != BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() || !BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>())</div>
<div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;  <span class="keywordflow">if</span> (!IfFalseBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a72516971c5734dc0f7546e64affca425">phis</a>().empty())</div>
<div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// TODO</span></div>
<div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;  <span class="comment">// This helps avoid infinite loop with SimplifyCondBranchToCondBranch which</span></div>
<div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;  <span class="comment">// may undo the transform done here.</span></div>
<div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;  <span class="comment">// TODO: There might be a more fine-grained solution to this.</span></div>
<div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a126a78caf2176eb39d879c899bdd749c">llvm::succ_empty</a>(IfFalseBB))</div>
<div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;  <span class="comment">// Use lambda to lazily compute expensive condition after cheap ones.</span></div>
<div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;  <span class="keyword">auto</span> NoSideEffects = [](<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a7dc3069afa2ce5ea62ac2eb183e51c00">llvm::none_of</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, [](<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayWriteToMemory() || <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayHaveSideEffects();</div>
<div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;      });</div>
<div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;  };</div>
<div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;  <span class="keywordflow">if</span> (BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1) != IfFalseBB &amp;&amp; <span class="comment">// no inf looping</span></div>
<div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;      BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1)-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6796a84f02394ce6ebef227c866cd5eb">getTerminatingDeoptimizeCall</a>() &amp;&amp; <span class="comment">// profitability</span></div>
<div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;      NoSideEffects(*BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>())) {</div>
<div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;    <span class="keyword">auto</span> *OldSuccessor = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1);</div>
<div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;    OldSuccessor-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>());</div>
<div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;    BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#adc5e7f9c460c68455e826783d77f9a99">setSuccessor</a>(1, IfFalseBB);</div>
<div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;    <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;      DTU-&gt;<a class="code" href="classllvm_1_1DomTreeUpdater.html#aae522cd1928cfac6850b50c7a3e22185">applyUpdates</a>(</div>
<div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;          {{<a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">DominatorTree::Insert</a>, BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>(), IfFalseBB},</div>
<div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;           {DominatorTree::Delete, BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>(), OldSuccessor}});</div>
<div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;  }</div>
<div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;  <span class="keywordflow">if</span> (BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0) != IfFalseBB &amp;&amp; <span class="comment">// no inf looping</span></div>
<div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;      BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0)-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6796a84f02394ce6ebef227c866cd5eb">getTerminatingDeoptimizeCall</a>() &amp;&amp; <span class="comment">// profitability</span></div>
<div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;      NoSideEffects(*BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>())) {</div>
<div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;    <span class="keyword">auto</span> *OldSuccessor = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0);</div>
<div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;    OldSuccessor-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>());</div>
<div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;    BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#adc5e7f9c460c68455e826783d77f9a99">setSuccessor</a>(0, IfFalseBB);</div>
<div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;    <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;      DTU-&gt;<a class="code" href="classllvm_1_1DomTreeUpdater.html#aae522cd1928cfac6850b50c7a3e22185">applyUpdates</a>(</div>
<div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;          {{<a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">DominatorTree::Insert</a>, BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>(), IfFalseBB},</div>
<div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;           {DominatorTree::Delete, BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>(), OldSuccessor}});</div>
<div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;  }</div>
<div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;}</div>
<div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;<span class="comment">/// If we have a conditional branch as a predecessor of another block,</span></div>
<div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;<span class="comment">/// this function tries to simplify it.  We know</span></div>
<div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;<span class="comment">/// that PBI and BI are both conditional branches, and BI is in one of the</span></div>
<div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;<span class="comment">/// successor blocks of PBI - PBI branches to BI.</span></div>
<div class="line"><a name="l04207"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a40f7c70fc970f25f1c32e8b2c28662ec"> 4207</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a40f7c70fc970f25f1c32e8b2c28662ec">SimplifyCondBranchToCondBranch</a>(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *PBI, <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI,</div>
<div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;                                           <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> *DTU,</div>
<div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;                                           <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</div>
<div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;                                           <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) {</div>
<div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() &amp;&amp; BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>());</div>
<div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160; </div>
<div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;  <span class="comment">// If this block ends with a branch instruction, and if there is a</span></div>
<div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;  <span class="comment">// predecessor that ends on a branch of the same condition, make</span></div>
<div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;  <span class="comment">// this conditional branch redundant.</span></div>
<div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;  <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>() == BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>() &amp;&amp;</div>
<div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;      PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0) != PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1)) {</div>
<div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;    <span class="comment">// Okay, the outcome of this conditional branch is statically</span></div>
<div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;    <span class="comment">// knowable.  If this block had a single pred, handle specially, otherwise</span></div>
<div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;    <span class="comment">// FoldCondBranchOnValueKnownInPredecessor() will handle it.</span></div>
<div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getSinglePredecessor()) {</div>
<div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;      <span class="comment">// Turn this into a branch on constant.</span></div>
<div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;      <span class="keywordtype">bool</span> CondIsTrue = PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0) == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>;</div>
<div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;      BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a3505dab06f59c36142a234321cdc3411">setCondition</a>(</div>
<div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;          <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(Type::getInt1Ty(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getContext()), CondIsTrue));</div>
<div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// Nuke the branch on constant.</span></div>
<div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;    }</div>
<div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;  }</div>
<div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160; </div>
<div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;  <span class="comment">// If the previous block ended with a widenable branch, determine if reusing</span></div>
<div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;  <span class="comment">// the target block is profitable and legal.  This will have the effect of</span></div>
<div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;  <span class="comment">// &quot;widening&quot; PBI, but doesn&#39;t require us to reason about hosting safety.</span></div>
<div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#ad98f06eded5a01ee8704f7d7d9ca4c5b">tryWidenCondBranchToCondBranch</a>(PBI, BI, DTU))</div>
<div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160; </div>
<div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;  <span class="comment">// If both branches are conditional and both contain stores to the same</span></div>
<div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;  <span class="comment">// address, remove the stores from the conditionals and create a conditional</span></div>
<div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;  <span class="comment">// merged store at the end.</span></div>
<div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#aeb1d8a382ce658ab7dbbbbcd06def17a">MergeCondStores</a> &amp;&amp; <a class="code" href="SimplifyCFG_8cpp.html#a6a58dfc629e1b208cdd7b2bd76203184">mergeConditionalStores</a>(PBI, BI, DTU, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>))</div>
<div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160; </div>
<div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;  <span class="comment">// If this is a conditional branch in an empty block, and if any</span></div>
<div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;  <span class="comment">// predecessors are a conditional branch to one of our destinations,</span></div>
<div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;  <span class="comment">// fold the conditions into logical ops and one cond br.</span></div>
<div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160; </div>
<div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;  <span class="comment">// Ignore dbg intrinsics.</span></div>
<div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;  <span class="keywordflow">if</span> (&amp;*<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;instructionsWithoutDebug(<span class="keyword">false</span>).begin() != BI)</div>
<div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160; </div>
<div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;  <span class="keywordtype">int</span> PBIOp, BIOp;</div>
<div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;  <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0) == BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0)) {</div>
<div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;    PBIOp = 0;</div>
<div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;    BIOp = 0;</div>
<div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0) == BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1)) {</div>
<div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;    PBIOp = 0;</div>
<div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;    BIOp = 1;</div>
<div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1) == BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0)) {</div>
<div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;    PBIOp = 1;</div>
<div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;    BIOp = 0;</div>
<div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1) == BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1)) {</div>
<div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;    PBIOp = 1;</div>
<div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;    BIOp = 1;</div>
<div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;  }</div>
<div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160; </div>
<div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;  <span class="comment">// Check to make sure that the other destination of this branch</span></div>
<div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;  <span class="comment">// isn&#39;t BB itself.  If so, this is an infinite loop that will</span></div>
<div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;  <span class="comment">// keep getting unwound.</span></div>
<div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;  <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(PBIOp) == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160; </div>
<div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;  <span class="comment">// Do not perform this transformation if it would require</span></div>
<div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;  <span class="comment">// insertion of a large number of select instructions. For targets</span></div>
<div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;  <span class="comment">// without predication/cmovs, this is a big pessimization.</span></div>
<div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160; </div>
<div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *CommonDest = PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(PBIOp);</div>
<div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *RemovedDest = PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(PBIOp ^ 1);</div>
<div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;  <span class="keywordtype">unsigned</span> NumPhis = 0;</div>
<div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> II = CommonDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); isa&lt;PHINode&gt;(II);</div>
<div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;       ++II, ++NumPhis) {</div>
<div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;    <span class="keywordflow">if</span> (NumPhis &gt; 2) <span class="comment">// Disable this xform.</span></div>
<div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;  }</div>
<div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160; </div>
<div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;  <span class="comment">// Finally, if everything is ok, fold the branches to logical ops.</span></div>
<div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *OtherDest = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(BIOp ^ 1);</div>
<div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160; </div>
<div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;FOLDING BRs:&quot;</span> &lt;&lt; *PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()</div>
<div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;AND: &quot;</span> &lt;&lt; *BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>());</div>
<div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160; </div>
<div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;DominatorTree::UpdateType, 5&gt;</a> Updates;</div>
<div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160; </div>
<div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;  <span class="comment">// If OtherDest *is* BB, then BB is a basic block with a single conditional</span></div>
<div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;  <span class="comment">// branch in it, where one edge (OtherDest) goes back to itself but the other</span></div>
<div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;  <span class="comment">// exits.  We don&#39;t *know* that the program avoids the infinite loop</span></div>
<div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;  <span class="comment">// (even though that seems likely).  If we do this xform naively, we&#39;ll end up</span></div>
<div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;  <span class="comment">// recursively unpeeling the loop.  Since we know that (after the xform is</span></div>
<div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;  <span class="comment">// done) that the block *is* infinite if reached, we just make it an obviously</span></div>
<div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;  <span class="comment">// infinite loop with no cond branch.</span></div>
<div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;  <span class="keywordflow">if</span> (OtherDest == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;    <span class="comment">// Insert it at the end of the function, because it&#39;s either code,</span></div>
<div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;    <span class="comment">// or it won&#39;t matter if it&#39;s hot. :)</span></div>
<div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *InfLoopBlock =</div>
<div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;        BasicBlock::Create(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getContext(), <span class="stringliteral">&quot;infloop&quot;</span>, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getParent());</div>
<div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;    BranchInst::Create(InfLoopBlock, InfLoopBlock);</div>
<div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;    <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;      Updates.push_back({<a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">DominatorTree::Insert</a>, InfLoopBlock, InfLoopBlock});</div>
<div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;    OtherDest = InfLoopBlock;</div>
<div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;  }</div>
<div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160; </div>
<div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; *PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">getParent</a>());</div>
<div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160; </div>
<div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;  <span class="comment">// BI may have other predecessors.  Because of this, we leave</span></div>
<div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;  <span class="comment">// it alone, but modify PBI.</span></div>
<div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160; </div>
<div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;  <span class="comment">// Make sure we get to CommonDest on True&amp;True directions.</span></div>
<div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *PBICond = PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>();</div>
<div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;NoFolder&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(PBI);</div>
<div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;  <span class="keywordflow">if</span> (PBIOp)</div>
<div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;    PBICond = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateNot(PBICond, PBICond-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + <span class="stringliteral">&quot;.not&quot;</span>);</div>
<div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160; </div>
<div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *BICond = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>();</div>
<div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;  <span class="keywordflow">if</span> (BIOp)</div>
<div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;    BICond = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateNot(BICond, BICond-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + <span class="stringliteral">&quot;.not&quot;</span>);</div>
<div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160; </div>
<div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;  <span class="comment">// Merge the conditions.</span></div>
<div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a> =</div>
<div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;      <a class="code" href="SimplifyCFG_8cpp.html#a5f162160c57fca10cd58c00b439414cb">createLogicalOp</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, Instruction::Or, PBICond, BICond, <span class="stringliteral">&quot;brmerge&quot;</span>);</div>
<div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160; </div>
<div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;  <span class="comment">// Modify PBI to branch on the new condition to the new dests.</span></div>
<div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;  PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a3505dab06f59c36142a234321cdc3411">setCondition</a>(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>);</div>
<div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;  PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#adc5e7f9c460c68455e826783d77f9a99">setSuccessor</a>(0, CommonDest);</div>
<div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;  PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#adc5e7f9c460c68455e826783d77f9a99">setSuccessor</a>(1, OtherDest);</div>
<div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160; </div>
<div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;  <span class="keywordflow">if</span> (DTU) {</div>
<div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;    Updates.push_back({<a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">DominatorTree::Insert</a>, PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>(), OtherDest});</div>
<div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;    Updates.push_back({DominatorTree::Delete, PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>(), RemovedDest});</div>
<div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160; </div>
<div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;    DTU-&gt;<a class="code" href="classllvm_1_1DomTreeUpdater.html#aae522cd1928cfac6850b50c7a3e22185">applyUpdates</a>(Updates);</div>
<div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;  }</div>
<div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160; </div>
<div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;  <span class="comment">// Update branch weight for PBI.</span></div>
<div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> PredTrueWeight, PredFalseWeight, SuccTrueWeight, SuccFalseWeight;</div>
<div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> PredCommon, PredOther, SuccCommon, SuccOther;</div>
<div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;  <span class="keywordtype">bool</span> HasWeights =</div>
<div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;      <a class="code" href="SimplifyCFG_8cpp.html#a404f7a1827e4eb8c5ded5ce6dafecf07">extractPredSuccWeights</a>(PBI, BI, PredTrueWeight, PredFalseWeight,</div>
<div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;                             SuccTrueWeight, SuccFalseWeight);</div>
<div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;  <span class="keywordflow">if</span> (HasWeights) {</div>
<div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;    PredCommon = PBIOp ? PredFalseWeight : PredTrueWeight;</div>
<div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;    PredOther = PBIOp ? PredTrueWeight : PredFalseWeight;</div>
<div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;    SuccCommon = BIOp ? SuccFalseWeight : SuccTrueWeight;</div>
<div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;    SuccOther = BIOp ? SuccTrueWeight : SuccFalseWeight;</div>
<div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;    <span class="comment">// The weight to CommonDest should be PredCommon * SuccTotal +</span></div>
<div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;    <span class="comment">//                                    PredOther * SuccCommon.</span></div>
<div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;    <span class="comment">// The weight to OtherDest should be PredOther * SuccOther.</span></div>
<div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> NewWeights[2] = {PredCommon * (SuccCommon + SuccOther) +</div>
<div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;                                  PredOther * SuccCommon,</div>
<div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;                              PredOther * SuccOther};</div>
<div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;    <span class="comment">// Halve the weights if any of them cannot fit in an uint32_t</span></div>
<div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#a95ec32778f2bb913dc4cc45ac7a66e42">FitWeights</a>(NewWeights);</div>
<div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160; </div>
<div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#a4953dfe289f5d9ad59a7964c4c63c2a9">setBranchWeights</a>(PBI, NewWeights[0], NewWeights[1]);</div>
<div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;  }</div>
<div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160; </div>
<div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;  <span class="comment">// OtherDest may have phi nodes.  If so, add an entry from PBI&#39;s</span></div>
<div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;  <span class="comment">// block that are identical to the entries for BI&#39;s block.</span></div>
<div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;  <a class="code" href="SimplifyCFG_8cpp.html#a41a075ef4b76f72591e86e1fe13f096d">AddPredecessorToBlock</a>(OtherDest, PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>(), <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160; </div>
<div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;  <span class="comment">// We know that the CommonDest already had an edge from PBI to</span></div>
<div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;  <span class="comment">// it.  If it has PHIs though, the PHIs may have different</span></div>
<div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;  <span class="comment">// entries for BB and PBI&#39;s BB.  If so, insert a select to make</span></div>
<div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;  <span class="comment">// them agree.</span></div>
<div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> &amp;PN : CommonDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a72516971c5734dc0f7546e64affca425">phis</a>()) {</div>
<div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *BIV = PN.<a class="code" href="classllvm_1_1PHINode.html#adfb61ffe25c950c75c86310245b3ef39">getIncomingValueForBlock</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;    <span class="keywordtype">unsigned</span> PBBIdx = PN.<a class="code" href="classllvm_1_1PHINode.html#ae9562b96f6f3fa41bd36538c080035ee">getBasicBlockIndex</a>(PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>());</div>
<div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *PBIV = PN.<a class="code" href="classllvm_1_1PHINode.html#a16c39eb6e60b42a40c399d8d65347bb6">getIncomingValue</a>(PBBIdx);</div>
<div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;    <span class="keywordflow">if</span> (BIV != PBIV) {</div>
<div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;      <span class="comment">// Insert a select in PBI to pick the right value.</span></div>
<div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;      <a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="namespacellvm_1_1ore.html#a8f5533240c6722d987a2443cba42019d">NV</a> = cast&lt;SelectInst&gt;(</div>
<div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSelect(PBICond, PBIV, BIV, PBIV-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + <span class="stringliteral">&quot;.mux&quot;</span>));</div>
<div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;      PN.<a class="code" href="classllvm_1_1PHINode.html#a88cdefb709309eddc6e5daca0be6a7b4">setIncomingValue</a>(PBBIdx, <a class="code" href="namespacellvm_1_1ore.html#a8f5533240c6722d987a2443cba42019d">NV</a>);</div>
<div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;      <span class="comment">// Although the select has the same condition as PBI, the original branch</span></div>
<div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;      <span class="comment">// weights for PBI do not apply to the new select because the select&#39;s</span></div>
<div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;      <span class="comment">// &#39;logical&#39; edges are incoming edges of the phi that is eliminated, not</span></div>
<div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;      <span class="comment">// the outgoing edges of PBI.</span></div>
<div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;      <span class="keywordflow">if</span> (HasWeights) {</div>
<div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;        <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> PredCommon = PBIOp ? PredFalseWeight : PredTrueWeight;</div>
<div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;        <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> PredOther = PBIOp ? PredTrueWeight : PredFalseWeight;</div>
<div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;        <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> SuccCommon = BIOp ? SuccFalseWeight : SuccTrueWeight;</div>
<div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;        <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> SuccOther = BIOp ? SuccTrueWeight : SuccFalseWeight;</div>
<div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;        <span class="comment">// The weight to PredCommonDest should be PredCommon * SuccTotal.</span></div>
<div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;        <span class="comment">// The weight to PredOtherDest should be PredOther * SuccCommon.</span></div>
<div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;        <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> NewWeights[2] = {PredCommon * (SuccCommon + SuccOther),</div>
<div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;                                  PredOther * SuccCommon};</div>
<div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160; </div>
<div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;        <a class="code" href="SimplifyCFG_8cpp.html#a95ec32778f2bb913dc4cc45ac7a66e42">FitWeights</a>(NewWeights);</div>
<div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160; </div>
<div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;        <a class="code" href="SimplifyCFG_8cpp.html#a4953dfe289f5d9ad59a7964c4c63c2a9">setBranchWeights</a>(<a class="code" href="namespacellvm_1_1ore.html#a8f5533240c6722d987a2443cba42019d">NV</a>, NewWeights[0], NewWeights[1]);</div>
<div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;      }</div>
<div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;    }</div>
<div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;  }</div>
<div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160; </div>
<div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;INTO: &quot;</span> &lt;&lt; *PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>());</div>
<div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; *PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">getParent</a>());</div>
<div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160; </div>
<div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;  <span class="comment">// This basic block is probably dead.  We know it has at least</span></div>
<div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;  <span class="comment">// one fewer predecessor.</span></div>
<div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;}</div>
<div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160; </div>
<div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;<span class="comment">// Simplifies a terminator by replacing it with a branch to TrueBB if Cond is</span></div>
<div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;<span class="comment">// true or to FalseBB if Cond is false.</span></div>
<div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;<span class="comment">// Takes care of updating the successors and removing the old terminator.</span></div>
<div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;<span class="comment">// Also makes sure not to introduce new successors by assuming that edges to</span></div>
<div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;<span class="comment">// non-successor TrueBBs and FalseBBs aren&#39;t reachable.</span></div>
<div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;<span class="keywordtype">bool</span> SimplifyCFGOpt::SimplifyTerminatorOnSelect(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *OldTerm,</div>
<div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;                                                <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *TrueBB,</div>
<div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;                                                <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *FalseBB,</div>
<div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;                                                <a class="code" href="classuint32__t.html">uint32_t</a> TrueWeight,</div>
<div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;                                                <a class="code" href="classuint32__t.html">uint32_t</a> FalseWeight) {</div>
<div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = OldTerm-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;  <span class="comment">// Remove any superfluous successor edges from the CFG.</span></div>
<div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;  <span class="comment">// First, figure out which successors to preserve.</span></div>
<div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;  <span class="comment">// If TrueBB and FalseBB are equal, only try to preserve one copy of that</span></div>
<div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;  <span class="comment">// successor.</span></div>
<div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *KeepEdge1 = TrueBB;</div>
<div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *KeepEdge2 = TrueBB != FalseBB ? FalseBB : <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160; </div>
<div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;  <a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;BasicBlock *, 2&gt;</a> RemovedSuccessors;</div>
<div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160; </div>
<div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;  <span class="comment">// Then remove the rest.</span></div>
<div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ : <a class="code" href="namespacellvm.html#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(OldTerm)) {</div>
<div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;    <span class="comment">// Make sure only to keep exactly one copy of each edge.</span></div>
<div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;    <span class="keywordflow">if</span> (Succ == KeepEdge1)</div>
<div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;      KeepEdge1 = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Succ == KeepEdge2)</div>
<div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;      KeepEdge2 = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;      Succ-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>,</div>
<div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;                              <span class="comment">/*KeepOneInputPHIs=*/</span><span class="keyword">true</span>);</div>
<div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160; </div>
<div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;      <span class="keywordflow">if</span> (Succ != TrueBB &amp;&amp; Succ != FalseBB)</div>
<div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;        RemovedSuccessors.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(Succ);</div>
<div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;    }</div>
<div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;  }</div>
<div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160; </div>
<div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(OldTerm);</div>
<div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetCurrentDebugLocation(OldTerm-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4f3bf98b5054831b608852e33427814">getDebugLoc</a>());</div>
<div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160; </div>
<div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;  <span class="comment">// Insert an appropriate new terminator.</span></div>
<div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;  <span class="keywordflow">if</span> (!KeepEdge1 &amp;&amp; !KeepEdge2) {</div>
<div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;    <span class="keywordflow">if</span> (TrueBB == FalseBB) {</div>
<div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;      <span class="comment">// We were only looking for one successor, and it was present.</span></div>
<div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;      <span class="comment">// Create an unconditional branch to it.</span></div>
<div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBr(TrueBB);</div>
<div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;      <span class="comment">// We found both of the successors we were looking for.</span></div>
<div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;      <span class="comment">// Create a conditional branch sharing the condition of the select.</span></div>
<div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;      <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *NewBI = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCondBr(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>, TrueBB, FalseBB);</div>
<div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;      <span class="keywordflow">if</span> (TrueWeight != FalseWeight)</div>
<div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;        <a class="code" href="SimplifyCFG_8cpp.html#a4953dfe289f5d9ad59a7964c4c63c2a9">setBranchWeights</a>(NewBI, TrueWeight, FalseWeight);</div>
<div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;    }</div>
<div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (KeepEdge1 &amp;&amp; (KeepEdge2 || TrueBB == FalseBB)) {</div>
<div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;    <span class="comment">// Neither of the selected blocks were successors, so this</span></div>
<div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;    <span class="comment">// terminator must be unreachable.</span></div>
<div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;    <span class="keyword">new</span> <a class="code" href="classllvm_1_1UnreachableInst.html">UnreachableInst</a>(OldTerm-&gt;<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), OldTerm);</div>
<div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;    <span class="comment">// One of the selected values was a successor, but the other wasn&#39;t.</span></div>
<div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;    <span class="comment">// Insert an unconditional branch to the one that was found;</span></div>
<div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;    <span class="comment">// the edge to the one that wasn&#39;t must be unreachable.</span></div>
<div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;    <span class="keywordflow">if</span> (!KeepEdge1) {</div>
<div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;      <span class="comment">// Only TrueBB was found.</span></div>
<div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBr(TrueBB);</div>
<div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;      <span class="comment">// Only FalseBB was found.</span></div>
<div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBr(FalseBB);</div>
<div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;    }</div>
<div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;  }</div>
<div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160; </div>
<div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;  <a class="code" href="SimplifyCFG_8cpp.html#aa4641512b28a6e42a40bda7576fe43cb">EraseTerminatorAndDCECond</a>(OldTerm);</div>
<div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160; </div>
<div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;  <span class="keywordflow">if</span> (DTU) {</div>
<div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;DominatorTree::UpdateType, 2&gt;</a> Updates;</div>
<div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;    Updates.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(RemovedSuccessors.<a class="code" href="classllvm_1_1SetVector.html#a18b9d328d2490f447589ba60345eba6e">size</a>());</div>
<div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *RemovedSuccessor : RemovedSuccessors)</div>
<div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;      Updates.push_back({DominatorTree::Delete, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, RemovedSuccessor});</div>
<div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;    DTU-&gt;applyUpdates(Updates);</div>
<div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;  }</div>
<div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160; </div>
<div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;}</div>
<div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160; </div>
<div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;<span class="comment">// Replaces</span></div>
<div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;<span class="comment">//   (switch (select cond, X, Y)) on constant X, Y</span></div>
<div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;<span class="comment">// with a branch - conditional if X and Y lead to distinct BBs,</span></div>
<div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;<span class="comment">// unconditional otherwise.</span></div>
<div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;<span class="keywordtype">bool</span> SimplifyCFGOpt::SimplifySwitchOnSelect(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>,</div>
<div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;                                            <a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a>) {</div>
<div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;  <span class="comment">// Check for constant integer values in the select.</span></div>
<div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a58b95af1ca96e109f85a0646a05fceb7">TrueVal</a> = dyn_cast&lt;ConstantInt&gt;(<a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a>-&gt;getTrueValue());</div>
<div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aeb5a2908109c763377832cbb4726b6d4">FalseVal</a> = dyn_cast&lt;ConstantInt&gt;(<a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a>-&gt;getFalseValue());</div>
<div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a58b95af1ca96e109f85a0646a05fceb7">TrueVal</a> || !<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aeb5a2908109c763377832cbb4726b6d4">FalseVal</a>)</div>
<div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160; </div>
<div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;  <span class="comment">// Find the relevant condition and destinations.</span></div>
<div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Condition = <a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a>-&gt;getCondition();</div>
<div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *TrueBB = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;findCaseValue(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a58b95af1ca96e109f85a0646a05fceb7">TrueVal</a>)-&gt;getCaseSuccessor();</div>
<div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *FalseBB = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;findCaseValue(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aeb5a2908109c763377832cbb4726b6d4">FalseVal</a>)-&gt;getCaseSuccessor();</div>
<div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160; </div>
<div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;  <span class="comment">// Get weight for TrueBB and FalseBB.</span></div>
<div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;  <a class="code" href="classuint32__t.html">uint32_t</a> TrueWeight = 0, FalseWeight = 0;</div>
<div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint64_t, 8&gt;</a> Weights;</div>
<div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;  <span class="keywordtype">bool</span> HasWeights = <a class="code" href="namespacellvm.html#add2fce2ce0e32b20e41b0aa9f8ca70c2">hasBranchWeightMD</a>(*<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;  <span class="keywordflow">if</span> (HasWeights) {</div>
<div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#a23f9dbda493b589bf024813b2c7e8c41">GetBranchWeights</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, Weights);</div>
<div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;    <span class="keywordflow">if</span> (Weights.size() == 1 + <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getNumCases()) {</div>
<div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;      TrueWeight =</div>
<div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;          (<a class="code" href="classuint32__t.html">uint32_t</a>)Weights[<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;findCaseValue(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a58b95af1ca96e109f85a0646a05fceb7">TrueVal</a>)-&gt;getSuccessorIndex()];</div>
<div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;      FalseWeight =</div>
<div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;          (<a class="code" href="classuint32__t.html">uint32_t</a>)Weights[<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;findCaseValue(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aeb5a2908109c763377832cbb4726b6d4">FalseVal</a>)-&gt;getSuccessorIndex()];</div>
<div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;    }</div>
<div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;  }</div>
<div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160; </div>
<div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;  <span class="comment">// Perform the actual simplification.</span></div>
<div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;  <span class="keywordflow">return</span> SimplifyTerminatorOnSelect(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, Condition, TrueBB, FalseBB, TrueWeight,</div>
<div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;                                    FalseWeight);</div>
<div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;}</div>
<div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160; </div>
<div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;<span class="comment">// Replaces</span></div>
<div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;<span class="comment">//   (indirectbr (select cond, blockaddress(@fn, BlockA),</span></div>
<div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;<span class="comment">//                             blockaddress(@fn, BlockB)))</span></div>
<div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;<span class="comment">// with</span></div>
<div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;<span class="comment">//   (br cond, BlockA, BlockB).</span></div>
<div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;<span class="keywordtype">bool</span> SimplifyCFGOpt::SimplifyIndirectBrOnSelect(<a class="code" href="classllvm_1_1IndirectBrInst.html">IndirectBrInst</a> *IBI,</div>
<div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;                                                <a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>) {</div>
<div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;  <span class="comment">// Check that both operands of the select are block addresses.</span></div>
<div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;  <a class="code" href="classllvm_1_1BlockAddress.html">BlockAddress</a> *TBA = dyn_cast&lt;BlockAddress&gt;(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getTrueValue());</div>
<div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;  <a class="code" href="classllvm_1_1BlockAddress.html">BlockAddress</a> *FBA = dyn_cast&lt;BlockAddress&gt;(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getFalseValue());</div>
<div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;  <span class="keywordflow">if</span> (!TBA || !FBA)</div>
<div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160; </div>
<div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;  <span class="comment">// Extract the actual blocks.</span></div>
<div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *TrueBB = TBA-&gt;<a class="code" href="classllvm_1_1BlockAddress.html#a5d6c0fe3482091758c3978229f6b5852">getBasicBlock</a>();</div>
<div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *FalseBB = FBA-&gt;<a class="code" href="classllvm_1_1BlockAddress.html#a5d6c0fe3482091758c3978229f6b5852">getBasicBlock</a>();</div>
<div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160; </div>
<div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;  <span class="comment">// Perform the actual simplification.</span></div>
<div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;  <span class="keywordflow">return</span> SimplifyTerminatorOnSelect(IBI, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition(), TrueBB, FalseBB, 0,</div>
<div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;                                    0);</div>
<div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;}</div>
<div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;<span class="comment">/// This is called when we find an icmp instruction</span></div>
<div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;<span class="comment">/// (a seteq/setne with a constant) as the only instruction in a</span></div>
<div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;<span class="comment">/// block that ends with an uncond branch.  We are looking for a very specific</span></div>
<div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;<span class="comment">/// pattern that occurs when &quot;A == 1 || A == 2 || A == 3&quot; gets simplified.  In</span></div>
<div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;<span class="comment">/// this case, we merge the first two &quot;or&#39;s of icmp&quot; into a switch, but then the</span></div>
<div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;<span class="comment">/// default value goes to an uncond block with a seteq in it, we get something</span></div>
<div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;<span class="comment">/// like:</span></div>
<div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;<span class="comment">///   switch i8 %A, label %DEFAULT [ i8 1, label %end    i8 2, label %end ]</span></div>
<div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;<span class="comment">/// DEFAULT:</span></div>
<div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;<span class="comment">///   %tmp = icmp eq i8 %A, 92</span></div>
<div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;<span class="comment">///   br label %end</span></div>
<div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;<span class="comment">/// end:</span></div>
<div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;<span class="comment">///   ... = phi i1 [ true, %entry ], [ %tmp, %DEFAULT ], [ true, %entry ]</span></div>
<div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;<span class="comment">/// We prefer to split the edge to &#39;end&#39; so that there is a true/false entry to</span></div>
<div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;<span class="comment">/// the PHI, merging the third icmp into the switch.</span></div>
<div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> SimplifyCFGOpt::tryToSimplifyUncondBranchWithICmpInIt(</div>
<div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;    <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *ICI, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>) {</div>
<div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = ICI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160; </div>
<div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;  <span class="comment">// If the block has any PHIs in it or the icmp has multiple uses, it is too</span></div>
<div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;  <span class="comment">// complex.</span></div>
<div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;  <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;begin()) || !ICI-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</div>
<div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160; </div>
<div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *V = ICI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *Cst = cast&lt;ConstantInt&gt;(ICI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1));</div>
<div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160; </div>
<div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;  <span class="comment">// The pattern we&#39;re looking for is where our only predecessor is a switch on</span></div>
<div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;  <span class="comment">// &#39;V&#39; and this block is the default case for the switch.  In this case we can</span></div>
<div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;  <span class="comment">// fold the compared value into the switch to simplify things.</span></div>
<div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getSinglePredecessor();</div>
<div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;  <span class="keywordflow">if</span> (!Pred || !isa&lt;SwitchInst&gt;(Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>()))</div>
<div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160; </div>
<div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;  <a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = cast&lt;SwitchInst&gt;(Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>());</div>
<div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition() != V)</div>
<div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160; </div>
<div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;  <span class="comment">// If BB is reachable on a non-default case, then we simply know the value of</span></div>
<div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;  <span class="comment">// V in this block.  Substitute it and constant fold the icmp instruction</span></div>
<div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;  <span class="comment">// away.</span></div>
<div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDefaultDest() != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *VVal = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;findCaseDest(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VVal &amp;&amp; <span class="stringliteral">&quot;Should have a unique destination value&quot;</span>);</div>
<div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;    ICI-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, VVal);</div>
<div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160; </div>
<div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="namespacellvm.html#aab02db480f387fca92956ef1c9a01941">simplifyInstruction</a>(ICI, {<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, ICI})) {</div>
<div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;      ICI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(V);</div>
<div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;      ICI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;    }</div>
<div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;    <span class="comment">// BB is now empty, so it is likely to simplify away.</span></div>
<div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;    <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;  }</div>
<div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160; </div>
<div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;  <span class="comment">// Ok, the block is reachable from the default dest.  If the constant we&#39;re</span></div>
<div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;  <span class="comment">// comparing exists in one of the other edges, then we can constant fold ICI</span></div>
<div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;  <span class="comment">// and zap it.</span></div>
<div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;findCaseValue(Cst) != <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;case_default()) {</div>
<div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V;</div>
<div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;    <span class="keywordflow">if</span> (ICI-&gt;<a class="code" href="classllvm_1_1CmpInst.html#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>() == ICmpInst::ICMP_EQ)</div>
<div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;      V = <a class="code" href="InstructionSimplify_8cpp.html#adb39181b87dffcd61082d08e02bf314e">ConstantInt::getFalse</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getContext());</div>
<div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;      V = <a class="code" href="InstructionSimplify_8cpp.html#a565dd825f238fa0a8c4bbfe562635f7c">ConstantInt::getTrue</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getContext());</div>
<div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160; </div>
<div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;    ICI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(V);</div>
<div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;    ICI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;    <span class="comment">// BB is now empty, so it is likely to simplify away.</span></div>
<div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;    <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;  }</div>
<div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160; </div>
<div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;  <span class="comment">// The use of the icmp has to be in the &#39;end&#39; block, by the only PHI node in</span></div>
<div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;  <span class="comment">// the block.</span></div>
<div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *SuccBlock = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getTerminator()-&gt;getSuccessor(0);</div>
<div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;  <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PHIUse = dyn_cast&lt;PHINode&gt;(ICI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a2fd1d2dc14e22227cfa8238778ab87b8">user_back</a>());</div>
<div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;  <span class="keywordflow">if</span> (PHIUse == <span class="keyword">nullptr</span> || PHIUse != &amp;SuccBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#ab706e7ebb1969c5e34f28bfcf2ff719e">front</a>() ||</div>
<div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;      isa&lt;PHINode&gt;(++<a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a>(PHIUse)))</div>
<div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160; </div>
<div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;  <span class="comment">// If the icmp is a SETEQ, then the default dest gets false, the new edge gets</span></div>
<div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;  <span class="comment">// true in the PHI.</span></div>
<div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *DefaultCst = <a class="code" href="InstructionSimplify_8cpp.html#a565dd825f238fa0a8c4bbfe562635f7c">ConstantInt::getTrue</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getContext());</div>
<div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *NewCst = <a class="code" href="InstructionSimplify_8cpp.html#adb39181b87dffcd61082d08e02bf314e">ConstantInt::getFalse</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getContext());</div>
<div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160; </div>
<div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;  <span class="keywordflow">if</span> (ICI-&gt;<a class="code" href="classllvm_1_1CmpInst.html#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>() == ICmpInst::ICMP_EQ)</div>
<div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;    <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(DefaultCst, NewCst);</div>
<div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160; </div>
<div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;  <span class="comment">// Replace ICI (which is used by the PHI for the default value) with true or</span></div>
<div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;  <span class="comment">// false depending on if it is EQ or NE.</span></div>
<div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;  ICI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(DefaultCst);</div>
<div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;  ICI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160; </div>
<div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;DominatorTree::UpdateType, 2&gt;</a> Updates;</div>
<div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160; </div>
<div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;  <span class="comment">// Okay, the switch goes to this block on a default value.  Add an edge from</span></div>
<div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;  <span class="comment">// the switch to the merge point on the compared value.</span></div>
<div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *NewBB =</div>
<div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;      BasicBlock::Create(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getContext(), <span class="stringliteral">&quot;switch.edge&quot;</span>, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getParent(), <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;  {</div>
<div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;    <a class="code" href="classllvm_1_1SwitchInstProfUpdateWrapper.html">SwitchInstProfUpdateWrapper</a> SIW(*<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;    <span class="keyword">auto</span> W0 = SIW.getSuccessorWeight(0);</div>
<div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;    <a class="code" href="classllvm_1_1SwitchInstProfUpdateWrapper.html#acf60dfe9415b02d8da94b723e1ce87f8">SwitchInstProfUpdateWrapper::CaseWeightOpt</a> NewW;</div>
<div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;    <span class="keywordflow">if</span> (W0) {</div>
<div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;      NewW = ((<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a>(*W0) + 1) &gt;&gt; 1);</div>
<div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;      SIW.setSuccessorWeight(0, *NewW);</div>
<div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;    }</div>
<div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;    SIW.addCase(Cst, NewBB, NewW);</div>
<div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;    <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;      Updates.push_back({<a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">DominatorTree::Insert</a>, Pred, NewBB});</div>
<div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;  }</div>
<div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160; </div>
<div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;  <span class="comment">// NewBB branches to the phi block, add the uncond branch and the phi entry.</span></div>
<div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(NewBB);</div>
<div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetCurrentDebugLocation(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDebugLoc());</div>
<div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBr(SuccBlock);</div>
<div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;  PHIUse-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(NewCst, NewBB);</div>
<div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;  <span class="keywordflow">if</span> (DTU) {</div>
<div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;    Updates.push_back({<a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">DominatorTree::Insert</a>, NewBB, SuccBlock});</div>
<div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;    DTU-&gt;applyUpdates(Updates);</div>
<div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;  }</div>
<div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;}</div>
<div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;<span class="comment">/// The specified branch is a conditional branch.</span></div>
<div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;<span class="comment">/// Check to see if it is branching on an or/and chain of icmp instructions, and</span></div>
<div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;<span class="comment">/// fold it into a switch instruction if so.</span></div>
<div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> SimplifyCFGOpt::SimplifyBranchOnICmpChain(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI,</div>
<div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;                                               <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>,</div>
<div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;                                               <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>) {</div>
<div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a> = dyn_cast&lt;Instruction&gt;(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>());</div>
<div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>)</div>
<div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160; </div>
<div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;  <span class="comment">// Change br (X == 0 | X == 1), T, F into a switch instruction.</span></div>
<div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;  <span class="comment">// If this is a bunch of seteq&#39;s or&#39;d together, or if it&#39;s a bunch of</span></div>
<div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;  <span class="comment">// &#39;setne&#39;s and&#39;ed together, collect them.</span></div>
<div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160; </div>
<div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;  <span class="comment">// Try to gather values from a chain of and/or to be turned into a switch</span></div>
<div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;  ConstantComparesGatherer ConstantCompare(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;  <span class="comment">// Unpack the result</span></div>
<div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;  <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;ConstantInt *&gt;</a> &amp;Values = ConstantCompare.Vals;</div>
<div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *CompVal = ConstantCompare.CompValue;</div>
<div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;  <span class="keywordtype">unsigned</span> UsedICmps = ConstantCompare.UsedICmps;</div>
<div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ExtraCase = ConstantCompare.Extra;</div>
<div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160; </div>
<div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;  <span class="comment">// If we didn&#39;t have a multiply compared value, fail.</span></div>
<div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;  <span class="keywordflow">if</span> (!CompVal)</div>
<div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160; </div>
<div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;  <span class="comment">// Avoid turning single icmps into a switch.</span></div>
<div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;  <span class="keywordflow">if</span> (UsedICmps &lt;= 1)</div>
<div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160; </div>
<div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;  <span class="keywordtype">bool</span> TrueWhenEqual = <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#a1a06b1cff93069d7403ea03e6150e386">m_LogicalOr</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>()));</div>
<div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160; </div>
<div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;  <span class="comment">// There might be duplicate constants in the list, which the switch</span></div>
<div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;  <span class="comment">// instruction can&#39;t handle, remove them now.</span></div>
<div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;  <a class="code" href="namespacellvm.html#add1eb5637dd671428b6f138ed3db6428">array_pod_sort</a>(Values.begin(), Values.end(), <a class="code" href="SimplifyCFG_8cpp.html#a8a7f7d7aa56a6449ae814f48b6a8ce6f">ConstantIntSortPredicate</a>);</div>
<div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;  Values.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a563ffc2ff61c499b3be2e00100cb72fa">erase</a>(<a class="code" href="namespacellvm.html#a92be87f8a371f277f7260fb99592d5f4">std::unique</a>(Values.begin(), Values.end()), Values.end());</div>
<div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160; </div>
<div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;  <span class="comment">// If Extra was used, we require at least two switch values to do the</span></div>
<div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;  <span class="comment">// transformation.  A switch with one value is just a conditional branch.</span></div>
<div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160;  <span class="keywordflow">if</span> (ExtraCase &amp;&amp; Values.size() &lt; 2)</div>
<div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160; </div>
<div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;  <span class="comment">// TODO: Preserve branch weight metadata, similarly to how</span></div>
<div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;  <span class="comment">// FoldValueComparisonIntoPredecessors preserves it.</span></div>
<div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160; </div>
<div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;  <span class="comment">// Figure out which block is which destination.</span></div>
<div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *DefaultBB = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1);</div>
<div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *EdgeBB = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0);</div>
<div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160;  <span class="keywordflow">if</span> (!TrueWhenEqual)</div>
<div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;    <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(DefaultBB, EdgeBB);</div>
<div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160; </div>
<div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160; </div>
<div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Converting &#39;icmp&#39; chain with &quot;</span> &lt;&lt; Values.size()</div>
<div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; cases into SWITCH.  BB is:\n&quot;</span></div>
<div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;                    &lt;&lt; *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160; </div>
<div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;DominatorTree::UpdateType, 2&gt;</a> Updates;</div>
<div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160; </div>
<div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;  <span class="comment">// If there are any extra values that couldn&#39;t be folded into the switch</span></div>
<div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;  <span class="comment">// then we evaluate them with an explicit branch first. Split the block</span></div>
<div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;  <span class="comment">// right before the condbr to handle it.</span></div>
<div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;  <span class="keywordflow">if</span> (ExtraCase) {</div>
<div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *NewBB = <a class="code" href="namespacellvm.html#ad295cb34421c21507bc9cdefe1ba3f16">SplitBlock</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, BI, DTU, <span class="comment">/*LI=*/</span><span class="keyword">nullptr</span>,</div>
<div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;                                   <span class="comment">/*MSSAU=*/</span><span class="keyword">nullptr</span>, <span class="stringliteral">&quot;switch.early.test&quot;</span>);</div>
<div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160; </div>
<div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;    <span class="comment">// Remove the uncond branch added to the old block.</span></div>
<div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *OldTI = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getTerminator();</div>
<div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(OldTI);</div>
<div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160; </div>
<div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;    <span class="comment">// There can be an unintended UB if extra values are Poison. Before the</span></div>
<div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;    <span class="comment">// transformation, extra values may not be evaluated according to the</span></div>
<div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;    <span class="comment">// condition, and it will not raise UB. But after transformation, we are</span></div>
<div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;    <span class="comment">// evaluating extra values before checking the condition, and it will raise</span></div>
<div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;    <span class="comment">// UB. It can be solved by adding freeze instruction to extra values.</span></div>
<div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;    <a class="code" href="classllvm_1_1AssumptionCache.html">AssumptionCache</a> *AC = <a class="code" href="PassBuilderBindings_8cpp.html#a47c521bf7ba0bb2147b96d068af30d04">Options</a>.AC;</div>
<div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160; </div>
<div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="ValueTracking_8cpp.html#af00585087cddeeb1e8995d4647966cfe">isGuaranteedNotToBeUndefOrPoison</a>(ExtraCase, AC, BI, <span class="keyword">nullptr</span>))</div>
<div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;      ExtraCase = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateFreeze(ExtraCase);</div>
<div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160; </div>
<div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;    <span class="keywordflow">if</span> (TrueWhenEqual)</div>
<div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCondBr(ExtraCase, EdgeBB, NewBB);</div>
<div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCondBr(ExtraCase, NewBB, EdgeBB);</div>
<div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160; </div>
<div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;    OldTI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160; </div>
<div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;    <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;      Updates.push_back({<a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">DominatorTree::Insert</a>, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, EdgeBB});</div>
<div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160; </div>
<div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160;    <span class="comment">// If there are PHI nodes in EdgeBB, then we need to add a new entry to them</span></div>
<div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;    <span class="comment">// for the edge we just added.</span></div>
<div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#a41a075ef4b76f72591e86e1fe13f096d">AddPredecessorToBlock</a>(EdgeBB, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, NewBB);</div>
<div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160; </div>
<div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  ** &#39;icmp&#39; chain unhandled condition: &quot;</span> &lt;&lt; *ExtraCase</div>
<div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;\nEXTRABB = &quot;</span> &lt;&lt; *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;    <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = NewBB;</div>
<div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;  }</div>
<div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160; </div>
<div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(BI);</div>
<div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;  <span class="comment">// Convert pointer to int before we switch.</span></div>
<div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;  <span class="keywordflow">if</span> (CompVal-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>()) {</div>
<div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;    CompVal = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePtrToInt(</div>
<div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;        CompVal, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIntPtrType(CompVal-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()), <span class="stringliteral">&quot;magicptr&quot;</span>);</div>
<div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;  }</div>
<div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160; </div>
<div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;  <span class="comment">// Create the new switch instruction now.</span></div>
<div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;  <a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="namespacellvm_1_1ms__demangle.html#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSwitch(CompVal, DefaultBB, Values.size());</div>
<div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160; </div>
<div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;  <span class="comment">// Add all of the &#39;cases&#39; to the switch instruction.</span></div>
<div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = Values.size(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l04788"></a><span class="lineno"> 4788</span>&#160;    <a class="code" href="namespacellvm_1_1ms__demangle.html#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a>-&gt;addCase(Values[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>], EdgeBB);</div>
<div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160; </div>
<div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;  <span class="comment">// We added edges from PI to the EdgeBB.  As such, if there were any</span></div>
<div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;  <span class="comment">// PHI nodes in EdgeBB, they need entries to be added corresponding to</span></div>
<div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;  <span class="comment">// the number of edges added.</span></div>
<div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BBI = EdgeBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); isa&lt;PHINode&gt;(BBI); ++BBI) {</div>
<div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = cast&lt;PHINode&gt;(BBI);</div>
<div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *InVal = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#adfb61ffe25c950c75c86310245b3ef39">getIncomingValueForBlock</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = Values.size() - 1; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;      PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(InVal, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;  }</div>
<div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160; </div>
<div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;  <span class="comment">// Erase the old branch instruction.</span></div>
<div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;  <a class="code" href="SimplifyCFG_8cpp.html#aa4641512b28a6e42a40bda7576fe43cb">EraseTerminatorAndDCECond</a>(BI);</div>
<div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;  <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;    DTU-&gt;applyUpdates(Updates);</div>
<div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160; </div>
<div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  ** &#39;icmp&#39; chain result is:\n&quot;</span> &lt;&lt; *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;}</div>
<div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160; </div>
<div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;<span class="keywordtype">bool</span> SimplifyCFGOpt::simplifyResume(<a class="code" href="classllvm_1_1ResumeInst.html">ResumeInst</a> *RI, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>) {</div>
<div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160;  <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(RI-&gt;<a class="code" href="classllvm_1_1ResumeInst.html#ac882730953c5fd70cfac11d3508b42f4">getValue</a>()))</div>
<div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;    <span class="keywordflow">return</span> simplifyCommonResume(RI);</div>
<div class="line"><a name="l04812"></a><span class="lineno"> 4812</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;LandingPadInst&gt;(RI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a46ef6115027606b67adcf4d28f3dac17">getFirstNonPHI</a>()) &amp;&amp;</div>
<div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;           RI-&gt;<a class="code" href="classllvm_1_1ResumeInst.html#ac882730953c5fd70cfac11d3508b42f4">getValue</a>() == RI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a46ef6115027606b67adcf4d28f3dac17">getFirstNonPHI</a>())</div>
<div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;    <span class="comment">// The resume must unwind the exception that caused control to branch here.</span></div>
<div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;    <span class="keywordflow">return</span> simplifySingleResume(RI);</div>
<div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160; </div>
<div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;}</div>
<div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160; </div>
<div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;<span class="comment">// Check if cleanup block is empty</span></div>
<div class="line"><a name="l04821"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a583f07468003b1c19e8227f1c0e63fb7"> 4821</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a583f07468003b1c19e8227f1c0e63fb7">isCleanupBlockEmpty</a>(<a class="code" href="classllvm_1_1iterator__range.html">iterator_range&lt;BasicBlock::iterator&gt;</a> <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>) {</div>
<div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>) {</div>
<div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;    <span class="keyword">auto</span> *II = dyn_cast&lt;IntrinsicInst&gt;(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;    <span class="keywordflow">if</span> (!II)</div>
<div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160; </div>
<div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;    <a class="code" href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IntrinsicID = II-&gt;<a class="code" href="classllvm_1_1CallBase.html#ac62778065b99372cc62cf994b967e7e8">getIntrinsicID</a>();</div>
<div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;    <span class="keywordflow">switch</span> (IntrinsicID) {</div>
<div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;    <span class="keywordflow">case</span> Intrinsic::dbg_declare:</div>
<div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160;    <span class="keywordflow">case</span> Intrinsic::dbg_value:</div>
<div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;    <span class="keywordflow">case</span> Intrinsic::dbg_label:</div>
<div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;    <span class="keywordflow">case</span> Intrinsic::lifetime_end:</div>
<div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;    }</div>
<div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;  }</div>
<div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;}</div>
<div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160; </div>
<div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;<span class="comment">// Simplify resume that is shared by several landing pads (phi of landing pad).</span></div>
<div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;<span class="keywordtype">bool</span> SimplifyCFGOpt::simplifyCommonResume(<a class="code" href="classllvm_1_1ResumeInst.html">ResumeInst</a> *RI) {</div>
<div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = RI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160; </div>
<div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;  <span class="comment">// Check that there are no other instructions except for debug and lifetime</span></div>
<div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;  <span class="comment">// intrinsics between the phi&#39;s and resume instruction.</span></div>
<div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#a583f07468003b1c19e8227f1c0e63fb7">isCleanupBlockEmpty</a>(</div>
<div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;          <a class="code" href="namespacellvm.html#ad1a91b49e0c092818a0b82f6cc130a1b">make_range</a>(RI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a46ef6115027606b67adcf4d28f3dac17">getFirstNonPHI</a>(), <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getTerminator())))</div>
<div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160; </div>
<div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;  <a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;BasicBlock *, 4&gt;</a> TrivialUnwindBlocks;</div>
<div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;  <span class="keyword">auto</span> *PhiLPInst = cast&lt;PHINode&gt;(RI-&gt;<a class="code" href="classllvm_1_1ResumeInst.html#ac882730953c5fd70cfac11d3508b42f4">getValue</a>());</div>
<div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160; </div>
<div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;  <span class="comment">// Check incoming blocks to see if any of them are trivial.</span></div>
<div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Idx = 0, End = PhiLPInst-&gt;getNumIncomingValues(); Idx != End;</div>
<div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;       Idx++) {</div>
<div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;    <span class="keyword">auto</span> *IncomingBB = PhiLPInst-&gt;getIncomingBlock(Idx);</div>
<div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;    <span class="keyword">auto</span> *IncomingValue = PhiLPInst-&gt;getIncomingValue(Idx);</div>
<div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160; </div>
<div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;    <span class="comment">// If the block has other successors, we can not delete it because</span></div>
<div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;    <span class="comment">// it has other dependents.</span></div>
<div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;    <span class="keywordflow">if</span> (IncomingBB-&gt;getUniqueSuccessor() != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160; </div>
<div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;    <span class="keyword">auto</span> *LandingPad = dyn_cast&lt;LandingPadInst&gt;(IncomingBB-&gt;getFirstNonPHI());</div>
<div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;    <span class="comment">// Not the landing pad that caused the control to branch here.</span></div>
<div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;    <span class="keywordflow">if</span> (IncomingValue != LandingPad)</div>
<div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04869"></a><span class="lineno"> 4869</span>&#160; </div>
<div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a583f07468003b1c19e8227f1c0e63fb7">isCleanupBlockEmpty</a>(</div>
<div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;            <a class="code" href="namespacellvm.html#ad1a91b49e0c092818a0b82f6cc130a1b">make_range</a>(LandingPad-&gt;getNextNode(), IncomingBB-&gt;getTerminator())))</div>
<div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;      TrivialUnwindBlocks.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(IncomingBB);</div>
<div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;  }</div>
<div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160; </div>
<div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;  <span class="comment">// If no trivial unwind blocks, don&#39;t do any simplifications.</span></div>
<div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;  <span class="keywordflow">if</span> (TrivialUnwindBlocks.<a class="code" href="classllvm_1_1SetVector.html#aaf9ee38b9973681c1720aaf03af3a069">empty</a>())</div>
<div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160; </div>
<div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;  <span class="comment">// Turn all invokes that unwind here into calls.</span></div>
<div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *TrivialBB : TrivialUnwindBlocks) {</div>
<div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;    <span class="comment">// Blocks that will be simplified should be removed from the phi node.</span></div>
<div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;    <span class="comment">// Note there could be multiple edges to the resume block, and we need</span></div>
<div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;    <span class="comment">// to remove them all.</span></div>
<div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160;    <span class="keywordflow">while</span> (PhiLPInst-&gt;getBasicBlockIndex(TrivialBB) != -1)</div>
<div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;      <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;removePredecessor(TrivialBB, <span class="keyword">true</span>);</div>
<div class="line"><a name="l04886"></a><span class="lineno"> 4886</span>&#160; </div>
<div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred :</div>
<div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;         <a class="code" href="namespacellvm.html#a8154638df88e4eaa568b67b23d463dac">llvm::make_early_inc_range</a>(<a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(TrivialBB))) {</div>
<div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;      <a class="code" href="namespacellvm.html#a83cbd0aa1465957c50eaea8374875b27">removeUnwindEdge</a>(Pred, DTU);</div>
<div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;      ++NumInvokes;</div>
<div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;    }</div>
<div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160; </div>
<div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;    <span class="comment">// In each SimplifyCFG run, only the current processed block can be erased.</span></div>
<div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;    <span class="comment">// Otherwise, it will break the iteration of SimplifyCFG pass. So instead</span></div>
<div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;    <span class="comment">// of erasing TrivialBB, we only remove the branch to the common resume</span></div>
<div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;    <span class="comment">// block so that we can later erase the resume block since it has no</span></div>
<div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160;    <span class="comment">// predecessors.</span></div>
<div class="line"><a name="l04898"></a><span class="lineno"> 4898</span>&#160;    TrivialBB-&gt;getTerminator()-&gt;eraseFromParent();</div>
<div class="line"><a name="l04899"></a><span class="lineno"> 4899</span>&#160;    <span class="keyword">new</span> <a class="code" href="classllvm_1_1UnreachableInst.html">UnreachableInst</a>(RI-&gt;<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), TrivialBB);</div>
<div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;    <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;      DTU-&gt;applyUpdates({{DominatorTree::Delete, TrivialBB, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>}});</div>
<div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;  }</div>
<div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160; </div>
<div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;  <span class="comment">// Delete the resume block if all its predecessors have been removed.</span></div>
<div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ad66c4759666aab78529658362b498c74">pred_empty</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>))</div>
<div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;    <a class="code" href="namespacellvm.html#a458b4709ebedccb846a179f1e422265b">DeleteDeadBlock</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, DTU);</div>
<div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160; </div>
<div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;  <span class="keywordflow">return</span> !TrivialUnwindBlocks.empty();</div>
<div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;}</div>
<div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160; </div>
<div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;<span class="comment">// Simplify resume that is only used by a single (non-phi) landing pad.</span></div>
<div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;<span class="keywordtype">bool</span> SimplifyCFGOpt::simplifySingleResume(<a class="code" href="classllvm_1_1ResumeInst.html">ResumeInst</a> *RI) {</div>
<div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = RI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;  <span class="keyword">auto</span> *LPInst = cast&lt;LandingPadInst&gt;(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getFirstNonPHI());</div>
<div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(RI-&gt;<a class="code" href="classllvm_1_1ResumeInst.html#ac882730953c5fd70cfac11d3508b42f4">getValue</a>() == LPInst &amp;&amp;</div>
<div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160;         <span class="stringliteral">&quot;Resume must unwind the exception that caused control to here&quot;</span>);</div>
<div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160; </div>
<div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;  <span class="comment">// Check that there are no other instructions except for debug intrinsics.</span></div>
<div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#a583f07468003b1c19e8227f1c0e63fb7">isCleanupBlockEmpty</a>(</div>
<div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;          make_range&lt;Instruction *&gt;(LPInst-&gt;getNextNode(), RI)))</div>
<div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160; </div>
<div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160;  <span class="comment">// Turn all invokes that unwind here into calls and delete the basic block.</span></div>
<div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred : <a class="code" href="namespacellvm.html#a8154638df88e4eaa568b67b23d463dac">llvm::make_early_inc_range</a>(<a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>))) {</div>
<div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;    <a class="code" href="namespacellvm.html#a83cbd0aa1465957c50eaea8374875b27">removeUnwindEdge</a>(Pred, DTU);</div>
<div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;    ++NumInvokes;</div>
<div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160;  }</div>
<div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160; </div>
<div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;  <span class="comment">// The landingpad is now unreachable.  Zap it.</span></div>
<div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;  <a class="code" href="namespacellvm.html#a458b4709ebedccb846a179f1e422265b">DeleteDeadBlock</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, DTU);</div>
<div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04932"></a><span class="lineno"> 4932</span>&#160;}</div>
<div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160; </div>
<div class="line"><a name="l04934"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#aedfe10b7b8a1008ddaa4104f54e0b483"> 4934</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#aedfe10b7b8a1008ddaa4104f54e0b483">removeEmptyCleanup</a>(<a class="code" href="classllvm_1_1CleanupReturnInst.html">CleanupReturnInst</a> *RI, <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> *DTU) {</div>
<div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;  <span class="comment">// If this is a trivial cleanup pad that executes no instructions, it can be</span></div>
<div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;  <span class="comment">// eliminated.  If the cleanup pad continues to the caller, any predecessor</span></div>
<div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;  <span class="comment">// that is an EH pad will be updated to continue to the caller and any</span></div>
<div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160;  <span class="comment">// predecessor that terminates with an invoke instruction will have its invoke</span></div>
<div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;  <span class="comment">// instruction converted to a call instruction.  If the cleanup pad being</span></div>
<div class="line"><a name="l04940"></a><span class="lineno"> 4940</span>&#160;  <span class="comment">// simplified does not continue to the caller, each predecessor will be</span></div>
<div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160;  <span class="comment">// updated to continue to the unwind destination of the cleanup pad being</span></div>
<div class="line"><a name="l04942"></a><span class="lineno"> 4942</span>&#160;  <span class="comment">// simplified.</span></div>
<div class="line"><a name="l04943"></a><span class="lineno"> 4943</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = RI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l04944"></a><span class="lineno"> 4944</span>&#160;  <a class="code" href="classllvm_1_1CleanupPadInst.html">CleanupPadInst</a> *CPInst = RI-&gt;<a class="code" href="classllvm_1_1CleanupReturnInst.html#a01bfb360ebaa795daa5623e2c1e3284e">getCleanupPad</a>();</div>
<div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;  <span class="keywordflow">if</span> (CPInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;    <span class="comment">// This isn&#39;t an empty cleanup.</span></div>
<div class="line"><a name="l04947"></a><span class="lineno"> 4947</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04948"></a><span class="lineno"> 4948</span>&#160; </div>
<div class="line"><a name="l04949"></a><span class="lineno"> 4949</span>&#160;  <span class="comment">// We cannot kill the pad if it has multiple uses.  This typically arises</span></div>
<div class="line"><a name="l04950"></a><span class="lineno"> 4950</span>&#160;  <span class="comment">// from unreachable basic blocks.</span></div>
<div class="line"><a name="l04951"></a><span class="lineno"> 4951</span>&#160;  <span class="keywordflow">if</span> (!CPInst-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</div>
<div class="line"><a name="l04952"></a><span class="lineno"> 4952</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04953"></a><span class="lineno"> 4953</span>&#160; </div>
<div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160;  <span class="comment">// Check that there are no other instructions except for benign intrinsics.</span></div>
<div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#a583f07468003b1c19e8227f1c0e63fb7">isCleanupBlockEmpty</a>(</div>
<div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160;          make_range&lt;Instruction *&gt;(CPInst-&gt;<a class="code" href="classllvm_1_1ilist__node__with__parent.html#a26708685cc8b94fe3d7092ee080dbb34">getNextNode</a>(), RI)))</div>
<div class="line"><a name="l04957"></a><span class="lineno"> 4957</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160; </div>
<div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;  <span class="comment">// If the cleanup return we are simplifying unwinds to the caller, this will</span></div>
<div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;  <span class="comment">// set UnwindDest to nullptr.</span></div>
<div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *UnwindDest = RI-&gt;<a class="code" href="classllvm_1_1CleanupReturnInst.html#a4b5ae24ac77905557021989915dfd964">getUnwindDest</a>();</div>
<div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *DestEHPad = UnwindDest ? UnwindDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a46ef6115027606b67adcf4d28f3dac17">getFirstNonPHI</a>() : <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160; </div>
<div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;  <span class="comment">// We&#39;re about to remove BB from the control flow.  Before we do, sink any</span></div>
<div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160;  <span class="comment">// PHINodes into the unwind destination.  Doing this before changing the</span></div>
<div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;  <span class="comment">// control flow avoids some potentially slow checks, since we can currently</span></div>
<div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;  <span class="comment">// be certain that UnwindDest and BB have no common predecessors (since they</span></div>
<div class="line"><a name="l04968"></a><span class="lineno"> 4968</span>&#160;  <span class="comment">// are both EH pads).</span></div>
<div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;  <span class="keywordflow">if</span> (UnwindDest) {</div>
<div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;    <span class="comment">// First, go through the PHI nodes in UnwindDest and update any nodes that</span></div>
<div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160;    <span class="comment">// reference the block we are removing</span></div>
<div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> &amp;DestPN : UnwindDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a72516971c5734dc0f7546e64affca425">phis</a>()) {</div>
<div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;      <span class="keywordtype">int</span> Idx = DestPN.getBasicBlockIndex(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;      <span class="comment">// Since BB unwinds to UnwindDest, it has to be in the PHI node.</span></div>
<div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Idx != -1);</div>
<div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;      <span class="comment">// This PHI node has an incoming value that corresponds to a control</span></div>
<div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;      <span class="comment">// path through the cleanup pad we are removing.  If the incoming</span></div>
<div class="line"><a name="l04978"></a><span class="lineno"> 4978</span>&#160;      <span class="comment">// value is in the cleanup pad, it must be a PHINode (because we</span></div>
<div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160;      <span class="comment">// verified above that the block is otherwise empty).  Otherwise, the</span></div>
<div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;      <span class="comment">// value is either a constant or a value that dominates the cleanup</span></div>
<div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;      <span class="comment">// pad being removed.</span></div>
<div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160;      <span class="comment">// Because BB and UnwindDest are both EH pads, all of their</span></div>
<div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;      <span class="comment">// predecessors must unwind to these blocks, and since no instruction</span></div>
<div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160;      <span class="comment">// can have multiple unwind destinations, there will be no overlap in</span></div>
<div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;      <span class="comment">// incoming blocks between SrcPN and DestPN.</span></div>
<div class="line"><a name="l04987"></a><span class="lineno"> 4987</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *SrcVal = DestPN.getIncomingValue(Idx);</div>
<div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160;      <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *SrcPN = dyn_cast&lt;PHINode&gt;(SrcVal);</div>
<div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160; </div>
<div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;      <span class="keywordtype">bool</span> NeedPHITranslation = SrcPN &amp;&amp; SrcPN-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>;</div>
<div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Pred : <a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)) {</div>
<div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Incoming =</div>
<div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;            NeedPHITranslation ? SrcPN-&gt;<a class="code" href="classllvm_1_1PHINode.html#adfb61ffe25c950c75c86310245b3ef39">getIncomingValueForBlock</a>(Pred) : SrcVal;</div>
<div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;        DestPN.addIncoming(Incoming, Pred);</div>
<div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;      }</div>
<div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160;    }</div>
<div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160; </div>
<div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;    <span class="comment">// Sink any remaining PHI nodes directly into UnwindDest.</span></div>
<div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InsertPt = DestEHPad;</div>
<div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> &amp;PN : <a class="code" href="namespacellvm.html#a8154638df88e4eaa568b67b23d463dac">make_early_inc_range</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;phis())) {</div>
<div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;      <span class="keywordflow">if</span> (PN.<a class="code" href="classllvm_1_1Value.html#a9d7de807ebdfe1819df3ff6cb0f16158">use_empty</a>() || !PN.<a class="code" href="classllvm_1_1Instruction.html#a91dbffd0cc6b209fd2bfe9a0236d779c">isUsedOutsideOfBlock</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>))</div>
<div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160;        <span class="comment">// If the PHI node has no uses or all of its uses are in this basic</span></div>
<div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;        <span class="comment">// block (meaning they are debug or lifetime intrinsics), just leave</span></div>
<div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160;        <span class="comment">// it.  It will be erased when we erase BB below.</span></div>
<div class="line"><a name="l05005"></a><span class="lineno"> 5005</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160; </div>
<div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;      <span class="comment">// Otherwise, sink this PHI node into UnwindDest.</span></div>
<div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;      <span class="comment">// Any predecessors to UnwindDest which are not already represented</span></div>
<div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160;      <span class="comment">// must be back edges which inherit the value from the path through</span></div>
<div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;      <span class="comment">// BB.  In this case, the PHI value must reference itself.</span></div>
<div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="HexagonGenPredicate_8cpp.html#a0de1bf31f56b17312cc34b911d86faa4">pred</a> : <a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(UnwindDest))</div>
<div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="HexagonGenPredicate_8cpp.html#a0de1bf31f56b17312cc34b911d86faa4">pred</a> != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160;          PN.<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(&amp;PN, <a class="code" href="HexagonGenPredicate_8cpp.html#a0de1bf31f56b17312cc34b911d86faa4">pred</a>);</div>
<div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160;      PN.<a class="code" href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(InsertPt);</div>
<div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;      <span class="comment">// Also, add a dummy incoming value for the original BB itself,</span></div>
<div class="line"><a name="l05016"></a><span class="lineno"> 5016</span>&#160;      <span class="comment">// so that the PHI is well-formed until we drop said predecessor.</span></div>
<div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;      PN.<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">PoisonValue::get</a>(PN.<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()), <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;    }</div>
<div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;  }</div>
<div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160; </div>
<div class="line"><a name="l05021"></a><span class="lineno"> 5021</span>&#160;  std::vector&lt;DominatorTree::UpdateType&gt; Updates;</div>
<div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160; </div>
<div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;  <span class="comment">// We use make_early_inc_range here because we will remove all predecessors.</span></div>
<div class="line"><a name="l05024"></a><span class="lineno"> 5024</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PredBB : <a class="code" href="namespacellvm.html#a8154638df88e4eaa568b67b23d463dac">llvm::make_early_inc_range</a>(<a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>))) {</div>
<div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160;    <span class="keywordflow">if</span> (UnwindDest == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;      <span class="keywordflow">if</span> (DTU) {</div>
<div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;        DTU-&gt;<a class="code" href="classllvm_1_1DomTreeUpdater.html#aae522cd1928cfac6850b50c7a3e22185">applyUpdates</a>(Updates);</div>
<div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;        Updates.clear();</div>
<div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160;      }</div>
<div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;      <a class="code" href="namespacellvm.html#a83cbd0aa1465957c50eaea8374875b27">removeUnwindEdge</a>(PredBB, DTU);</div>
<div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;      ++NumInvokes;</div>
<div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160;      <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;removePredecessor(PredBB);</div>
<div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TI = PredBB-&gt;getTerminator();</div>
<div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;      TI-&gt;<a class="code" href="classllvm_1_1User.html#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, UnwindDest);</div>
<div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;      <span class="keywordflow">if</span> (DTU) {</div>
<div class="line"><a name="l05037"></a><span class="lineno"> 5037</span>&#160;        Updates.push_back({<a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">DominatorTree::Insert</a>, PredBB, UnwindDest});</div>
<div class="line"><a name="l05038"></a><span class="lineno"> 5038</span>&#160;        Updates.push_back({DominatorTree::Delete, PredBB, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>});</div>
<div class="line"><a name="l05039"></a><span class="lineno"> 5039</span>&#160;      }</div>
<div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160;    }</div>
<div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160;  }</div>
<div class="line"><a name="l05042"></a><span class="lineno"> 5042</span>&#160; </div>
<div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160;  <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l05044"></a><span class="lineno"> 5044</span>&#160;    DTU-&gt;<a class="code" href="classllvm_1_1DomTreeUpdater.html#aae522cd1928cfac6850b50c7a3e22185">applyUpdates</a>(Updates);</div>
<div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160; </div>
<div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160;  <a class="code" href="namespacellvm.html#a458b4709ebedccb846a179f1e422265b">DeleteDeadBlock</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, DTU);</div>
<div class="line"><a name="l05047"></a><span class="lineno"> 5047</span>&#160; </div>
<div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;}</div>
<div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160; </div>
<div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;<span class="comment">// Try to merge two cleanuppads together.</span></div>
<div class="line"><a name="l05052"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a1f70470f7a7722fd55c58c81358107f2"> 5052</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a1f70470f7a7722fd55c58c81358107f2">mergeCleanupPad</a>(<a class="code" href="classllvm_1_1CleanupReturnInst.html">CleanupReturnInst</a> *RI) {</div>
<div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;  <span class="comment">// Skip any cleanuprets which unwind to caller, there is nothing to merge</span></div>
<div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160;  <span class="comment">// with.</span></div>
<div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *UnwindDest = RI-&gt;<a class="code" href="classllvm_1_1CleanupReturnInst.html#a4b5ae24ac77905557021989915dfd964">getUnwindDest</a>();</div>
<div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;  <span class="keywordflow">if</span> (!UnwindDest)</div>
<div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160; </div>
<div class="line"><a name="l05059"></a><span class="lineno"> 5059</span>&#160;  <span class="comment">// This cleanupret isn&#39;t the only predecessor of this cleanuppad, it wouldn&#39;t</span></div>
<div class="line"><a name="l05060"></a><span class="lineno"> 5060</span>&#160;  <span class="comment">// be safe to merge without code duplication.</span></div>
<div class="line"><a name="l05061"></a><span class="lineno"> 5061</span>&#160;  <span class="keywordflow">if</span> (UnwindDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>() != RI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>())</div>
<div class="line"><a name="l05062"></a><span class="lineno"> 5062</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05063"></a><span class="lineno"> 5063</span>&#160; </div>
<div class="line"><a name="l05064"></a><span class="lineno"> 5064</span>&#160;  <span class="comment">// Verify that our cleanuppad&#39;s unwind destination is another cleanuppad.</span></div>
<div class="line"><a name="l05065"></a><span class="lineno"> 5065</span>&#160;  <span class="keyword">auto</span> *SuccessorCleanupPad = dyn_cast&lt;CleanupPadInst&gt;(&amp;UnwindDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#ab706e7ebb1969c5e34f28bfcf2ff719e">front</a>());</div>
<div class="line"><a name="l05066"></a><span class="lineno"> 5066</span>&#160;  <span class="keywordflow">if</span> (!SuccessorCleanupPad)</div>
<div class="line"><a name="l05067"></a><span class="lineno"> 5067</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05068"></a><span class="lineno"> 5068</span>&#160; </div>
<div class="line"><a name="l05069"></a><span class="lineno"> 5069</span>&#160;  <a class="code" href="classllvm_1_1CleanupPadInst.html">CleanupPadInst</a> *PredecessorCleanupPad = RI-&gt;<a class="code" href="classllvm_1_1CleanupReturnInst.html#a01bfb360ebaa795daa5623e2c1e3284e">getCleanupPad</a>();</div>
<div class="line"><a name="l05070"></a><span class="lineno"> 5070</span>&#160;  <span class="comment">// Replace any uses of the successor cleanupad with the predecessor pad</span></div>
<div class="line"><a name="l05071"></a><span class="lineno"> 5071</span>&#160;  <span class="comment">// The only cleanuppad uses should be this cleanupret, it&#39;s cleanupret and</span></div>
<div class="line"><a name="l05072"></a><span class="lineno"> 5072</span>&#160;  <span class="comment">// funclet bundle operands.</span></div>
<div class="line"><a name="l05073"></a><span class="lineno"> 5073</span>&#160;  SuccessorCleanupPad-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(PredecessorCleanupPad);</div>
<div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;  <span class="comment">// Remove the old cleanuppad.</span></div>
<div class="line"><a name="l05075"></a><span class="lineno"> 5075</span>&#160;  SuccessorCleanupPad-&gt;eraseFromParent();</div>
<div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;  <span class="comment">// Now, we simply replace the cleanupret with a branch to the unwind</span></div>
<div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;  <span class="comment">// destination.</span></div>
<div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;  BranchInst::Create(UnwindDest, RI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>());</div>
<div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;  RI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160; </div>
<div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;}</div>
<div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160; </div>
<div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160;<span class="keywordtype">bool</span> SimplifyCFGOpt::simplifyCleanupReturn(<a class="code" href="classllvm_1_1CleanupReturnInst.html">CleanupReturnInst</a> *RI) {</div>
<div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160;  <span class="comment">// It is possible to transiantly have an undef cleanuppad operand because we</span></div>
<div class="line"><a name="l05086"></a><span class="lineno"> 5086</span>&#160;  <span class="comment">// have deleted some, but not all, dead blocks.</span></div>
<div class="line"><a name="l05087"></a><span class="lineno"> 5087</span>&#160;  <span class="comment">// Eventually, this block will be deleted.</span></div>
<div class="line"><a name="l05088"></a><span class="lineno"> 5088</span>&#160;  <span class="keywordflow">if</span> (isa&lt;UndefValue&gt;(RI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)))</div>
<div class="line"><a name="l05089"></a><span class="lineno"> 5089</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05090"></a><span class="lineno"> 5090</span>&#160; </div>
<div class="line"><a name="l05091"></a><span class="lineno"> 5091</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a1f70470f7a7722fd55c58c81358107f2">mergeCleanupPad</a>(RI))</div>
<div class="line"><a name="l05092"></a><span class="lineno"> 5092</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160; </div>
<div class="line"><a name="l05094"></a><span class="lineno"> 5094</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#aedfe10b7b8a1008ddaa4104f54e0b483">removeEmptyCleanup</a>(RI, DTU))</div>
<div class="line"><a name="l05095"></a><span class="lineno"> 5095</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05096"></a><span class="lineno"> 5096</span>&#160; </div>
<div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05098"></a><span class="lineno"> 5098</span>&#160;}</div>
<div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160; </div>
<div class="line"><a name="l05100"></a><span class="lineno"> 5100</span>&#160;<span class="comment">// WARNING: keep in sync with InstCombinerImpl::visitUnreachableInst()!</span></div>
<div class="line"><a name="l05101"></a><span class="lineno"> 5101</span>&#160;<span class="keywordtype">bool</span> SimplifyCFGOpt::simplifyUnreachable(<a class="code" href="classllvm_1_1UnreachableInst.html">UnreachableInst</a> *UI) {</div>
<div class="line"><a name="l05102"></a><span class="lineno"> 5102</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = UI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l05103"></a><span class="lineno"> 5103</span>&#160; </div>
<div class="line"><a name="l05104"></a><span class="lineno"> 5104</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05105"></a><span class="lineno"> 5105</span>&#160; </div>
<div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;  <span class="comment">// If there are any instructions immediately before the unreachable that can</span></div>
<div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;  <span class="comment">// be removed, do so.</span></div>
<div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;  <span class="keywordflow">while</span> (UI-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>() != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;begin()) {</div>
<div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BBI = UI-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>();</div>
<div class="line"><a name="l05110"></a><span class="lineno"> 5110</span>&#160;    --BBI;</div>
<div class="line"><a name="l05111"></a><span class="lineno"> 5111</span>&#160; </div>
<div class="line"><a name="l05112"></a><span class="lineno"> 5112</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#abff5a423c1f45e23958dde8ee695c9a9">isGuaranteedToTransferExecutionToSuccessor</a>(&amp;*BBI))</div>
<div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;      <span class="keywordflow">break</span>; <span class="comment">// Can not drop any more instructions. We&#39;re done here.</span></div>
<div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;    <span class="comment">// Otherwise, this instruction can be freely erased,</span></div>
<div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160;    <span class="comment">// even if it is not side-effect free.</span></div>
<div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160; </div>
<div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;    <span class="comment">// Note that deleting EH&#39;s here is in fact okay, although it involves a bit</span></div>
<div class="line"><a name="l05118"></a><span class="lineno"> 5118</span>&#160;    <span class="comment">// of subtle reasoning. If this inst is an EH, all the predecessors of this</span></div>
<div class="line"><a name="l05119"></a><span class="lineno"> 5119</span>&#160;    <span class="comment">// block will be the unwind edges of Invoke/CatchSwitch/CleanupReturn,</span></div>
<div class="line"><a name="l05120"></a><span class="lineno"> 5120</span>&#160;    <span class="comment">// and we can therefore guarantee this block will be erased.</span></div>
<div class="line"><a name="l05121"></a><span class="lineno"> 5121</span>&#160; </div>
<div class="line"><a name="l05122"></a><span class="lineno"> 5122</span>&#160;    <span class="comment">// Delete this instruction (any uses are guaranteed to be dead)</span></div>
<div class="line"><a name="l05123"></a><span class="lineno"> 5123</span>&#160;    BBI-&gt;replaceAllUsesWith(<a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">PoisonValue::get</a>(BBI-&gt;getType()));</div>
<div class="line"><a name="l05124"></a><span class="lineno"> 5124</span>&#160;    BBI-&gt;eraseFromParent();</div>
<div class="line"><a name="l05125"></a><span class="lineno"> 5125</span>&#160;    Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05126"></a><span class="lineno"> 5126</span>&#160;  }</div>
<div class="line"><a name="l05127"></a><span class="lineno"> 5127</span>&#160; </div>
<div class="line"><a name="l05128"></a><span class="lineno"> 5128</span>&#160;  <span class="comment">// If the unreachable instruction is the first in the block, take a gander</span></div>
<div class="line"><a name="l05129"></a><span class="lineno"> 5129</span>&#160;  <span class="comment">// at all of the predecessors of this instruction, and simplify them.</span></div>
<div class="line"><a name="l05130"></a><span class="lineno"> 5130</span>&#160;  <span class="keywordflow">if</span> (&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;front() != UI)</div>
<div class="line"><a name="l05131"></a><span class="lineno"> 5131</span>&#160;    <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160; </div>
<div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160;  std::vector&lt;DominatorTree::UpdateType&gt; Updates;</div>
<div class="line"><a name="l05134"></a><span class="lineno"> 5134</span>&#160; </div>
<div class="line"><a name="l05135"></a><span class="lineno"> 5135</span>&#160;  <a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;BasicBlock *, 8&gt;</a> Preds(<a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>), <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>));</div>
<div class="line"><a name="l05136"></a><span class="lineno"> 5136</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = Preds.size(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l05137"></a><span class="lineno"> 5137</span>&#160;    <span class="keyword">auto</span> *Predecessor = Preds[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l05138"></a><span class="lineno"> 5138</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TI = Predecessor-&gt;getTerminator();</div>
<div class="line"><a name="l05139"></a><span class="lineno"> 5139</span>&#160;    <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(TI);</div>
<div class="line"><a name="l05140"></a><span class="lineno"> 5140</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *BI = dyn_cast&lt;BranchInst&gt;(TI)) {</div>
<div class="line"><a name="l05141"></a><span class="lineno"> 5141</span>&#160;      <span class="comment">// We could either have a proper unconditional branch,</span></div>
<div class="line"><a name="l05142"></a><span class="lineno"> 5142</span>&#160;      <span class="comment">// or a degenerate conditional branch with matching destinations.</span></div>
<div class="line"><a name="l05143"></a><span class="lineno"> 5143</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad37b3ffc4c5f3cbe9248d587a2efb850">successors</a>(),</div>
<div class="line"><a name="l05144"></a><span class="lineno"> 5144</span>&#160;                 [<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>](<span class="keyword">auto</span> *<a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a>) { return Successor == BB; })) {</div>
<div class="line"><a name="l05145"></a><span class="lineno"> 5145</span>&#160;        <span class="keyword">new</span> <a class="code" href="classllvm_1_1UnreachableInst.html">UnreachableInst</a>(TI-&gt;<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), TI);</div>
<div class="line"><a name="l05146"></a><span class="lineno"> 5146</span>&#160;        TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160;        Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() &amp;&amp; <span class="stringliteral">&quot;Can&#39;t get here with an uncond branch.&quot;</span>);</div>
<div class="line"><a name="l05150"></a><span class="lineno"> 5150</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a>* <a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a> = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>();</div>
<div class="line"><a name="l05151"></a><span class="lineno"> 5151</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0) != BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1) &amp;&amp;</div>
<div class="line"><a name="l05152"></a><span class="lineno"> 5152</span>&#160;               <span class="stringliteral">&quot;The destinations are guaranteed to be different here.&quot;</span>);</div>
<div class="line"><a name="l05153"></a><span class="lineno"> 5153</span>&#160;        <span class="keywordflow">if</span> (BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0) == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l05154"></a><span class="lineno"> 5154</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAssumption(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateNot(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>));</div>
<div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBr(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1));</div>
<div class="line"><a name="l05156"></a><span class="lineno"> 5156</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05157"></a><span class="lineno"> 5157</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1) == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> &amp;&amp; <span class="stringliteral">&quot;Incorrect CFG&quot;</span>);</div>
<div class="line"><a name="l05158"></a><span class="lineno"> 5158</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAssumption(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>);</div>
<div class="line"><a name="l05159"></a><span class="lineno"> 5159</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBr(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0));</div>
<div class="line"><a name="l05160"></a><span class="lineno"> 5160</span>&#160;        }</div>
<div class="line"><a name="l05161"></a><span class="lineno"> 5161</span>&#160;        <a class="code" href="SimplifyCFG_8cpp.html#aa4641512b28a6e42a40bda7576fe43cb">EraseTerminatorAndDCECond</a>(BI);</div>
<div class="line"><a name="l05162"></a><span class="lineno"> 5162</span>&#160;        Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05163"></a><span class="lineno"> 5163</span>&#160;      }</div>
<div class="line"><a name="l05164"></a><span class="lineno"> 5164</span>&#160;      <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l05165"></a><span class="lineno"> 5165</span>&#160;        Updates.push_back({DominatorTree::Delete, Predecessor, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>});</div>
<div class="line"><a name="l05166"></a><span class="lineno"> 5166</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;SwitchInst&gt;(TI)) {</div>
<div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;      <a class="code" href="classllvm_1_1SwitchInstProfUpdateWrapper.html">SwitchInstProfUpdateWrapper</a> SU(*<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = SU-&gt;case_begin(), <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = SU-&gt;case_end(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>;) {</div>
<div class="line"><a name="l05169"></a><span class="lineno"> 5169</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>-&gt;getCaseSuccessor() != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l05170"></a><span class="lineno"> 5170</span>&#160;          ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l05171"></a><span class="lineno"> 5171</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05172"></a><span class="lineno"> 5172</span>&#160;        }</div>
<div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160;        <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;removePredecessor(SU-&gt;getParent());</div>
<div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;        <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = SU.removeCase(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160;        <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = SU-&gt;case_end();</div>
<div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;        Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05177"></a><span class="lineno"> 5177</span>&#160;      }</div>
<div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160;      <span class="comment">// Note that the default destination can&#39;t be removed!</span></div>
<div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160;      <span class="keywordflow">if</span> (DTU &amp;&amp; <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDefaultDest() != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160;        Updates.push_back({DominatorTree::Delete, Predecessor, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>});</div>
<div class="line"><a name="l05181"></a><span class="lineno"> 5181</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *II = dyn_cast&lt;InvokeInst&gt;(TI)) {</div>
<div class="line"><a name="l05182"></a><span class="lineno"> 5182</span>&#160;      <span class="keywordflow">if</span> (II-&gt;<a class="code" href="classllvm_1_1InvokeInst.html#a5ba379c3251d99b4c23c8f2e6abe4a6c">getUnwindDest</a>() == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l05183"></a><span class="lineno"> 5183</span>&#160;        <span class="keywordflow">if</span> (DTU) {</div>
<div class="line"><a name="l05184"></a><span class="lineno"> 5184</span>&#160;          DTU-&gt;applyUpdates(Updates);</div>
<div class="line"><a name="l05185"></a><span class="lineno"> 5185</span>&#160;          Updates.clear();</div>
<div class="line"><a name="l05186"></a><span class="lineno"> 5186</span>&#160;        }</div>
<div class="line"><a name="l05187"></a><span class="lineno"> 5187</span>&#160;        <span class="keyword">auto</span> *CI = cast&lt;CallInst&gt;(<a class="code" href="namespacellvm.html#a83cbd0aa1465957c50eaea8374875b27">removeUnwindEdge</a>(TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>(), DTU));</div>
<div class="line"><a name="l05188"></a><span class="lineno"> 5188</span>&#160;        <span class="keywordflow">if</span> (!CI-&gt;doesNotThrow())</div>
<div class="line"><a name="l05189"></a><span class="lineno"> 5189</span>&#160;          CI-&gt;setDoesNotThrow();</div>
<div class="line"><a name="l05190"></a><span class="lineno"> 5190</span>&#160;        Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05191"></a><span class="lineno"> 5191</span>&#160;      }</div>
<div class="line"><a name="l05192"></a><span class="lineno"> 5192</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *CSI = dyn_cast&lt;CatchSwitchInst&gt;(TI)) {</div>
<div class="line"><a name="l05193"></a><span class="lineno"> 5193</span>&#160;      <span class="keywordflow">if</span> (CSI-&gt;getUnwindDest() == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l05194"></a><span class="lineno"> 5194</span>&#160;        <span class="keywordflow">if</span> (DTU) {</div>
<div class="line"><a name="l05195"></a><span class="lineno"> 5195</span>&#160;          DTU-&gt;applyUpdates(Updates);</div>
<div class="line"><a name="l05196"></a><span class="lineno"> 5196</span>&#160;          Updates.clear();</div>
<div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;        }</div>
<div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;        <a class="code" href="namespacellvm.html#a83cbd0aa1465957c50eaea8374875b27">removeUnwindEdge</a>(TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>(), DTU);</div>
<div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;        Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05200"></a><span class="lineno"> 5200</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05201"></a><span class="lineno"> 5201</span>&#160;      }</div>
<div class="line"><a name="l05202"></a><span class="lineno"> 5202</span>&#160; </div>
<div class="line"><a name="l05203"></a><span class="lineno"> 5203</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1mapped__iterator.html">CatchSwitchInst::handler_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = CSI-&gt;handler_begin(),</div>
<div class="line"><a name="l05204"></a><span class="lineno"> 5204</span>&#160;                                             <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = CSI-&gt;handler_end();</div>
<div class="line"><a name="l05205"></a><span class="lineno"> 5205</span>&#160;           <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l05206"></a><span class="lineno"> 5206</span>&#160;        <span class="keywordflow">if</span> (*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l05207"></a><span class="lineno"> 5207</span>&#160;          CSI-&gt;removeHandler(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l05208"></a><span class="lineno"> 5208</span>&#160;          --<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l05209"></a><span class="lineno"> 5209</span>&#160;          --<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>;</div>
<div class="line"><a name="l05210"></a><span class="lineno"> 5210</span>&#160;          Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05211"></a><span class="lineno"> 5211</span>&#160;        }</div>
<div class="line"><a name="l05212"></a><span class="lineno"> 5212</span>&#160;      }</div>
<div class="line"><a name="l05213"></a><span class="lineno"> 5213</span>&#160;      <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l05214"></a><span class="lineno"> 5214</span>&#160;        Updates.push_back({DominatorTree::Delete, Predecessor, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>});</div>
<div class="line"><a name="l05215"></a><span class="lineno"> 5215</span>&#160;      <span class="keywordflow">if</span> (CSI-&gt;getNumHandlers() == 0) {</div>
<div class="line"><a name="l05216"></a><span class="lineno"> 5216</span>&#160;        <span class="keywordflow">if</span> (CSI-&gt;hasUnwindDest()) {</div>
<div class="line"><a name="l05217"></a><span class="lineno"> 5217</span>&#160;          <span class="comment">// Redirect all predecessors of the block containing CatchSwitchInst</span></div>
<div class="line"><a name="l05218"></a><span class="lineno"> 5218</span>&#160;          <span class="comment">// to instead branch to the CatchSwitchInst&#39;s unwind destination.</span></div>
<div class="line"><a name="l05219"></a><span class="lineno"> 5219</span>&#160;          <span class="keywordflow">if</span> (DTU) {</div>
<div class="line"><a name="l05220"></a><span class="lineno"> 5220</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">auto</span> *PredecessorOfPredecessor : <a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(Predecessor)) {</div>
<div class="line"><a name="l05221"></a><span class="lineno"> 5221</span>&#160;              Updates.push_back({<a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">DominatorTree::Insert</a>,</div>
<div class="line"><a name="l05222"></a><span class="lineno"> 5222</span>&#160;                                 PredecessorOfPredecessor,</div>
<div class="line"><a name="l05223"></a><span class="lineno"> 5223</span>&#160;                                 CSI-&gt;getUnwindDest()});</div>
<div class="line"><a name="l05224"></a><span class="lineno"> 5224</span>&#160;              Updates.push_back({DominatorTree::Delete,</div>
<div class="line"><a name="l05225"></a><span class="lineno"> 5225</span>&#160;                                 PredecessorOfPredecessor, Predecessor});</div>
<div class="line"><a name="l05226"></a><span class="lineno"> 5226</span>&#160;            }</div>
<div class="line"><a name="l05227"></a><span class="lineno"> 5227</span>&#160;          }</div>
<div class="line"><a name="l05228"></a><span class="lineno"> 5228</span>&#160;          Predecessor-&gt;replaceAllUsesWith(CSI-&gt;getUnwindDest());</div>
<div class="line"><a name="l05229"></a><span class="lineno"> 5229</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05230"></a><span class="lineno"> 5230</span>&#160;          <span class="comment">// Rewrite all preds to unwind to caller (or from invoke to call).</span></div>
<div class="line"><a name="l05231"></a><span class="lineno"> 5231</span>&#160;          <span class="keywordflow">if</span> (DTU) {</div>
<div class="line"><a name="l05232"></a><span class="lineno"> 5232</span>&#160;            DTU-&gt;applyUpdates(Updates);</div>
<div class="line"><a name="l05233"></a><span class="lineno"> 5233</span>&#160;            Updates.clear();</div>
<div class="line"><a name="l05234"></a><span class="lineno"> 5234</span>&#160;          }</div>
<div class="line"><a name="l05235"></a><span class="lineno"> 5235</span>&#160;          <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock *, 8&gt;</a> EHPreds(<a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(Predecessor));</div>
<div class="line"><a name="l05236"></a><span class="lineno"> 5236</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *EHPred : EHPreds)</div>
<div class="line"><a name="l05237"></a><span class="lineno"> 5237</span>&#160;            <a class="code" href="namespacellvm.html#a83cbd0aa1465957c50eaea8374875b27">removeUnwindEdge</a>(EHPred, DTU);</div>
<div class="line"><a name="l05238"></a><span class="lineno"> 5238</span>&#160;        }</div>
<div class="line"><a name="l05239"></a><span class="lineno"> 5239</span>&#160;        <span class="comment">// The catchswitch is no longer reachable.</span></div>
<div class="line"><a name="l05240"></a><span class="lineno"> 5240</span>&#160;        <span class="keyword">new</span> <a class="code" href="classllvm_1_1UnreachableInst.html">UnreachableInst</a>(CSI-&gt;getContext(), CSI);</div>
<div class="line"><a name="l05241"></a><span class="lineno"> 5241</span>&#160;        CSI-&gt;eraseFromParent();</div>
<div class="line"><a name="l05242"></a><span class="lineno"> 5242</span>&#160;        Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05243"></a><span class="lineno"> 5243</span>&#160;      }</div>
<div class="line"><a name="l05244"></a><span class="lineno"> 5244</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *CRI = dyn_cast&lt;CleanupReturnInst&gt;(TI)) {</div>
<div class="line"><a name="l05245"></a><span class="lineno"> 5245</span>&#160;      (void)CRI;</div>
<div class="line"><a name="l05246"></a><span class="lineno"> 5246</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CRI-&gt;hasUnwindDest() &amp;&amp; CRI-&gt;getUnwindDest() == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> &amp;&amp;</div>
<div class="line"><a name="l05247"></a><span class="lineno"> 5247</span>&#160;             <span class="stringliteral">&quot;Expected to always have an unwind to BB.&quot;</span>);</div>
<div class="line"><a name="l05248"></a><span class="lineno"> 5248</span>&#160;      <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l05249"></a><span class="lineno"> 5249</span>&#160;        Updates.push_back({DominatorTree::Delete, Predecessor, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>});</div>
<div class="line"><a name="l05250"></a><span class="lineno"> 5250</span>&#160;      <span class="keyword">new</span> <a class="code" href="classllvm_1_1UnreachableInst.html">UnreachableInst</a>(TI-&gt;<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), TI);</div>
<div class="line"><a name="l05251"></a><span class="lineno"> 5251</span>&#160;      TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l05252"></a><span class="lineno"> 5252</span>&#160;      Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05253"></a><span class="lineno"> 5253</span>&#160;    }</div>
<div class="line"><a name="l05254"></a><span class="lineno"> 5254</span>&#160;  }</div>
<div class="line"><a name="l05255"></a><span class="lineno"> 5255</span>&#160; </div>
<div class="line"><a name="l05256"></a><span class="lineno"> 5256</span>&#160;  <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l05257"></a><span class="lineno"> 5257</span>&#160;    DTU-&gt;applyUpdates(Updates);</div>
<div class="line"><a name="l05258"></a><span class="lineno"> 5258</span>&#160; </div>
<div class="line"><a name="l05259"></a><span class="lineno"> 5259</span>&#160;  <span class="comment">// If this block is now dead, remove it.</span></div>
<div class="line"><a name="l05260"></a><span class="lineno"> 5260</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ad66c4759666aab78529658362b498c74">pred_empty</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) &amp;&amp; <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> != &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getParent()-&gt;getEntryBlock()) {</div>
<div class="line"><a name="l05261"></a><span class="lineno"> 5261</span>&#160;    <a class="code" href="namespacellvm.html#a458b4709ebedccb846a179f1e422265b">DeleteDeadBlock</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, DTU);</div>
<div class="line"><a name="l05262"></a><span class="lineno"> 5262</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05263"></a><span class="lineno"> 5263</span>&#160;  }</div>
<div class="line"><a name="l05264"></a><span class="lineno"> 5264</span>&#160; </div>
<div class="line"><a name="l05265"></a><span class="lineno"> 5265</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l05266"></a><span class="lineno"> 5266</span>&#160;}</div>
<div class="line"><a name="l05267"></a><span class="lineno"> 5267</span>&#160; </div>
<div class="line"><a name="l05268"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#ae157392aa0ecec324802dc03211c354d"> 5268</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#ae157392aa0ecec324802dc03211c354d">CasesAreContiguous</a>(<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;ConstantInt *&gt;</a> &amp;Cases) {</div>
<div class="line"><a name="l05269"></a><span class="lineno"> 5269</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Cases.size() &gt;= 1);</div>
<div class="line"><a name="l05270"></a><span class="lineno"> 5270</span>&#160; </div>
<div class="line"><a name="l05271"></a><span class="lineno"> 5271</span>&#160;  <a class="code" href="namespacellvm.html#add1eb5637dd671428b6f138ed3db6428">array_pod_sort</a>(Cases.begin(), Cases.end(), <a class="code" href="SimplifyCFG_8cpp.html#a8a7f7d7aa56a6449ae814f48b6a8ce6f">ConstantIntSortPredicate</a>);</div>
<div class="line"><a name="l05272"></a><span class="lineno"> 5272</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 1, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = Cases.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l05273"></a><span class="lineno"> 5273</span>&#160;    <span class="keywordflow">if</span> (Cases[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> - 1]-&gt;getValue() != Cases[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]-&gt;getValue() + 1)</div>
<div class="line"><a name="l05274"></a><span class="lineno"> 5274</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05275"></a><span class="lineno"> 5275</span>&#160;  }</div>
<div class="line"><a name="l05276"></a><span class="lineno"> 5276</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05277"></a><span class="lineno"> 5277</span>&#160;}</div>
<div class="line"><a name="l05278"></a><span class="lineno"> 5278</span>&#160; </div>
<div class="line"><a name="l05279"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a8ebee7bc3fcddb111c6a2e28918c6fd8"> 5279</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="SimplifyCFG_8cpp.html#a8ebee7bc3fcddb111c6a2e28918c6fd8">createUnreachableSwitchDefault</a>(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *Switch,</div>
<div class="line"><a name="l05280"></a><span class="lineno"> 5280</span>&#160;                                           <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> *DTU) {</div>
<div class="line"><a name="l05281"></a><span class="lineno"> 5281</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SimplifyCFG: switch default is dead.\n&quot;</span>);</div>
<div class="line"><a name="l05282"></a><span class="lineno"> 5282</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = Switch-&gt;getParent();</div>
<div class="line"><a name="l05283"></a><span class="lineno"> 5283</span>&#160;  <span class="keyword">auto</span> *OrigDefaultBlock = Switch-&gt;getDefaultDest();</div>
<div class="line"><a name="l05284"></a><span class="lineno"> 5284</span>&#160;  OrigDefaultBlock-&gt;removePredecessor(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l05285"></a><span class="lineno"> 5285</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *NewDefaultBlock = BasicBlock::Create(</div>
<div class="line"><a name="l05286"></a><span class="lineno"> 5286</span>&#160;      <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getContext(), <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getName() + <span class="stringliteral">&quot;.unreachabledefault&quot;</span>, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getParent(),</div>
<div class="line"><a name="l05287"></a><span class="lineno"> 5287</span>&#160;      OrigDefaultBlock);</div>
<div class="line"><a name="l05288"></a><span class="lineno"> 5288</span>&#160;  <span class="keyword">new</span> <a class="code" href="classllvm_1_1UnreachableInst.html">UnreachableInst</a>(Switch-&gt;getContext(), NewDefaultBlock);</div>
<div class="line"><a name="l05289"></a><span class="lineno"> 5289</span>&#160;  Switch-&gt;setDefaultDest(&amp;*NewDefaultBlock);</div>
<div class="line"><a name="l05290"></a><span class="lineno"> 5290</span>&#160;  <span class="keywordflow">if</span> (DTU) {</div>
<div class="line"><a name="l05291"></a><span class="lineno"> 5291</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;DominatorTree::UpdateType, 2&gt;</a> Updates;</div>
<div class="line"><a name="l05292"></a><span class="lineno"> 5292</span>&#160;    Updates.push_back({<a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">DominatorTree::Insert</a>, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, &amp;*NewDefaultBlock});</div>
<div class="line"><a name="l05293"></a><span class="lineno"> 5293</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">is_contained</a>(<a class="code" href="namespacellvm.html#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>), OrigDefaultBlock))</div>
<div class="line"><a name="l05294"></a><span class="lineno"> 5294</span>&#160;      Updates.push_back({DominatorTree::Delete, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, &amp;*OrigDefaultBlock});</div>
<div class="line"><a name="l05295"></a><span class="lineno"> 5295</span>&#160;    DTU-&gt;<a class="code" href="classllvm_1_1DomTreeUpdater.html#aae522cd1928cfac6850b50c7a3e22185">applyUpdates</a>(Updates);</div>
<div class="line"><a name="l05296"></a><span class="lineno"> 5296</span>&#160;  }</div>
<div class="line"><a name="l05297"></a><span class="lineno"> 5297</span>&#160;}</div>
<div class="line"><a name="l05298"></a><span class="lineno"> 5298</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l05299"></a><span class="lineno"> 5299</span>&#160;<span class="comment">/// Turn a switch into an integer range comparison and branch.</span></div>
<div class="line"><a name="l05300"></a><span class="lineno"> 5300</span>&#160;<span class="comment">/// Switches with more than 2 destinations are ignored.</span></div>
<div class="line"><a name="l05301"></a><span class="lineno"> 5301</span>&#160;<span class="comment">/// Switches with 1 destination are also ignored.</span></div>
<div class="line"><a name="l05302"></a><span class="lineno"> 5302</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> SimplifyCFGOpt::TurnSwitchRangeIntoICmp(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>,</div>
<div class="line"><a name="l05303"></a><span class="lineno"> 5303</span>&#160;                                             <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>) {</div>
<div class="line"><a name="l05304"></a><span class="lineno"> 5304</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getNumCases() &gt; 1 &amp;&amp; <span class="stringliteral">&quot;Degenerate switch?&quot;</span>);</div>
<div class="line"><a name="l05305"></a><span class="lineno"> 5305</span>&#160; </div>
<div class="line"><a name="l05306"></a><span class="lineno"> 5306</span>&#160;  <span class="keywordtype">bool</span> HasDefault =</div>
<div class="line"><a name="l05307"></a><span class="lineno"> 5307</span>&#160;      !isa&lt;UnreachableInst&gt;(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDefaultDest()-&gt;getFirstNonPHIOrDbg());</div>
<div class="line"><a name="l05308"></a><span class="lineno"> 5308</span>&#160; </div>
<div class="line"><a name="l05309"></a><span class="lineno"> 5309</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getParent();</div>
<div class="line"><a name="l05310"></a><span class="lineno"> 5310</span>&#160; </div>
<div class="line"><a name="l05311"></a><span class="lineno"> 5311</span>&#160;  <span class="comment">// Partition the cases into two sets with different destinations.</span></div>
<div class="line"><a name="l05312"></a><span class="lineno"> 5312</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *DestA = HasDefault ? <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDefaultDest() : <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05313"></a><span class="lineno"> 5313</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *DestB = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05314"></a><span class="lineno"> 5314</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;ConstantInt *, 16&gt;</a> CasesA;</div>
<div class="line"><a name="l05315"></a><span class="lineno"> 5315</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;ConstantInt *, 16&gt;</a> CasesB;</div>
<div class="line"><a name="l05316"></a><span class="lineno"> 5316</span>&#160; </div>
<div class="line"><a name="l05317"></a><span class="lineno"> 5317</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> Case : <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;cases()) {</div>
<div class="line"><a name="l05318"></a><span class="lineno"> 5318</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Dest = Case.getCaseSuccessor();</div>
<div class="line"><a name="l05319"></a><span class="lineno"> 5319</span>&#160;    <span class="keywordflow">if</span> (!DestA)</div>
<div class="line"><a name="l05320"></a><span class="lineno"> 5320</span>&#160;      DestA = Dest;</div>
<div class="line"><a name="l05321"></a><span class="lineno"> 5321</span>&#160;    <span class="keywordflow">if</span> (Dest == DestA) {</div>
<div class="line"><a name="l05322"></a><span class="lineno"> 5322</span>&#160;      CasesA.push_back(Case.getCaseValue());</div>
<div class="line"><a name="l05323"></a><span class="lineno"> 5323</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05324"></a><span class="lineno"> 5324</span>&#160;    }</div>
<div class="line"><a name="l05325"></a><span class="lineno"> 5325</span>&#160;    <span class="keywordflow">if</span> (!DestB)</div>
<div class="line"><a name="l05326"></a><span class="lineno"> 5326</span>&#160;      DestB = Dest;</div>
<div class="line"><a name="l05327"></a><span class="lineno"> 5327</span>&#160;    <span class="keywordflow">if</span> (Dest == DestB) {</div>
<div class="line"><a name="l05328"></a><span class="lineno"> 5328</span>&#160;      CasesB.push_back(Case.getCaseValue());</div>
<div class="line"><a name="l05329"></a><span class="lineno"> 5329</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05330"></a><span class="lineno"> 5330</span>&#160;    }</div>
<div class="line"><a name="l05331"></a><span class="lineno"> 5331</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// More than two destinations.</span></div>
<div class="line"><a name="l05332"></a><span class="lineno"> 5332</span>&#160;  }</div>
<div class="line"><a name="l05333"></a><span class="lineno"> 5333</span>&#160;  <span class="keywordflow">if</span> (!DestB)</div>
<div class="line"><a name="l05334"></a><span class="lineno"> 5334</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// All destinations are the same and the default is unreachable</span></div>
<div class="line"><a name="l05335"></a><span class="lineno"> 5335</span>&#160; </div>
<div class="line"><a name="l05336"></a><span class="lineno"> 5336</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DestA &amp;&amp; DestB &amp;&amp;</div>
<div class="line"><a name="l05337"></a><span class="lineno"> 5337</span>&#160;         <span class="stringliteral">&quot;Single-destination switch should have been folded.&quot;</span>);</div>
<div class="line"><a name="l05338"></a><span class="lineno"> 5338</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DestA != DestB);</div>
<div class="line"><a name="l05339"></a><span class="lineno"> 5339</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DestB != <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDefaultDest());</div>
<div class="line"><a name="l05340"></a><span class="lineno"> 5340</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!CasesB.empty() &amp;&amp; <span class="stringliteral">&quot;There must be non-default cases.&quot;</span>);</div>
<div class="line"><a name="l05341"></a><span class="lineno"> 5341</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!CasesA.empty() || HasDefault);</div>
<div class="line"><a name="l05342"></a><span class="lineno"> 5342</span>&#160; </div>
<div class="line"><a name="l05343"></a><span class="lineno"> 5343</span>&#160;  <span class="comment">// Figure out if one of the sets of cases form a contiguous range.</span></div>
<div class="line"><a name="l05344"></a><span class="lineno"> 5344</span>&#160;  <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;ConstantInt *&gt;</a> *ContiguousCases = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05345"></a><span class="lineno"> 5345</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *ContiguousDest = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05346"></a><span class="lineno"> 5346</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *OtherDest = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05347"></a><span class="lineno"> 5347</span>&#160;  <span class="keywordflow">if</span> (!CasesA.empty() &amp;&amp; <a class="code" href="SimplifyCFG_8cpp.html#ae157392aa0ecec324802dc03211c354d">CasesAreContiguous</a>(CasesA)) {</div>
<div class="line"><a name="l05348"></a><span class="lineno"> 5348</span>&#160;    ContiguousCases = &amp;CasesA;</div>
<div class="line"><a name="l05349"></a><span class="lineno"> 5349</span>&#160;    ContiguousDest = DestA;</div>
<div class="line"><a name="l05350"></a><span class="lineno"> 5350</span>&#160;    OtherDest = DestB;</div>
<div class="line"><a name="l05351"></a><span class="lineno"> 5351</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#ae157392aa0ecec324802dc03211c354d">CasesAreContiguous</a>(CasesB)) {</div>
<div class="line"><a name="l05352"></a><span class="lineno"> 5352</span>&#160;    ContiguousCases = &amp;CasesB;</div>
<div class="line"><a name="l05353"></a><span class="lineno"> 5353</span>&#160;    ContiguousDest = DestB;</div>
<div class="line"><a name="l05354"></a><span class="lineno"> 5354</span>&#160;    OtherDest = DestA;</div>
<div class="line"><a name="l05355"></a><span class="lineno"> 5355</span>&#160;  } <span class="keywordflow">else</span></div>
<div class="line"><a name="l05356"></a><span class="lineno"> 5356</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05357"></a><span class="lineno"> 5357</span>&#160; </div>
<div class="line"><a name="l05358"></a><span class="lineno"> 5358</span>&#160;  <span class="comment">// Start building the compare and branch.</span></div>
<div class="line"><a name="l05359"></a><span class="lineno"> 5359</span>&#160; </div>
<div class="line"><a name="l05360"></a><span class="lineno"> 5360</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="ELFObjHandler_8cpp.html#a250e66aa31a03567cc345ca1bc463b8c">Offset</a> = ConstantExpr::getNeg(ContiguousCases-&gt;back());</div>
<div class="line"><a name="l05361"></a><span class="lineno"> 5361</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *NumCases =</div>
<div class="line"><a name="l05362"></a><span class="lineno"> 5362</span>&#160;      <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(<a class="code" href="ELFObjHandler_8cpp.html#a250e66aa31a03567cc345ca1bc463b8c">Offset</a>-&gt;getType(), ContiguousCases-&gt;size());</div>
<div class="line"><a name="l05363"></a><span class="lineno"> 5363</span>&#160; </div>
<div class="line"><a name="l05364"></a><span class="lineno"> 5364</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Sub = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition();</div>
<div class="line"><a name="l05365"></a><span class="lineno"> 5365</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="ELFObjHandler_8cpp.html#a250e66aa31a03567cc345ca1bc463b8c">Offset</a>-&gt;isNullValue())</div>
<div class="line"><a name="l05366"></a><span class="lineno"> 5366</span>&#160;    Sub = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAdd(Sub, <a class="code" href="ELFObjHandler_8cpp.html#a250e66aa31a03567cc345ca1bc463b8c">Offset</a>, Sub-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + <span class="stringliteral">&quot;.off&quot;</span>);</div>
<div class="line"><a name="l05367"></a><span class="lineno"> 5367</span>&#160; </div>
<div class="line"><a name="l05368"></a><span class="lineno"> 5368</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>;</div>
<div class="line"><a name="l05369"></a><span class="lineno"> 5369</span>&#160;  <span class="comment">// If NumCases overflowed, then all possible values jump to the successor.</span></div>
<div class="line"><a name="l05370"></a><span class="lineno"> 5370</span>&#160;  <span class="keywordflow">if</span> (NumCases-&gt;<a class="code" href="classllvm_1_1Constant.html#ae4b6abe77abf42fb02081a6cc41a0132">isNullValue</a>() &amp;&amp; !ContiguousCases-&gt;empty())</div>
<div class="line"><a name="l05371"></a><span class="lineno"> 5371</span>&#160;    <a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a> = <a class="code" href="InstructionSimplify_8cpp.html#a565dd825f238fa0a8c4bbfe562635f7c">ConstantInt::getTrue</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getContext());</div>
<div class="line"><a name="l05372"></a><span class="lineno"> 5372</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l05373"></a><span class="lineno"> 5373</span>&#160;    <a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateICmpULT(Sub, NumCases, <span class="stringliteral">&quot;switch&quot;</span>);</div>
<div class="line"><a name="l05374"></a><span class="lineno"> 5374</span>&#160;  <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *NewBI = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCondBr(Cmp, ContiguousDest, OtherDest);</div>
<div class="line"><a name="l05375"></a><span class="lineno"> 5375</span>&#160; </div>
<div class="line"><a name="l05376"></a><span class="lineno"> 5376</span>&#160;  <span class="comment">// Update weight for the newly-created conditional branch.</span></div>
<div class="line"><a name="l05377"></a><span class="lineno"> 5377</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#add2fce2ce0e32b20e41b0aa9f8ca70c2">hasBranchWeightMD</a>(*<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>)) {</div>
<div class="line"><a name="l05378"></a><span class="lineno"> 5378</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint64_t, 8&gt;</a> Weights;</div>
<div class="line"><a name="l05379"></a><span class="lineno"> 5379</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#a23f9dbda493b589bf024813b2c7e8c41">GetBranchWeights</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, Weights);</div>
<div class="line"><a name="l05380"></a><span class="lineno"> 5380</span>&#160;    <span class="keywordflow">if</span> (Weights.size() == 1 + <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getNumCases()) {</div>
<div class="line"><a name="l05381"></a><span class="lineno"> 5381</span>&#160;      <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> TrueWeight = 0;</div>
<div class="line"><a name="l05382"></a><span class="lineno"> 5382</span>&#160;      <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> FalseWeight = 0;</div>
<div class="line"><a name="l05383"></a><span class="lineno"> 5383</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = Weights.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l05384"></a><span class="lineno"> 5384</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getSuccessor(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) == ContiguousDest)</div>
<div class="line"><a name="l05385"></a><span class="lineno"> 5385</span>&#160;          TrueWeight += Weights[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l05386"></a><span class="lineno"> 5386</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l05387"></a><span class="lineno"> 5387</span>&#160;          FalseWeight += Weights[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l05388"></a><span class="lineno"> 5388</span>&#160;      }</div>
<div class="line"><a name="l05389"></a><span class="lineno"> 5389</span>&#160;      <span class="keywordflow">while</span> (TrueWeight &gt; UINT32_MAX || FalseWeight &gt; UINT32_MAX) {</div>
<div class="line"><a name="l05390"></a><span class="lineno"> 5390</span>&#160;        TrueWeight /= 2;</div>
<div class="line"><a name="l05391"></a><span class="lineno"> 5391</span>&#160;        FalseWeight /= 2;</div>
<div class="line"><a name="l05392"></a><span class="lineno"> 5392</span>&#160;      }</div>
<div class="line"><a name="l05393"></a><span class="lineno"> 5393</span>&#160;      <a class="code" href="SimplifyCFG_8cpp.html#a4953dfe289f5d9ad59a7964c4c63c2a9">setBranchWeights</a>(NewBI, TrueWeight, FalseWeight);</div>
<div class="line"><a name="l05394"></a><span class="lineno"> 5394</span>&#160;    }</div>
<div class="line"><a name="l05395"></a><span class="lineno"> 5395</span>&#160;  }</div>
<div class="line"><a name="l05396"></a><span class="lineno"> 5396</span>&#160; </div>
<div class="line"><a name="l05397"></a><span class="lineno"> 5397</span>&#160;  <span class="comment">// Prune obsolete incoming values off the successors&#39; PHI nodes.</span></div>
<div class="line"><a name="l05398"></a><span class="lineno"> 5398</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> BBI = ContiguousDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); isa&lt;PHINode&gt;(BBI); ++BBI) {</div>
<div class="line"><a name="l05399"></a><span class="lineno"> 5399</span>&#160;    <span class="keywordtype">unsigned</span> PreviousEdges = ContiguousCases-&gt;size();</div>
<div class="line"><a name="l05400"></a><span class="lineno"> 5400</span>&#160;    <span class="keywordflow">if</span> (ContiguousDest == <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDefaultDest())</div>
<div class="line"><a name="l05401"></a><span class="lineno"> 5401</span>&#160;      ++PreviousEdges;</div>
<div class="line"><a name="l05402"></a><span class="lineno"> 5402</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = PreviousEdges - 1; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l05403"></a><span class="lineno"> 5403</span>&#160;      cast&lt;PHINode&gt;(BBI)-&gt;removeIncomingValue(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getParent());</div>
<div class="line"><a name="l05404"></a><span class="lineno"> 5404</span>&#160;  }</div>
<div class="line"><a name="l05405"></a><span class="lineno"> 5405</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> BBI = OtherDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); isa&lt;PHINode&gt;(BBI); ++BBI) {</div>
<div class="line"><a name="l05406"></a><span class="lineno"> 5406</span>&#160;    <span class="keywordtype">unsigned</span> PreviousEdges = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getNumCases() - ContiguousCases-&gt;size();</div>
<div class="line"><a name="l05407"></a><span class="lineno"> 5407</span>&#160;    <span class="keywordflow">if</span> (OtherDest == <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDefaultDest())</div>
<div class="line"><a name="l05408"></a><span class="lineno"> 5408</span>&#160;      ++PreviousEdges;</div>
<div class="line"><a name="l05409"></a><span class="lineno"> 5409</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = PreviousEdges - 1; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l05410"></a><span class="lineno"> 5410</span>&#160;      cast&lt;PHINode&gt;(BBI)-&gt;removeIncomingValue(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getParent());</div>
<div class="line"><a name="l05411"></a><span class="lineno"> 5411</span>&#160;  }</div>
<div class="line"><a name="l05412"></a><span class="lineno"> 5412</span>&#160; </div>
<div class="line"><a name="l05413"></a><span class="lineno"> 5413</span>&#160;  <span class="comment">// Clean up the default block - it may have phis or other instructions before</span></div>
<div class="line"><a name="l05414"></a><span class="lineno"> 5414</span>&#160;  <span class="comment">// the unreachable terminator.</span></div>
<div class="line"><a name="l05415"></a><span class="lineno"> 5415</span>&#160;  <span class="keywordflow">if</span> (!HasDefault)</div>
<div class="line"><a name="l05416"></a><span class="lineno"> 5416</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#a8ebee7bc3fcddb111c6a2e28918c6fd8">createUnreachableSwitchDefault</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, DTU);</div>
<div class="line"><a name="l05417"></a><span class="lineno"> 5417</span>&#160; </div>
<div class="line"><a name="l05418"></a><span class="lineno"> 5418</span>&#160;  <span class="keyword">auto</span> *UnreachableDefault = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDefaultDest();</div>
<div class="line"><a name="l05419"></a><span class="lineno"> 5419</span>&#160; </div>
<div class="line"><a name="l05420"></a><span class="lineno"> 5420</span>&#160;  <span class="comment">// Drop the switch.</span></div>
<div class="line"><a name="l05421"></a><span class="lineno"> 5421</span>&#160;  <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l05422"></a><span class="lineno"> 5422</span>&#160; </div>
<div class="line"><a name="l05423"></a><span class="lineno"> 5423</span>&#160;  <span class="keywordflow">if</span> (!HasDefault &amp;&amp; DTU)</div>
<div class="line"><a name="l05424"></a><span class="lineno"> 5424</span>&#160;    DTU-&gt;applyUpdates({{DominatorTree::Delete, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, UnreachableDefault}});</div>
<div class="line"><a name="l05425"></a><span class="lineno"> 5425</span>&#160; </div>
<div class="line"><a name="l05426"></a><span class="lineno"> 5426</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05427"></a><span class="lineno"> 5427</span>&#160;}</div>
<div class="line"><a name="l05428"></a><span class="lineno"> 5428</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l05429"></a><span class="lineno"> 5429</span>&#160;<span class="comment">/// Compute masked bits for the condition of a switch</span></div>
<div class="line"><a name="l05430"></a><span class="lineno"> 5430</span>&#160;<span class="comment">/// and use it to remove dead cases.</span></div>
<div class="line"><a name="l05431"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a83b0a34d940365e97b9a531c1f13f3b9"> 5431</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a83b0a34d940365e97b9a531c1f13f3b9">eliminateDeadSwitchCases</a>(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> *DTU,</div>
<div class="line"><a name="l05432"></a><span class="lineno"> 5432</span>&#160;                                     <a class="code" href="classllvm_1_1AssumptionCache.html">AssumptionCache</a> *AC,</div>
<div class="line"><a name="l05433"></a><span class="lineno"> 5433</span>&#160;                                     <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>) {</div>
<div class="line"><a name="l05434"></a><span class="lineno"> 5434</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a> = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition();</div>
<div class="line"><a name="l05435"></a><span class="lineno"> 5435</span>&#160;  <a class="code" href="structllvm_1_1KnownBits.html">KnownBits</a> Known = <a class="code" href="namespacellvm.html#aa1f8f0633edd8b9a1c5ec15bb9fc5640">computeKnownBits</a>(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, 0, AC, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l05436"></a><span class="lineno"> 5436</span>&#160; </div>
<div class="line"><a name="l05437"></a><span class="lineno"> 5437</span>&#160;  <span class="comment">// We can also eliminate cases by determining that their values are outside of</span></div>
<div class="line"><a name="l05438"></a><span class="lineno"> 5438</span>&#160;  <span class="comment">// the limited range of the condition based on how many significant (non-sign)</span></div>
<div class="line"><a name="l05439"></a><span class="lineno"> 5439</span>&#160;  <span class="comment">// bits are in the condition value.</span></div>
<div class="line"><a name="l05440"></a><span class="lineno"> 5440</span>&#160;  <span class="keywordtype">unsigned</span> MaxSignificantBitsInCond =</div>
<div class="line"><a name="l05441"></a><span class="lineno"> 5441</span>&#160;      <a class="code" href="namespacellvm.html#ae95177e7337984f5bc961723ecf67169">ComputeMaxSignificantBits</a>(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, 0, AC, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l05442"></a><span class="lineno"> 5442</span>&#160; </div>
<div class="line"><a name="l05443"></a><span class="lineno"> 5443</span>&#160;  <span class="comment">// Gather dead cases.</span></div>
<div class="line"><a name="l05444"></a><span class="lineno"> 5444</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;ConstantInt *, 8&gt;</a> DeadCases;</div>
<div class="line"><a name="l05445"></a><span class="lineno"> 5445</span>&#160;  <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;BasicBlock *, int, 8&gt;</a> NumPerSuccessorCases;</div>
<div class="line"><a name="l05446"></a><span class="lineno"> 5446</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock *, 8&gt;</a> UniqueSuccessors;</div>
<div class="line"><a name="l05447"></a><span class="lineno"> 5447</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;Case : <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;cases()) {</div>
<div class="line"><a name="l05448"></a><span class="lineno"> 5448</span>&#160;    <span class="keyword">auto</span> *<a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a> = Case.getCaseSuccessor();</div>
<div class="line"><a name="l05449"></a><span class="lineno"> 5449</span>&#160;    <span class="keywordflow">if</span> (DTU) {</div>
<div class="line"><a name="l05450"></a><span class="lineno"> 5450</span>&#160;      <span class="keywordflow">if</span> (!NumPerSuccessorCases.<a class="code" href="classllvm_1_1DenseMapBase.html#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(<a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a>))</div>
<div class="line"><a name="l05451"></a><span class="lineno"> 5451</span>&#160;        UniqueSuccessors.push_back(<a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a>);</div>
<div class="line"><a name="l05452"></a><span class="lineno"> 5452</span>&#160;      ++NumPerSuccessorCases[<a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a>];</div>
<div class="line"><a name="l05453"></a><span class="lineno"> 5453</span>&#160;    }</div>
<div class="line"><a name="l05454"></a><span class="lineno"> 5454</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;CaseVal = Case.getCaseValue()-&gt;getValue();</div>
<div class="line"><a name="l05455"></a><span class="lineno"> 5455</span>&#160;    <span class="keywordflow">if</span> (Known.<a class="code" href="structllvm_1_1KnownBits.html#ac67bca6c764da76f5e152330d92ed916">Zero</a>.<a class="code" href="classllvm_1_1APInt.html#a6da514c588b2668280a861a59bfc9fa5">intersects</a>(CaseVal) || !Known.<a class="code" href="structllvm_1_1KnownBits.html#aba205f553f24c184ea47fc1a6cb56537">One</a>.<a class="code" href="classllvm_1_1APInt.html#acfae9bdee6027ffa8ffe244cc22e3a76">isSubsetOf</a>(CaseVal) ||</div>
<div class="line"><a name="l05456"></a><span class="lineno"> 5456</span>&#160;        (CaseVal.<a class="code" href="classllvm_1_1APInt.html#a1c9300bfa022ac28948bd4336376e3c1">getMinSignedBits</a>() &gt; MaxSignificantBitsInCond)) {</div>
<div class="line"><a name="l05457"></a><span class="lineno"> 5457</span>&#160;      DeadCases.push_back(Case.getCaseValue());</div>
<div class="line"><a name="l05458"></a><span class="lineno"> 5458</span>&#160;      <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l05459"></a><span class="lineno"> 5459</span>&#160;        --NumPerSuccessorCases[<a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a>];</div>
<div class="line"><a name="l05460"></a><span class="lineno"> 5460</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SimplifyCFG: switch case &quot;</span> &lt;&lt; CaseVal</div>
<div class="line"><a name="l05461"></a><span class="lineno"> 5461</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot; is dead.\n&quot;</span>);</div>
<div class="line"><a name="l05462"></a><span class="lineno"> 5462</span>&#160;    }</div>
<div class="line"><a name="l05463"></a><span class="lineno"> 5463</span>&#160;  }</div>
<div class="line"><a name="l05464"></a><span class="lineno"> 5464</span>&#160; </div>
<div class="line"><a name="l05465"></a><span class="lineno"> 5465</span>&#160;  <span class="comment">// If we can prove that the cases must cover all possible values, the</span></div>
<div class="line"><a name="l05466"></a><span class="lineno"> 5466</span>&#160;  <span class="comment">// default destination becomes dead and we can remove it.  If we know some</span></div>
<div class="line"><a name="l05467"></a><span class="lineno"> 5467</span>&#160;  <span class="comment">// of the bits in the value, we can use that to more precisely compute the</span></div>
<div class="line"><a name="l05468"></a><span class="lineno"> 5468</span>&#160;  <span class="comment">// number of possible unique case values.</span></div>
<div class="line"><a name="l05469"></a><span class="lineno"> 5469</span>&#160;  <span class="keywordtype">bool</span> HasDefault =</div>
<div class="line"><a name="l05470"></a><span class="lineno"> 5470</span>&#160;      !isa&lt;UnreachableInst&gt;(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDefaultDest()-&gt;getFirstNonPHIOrDbg());</div>
<div class="line"><a name="l05471"></a><span class="lineno"> 5471</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> NumUnknownBits =</div>
<div class="line"><a name="l05472"></a><span class="lineno"> 5472</span>&#160;      Known.<a class="code" href="structllvm_1_1KnownBits.html#a4fdc09049a61f952b5d52788dbd2f69b">getBitWidth</a>() - (Known.<a class="code" href="structllvm_1_1KnownBits.html#ac67bca6c764da76f5e152330d92ed916">Zero</a> | Known.<a class="code" href="structllvm_1_1KnownBits.html#aba205f553f24c184ea47fc1a6cb56537">One</a>).<a class="code" href="namespacellvm.html#a99e12a4a954a95d45f52950d13a43fc6">countPopulation</a>();</div>
<div class="line"><a name="l05473"></a><span class="lineno"> 5473</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NumUnknownBits &lt;= Known.<a class="code" href="structllvm_1_1KnownBits.html#a4fdc09049a61f952b5d52788dbd2f69b">getBitWidth</a>());</div>
<div class="line"><a name="l05474"></a><span class="lineno"> 5474</span>&#160;  <span class="keywordflow">if</span> (HasDefault &amp;&amp; DeadCases.empty() &amp;&amp;</div>
<div class="line"><a name="l05475"></a><span class="lineno"> 5475</span>&#160;      NumUnknownBits &lt; 64 <span class="comment">/* avoid overflow */</span> &amp;&amp;</div>
<div class="line"><a name="l05476"></a><span class="lineno"> 5476</span>&#160;      <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getNumCases() == (1ULL &lt;&lt; NumUnknownBits)) {</div>
<div class="line"><a name="l05477"></a><span class="lineno"> 5477</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#a8ebee7bc3fcddb111c6a2e28918c6fd8">createUnreachableSwitchDefault</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, DTU);</div>
<div class="line"><a name="l05478"></a><span class="lineno"> 5478</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05479"></a><span class="lineno"> 5479</span>&#160;  }</div>
<div class="line"><a name="l05480"></a><span class="lineno"> 5480</span>&#160; </div>
<div class="line"><a name="l05481"></a><span class="lineno"> 5481</span>&#160;  <span class="keywordflow">if</span> (DeadCases.empty())</div>
<div class="line"><a name="l05482"></a><span class="lineno"> 5482</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05483"></a><span class="lineno"> 5483</span>&#160; </div>
<div class="line"><a name="l05484"></a><span class="lineno"> 5484</span>&#160;  <a class="code" href="classllvm_1_1SwitchInstProfUpdateWrapper.html">SwitchInstProfUpdateWrapper</a> SIW(*<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l05485"></a><span class="lineno"> 5485</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *DeadCase : DeadCases) {</div>
<div class="line"><a name="l05486"></a><span class="lineno"> 5486</span>&#160;    <a class="code" href="classllvm_1_1SwitchInst_1_1CaseIteratorImpl.html">SwitchInst::CaseIt</a> CaseI = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;findCaseValue(DeadCase);</div>
<div class="line"><a name="l05487"></a><span class="lineno"> 5487</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CaseI != <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;case_default() &amp;&amp;</div>
<div class="line"><a name="l05488"></a><span class="lineno"> 5488</span>&#160;           <span class="stringliteral">&quot;Case was not found. Probably mistake in DeadCases forming.&quot;</span>);</div>
<div class="line"><a name="l05489"></a><span class="lineno"> 5489</span>&#160;    <span class="comment">// Prune unused values from PHI nodes.</span></div>
<div class="line"><a name="l05490"></a><span class="lineno"> 5490</span>&#160;    CaseI-&gt;getCaseSuccessor()-&gt;removePredecessor(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getParent());</div>
<div class="line"><a name="l05491"></a><span class="lineno"> 5491</span>&#160;    SIW.<a class="code" href="classllvm_1_1SwitchInstProfUpdateWrapper.html#adf90515665080eadf537aff00bbf0594">removeCase</a>(CaseI);</div>
<div class="line"><a name="l05492"></a><span class="lineno"> 5492</span>&#160;  }</div>
<div class="line"><a name="l05493"></a><span class="lineno"> 5493</span>&#160; </div>
<div class="line"><a name="l05494"></a><span class="lineno"> 5494</span>&#160;  <span class="keywordflow">if</span> (DTU) {</div>
<div class="line"><a name="l05495"></a><span class="lineno"> 5495</span>&#160;    std::vector&lt;DominatorTree::UpdateType&gt; Updates;</div>
<div class="line"><a name="l05496"></a><span class="lineno"> 5496</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a> : UniqueSuccessors)</div>
<div class="line"><a name="l05497"></a><span class="lineno"> 5497</span>&#160;      <span class="keywordflow">if</span> (NumPerSuccessorCases[<a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a>] == 0)</div>
<div class="line"><a name="l05498"></a><span class="lineno"> 5498</span>&#160;        Updates.push_back({DominatorTree::Delete, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getParent(), <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a>});</div>
<div class="line"><a name="l05499"></a><span class="lineno"> 5499</span>&#160;    DTU-&gt;<a class="code" href="classllvm_1_1DomTreeUpdater.html#aae522cd1928cfac6850b50c7a3e22185">applyUpdates</a>(Updates);</div>
<div class="line"><a name="l05500"></a><span class="lineno"> 5500</span>&#160;  }</div>
<div class="line"><a name="l05501"></a><span class="lineno"> 5501</span>&#160; </div>
<div class="line"><a name="l05502"></a><span class="lineno"> 5502</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05503"></a><span class="lineno"> 5503</span>&#160;}</div>
<div class="line"><a name="l05504"></a><span class="lineno"> 5504</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l05505"></a><span class="lineno"> 5505</span>&#160;<span class="comment">/// If BB would be eligible for simplification by</span></div>
<div class="line"><a name="l05506"></a><span class="lineno"> 5506</span>&#160;<span class="comment">/// TryToSimplifyUncondBranchFromEmptyBlock (i.e. it is empty and terminated</span></div>
<div class="line"><a name="l05507"></a><span class="lineno"> 5507</span>&#160;<span class="comment">/// by an unconditional branch), look at the phi node for BB in the successor</span></div>
<div class="line"><a name="l05508"></a><span class="lineno"> 5508</span>&#160;<span class="comment">/// block and see if the incoming value is equal to CaseValue. If so, return</span></div>
<div class="line"><a name="l05509"></a><span class="lineno"> 5509</span>&#160;<span class="comment">/// the phi node, and set PhiIndex to BB&#39;s index in the phi node.</span></div>
<div class="line"><a name="l05510"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a3a785324436b8d2862b09f5fd8d1c061"> 5510</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="SimplifyCFG_8cpp.html#a3a785324436b8d2862b09f5fd8d1c061">FindPHIForConditionForwarding</a>(<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CaseValue,</div>
<div class="line"><a name="l05511"></a><span class="lineno"> 5511</span>&#160;                                              <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <span class="keywordtype">int</span> *PhiIndex) {</div>
<div class="line"><a name="l05512"></a><span class="lineno"> 5512</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getFirstNonPHIOrDbg() != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getTerminator())</div>
<div class="line"><a name="l05513"></a><span class="lineno"> 5513</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>; <span class="comment">// BB must be empty to be a candidate for simplification.</span></div>
<div class="line"><a name="l05514"></a><span class="lineno"> 5514</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getSinglePredecessor())</div>
<div class="line"><a name="l05515"></a><span class="lineno"> 5515</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>; <span class="comment">// BB must be dominated by the switch.</span></div>
<div class="line"><a name="l05516"></a><span class="lineno"> 5516</span>&#160; </div>
<div class="line"><a name="l05517"></a><span class="lineno"> 5517</span>&#160;  <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a> = dyn_cast&lt;BranchInst&gt;(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getTerminator());</div>
<div class="line"><a name="l05518"></a><span class="lineno"> 5518</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a> || !<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a>-&gt;isUnconditional())</div>
<div class="line"><a name="l05519"></a><span class="lineno"> 5519</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>; <span class="comment">// Terminator must be unconditional branch.</span></div>
<div class="line"><a name="l05520"></a><span class="lineno"> 5520</span>&#160; </div>
<div class="line"><a name="l05521"></a><span class="lineno"> 5521</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ = <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a>-&gt;getSuccessor(0);</div>
<div class="line"><a name="l05522"></a><span class="lineno"> 5522</span>&#160; </div>
<div class="line"><a name="l05523"></a><span class="lineno"> 5523</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> &amp;<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> : Succ-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a72516971c5734dc0f7546e64affca425">phis</a>()) {</div>
<div class="line"><a name="l05524"></a><span class="lineno"> 5524</span>&#160;    <span class="keywordtype">int</span> Idx = <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getBasicBlockIndex(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l05525"></a><span class="lineno"> 5525</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Idx &gt;= 0 &amp;&amp; <span class="stringliteral">&quot;PHI has no entry for predecessor?&quot;</span>);</div>
<div class="line"><a name="l05526"></a><span class="lineno"> 5526</span>&#160; </div>
<div class="line"><a name="l05527"></a><span class="lineno"> 5527</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *InValue = <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getIncomingValue(Idx);</div>
<div class="line"><a name="l05528"></a><span class="lineno"> 5528</span>&#160;    <span class="keywordflow">if</span> (InValue != CaseValue)</div>
<div class="line"><a name="l05529"></a><span class="lineno"> 5529</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05530"></a><span class="lineno"> 5530</span>&#160; </div>
<div class="line"><a name="l05531"></a><span class="lineno"> 5531</span>&#160;    *PhiIndex = Idx;</div>
<div class="line"><a name="l05532"></a><span class="lineno"> 5532</span>&#160;    <span class="keywordflow">return</span> &amp;<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>;</div>
<div class="line"><a name="l05533"></a><span class="lineno"> 5533</span>&#160;  }</div>
<div class="line"><a name="l05534"></a><span class="lineno"> 5534</span>&#160; </div>
<div class="line"><a name="l05535"></a><span class="lineno"> 5535</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05536"></a><span class="lineno"> 5536</span>&#160;}</div>
<div class="line"><a name="l05537"></a><span class="lineno"> 5537</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l05538"></a><span class="lineno"> 5538</span>&#160;<span class="comment">/// Try to forward the condition of a switch instruction to a phi node</span></div>
<div class="line"><a name="l05539"></a><span class="lineno"> 5539</span>&#160;<span class="comment">/// dominated by the switch, if that would mean that some of the destination</span></div>
<div class="line"><a name="l05540"></a><span class="lineno"> 5540</span>&#160;<span class="comment">/// blocks of the switch can be folded away. Return true if a change is made.</span></div>
<div class="line"><a name="l05541"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a819fe08329be34252ffde1e710574a34"> 5541</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a819fe08329be34252ffde1e710574a34">ForwardSwitchConditionToPHI</a>(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>) {</div>
<div class="line"><a name="l05542"></a><span class="lineno"> 5542</span>&#160;  <span class="keyword">using</span> ForwardingNodesMap = <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;PHINode *, SmallVector&lt;int, 4&gt;</a>&gt;;</div>
<div class="line"><a name="l05543"></a><span class="lineno"> 5543</span>&#160; </div>
<div class="line"><a name="l05544"></a><span class="lineno"> 5544</span>&#160;  ForwardingNodesMap ForwardingNodes;</div>
<div class="line"><a name="l05545"></a><span class="lineno"> 5545</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *SwitchBlock = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getParent();</div>
<div class="line"><a name="l05546"></a><span class="lineno"> 5546</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05547"></a><span class="lineno"> 5547</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;Case : <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;cases()) {</div>
<div class="line"><a name="l05548"></a><span class="lineno"> 5548</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CaseValue = Case.getCaseValue();</div>
<div class="line"><a name="l05549"></a><span class="lineno"> 5549</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *CaseDest = Case.getCaseSuccessor();</div>
<div class="line"><a name="l05550"></a><span class="lineno"> 5550</span>&#160; </div>
<div class="line"><a name="l05551"></a><span class="lineno"> 5551</span>&#160;    <span class="comment">// Replace phi operands in successor blocks that are using the constant case</span></div>
<div class="line"><a name="l05552"></a><span class="lineno"> 5552</span>&#160;    <span class="comment">// value rather than the switch condition variable:</span></div>
<div class="line"><a name="l05553"></a><span class="lineno"> 5553</span>&#160;    <span class="comment">//   switchbb:</span></div>
<div class="line"><a name="l05554"></a><span class="lineno"> 5554</span>&#160;    <span class="comment">//   switch i32 %x, label %default [</span></div>
<div class="line"><a name="l05555"></a><span class="lineno"> 5555</span>&#160;    <span class="comment">//     i32 17, label %succ</span></div>
<div class="line"><a name="l05556"></a><span class="lineno"> 5556</span>&#160;    <span class="comment">//   ...</span></div>
<div class="line"><a name="l05557"></a><span class="lineno"> 5557</span>&#160;    <span class="comment">//   succ:</span></div>
<div class="line"><a name="l05558"></a><span class="lineno"> 5558</span>&#160;    <span class="comment">//     %r = phi i32 ... [ 17, %switchbb ] ...</span></div>
<div class="line"><a name="l05559"></a><span class="lineno"> 5559</span>&#160;    <span class="comment">// --&gt;</span></div>
<div class="line"><a name="l05560"></a><span class="lineno"> 5560</span>&#160;    <span class="comment">//     %r = phi i32 ... [ %x, %switchbb ] ...</span></div>
<div class="line"><a name="l05561"></a><span class="lineno"> 5561</span>&#160; </div>
<div class="line"><a name="l05562"></a><span class="lineno"> 5562</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> &amp;Phi : CaseDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a72516971c5734dc0f7546e64affca425">phis</a>()) {</div>
<div class="line"><a name="l05563"></a><span class="lineno"> 5563</span>&#160;      <span class="comment">// This only works if there is exactly 1 incoming edge from the switch to</span></div>
<div class="line"><a name="l05564"></a><span class="lineno"> 5564</span>&#160;      <span class="comment">// a phi. If there is &gt;1, that means multiple cases of the switch map to 1</span></div>
<div class="line"><a name="l05565"></a><span class="lineno"> 5565</span>&#160;      <span class="comment">// value in the phi, and that phi value is not the switch condition. Thus,</span></div>
<div class="line"><a name="l05566"></a><span class="lineno"> 5566</span>&#160;      <span class="comment">// this transform would not make sense (the phi would be invalid because</span></div>
<div class="line"><a name="l05567"></a><span class="lineno"> 5567</span>&#160;      <span class="comment">// a phi can&#39;t have different incoming values from the same block).</span></div>
<div class="line"><a name="l05568"></a><span class="lineno"> 5568</span>&#160;      <span class="keywordtype">int</span> SwitchBBIdx = Phi.getBasicBlockIndex(SwitchBlock);</div>
<div class="line"><a name="l05569"></a><span class="lineno"> 5569</span>&#160;      <span class="keywordflow">if</span> (Phi.getIncomingValue(SwitchBBIdx) == CaseValue &amp;&amp;</div>
<div class="line"><a name="l05570"></a><span class="lineno"> 5570</span>&#160;          <a class="code" href="namespacellvm.html#ab1772fd431decccb7926d484ea223db7">count</a>(Phi.blocks(), SwitchBlock) == 1) {</div>
<div class="line"><a name="l05571"></a><span class="lineno"> 5571</span>&#160;        Phi.setIncomingValue(SwitchBBIdx, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition());</div>
<div class="line"><a name="l05572"></a><span class="lineno"> 5572</span>&#160;        Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05573"></a><span class="lineno"> 5573</span>&#160;      }</div>
<div class="line"><a name="l05574"></a><span class="lineno"> 5574</span>&#160;    }</div>
<div class="line"><a name="l05575"></a><span class="lineno"> 5575</span>&#160; </div>
<div class="line"><a name="l05576"></a><span class="lineno"> 5576</span>&#160;    <span class="comment">// Collect phi nodes that are indirectly using this switch&#39;s case constants.</span></div>
<div class="line"><a name="l05577"></a><span class="lineno"> 5577</span>&#160;    <span class="keywordtype">int</span> PhiIdx;</div>
<div class="line"><a name="l05578"></a><span class="lineno"> 5578</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Phi = <a class="code" href="SimplifyCFG_8cpp.html#a3a785324436b8d2862b09f5fd8d1c061">FindPHIForConditionForwarding</a>(CaseValue, CaseDest, &amp;PhiIdx))</div>
<div class="line"><a name="l05579"></a><span class="lineno"> 5579</span>&#160;      ForwardingNodes[Phi].push_back(PhiIdx);</div>
<div class="line"><a name="l05580"></a><span class="lineno"> 5580</span>&#160;  }</div>
<div class="line"><a name="l05581"></a><span class="lineno"> 5581</span>&#160; </div>
<div class="line"><a name="l05582"></a><span class="lineno"> 5582</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;ForwardingNode : ForwardingNodes) {</div>
<div class="line"><a name="l05583"></a><span class="lineno"> 5583</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *Phi = ForwardingNode.first;</div>
<div class="line"><a name="l05584"></a><span class="lineno"> 5584</span>&#160;    <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int&gt;</a> &amp;Indexes = ForwardingNode.second;</div>
<div class="line"><a name="l05585"></a><span class="lineno"> 5585</span>&#160;    <span class="keywordflow">if</span> (Indexes.size() &lt; 2)</div>
<div class="line"><a name="l05586"></a><span class="lineno"> 5586</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05587"></a><span class="lineno"> 5587</span>&#160; </div>
<div class="line"><a name="l05588"></a><span class="lineno"> 5588</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a> : Indexes)</div>
<div class="line"><a name="l05589"></a><span class="lineno"> 5589</span>&#160;      Phi-&gt;<a class="code" href="classllvm_1_1PHINode.html#a88cdefb709309eddc6e5daca0be6a7b4">setIncomingValue</a>(<a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition());</div>
<div class="line"><a name="l05590"></a><span class="lineno"> 5590</span>&#160;    Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05591"></a><span class="lineno"> 5591</span>&#160;  }</div>
<div class="line"><a name="l05592"></a><span class="lineno"> 5592</span>&#160; </div>
<div class="line"><a name="l05593"></a><span class="lineno"> 5593</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l05594"></a><span class="lineno"> 5594</span>&#160;}</div>
<div class="line"><a name="l05595"></a><span class="lineno"> 5595</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l05596"></a><span class="lineno"> 5596</span>&#160;<span class="comment">/// Return true if the backend will be able to handle</span></div>
<div class="line"><a name="l05597"></a><span class="lineno"> 5597</span>&#160;<span class="comment">/// initializing an array of constants like C.</span></div>
<div class="line"><a name="l05598"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a006522c92584fa9c362c0b3add3bbf8a"> 5598</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a006522c92584fa9c362c0b3add3bbf8a">ValidLookupTableConstant</a>(<a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) {</div>
<div class="line"><a name="l05599"></a><span class="lineno"> 5599</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;isThreadDependent())</div>
<div class="line"><a name="l05600"></a><span class="lineno"> 5600</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05601"></a><span class="lineno"> 5601</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;isDLLImportDependent())</div>
<div class="line"><a name="l05602"></a><span class="lineno"> 5602</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05603"></a><span class="lineno"> 5603</span>&#160; </div>
<div class="line"><a name="l05604"></a><span class="lineno"> 5604</span>&#160;  <span class="keywordflow">if</span> (!isa&lt;ConstantFP&gt;(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>) &amp;&amp; !isa&lt;ConstantInt&gt;(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>) &amp;&amp;</div>
<div class="line"><a name="l05605"></a><span class="lineno"> 5605</span>&#160;      !isa&lt;ConstantPointerNull&gt;(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>) &amp;&amp; !isa&lt;GlobalValue&gt;(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>) &amp;&amp;</div>
<div class="line"><a name="l05606"></a><span class="lineno"> 5606</span>&#160;      !isa&lt;UndefValue&gt;(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>) &amp;&amp; !isa&lt;ConstantExpr&gt;(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>))</div>
<div class="line"><a name="l05607"></a><span class="lineno"> 5607</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05608"></a><span class="lineno"> 5608</span>&#160; </div>
<div class="line"><a name="l05609"></a><span class="lineno"> 5609</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE = dyn_cast&lt;ConstantExpr&gt;(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>)) {</div>
<div class="line"><a name="l05610"></a><span class="lineno"> 5610</span>&#160;    <span class="comment">// Pointer casts and in-bounds GEPs will not prohibit the backend from</span></div>
<div class="line"><a name="l05611"></a><span class="lineno"> 5611</span>&#160;    <span class="comment">// materializing the array of constants.</span></div>
<div class="line"><a name="l05612"></a><span class="lineno"> 5612</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *StrippedC = cast&lt;Constant&gt;(CE-&gt;stripInBoundsConstantOffsets());</div>
<div class="line"><a name="l05613"></a><span class="lineno"> 5613</span>&#160;    <span class="keywordflow">if</span> (StrippedC == <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> || !<a class="code" href="SimplifyCFG_8cpp.html#a006522c92584fa9c362c0b3add3bbf8a">ValidLookupTableConstant</a>(StrippedC, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>))</div>
<div class="line"><a name="l05614"></a><span class="lineno"> 5614</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05615"></a><span class="lineno"> 5615</span>&#160;  }</div>
<div class="line"><a name="l05616"></a><span class="lineno"> 5616</span>&#160; </div>
<div class="line"><a name="l05617"></a><span class="lineno"> 5617</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a265e334c170d96e5cbcf8b420db520d4">shouldBuildLookupTablesForConstant</a>(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>))</div>
<div class="line"><a name="l05618"></a><span class="lineno"> 5618</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05619"></a><span class="lineno"> 5619</span>&#160; </div>
<div class="line"><a name="l05620"></a><span class="lineno"> 5620</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05621"></a><span class="lineno"> 5621</span>&#160;}</div>
<div class="line"><a name="l05622"></a><span class="lineno"> 5622</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l05623"></a><span class="lineno"> 5623</span>&#160;<span class="comment">/// If V is a Constant, return it. Otherwise, try to look up</span></div>
<div class="line"><a name="l05624"></a><span class="lineno"> 5624</span>&#160;<span class="comment">/// its constant value in ConstantPool, returning 0 if it&#39;s not there.</span></div>
<div class="line"><a name="l05625"></a><span class="lineno"> 5625</span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Constant.html">Constant</a> *</div>
<div class="line"><a name="l05626"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#afe11668c8bd8d29c005ca8e66ba9ef6b"> 5626</a></span>&#160;<a class="code" href="SimplifyCFG_8cpp.html#afe11668c8bd8d29c005ca8e66ba9ef6b">LookupConstant</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V,</div>
<div class="line"><a name="l05627"></a><span class="lineno"> 5627</span>&#160;               <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;Value *, Constant *&gt;</a> &amp;<a class="code" href="classllvm_1_1ConstantPool.html">ConstantPool</a>) {</div>
<div class="line"><a name="l05628"></a><span class="lineno"> 5628</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;Constant&gt;(V))</div>
<div class="line"><a name="l05629"></a><span class="lineno"> 5629</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>;</div>
<div class="line"><a name="l05630"></a><span class="lineno"> 5630</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1ConstantPool.html">ConstantPool</a>.lookup(V);</div>
<div class="line"><a name="l05631"></a><span class="lineno"> 5631</span>&#160;}</div>
<div class="line"><a name="l05632"></a><span class="lineno"> 5632</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l05633"></a><span class="lineno"> 5633</span>&#160;<span class="comment">/// Try to fold instruction I into a constant. This works for</span></div>
<div class="line"><a name="l05634"></a><span class="lineno"> 5634</span>&#160;<span class="comment">/// simple instructions such as binary operations where both operands are</span></div>
<div class="line"><a name="l05635"></a><span class="lineno"> 5635</span>&#160;<span class="comment">/// constant or can be replaced by constants from the ConstantPool. Returns the</span></div>
<div class="line"><a name="l05636"></a><span class="lineno"> 5636</span>&#160;<span class="comment">/// resulting constant on success, 0 otherwise.</span></div>
<div class="line"><a name="l05637"></a><span class="lineno"> 5637</span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Constant.html">Constant</a> *</div>
<div class="line"><a name="l05638"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a9ff3ba9554f4e6ee2a870ca63d9a6923"> 5638</a></span>&#160;<a class="code" href="SimplifyCFG_8cpp.html#a9ff3ba9554f4e6ee2a870ca63d9a6923">ConstantFold</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</div>
<div class="line"><a name="l05639"></a><span class="lineno"> 5639</span>&#160;             <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;Value *, Constant *&gt;</a> &amp;<a class="code" href="classllvm_1_1ConstantPool.html">ConstantPool</a>) {</div>
<div class="line"><a name="l05640"></a><span class="lineno"> 5640</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a> = dyn_cast&lt;SelectInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l05641"></a><span class="lineno"> 5641</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a015846b6188ce15e08cd94c74a9df1a3">A</a> = <a class="code" href="SimplifyCFG_8cpp.html#afe11668c8bd8d29c005ca8e66ba9ef6b">LookupConstant</a>(<a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a>-&gt;getCondition(), <a class="code" href="classllvm_1_1ConstantPool.html">ConstantPool</a>);</div>
<div class="line"><a name="l05642"></a><span class="lineno"> 5642</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="README__ALTIVEC_8txt.html#a015846b6188ce15e08cd94c74a9df1a3">A</a>)</div>
<div class="line"><a name="l05643"></a><span class="lineno"> 5643</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05644"></a><span class="lineno"> 5644</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="README__ALTIVEC_8txt.html#a015846b6188ce15e08cd94c74a9df1a3">A</a>-&gt;isAllOnesValue())</div>
<div class="line"><a name="l05645"></a><span class="lineno"> 5645</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="SimplifyCFG_8cpp.html#afe11668c8bd8d29c005ca8e66ba9ef6b">LookupConstant</a>(<a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a>-&gt;getTrueValue(), <a class="code" href="classllvm_1_1ConstantPool.html">ConstantPool</a>);</div>
<div class="line"><a name="l05646"></a><span class="lineno"> 5646</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="README__ALTIVEC_8txt.html#a015846b6188ce15e08cd94c74a9df1a3">A</a>-&gt;isNullValue())</div>
<div class="line"><a name="l05647"></a><span class="lineno"> 5647</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="SimplifyCFG_8cpp.html#afe11668c8bd8d29c005ca8e66ba9ef6b">LookupConstant</a>(<a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a>-&gt;getFalseValue(), <a class="code" href="classllvm_1_1ConstantPool.html">ConstantPool</a>);</div>
<div class="line"><a name="l05648"></a><span class="lineno"> 5648</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05649"></a><span class="lineno"> 5649</span>&#160;  }</div>
<div class="line"><a name="l05650"></a><span class="lineno"> 5650</span>&#160; </div>
<div class="line"><a name="l05651"></a><span class="lineno"> 5651</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Constant *, 4&gt;</a> COps;</div>
<div class="line"><a name="l05652"></a><span class="lineno"> 5652</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNumOperands(); <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>) {</div>
<div class="line"><a name="l05653"></a><span class="lineno"> 5653</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a015846b6188ce15e08cd94c74a9df1a3">A</a> = <a class="code" href="SimplifyCFG_8cpp.html#afe11668c8bd8d29c005ca8e66ba9ef6b">LookupConstant</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(<a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>), <a class="code" href="classllvm_1_1ConstantPool.html">ConstantPool</a>))</div>
<div class="line"><a name="l05654"></a><span class="lineno"> 5654</span>&#160;      COps.push_back(<a class="code" href="README__ALTIVEC_8txt.html#a015846b6188ce15e08cd94c74a9df1a3">A</a>);</div>
<div class="line"><a name="l05655"></a><span class="lineno"> 5655</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l05656"></a><span class="lineno"> 5656</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05657"></a><span class="lineno"> 5657</span>&#160;  }</div>
<div class="line"><a name="l05658"></a><span class="lineno"> 5658</span>&#160; </div>
<div class="line"><a name="l05659"></a><span class="lineno"> 5659</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a72278be77e997abc4b0dbde1be280006">ConstantFoldInstOperands</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, COps, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l05660"></a><span class="lineno"> 5660</span>&#160;}</div>
<div class="line"><a name="l05661"></a><span class="lineno"> 5661</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l05662"></a><span class="lineno"> 5662</span>&#160;<span class="comment">/// Try to determine the resulting constant values in phi nodes</span></div>
<div class="line"><a name="l05663"></a><span class="lineno"> 5663</span>&#160;<span class="comment">/// at the common destination basic block, *CommonDest, for one of the case</span></div>
<div class="line"><a name="l05664"></a><span class="lineno"> 5664</span>&#160;<span class="comment">/// destionations CaseDest corresponding to value CaseVal (0 for the default</span></div>
<div class="line"><a name="l05665"></a><span class="lineno"> 5665</span>&#160;<span class="comment">/// case), of a switch instruction SI.</span></div>
<div class="line"><a name="l05666"></a><span class="lineno"> 5666</span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="line"><a name="l05667"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a3e42eb8e250f1bfc825a58cbd042342d"> 5667</a></span>&#160;<a class="code" href="SimplifyCFG_8cpp.html#a3e42eb8e250f1bfc825a58cbd042342d">getCaseResults</a>(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CaseVal, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *CaseDest,</div>
<div class="line"><a name="l05668"></a><span class="lineno"> 5668</span>&#160;               <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> **CommonDest,</div>
<div class="line"><a name="l05669"></a><span class="lineno"> 5669</span>&#160;               <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl</a>&lt;std::pair&lt;PHINode *, Constant *&gt;&gt; &amp;Res,</div>
<div class="line"><a name="l05670"></a><span class="lineno"> 5670</span>&#160;               <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) {</div>
<div class="line"><a name="l05671"></a><span class="lineno"> 5671</span>&#160;  <span class="comment">// The block from which we enter the common destination.</span></div>
<div class="line"><a name="l05672"></a><span class="lineno"> 5672</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getParent();</div>
<div class="line"><a name="l05673"></a><span class="lineno"> 5673</span>&#160; </div>
<div class="line"><a name="l05674"></a><span class="lineno"> 5674</span>&#160;  <span class="comment">// If CaseDest is empty except for some side-effect free instructions through</span></div>
<div class="line"><a name="l05675"></a><span class="lineno"> 5675</span>&#160;  <span class="comment">// which we can constant-propagate the CaseVal, continue to its successor.</span></div>
<div class="line"><a name="l05676"></a><span class="lineno"> 5676</span>&#160;  <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;Value *, Constant *&gt;</a> <a class="code" href="Relocation_8txt.html#a6837a23f15afcf10e8fbee3970ab6e9a">ConstantPool</a>;</div>
<div class="line"><a name="l05677"></a><span class="lineno"> 5677</span>&#160;  <a class="code" href="classllvm_1_1ConstantPool.html">ConstantPool</a>.insert(std::make_pair(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition(), CaseVal));</div>
<div class="line"><a name="l05678"></a><span class="lineno"> 5678</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : CaseDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a2069641f358ef416658a2f321ca19d74">instructionsWithoutDebug</a>(<span class="keyword">false</span>)) {</div>
<div class="line"><a name="l05679"></a><span class="lineno"> 5679</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isTerminator()) {</div>
<div class="line"><a name="l05680"></a><span class="lineno"> 5680</span>&#160;      <span class="comment">// If the terminator is a simple branch, continue to the next block.</span></div>
<div class="line"><a name="l05681"></a><span class="lineno"> 5681</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getNumSuccessors() != 1 || <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isExceptionalTerminator())</div>
<div class="line"><a name="l05682"></a><span class="lineno"> 5682</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05683"></a><span class="lineno"> 5683</span>&#160;      Pred = CaseDest;</div>
<div class="line"><a name="l05684"></a><span class="lineno"> 5684</span>&#160;      CaseDest = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getSuccessor(0);</div>
<div class="line"><a name="l05685"></a><span class="lineno"> 5685</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = <a class="code" href="SimplifyCFG_8cpp.html#a9ff3ba9554f4e6ee2a870ca63d9a6923">ConstantFold</a>(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classllvm_1_1ConstantPool.html">ConstantPool</a>)) {</div>
<div class="line"><a name="l05686"></a><span class="lineno"> 5686</span>&#160;      <span class="comment">// Instruction is side-effect free and constant.</span></div>
<div class="line"><a name="l05687"></a><span class="lineno"> 5687</span>&#160; </div>
<div class="line"><a name="l05688"></a><span class="lineno"> 5688</span>&#160;      <span class="comment">// If the instruction has uses outside this block or a phi node slot for</span></div>
<div class="line"><a name="l05689"></a><span class="lineno"> 5689</span>&#160;      <span class="comment">// the block, it is not safe to bypass the instruction since it would then</span></div>
<div class="line"><a name="l05690"></a><span class="lineno"> 5690</span>&#160;      <span class="comment">// no longer dominate all its uses.</span></div>
<div class="line"><a name="l05691"></a><span class="lineno"> 5691</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="classllvm_1_1Use.html">Use</a> : <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.uses()) {</div>
<div class="line"><a name="l05692"></a><span class="lineno"> 5692</span>&#160;        <a class="code" href="classllvm_1_1User.html">User</a> *<a class="code" href="classllvm_1_1User.html">User</a> = <a class="code" href="classllvm_1_1Use.html">Use</a>.<a class="code" href="classllvm_1_1Use.html#a50a2e57da274f8d69b9f932977379cdf">getUser</a>();</div>
<div class="line"><a name="l05693"></a><span class="lineno"> 5693</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(<a class="code" href="classllvm_1_1User.html">User</a>))</div>
<div class="line"><a name="l05694"></a><span class="lineno"> 5694</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() == CaseDest)</div>
<div class="line"><a name="l05695"></a><span class="lineno"> 5695</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05696"></a><span class="lineno"> 5696</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *Phi = dyn_cast&lt;PHINode&gt;(<a class="code" href="classllvm_1_1User.html">User</a>))</div>
<div class="line"><a name="l05697"></a><span class="lineno"> 5697</span>&#160;          <span class="keywordflow">if</span> (Phi-&gt;getIncomingBlock(<a class="code" href="classllvm_1_1Use.html">Use</a>) == CaseDest)</div>
<div class="line"><a name="l05698"></a><span class="lineno"> 5698</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05699"></a><span class="lineno"> 5699</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05700"></a><span class="lineno"> 5700</span>&#160;      }</div>
<div class="line"><a name="l05701"></a><span class="lineno"> 5701</span>&#160; </div>
<div class="line"><a name="l05702"></a><span class="lineno"> 5702</span>&#160;      <a class="code" href="classllvm_1_1ConstantPool.html">ConstantPool</a>.insert(std::make_pair(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>));</div>
<div class="line"><a name="l05703"></a><span class="lineno"> 5703</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05704"></a><span class="lineno"> 5704</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l05705"></a><span class="lineno"> 5705</span>&#160;    }</div>
<div class="line"><a name="l05706"></a><span class="lineno"> 5706</span>&#160;  }</div>
<div class="line"><a name="l05707"></a><span class="lineno"> 5707</span>&#160; </div>
<div class="line"><a name="l05708"></a><span class="lineno"> 5708</span>&#160;  <span class="comment">// If we did not have a CommonDest before, use the current one.</span></div>
<div class="line"><a name="l05709"></a><span class="lineno"> 5709</span>&#160;  <span class="keywordflow">if</span> (!*CommonDest)</div>
<div class="line"><a name="l05710"></a><span class="lineno"> 5710</span>&#160;    *CommonDest = CaseDest;</div>
<div class="line"><a name="l05711"></a><span class="lineno"> 5711</span>&#160;  <span class="comment">// If the destination isn&#39;t the common one, abort.</span></div>
<div class="line"><a name="l05712"></a><span class="lineno"> 5712</span>&#160;  <span class="keywordflow">if</span> (CaseDest != *CommonDest)</div>
<div class="line"><a name="l05713"></a><span class="lineno"> 5713</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05714"></a><span class="lineno"> 5714</span>&#160; </div>
<div class="line"><a name="l05715"></a><span class="lineno"> 5715</span>&#160;  <span class="comment">// Get the values for this case from phi nodes in the destination block.</span></div>
<div class="line"><a name="l05716"></a><span class="lineno"> 5716</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> &amp;<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> : (*CommonDest)-&gt;phis()) {</div>
<div class="line"><a name="l05717"></a><span class="lineno"> 5717</span>&#160;    <span class="keywordtype">int</span> Idx = <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getBasicBlockIndex(Pred);</div>
<div class="line"><a name="l05718"></a><span class="lineno"> 5718</span>&#160;    <span class="keywordflow">if</span> (Idx == -1)</div>
<div class="line"><a name="l05719"></a><span class="lineno"> 5719</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05720"></a><span class="lineno"> 5720</span>&#160; </div>
<div class="line"><a name="l05721"></a><span class="lineno"> 5721</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *ConstVal =</div>
<div class="line"><a name="l05722"></a><span class="lineno"> 5722</span>&#160;        <a class="code" href="SimplifyCFG_8cpp.html#afe11668c8bd8d29c005ca8e66ba9ef6b">LookupConstant</a>(<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getIncomingValue(Idx), <a class="code" href="classllvm_1_1ConstantPool.html">ConstantPool</a>);</div>
<div class="line"><a name="l05723"></a><span class="lineno"> 5723</span>&#160;    <span class="keywordflow">if</span> (!ConstVal)</div>
<div class="line"><a name="l05724"></a><span class="lineno"> 5724</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05725"></a><span class="lineno"> 5725</span>&#160; </div>
<div class="line"><a name="l05726"></a><span class="lineno"> 5726</span>&#160;    <span class="comment">// Be conservative about which kinds of constants we support.</span></div>
<div class="line"><a name="l05727"></a><span class="lineno"> 5727</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#a006522c92584fa9c362c0b3add3bbf8a">ValidLookupTableConstant</a>(ConstVal, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>))</div>
<div class="line"><a name="l05728"></a><span class="lineno"> 5728</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05729"></a><span class="lineno"> 5729</span>&#160; </div>
<div class="line"><a name="l05730"></a><span class="lineno"> 5730</span>&#160;    Res.push_back(std::make_pair(&amp;<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, ConstVal));</div>
<div class="line"><a name="l05731"></a><span class="lineno"> 5731</span>&#160;  }</div>
<div class="line"><a name="l05732"></a><span class="lineno"> 5732</span>&#160; </div>
<div class="line"><a name="l05733"></a><span class="lineno"> 5733</span>&#160;  <span class="keywordflow">return</span> Res.size() &gt; 0;</div>
<div class="line"><a name="l05734"></a><span class="lineno"> 5734</span>&#160;}</div>
<div class="line"><a name="l05735"></a><span class="lineno"> 5735</span>&#160; </div>
<div class="line"><a name="l05736"></a><span class="lineno"> 5736</span>&#160;<span class="comment">// Helper function used to add CaseVal to the list of cases that generate</span></div>
<div class="line"><a name="l05737"></a><span class="lineno"> 5737</span>&#160;<span class="comment">// Result. Returns the updated number of cases that generate this result.</span></div>
<div class="line"><a name="l05738"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#ac46c68ef01d64ec7e21b62016818063a"> 5738</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="SimplifyCFG_8cpp.html#ac46c68ef01d64ec7e21b62016818063a">mapCaseToResult</a>(<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CaseVal,</div>
<div class="line"><a name="l05739"></a><span class="lineno"> 5739</span>&#160;                              SwitchCaseResultVectorTy &amp;UniqueResults,</div>
<div class="line"><a name="l05740"></a><span class="lineno"> 5740</span>&#160;                              <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Result) {</div>
<div class="line"><a name="l05741"></a><span class="lineno"> 5741</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : UniqueResults) {</div>
<div class="line"><a name="l05742"></a><span class="lineno"> 5742</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.first == Result) {</div>
<div class="line"><a name="l05743"></a><span class="lineno"> 5743</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.second.push_back(CaseVal);</div>
<div class="line"><a name="l05744"></a><span class="lineno"> 5744</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.second.size();</div>
<div class="line"><a name="l05745"></a><span class="lineno"> 5745</span>&#160;    }</div>
<div class="line"><a name="l05746"></a><span class="lineno"> 5746</span>&#160;  }</div>
<div class="line"><a name="l05747"></a><span class="lineno"> 5747</span>&#160;  UniqueResults.push_back(</div>
<div class="line"><a name="l05748"></a><span class="lineno"> 5748</span>&#160;      std::make_pair(Result, <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;ConstantInt *, 4&gt;</a>(1, CaseVal)));</div>
<div class="line"><a name="l05749"></a><span class="lineno"> 5749</span>&#160;  <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l05750"></a><span class="lineno"> 5750</span>&#160;}</div>
<div class="line"><a name="l05751"></a><span class="lineno"> 5751</span>&#160; </div>
<div class="line"><a name="l05752"></a><span class="lineno"> 5752</span>&#160;<span class="comment">// Helper function that initializes a map containing</span></div>
<div class="line"><a name="l05753"></a><span class="lineno"> 5753</span>&#160;<span class="comment">// results for the PHI node of the common destination block for a switch</span></div>
<div class="line"><a name="l05754"></a><span class="lineno"> 5754</span>&#160;<span class="comment">// instruction. Returns false if multiple PHI nodes have been found or if</span></div>
<div class="line"><a name="l05755"></a><span class="lineno"> 5755</span>&#160;<span class="comment">// there is not a common destination block for the switch.</span></div>
<div class="line"><a name="l05756"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a95851c48d68c2406ef12a7cca9c65f76"> 5756</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a95851c48d68c2406ef12a7cca9c65f76">initializeUniqueCases</a>(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *&amp;<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>,</div>
<div class="line"><a name="l05757"></a><span class="lineno"> 5757</span>&#160;                                  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *&amp;CommonDest,</div>
<div class="line"><a name="l05758"></a><span class="lineno"> 5758</span>&#160;                                  SwitchCaseResultVectorTy &amp;UniqueResults,</div>
<div class="line"><a name="l05759"></a><span class="lineno"> 5759</span>&#160;                                  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *&amp;DefaultResult,</div>
<div class="line"><a name="l05760"></a><span class="lineno"> 5760</span>&#160;                                  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</div>
<div class="line"><a name="l05761"></a><span class="lineno"> 5761</span>&#160;                                  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>,</div>
<div class="line"><a name="l05762"></a><span class="lineno"> 5762</span>&#160;                                  uintptr_t MaxUniqueResults) {</div>
<div class="line"><a name="l05763"></a><span class="lineno"> 5763</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;cases()) {</div>
<div class="line"><a name="l05764"></a><span class="lineno"> 5764</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CaseVal = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getCaseValue();</div>
<div class="line"><a name="l05765"></a><span class="lineno"> 5765</span>&#160; </div>
<div class="line"><a name="l05766"></a><span class="lineno"> 5766</span>&#160;    <span class="comment">// Resulting value at phi nodes for this case value.</span></div>
<div class="line"><a name="l05767"></a><span class="lineno"> 5767</span>&#160;    SwitchCaseResultsTy <a class="code" href="AliasAnalysis_8cpp.html#a7e344cff0feadf0b02223fee63cc7475">Results</a>;</div>
<div class="line"><a name="l05768"></a><span class="lineno"> 5768</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#a3e42eb8e250f1bfc825a58cbd042342d">getCaseResults</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, CaseVal, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getCaseSuccessor(), &amp;CommonDest, <a class="code" href="AliasAnalysis_8cpp.html#a7e344cff0feadf0b02223fee63cc7475">Results</a>,</div>
<div class="line"><a name="l05769"></a><span class="lineno"> 5769</span>&#160;                        <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>))</div>
<div class="line"><a name="l05770"></a><span class="lineno"> 5770</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05771"></a><span class="lineno"> 5771</span>&#160; </div>
<div class="line"><a name="l05772"></a><span class="lineno"> 5772</span>&#160;    <span class="comment">// Only one value per case is permitted.</span></div>
<div class="line"><a name="l05773"></a><span class="lineno"> 5773</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AliasAnalysis_8cpp.html#a7e344cff0feadf0b02223fee63cc7475">Results</a>.<a class="code" href="classllvm_1_1Function.html#a969eb757b1e43b455d4a8d0f603e695b">size</a>() &gt; 1)</div>
<div class="line"><a name="l05774"></a><span class="lineno"> 5774</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05775"></a><span class="lineno"> 5775</span>&#160; </div>
<div class="line"><a name="l05776"></a><span class="lineno"> 5776</span>&#160;    <span class="comment">// Add the case-&gt;result mapping to UniqueResults.</span></div>
<div class="line"><a name="l05777"></a><span class="lineno"> 5777</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> NumCasesForResult =</div>
<div class="line"><a name="l05778"></a><span class="lineno"> 5778</span>&#160;        <a class="code" href="SimplifyCFG_8cpp.html#ac46c68ef01d64ec7e21b62016818063a">mapCaseToResult</a>(CaseVal, UniqueResults, <a class="code" href="AliasAnalysis_8cpp.html#a7e344cff0feadf0b02223fee63cc7475">Results</a>.<a class="code" href="classllvm_1_1Function.html#a88a5e60837674780a9d812d661897ac5">begin</a>()-&gt;second);</div>
<div class="line"><a name="l05779"></a><span class="lineno"> 5779</span>&#160; </div>
<div class="line"><a name="l05780"></a><span class="lineno"> 5780</span>&#160;    <span class="comment">// Early out if there are too many cases for this result.</span></div>
<div class="line"><a name="l05781"></a><span class="lineno"> 5781</span>&#160;    <span class="keywordflow">if</span> (NumCasesForResult &gt; <a class="code" href="SimplifyCFG_8cpp.html#a95d324dd1b821acc61ba55ec642796c4">MaxSwitchCasesPerResult</a>)</div>
<div class="line"><a name="l05782"></a><span class="lineno"> 5782</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05783"></a><span class="lineno"> 5783</span>&#160; </div>
<div class="line"><a name="l05784"></a><span class="lineno"> 5784</span>&#160;    <span class="comment">// Early out if there are too many unique results.</span></div>
<div class="line"><a name="l05785"></a><span class="lineno"> 5785</span>&#160;    <span class="keywordflow">if</span> (UniqueResults.size() &gt; MaxUniqueResults)</div>
<div class="line"><a name="l05786"></a><span class="lineno"> 5786</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05787"></a><span class="lineno"> 5787</span>&#160; </div>
<div class="line"><a name="l05788"></a><span class="lineno"> 5788</span>&#160;    <span class="comment">// Check the PHI consistency.</span></div>
<div class="line"><a name="l05789"></a><span class="lineno"> 5789</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>)</div>
<div class="line"><a name="l05790"></a><span class="lineno"> 5790</span>&#160;      <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <a class="code" href="AliasAnalysis_8cpp.html#a7e344cff0feadf0b02223fee63cc7475">Results</a>[0].first;</div>
<div class="line"><a name="l05791"></a><span class="lineno"> 5791</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> != <a class="code" href="AliasAnalysis_8cpp.html#a7e344cff0feadf0b02223fee63cc7475">Results</a>[0].first)</div>
<div class="line"><a name="l05792"></a><span class="lineno"> 5792</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05793"></a><span class="lineno"> 5793</span>&#160;  }</div>
<div class="line"><a name="l05794"></a><span class="lineno"> 5794</span>&#160;  <span class="comment">// Find the default result value.</span></div>
<div class="line"><a name="l05795"></a><span class="lineno"> 5795</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;PHINode *, Constant *&gt;</a>, 1&gt; DefaultResults;</div>
<div class="line"><a name="l05796"></a><span class="lineno"> 5796</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *DefaultDest = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDefaultDest();</div>
<div class="line"><a name="l05797"></a><span class="lineno"> 5797</span>&#160;  <a class="code" href="SimplifyCFG_8cpp.html#a3e42eb8e250f1bfc825a58cbd042342d">getCaseResults</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <span class="keyword">nullptr</span>, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDefaultDest(), &amp;CommonDest, DefaultResults,</div>
<div class="line"><a name="l05798"></a><span class="lineno"> 5798</span>&#160;                 <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>);</div>
<div class="line"><a name="l05799"></a><span class="lineno"> 5799</span>&#160;  <span class="comment">// If the default value is not found abort unless the default destination</span></div>
<div class="line"><a name="l05800"></a><span class="lineno"> 5800</span>&#160;  <span class="comment">// is unreachable.</span></div>
<div class="line"><a name="l05801"></a><span class="lineno"> 5801</span>&#160;  DefaultResult =</div>
<div class="line"><a name="l05802"></a><span class="lineno"> 5802</span>&#160;      DefaultResults.size() == 1 ? DefaultResults.begin()-&gt;second : <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05803"></a><span class="lineno"> 5803</span>&#160;  <span class="keywordflow">if</span> ((!DefaultResult &amp;&amp;</div>
<div class="line"><a name="l05804"></a><span class="lineno"> 5804</span>&#160;       !isa&lt;UnreachableInst&gt;(DefaultDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a94c9bd7b123be808934be99e1bcedd24">getFirstNonPHIOrDbg</a>())))</div>
<div class="line"><a name="l05805"></a><span class="lineno"> 5805</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05806"></a><span class="lineno"> 5806</span>&#160; </div>
<div class="line"><a name="l05807"></a><span class="lineno"> 5807</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05808"></a><span class="lineno"> 5808</span>&#160;}</div>
<div class="line"><a name="l05809"></a><span class="lineno"> 5809</span>&#160; </div>
<div class="line"><a name="l05810"></a><span class="lineno"> 5810</span>&#160;<span class="comment">// Helper function that checks if it is possible to transform a switch with only</span></div>
<div class="line"><a name="l05811"></a><span class="lineno"> 5811</span>&#160;<span class="comment">// two cases (or two cases + default) that produces a result into a select.</span></div>
<div class="line"><a name="l05812"></a><span class="lineno"> 5812</span>&#160;<span class="comment">// TODO: Handle switches with more than 2 cases that map to the same result.</span></div>
<div class="line"><a name="l05813"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#abf7c0c7b7ca80941f61578f1d6691d01"> 5813</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="SimplifyCFG_8cpp.html#abf7c0c7b7ca80941f61578f1d6691d01">foldSwitchToSelect</a>(<span class="keyword">const</span> SwitchCaseResultVectorTy &amp;ResultVector,</div>
<div class="line"><a name="l05814"></a><span class="lineno"> 5814</span>&#160;                                 <a class="code" href="classllvm_1_1Constant.html">Constant</a> *DefaultResult, <a class="code" href="classllvm_1_1Value.html">Value</a> *Condition,</div>
<div class="line"><a name="l05815"></a><span class="lineno"> 5815</span>&#160;                                 <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>) {</div>
<div class="line"><a name="l05816"></a><span class="lineno"> 5816</span>&#160;  <span class="comment">// If we are selecting between only two cases transform into a simple</span></div>
<div class="line"><a name="l05817"></a><span class="lineno"> 5817</span>&#160;  <span class="comment">// select or a two-way select if default is possible.</span></div>
<div class="line"><a name="l05818"></a><span class="lineno"> 5818</span>&#160;  <span class="comment">// Example:</span></div>
<div class="line"><a name="l05819"></a><span class="lineno"> 5819</span>&#160;  <span class="comment">// switch (a) {                  %0 = icmp eq i32 %a, 10</span></div>
<div class="line"><a name="l05820"></a><span class="lineno"> 5820</span>&#160;  <span class="comment">//   case 10: return 42;         %1 = select i1 %0, i32 42, i32 4</span></div>
<div class="line"><a name="l05821"></a><span class="lineno"> 5821</span>&#160;  <span class="comment">//   case 20: return 2;   ----&gt;  %2 = icmp eq i32 %a, 20</span></div>
<div class="line"><a name="l05822"></a><span class="lineno"> 5822</span>&#160;  <span class="comment">//   default: return 4;          %3 = select i1 %2, i32 2, i32 %1</span></div>
<div class="line"><a name="l05823"></a><span class="lineno"> 5823</span>&#160;  <span class="comment">// }</span></div>
<div class="line"><a name="l05824"></a><span class="lineno"> 5824</span>&#160;  <span class="keywordflow">if</span> (ResultVector.size() == 2 &amp;&amp; ResultVector[0].second.size() == 1 &amp;&amp;</div>
<div class="line"><a name="l05825"></a><span class="lineno"> 5825</span>&#160;      ResultVector[1].second.size() == 1) {</div>
<div class="line"><a name="l05826"></a><span class="lineno"> 5826</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *FirstCase = ResultVector[0].second[0];</div>
<div class="line"><a name="l05827"></a><span class="lineno"> 5827</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *SecondCase = ResultVector[1].second[0];</div>
<div class="line"><a name="l05828"></a><span class="lineno"> 5828</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *SelectValue = ResultVector[1].first;</div>
<div class="line"><a name="l05829"></a><span class="lineno"> 5829</span>&#160;    <span class="keywordflow">if</span> (DefaultResult) {</div>
<div class="line"><a name="l05830"></a><span class="lineno"> 5830</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *ValueCompare =</div>
<div class="line"><a name="l05831"></a><span class="lineno"> 5831</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateICmpEQ(Condition, SecondCase, <span class="stringliteral">&quot;switch.selectcmp&quot;</span>);</div>
<div class="line"><a name="l05832"></a><span class="lineno"> 5832</span>&#160;      SelectValue = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSelect(ValueCompare, ResultVector[1].first,</div>
<div class="line"><a name="l05833"></a><span class="lineno"> 5833</span>&#160;                                         DefaultResult, <span class="stringliteral">&quot;switch.select&quot;</span>);</div>
<div class="line"><a name="l05834"></a><span class="lineno"> 5834</span>&#160;    }</div>
<div class="line"><a name="l05835"></a><span class="lineno"> 5835</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *ValueCompare =</div>
<div class="line"><a name="l05836"></a><span class="lineno"> 5836</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateICmpEQ(Condition, FirstCase, <span class="stringliteral">&quot;switch.selectcmp&quot;</span>);</div>
<div class="line"><a name="l05837"></a><span class="lineno"> 5837</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSelect(ValueCompare, ResultVector[0].first,</div>
<div class="line"><a name="l05838"></a><span class="lineno"> 5838</span>&#160;                                SelectValue, <span class="stringliteral">&quot;switch.select&quot;</span>);</div>
<div class="line"><a name="l05839"></a><span class="lineno"> 5839</span>&#160;  }</div>
<div class="line"><a name="l05840"></a><span class="lineno"> 5840</span>&#160; </div>
<div class="line"><a name="l05841"></a><span class="lineno"> 5841</span>&#160;  <span class="comment">// Handle the degenerate case where two cases have the same result value.</span></div>
<div class="line"><a name="l05842"></a><span class="lineno"> 5842</span>&#160;  <span class="keywordflow">if</span> (ResultVector.size() == 1 &amp;&amp; DefaultResult) {</div>
<div class="line"><a name="l05843"></a><span class="lineno"> 5843</span>&#160;    <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;ConstantInt *&gt;</a> CaseValues = ResultVector[0].second;</div>
<div class="line"><a name="l05844"></a><span class="lineno"> 5844</span>&#160;    <span class="keywordtype">unsigned</span> CaseCount = CaseValues.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>();</div>
<div class="line"><a name="l05845"></a><span class="lineno"> 5845</span>&#160;    <span class="comment">// n bits group cases map to the same result:</span></div>
<div class="line"><a name="l05846"></a><span class="lineno"> 5846</span>&#160;    <span class="comment">// case 0,4      -&gt; Cond &amp; 0b1..1011 == 0 ? result : default</span></div>
<div class="line"><a name="l05847"></a><span class="lineno"> 5847</span>&#160;    <span class="comment">// case 0,2,4,6  -&gt; Cond &amp; 0b1..1001 == 0 ? result : default</span></div>
<div class="line"><a name="l05848"></a><span class="lineno"> 5848</span>&#160;    <span class="comment">// case 0,2,8,10 -&gt; Cond &amp; 0b1..0101 == 0 ? result : default</span></div>
<div class="line"><a name="l05849"></a><span class="lineno"> 5849</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2_32</a>(CaseCount)) {</div>
<div class="line"><a name="l05850"></a><span class="lineno"> 5850</span>&#160;      <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *MinCaseVal = CaseValues[0];</div>
<div class="line"><a name="l05851"></a><span class="lineno"> 5851</span>&#160;      <span class="comment">// Find mininal value.</span></div>
<div class="line"><a name="l05852"></a><span class="lineno"> 5852</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Case : CaseValues)</div>
<div class="line"><a name="l05853"></a><span class="lineno"> 5853</span>&#160;        <span class="keywordflow">if</span> (Case-&gt;getValue().slt(MinCaseVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>()))</div>
<div class="line"><a name="l05854"></a><span class="lineno"> 5854</span>&#160;          MinCaseVal = Case;</div>
<div class="line"><a name="l05855"></a><span class="lineno"> 5855</span>&#160; </div>
<div class="line"><a name="l05856"></a><span class="lineno"> 5856</span>&#160;      <span class="comment">// Mark the bits case number touched.</span></div>
<div class="line"><a name="l05857"></a><span class="lineno"> 5857</span>&#160;      <a class="code" href="classllvm_1_1APInt.html">APInt</a> BitMask = APInt::getZero(MinCaseVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#ab240d0d30dfa9b392ef9d813f3f9e4be">getBitWidth</a>());</div>
<div class="line"><a name="l05858"></a><span class="lineno"> 5858</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Case : CaseValues)</div>
<div class="line"><a name="l05859"></a><span class="lineno"> 5859</span>&#160;        BitMask |= (Case-&gt;getValue() - MinCaseVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>());</div>
<div class="line"><a name="l05860"></a><span class="lineno"> 5860</span>&#160; </div>
<div class="line"><a name="l05861"></a><span class="lineno"> 5861</span>&#160;      <span class="comment">// Check if cases with the same result can cover all number</span></div>
<div class="line"><a name="l05862"></a><span class="lineno"> 5862</span>&#160;      <span class="comment">// in touched bits.</span></div>
<div class="line"><a name="l05863"></a><span class="lineno"> 5863</span>&#160;      <span class="keywordflow">if</span> (BitMask.<a class="code" href="classllvm_1_1APInt.html#a7237782a64e78d98366d51252b16ca07">countPopulation</a>() == <a class="code" href="namespacellvm.html#a646986783f35e0fef8988f0f28d2589f">Log2_32</a>(CaseCount)) {</div>
<div class="line"><a name="l05864"></a><span class="lineno"> 5864</span>&#160;        <span class="keywordflow">if</span> (!MinCaseVal-&gt;<a class="code" href="classllvm_1_1Constant.html#ae4b6abe77abf42fb02081a6cc41a0132">isNullValue</a>())</div>
<div class="line"><a name="l05865"></a><span class="lineno"> 5865</span>&#160;          Condition = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSub(Condition, MinCaseVal);</div>
<div class="line"><a name="l05866"></a><span class="lineno"> 5866</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAnd(Condition, ~BitMask, <span class="stringliteral">&quot;switch.and&quot;</span>);</div>
<div class="line"><a name="l05867"></a><span class="lineno"> 5867</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Cmp = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateICmpEQ(</div>
<div class="line"><a name="l05868"></a><span class="lineno"> 5868</span>&#160;            <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>, Constant::getNullValue(<a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>-&gt;getType()), <span class="stringliteral">&quot;switch.selectcmp&quot;</span>);</div>
<div class="line"><a name="l05869"></a><span class="lineno"> 5869</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSelect(Cmp, ResultVector[0].first, DefaultResult);</div>
<div class="line"><a name="l05870"></a><span class="lineno"> 5870</span>&#160;      }</div>
<div class="line"><a name="l05871"></a><span class="lineno"> 5871</span>&#160;    }</div>
<div class="line"><a name="l05872"></a><span class="lineno"> 5872</span>&#160; </div>
<div class="line"><a name="l05873"></a><span class="lineno"> 5873</span>&#160;    <span class="comment">// Handle the degenerate case where two cases have the same value.</span></div>
<div class="line"><a name="l05874"></a><span class="lineno"> 5874</span>&#160;    <span class="keywordflow">if</span> (CaseValues.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == 2) {</div>
<div class="line"><a name="l05875"></a><span class="lineno"> 5875</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Cmp1 = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateICmpEQ(Condition, CaseValues[0],</div>
<div class="line"><a name="l05876"></a><span class="lineno"> 5876</span>&#160;                                         <span class="stringliteral">&quot;switch.selectcmp.case1&quot;</span>);</div>
<div class="line"><a name="l05877"></a><span class="lineno"> 5877</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Cmp2 = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateICmpEQ(Condition, CaseValues[1],</div>
<div class="line"><a name="l05878"></a><span class="lineno"> 5878</span>&#160;                                         <span class="stringliteral">&quot;switch.selectcmp.case2&quot;</span>);</div>
<div class="line"><a name="l05879"></a><span class="lineno"> 5879</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Cmp = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateOr(Cmp1, Cmp2, <span class="stringliteral">&quot;switch.selectcmp&quot;</span>);</div>
<div class="line"><a name="l05880"></a><span class="lineno"> 5880</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSelect(Cmp, ResultVector[0].first, DefaultResult);</div>
<div class="line"><a name="l05881"></a><span class="lineno"> 5881</span>&#160;    }</div>
<div class="line"><a name="l05882"></a><span class="lineno"> 5882</span>&#160;  }</div>
<div class="line"><a name="l05883"></a><span class="lineno"> 5883</span>&#160; </div>
<div class="line"><a name="l05884"></a><span class="lineno"> 5884</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05885"></a><span class="lineno"> 5885</span>&#160;}</div>
<div class="line"><a name="l05886"></a><span class="lineno"> 5886</span>&#160; </div>
<div class="line"><a name="l05887"></a><span class="lineno"> 5887</span>&#160;<span class="comment">// Helper function to cleanup a switch instruction that has been converted into</span></div>
<div class="line"><a name="l05888"></a><span class="lineno"> 5888</span>&#160;<span class="comment">// a select, fixing up PHI nodes and basic blocks.</span></div>
<div class="line"><a name="l05889"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a0ceff22bcbbcc85abecced9a3a395ccf"> 5889</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="SimplifyCFG_8cpp.html#a0ceff22bcbbcc85abecced9a3a395ccf">removeSwitchAfterSelectFold</a>(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>,</div>
<div class="line"><a name="l05890"></a><span class="lineno"> 5890</span>&#160;                                        <a class="code" href="classllvm_1_1Value.html">Value</a> *SelectValue,</div>
<div class="line"><a name="l05891"></a><span class="lineno"> 5891</span>&#160;                                        <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>,</div>
<div class="line"><a name="l05892"></a><span class="lineno"> 5892</span>&#160;                                        <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> *DTU) {</div>
<div class="line"><a name="l05893"></a><span class="lineno"> 5893</span>&#160;  std::vector&lt;DominatorTree::UpdateType&gt; Updates;</div>
<div class="line"><a name="l05894"></a><span class="lineno"> 5894</span>&#160; </div>
<div class="line"><a name="l05895"></a><span class="lineno"> 5895</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *SelectBB = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getParent();</div>
<div class="line"><a name="l05896"></a><span class="lineno"> 5896</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *DestBB = <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getParent();</div>
<div class="line"><a name="l05897"></a><span class="lineno"> 5897</span>&#160; </div>
<div class="line"><a name="l05898"></a><span class="lineno"> 5898</span>&#160;  <span class="keywordflow">if</span> (DTU &amp;&amp; !<a class="code" href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">is_contained</a>(<a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(DestBB), SelectBB))</div>
<div class="line"><a name="l05899"></a><span class="lineno"> 5899</span>&#160;    Updates.push_back({<a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">DominatorTree::Insert</a>, SelectBB, DestBB});</div>
<div class="line"><a name="l05900"></a><span class="lineno"> 5900</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBr(DestBB);</div>
<div class="line"><a name="l05901"></a><span class="lineno"> 5901</span>&#160; </div>
<div class="line"><a name="l05902"></a><span class="lineno"> 5902</span>&#160;  <span class="comment">// Remove the switch.</span></div>
<div class="line"><a name="l05903"></a><span class="lineno"> 5903</span>&#160; </div>
<div class="line"><a name="l05904"></a><span class="lineno"> 5904</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getBasicBlockIndex(SelectBB) &gt;= 0)</div>
<div class="line"><a name="l05905"></a><span class="lineno"> 5905</span>&#160;    <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;removeIncomingValue(SelectBB);</div>
<div class="line"><a name="l05906"></a><span class="lineno"> 5906</span>&#160;  <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;addIncoming(SelectValue, SelectBB);</div>
<div class="line"><a name="l05907"></a><span class="lineno"> 5907</span>&#160; </div>
<div class="line"><a name="l05908"></a><span class="lineno"> 5908</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BasicBlock *, 4&gt;</a> RemovedSuccessors;</div>
<div class="line"><a name="l05909"></a><span class="lineno"> 5909</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getNumSuccessors(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l05910"></a><span class="lineno"> 5910</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getSuccessor(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l05911"></a><span class="lineno"> 5911</span>&#160; </div>
<div class="line"><a name="l05912"></a><span class="lineno"> 5912</span>&#160;    <span class="keywordflow">if</span> (Succ == DestBB)</div>
<div class="line"><a name="l05913"></a><span class="lineno"> 5913</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05914"></a><span class="lineno"> 5914</span>&#160;    Succ-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(SelectBB);</div>
<div class="line"><a name="l05915"></a><span class="lineno"> 5915</span>&#160;    <span class="keywordflow">if</span> (DTU &amp;&amp; RemovedSuccessors.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(Succ).second)</div>
<div class="line"><a name="l05916"></a><span class="lineno"> 5916</span>&#160;      Updates.push_back({DominatorTree::Delete, SelectBB, Succ});</div>
<div class="line"><a name="l05917"></a><span class="lineno"> 5917</span>&#160;  }</div>
<div class="line"><a name="l05918"></a><span class="lineno"> 5918</span>&#160;  <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l05919"></a><span class="lineno"> 5919</span>&#160;  <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l05920"></a><span class="lineno"> 5920</span>&#160;    DTU-&gt;<a class="code" href="classllvm_1_1DomTreeUpdater.html#aae522cd1928cfac6850b50c7a3e22185">applyUpdates</a>(Updates);</div>
<div class="line"><a name="l05921"></a><span class="lineno"> 5921</span>&#160;}</div>
<div class="line"><a name="l05922"></a><span class="lineno"> 5922</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l05923"></a><span class="lineno"> 5923</span>&#160;<span class="comment">/// If a switch is only used to initialize one or more phi nodes in a common</span></div>
<div class="line"><a name="l05924"></a><span class="lineno"> 5924</span>&#160;<span class="comment">/// successor block with only two different constant values, try to replace the</span></div>
<div class="line"><a name="l05925"></a><span class="lineno"> 5925</span>&#160;<span class="comment">/// switch with a select. Returns true if the fold was made.</span></div>
<div class="line"><a name="l05926"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a794d3a5f46134c24aade41b327d8418e"> 5926</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a794d3a5f46134c24aade41b327d8418e">trySwitchToSelect</a>(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>,</div>
<div class="line"><a name="l05927"></a><span class="lineno"> 5927</span>&#160;                              <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> *DTU, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</div>
<div class="line"><a name="l05928"></a><span class="lineno"> 5928</span>&#160;                              <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) {</div>
<div class="line"><a name="l05929"></a><span class="lineno"> 5929</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<span class="keyword">const</span> <a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a> = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition();</div>
<div class="line"><a name="l05930"></a><span class="lineno"> 5930</span>&#160;  <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05931"></a><span class="lineno"> 5931</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *CommonDest = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05932"></a><span class="lineno"> 5932</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *DefaultResult;</div>
<div class="line"><a name="l05933"></a><span class="lineno"> 5933</span>&#160;  SwitchCaseResultVectorTy UniqueResults;</div>
<div class="line"><a name="l05934"></a><span class="lineno"> 5934</span>&#160;  <span class="comment">// Collect all the cases that will deliver the same value from the switch.</span></div>
<div class="line"><a name="l05935"></a><span class="lineno"> 5935</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#a95851c48d68c2406ef12a7cca9c65f76">initializeUniqueCases</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, CommonDest, UniqueResults, DefaultResult,</div>
<div class="line"><a name="l05936"></a><span class="lineno"> 5936</span>&#160;                             <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, <span class="comment">/*MaxUniqueResults*/</span> 2))</div>
<div class="line"><a name="l05937"></a><span class="lineno"> 5937</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05938"></a><span class="lineno"> 5938</span>&#160; </div>
<div class="line"><a name="l05939"></a><span class="lineno"> 5939</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> != <span class="keyword">nullptr</span> &amp;&amp; <span class="stringliteral">&quot;PHI for value select not found&quot;</span>);</div>
<div class="line"><a name="l05940"></a><span class="lineno"> 5940</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l05941"></a><span class="lineno"> 5941</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *SelectValue =</div>
<div class="line"><a name="l05942"></a><span class="lineno"> 5942</span>&#160;      <a class="code" href="SimplifyCFG_8cpp.html#abf7c0c7b7ca80941f61578f1d6691d01">foldSwitchToSelect</a>(UniqueResults, DefaultResult, <a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l05943"></a><span class="lineno"> 5943</span>&#160;  <span class="keywordflow">if</span> (!SelectValue)</div>
<div class="line"><a name="l05944"></a><span class="lineno"> 5944</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05945"></a><span class="lineno"> 5945</span>&#160; </div>
<div class="line"><a name="l05946"></a><span class="lineno"> 5946</span>&#160;  <a class="code" href="SimplifyCFG_8cpp.html#a0ceff22bcbbcc85abecced9a3a395ccf">removeSwitchAfterSelectFold</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, SelectValue, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, DTU);</div>
<div class="line"><a name="l05947"></a><span class="lineno"> 5947</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05948"></a><span class="lineno"> 5948</span>&#160;}</div>
<div class="line"><a name="l05949"></a><span class="lineno"> 5949</span>&#160; </div>
<div class="line"><a name="l05950"></a><span class="lineno"> 5950</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l05951"></a><span class="lineno"> 5951</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l05952"></a><span class="lineno"> 5952</span>&#160;<span class="comment">/// This class represents a lookup table that can be used to replace a switch.</span></div>
<div class="line"><a name="l05953"></a><span class="lineno"> 5953</span>&#160;<span class="comment"></span><span class="keyword">class </span>SwitchLookupTable {</div>
<div class="line"><a name="l05954"></a><span class="lineno"> 5954</span>&#160;<span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l05955"></a><span class="lineno"> 5955</span>&#160;<span class="comment">  /// Create a lookup table to use as a switch replacement with the contents</span></div>
<div class="line"><a name="l05956"></a><span class="lineno"> 5956</span>&#160;<span class="comment">  /// of Values, using DefaultValue to fill any holes in the table.</span></div>
<div class="line"><a name="l05957"></a><span class="lineno"> 5957</span>&#160;<span class="comment"></span>  SwitchLookupTable(</div>
<div class="line"><a name="l05958"></a><span class="lineno"> 5958</span>&#160;      <a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> TableSize, <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="ELFObjHandler_8cpp.html#a250e66aa31a03567cc345ca1bc463b8c">Offset</a>,</div>
<div class="line"><a name="l05959"></a><span class="lineno"> 5959</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl</a>&lt;std::pair&lt;ConstantInt *, Constant *&gt;&gt; &amp;Values,</div>
<div class="line"><a name="l05960"></a><span class="lineno"> 5960</span>&#160;      <a class="code" href="classllvm_1_1Constant.html">Constant</a> *DefaultValue, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> &amp;FuncName);</div>
<div class="line"><a name="l05961"></a><span class="lineno"> 5961</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l05962"></a><span class="lineno"> 5962</span>&#160;<span class="comment">  /// Build instructions with Builder to retrieve the value at</span></div>
<div class="line"><a name="l05963"></a><span class="lineno"> 5963</span>&#160;<span class="comment">  /// the position given by Index in the lookup table.</span></div>
<div class="line"><a name="l05964"></a><span class="lineno"> 5964</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Value.html">Value</a> *BuildLookup(<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l05965"></a><span class="lineno"> 5965</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l05966"></a><span class="lineno"> 5966</span>&#160;<span class="comment">  /// Return true if a table with TableSize elements of</span></div>
<div class="line"><a name="l05967"></a><span class="lineno"> 5967</span>&#160;<span class="comment">  /// type ElementType would fit in a target-legal register.</span></div>
<div class="line"><a name="l05968"></a><span class="lineno"> 5968</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <span class="keywordtype">bool</span> WouldFitInRegister(<span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> TableSize,</div>
<div class="line"><a name="l05969"></a><span class="lineno"> 5969</span>&#160;                                 <a class="code" href="classllvm_1_1Type.html">Type</a> *ElementType);</div>
<div class="line"><a name="l05970"></a><span class="lineno"> 5970</span>&#160; </div>
<div class="line"><a name="l05971"></a><span class="lineno"> 5971</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l05972"></a><span class="lineno"> 5972</span>&#160;  <span class="comment">// Depending on the contents of the table, it can be represented in</span></div>
<div class="line"><a name="l05973"></a><span class="lineno"> 5973</span>&#160;  <span class="comment">// different ways.</span></div>
<div class="line"><a name="l05974"></a><span class="lineno"> 5974</span>&#160;  <span class="keyword">enum</span> {</div>
<div class="line"><a name="l05975"></a><span class="lineno"> 5975</span>&#160;    <span class="comment">// For tables where each element contains the same value, we just have to</span></div>
<div class="line"><a name="l05976"></a><span class="lineno"> 5976</span>&#160;    <span class="comment">// store that single value and return it for each lookup.</span></div>
<div class="line"><a name="l05977"></a><span class="lineno"> 5977</span>&#160;    SingleValueKind,</div>
<div class="line"><a name="l05978"></a><span class="lineno"> 5978</span>&#160; </div>
<div class="line"><a name="l05979"></a><span class="lineno"> 5979</span>&#160;    <span class="comment">// For tables where there is a linear relationship between table index</span></div>
<div class="line"><a name="l05980"></a><span class="lineno"> 5980</span>&#160;    <span class="comment">// and values. We calculate the result with a simple multiplication</span></div>
<div class="line"><a name="l05981"></a><span class="lineno"> 5981</span>&#160;    <span class="comment">// and addition instead of a table lookup.</span></div>
<div class="line"><a name="l05982"></a><span class="lineno"> 5982</span>&#160;    LinearMapKind,</div>
<div class="line"><a name="l05983"></a><span class="lineno"> 5983</span>&#160; </div>
<div class="line"><a name="l05984"></a><span class="lineno"> 5984</span>&#160;    <span class="comment">// For small tables with integer elements, we can pack them into a bitmap</span></div>
<div class="line"><a name="l05985"></a><span class="lineno"> 5985</span>&#160;    <span class="comment">// that fits into a target-legal register. Values are retrieved by</span></div>
<div class="line"><a name="l05986"></a><span class="lineno"> 5986</span>&#160;    <span class="comment">// shift and mask operations.</span></div>
<div class="line"><a name="l05987"></a><span class="lineno"> 5987</span>&#160;    BitMapKind,</div>
<div class="line"><a name="l05988"></a><span class="lineno"> 5988</span>&#160; </div>
<div class="line"><a name="l05989"></a><span class="lineno"> 5989</span>&#160;    <span class="comment">// The table is stored as an array of values. Values are retrieved by load</span></div>
<div class="line"><a name="l05990"></a><span class="lineno"> 5990</span>&#160;    <span class="comment">// instructions from the table.</span></div>
<div class="line"><a name="l05991"></a><span class="lineno"> 5991</span>&#160;    ArrayKind</div>
<div class="line"><a name="l05992"></a><span class="lineno"> 5992</span>&#160;  } <a class="code" href="namespacellvm_1_1lltok.html#af353621f14cb4b4b3af5ffaff84076b1">Kind</a>;</div>
<div class="line"><a name="l05993"></a><span class="lineno"> 5993</span>&#160; </div>
<div class="line"><a name="l05994"></a><span class="lineno"> 5994</span>&#160;  <span class="comment">// For SingleValueKind, this is the single value.</span></div>
<div class="line"><a name="l05995"></a><span class="lineno"> 5995</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *SingleValue = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05996"></a><span class="lineno"> 5996</span>&#160; </div>
<div class="line"><a name="l05997"></a><span class="lineno"> 5997</span>&#160;  <span class="comment">// For BitMapKind, this is the bitmap.</span></div>
<div class="line"><a name="l05998"></a><span class="lineno"> 5998</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *BitMap = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05999"></a><span class="lineno"> 5999</span>&#160;  <a class="code" href="classllvm_1_1IntegerType.html">IntegerType</a> *BitMapElementTy = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06000"></a><span class="lineno"> 6000</span>&#160; </div>
<div class="line"><a name="l06001"></a><span class="lineno"> 6001</span>&#160;  <span class="comment">// For LinearMapKind, these are the constants used to derive the value.</span></div>
<div class="line"><a name="l06002"></a><span class="lineno"> 6002</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *LinearOffset = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06003"></a><span class="lineno"> 6003</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *LinearMultiplier = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06004"></a><span class="lineno"> 6004</span>&#160; </div>
<div class="line"><a name="l06005"></a><span class="lineno"> 6005</span>&#160;  <span class="comment">// For ArrayKind, this is the array.</span></div>
<div class="line"><a name="l06006"></a><span class="lineno"> 6006</span>&#160;  <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *<a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a4410ec34d9e6c1a68100ca0ce033fb17">Array</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06007"></a><span class="lineno"> 6007</span>&#160;};</div>
<div class="line"><a name="l06008"></a><span class="lineno"> 6008</span>&#160; </div>
<div class="line"><a name="l06009"></a><span class="lineno"> 6009</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l06010"></a><span class="lineno"> 6010</span>&#160; </div>
<div class="line"><a name="l06011"></a><span class="lineno"> 6011</span>&#160;SwitchLookupTable::SwitchLookupTable(</div>
<div class="line"><a name="l06012"></a><span class="lineno"> 6012</span>&#160;    <a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> TableSize, <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="ELFObjHandler_8cpp.html#a250e66aa31a03567cc345ca1bc463b8c">Offset</a>,</div>
<div class="line"><a name="l06013"></a><span class="lineno"> 6013</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl</a>&lt;std::pair&lt;ConstantInt *, Constant *&gt;&gt; &amp;Values,</div>
<div class="line"><a name="l06014"></a><span class="lineno"> 6014</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *DefaultValue, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> &amp;FuncName) {</div>
<div class="line"><a name="l06015"></a><span class="lineno"> 6015</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Values.size() &amp;&amp; <span class="stringliteral">&quot;Can&#39;t build lookup table without values!&quot;</span>);</div>
<div class="line"><a name="l06016"></a><span class="lineno"> 6016</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TableSize &gt;= Values.size() &amp;&amp; <span class="stringliteral">&quot;Can&#39;t fit values in table!&quot;</span>);</div>
<div class="line"><a name="l06017"></a><span class="lineno"> 6017</span>&#160; </div>
<div class="line"><a name="l06018"></a><span class="lineno"> 6018</span>&#160;  <span class="comment">// If all values in the table are equal, this is that value.</span></div>
<div class="line"><a name="l06019"></a><span class="lineno"> 6019</span>&#160;  SingleValue = Values.begin()-&gt;second;</div>
<div class="line"><a name="l06020"></a><span class="lineno"> 6020</span>&#160; </div>
<div class="line"><a name="l06021"></a><span class="lineno"> 6021</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *<a class="code" href="classllvm_1_1PointerUnion.html">ValueType</a> = Values.begin()-&gt;second-&gt;getType();</div>
<div class="line"><a name="l06022"></a><span class="lineno"> 6022</span>&#160; </div>
<div class="line"><a name="l06023"></a><span class="lineno"> 6023</span>&#160;  <span class="comment">// Build up the table contents.</span></div>
<div class="line"><a name="l06024"></a><span class="lineno"> 6024</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Constant *, 64&gt;</a> TableContents(TableSize);</div>
<div class="line"><a name="l06025"></a><span class="lineno"> 6025</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = Values.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l06026"></a><span class="lineno"> 6026</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CaseVal = Values[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].first;</div>
<div class="line"><a name="l06027"></a><span class="lineno"> 6027</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *CaseRes = Values[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].second;</div>
<div class="line"><a name="l06028"></a><span class="lineno"> 6028</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CaseRes-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() == <a class="code" href="classllvm_1_1PointerUnion.html">ValueType</a>);</div>
<div class="line"><a name="l06029"></a><span class="lineno"> 6029</span>&#160; </div>
<div class="line"><a name="l06030"></a><span class="lineno"> 6030</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Idx = (CaseVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>() - <a class="code" href="ELFObjHandler_8cpp.html#a250e66aa31a03567cc345ca1bc463b8c">Offset</a>-&gt;getValue()).getLimitedValue();</div>
<div class="line"><a name="l06031"></a><span class="lineno"> 6031</span>&#160;    TableContents[Idx] = CaseRes;</div>
<div class="line"><a name="l06032"></a><span class="lineno"> 6032</span>&#160; </div>
<div class="line"><a name="l06033"></a><span class="lineno"> 6033</span>&#160;    <span class="keywordflow">if</span> (CaseRes != SingleValue)</div>
<div class="line"><a name="l06034"></a><span class="lineno"> 6034</span>&#160;      SingleValue = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06035"></a><span class="lineno"> 6035</span>&#160;  }</div>
<div class="line"><a name="l06036"></a><span class="lineno"> 6036</span>&#160; </div>
<div class="line"><a name="l06037"></a><span class="lineno"> 6037</span>&#160;  <span class="comment">// Fill in any holes in the table with the default result.</span></div>
<div class="line"><a name="l06038"></a><span class="lineno"> 6038</span>&#160;  <span class="keywordflow">if</span> (Values.size() &lt; TableSize) {</div>
<div class="line"><a name="l06039"></a><span class="lineno"> 6039</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DefaultValue &amp;&amp;</div>
<div class="line"><a name="l06040"></a><span class="lineno"> 6040</span>&#160;           <span class="stringliteral">&quot;Need a default value to fill the lookup table holes.&quot;</span>);</div>
<div class="line"><a name="l06041"></a><span class="lineno"> 6041</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DefaultValue-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() == <a class="code" href="classllvm_1_1PointerUnion.html">ValueType</a>);</div>
<div class="line"><a name="l06042"></a><span class="lineno"> 6042</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; TableSize; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l06043"></a><span class="lineno"> 6043</span>&#160;      <span class="keywordflow">if</span> (!TableContents[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>])</div>
<div class="line"><a name="l06044"></a><span class="lineno"> 6044</span>&#160;        TableContents[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = DefaultValue;</div>
<div class="line"><a name="l06045"></a><span class="lineno"> 6045</span>&#160;    }</div>
<div class="line"><a name="l06046"></a><span class="lineno"> 6046</span>&#160; </div>
<div class="line"><a name="l06047"></a><span class="lineno"> 6047</span>&#160;    <span class="keywordflow">if</span> (DefaultValue != SingleValue)</div>
<div class="line"><a name="l06048"></a><span class="lineno"> 6048</span>&#160;      SingleValue = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06049"></a><span class="lineno"> 6049</span>&#160;  }</div>
<div class="line"><a name="l06050"></a><span class="lineno"> 6050</span>&#160; </div>
<div class="line"><a name="l06051"></a><span class="lineno"> 6051</span>&#160;  <span class="comment">// If each element in the table contains the same value, we only need to store</span></div>
<div class="line"><a name="l06052"></a><span class="lineno"> 6052</span>&#160;  <span class="comment">// that single value.</span></div>
<div class="line"><a name="l06053"></a><span class="lineno"> 6053</span>&#160;  <span class="keywordflow">if</span> (SingleValue) {</div>
<div class="line"><a name="l06054"></a><span class="lineno"> 6054</span>&#160;    <a class="code" href="namespacellvm_1_1lltok.html#af353621f14cb4b4b3af5ffaff84076b1">Kind</a> = SingleValueKind;</div>
<div class="line"><a name="l06055"></a><span class="lineno"> 6055</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l06056"></a><span class="lineno"> 6056</span>&#160;  }</div>
<div class="line"><a name="l06057"></a><span class="lineno"> 6057</span>&#160; </div>
<div class="line"><a name="l06058"></a><span class="lineno"> 6058</span>&#160;  <span class="comment">// Check if we can derive the value with a linear transformation from the</span></div>
<div class="line"><a name="l06059"></a><span class="lineno"> 6059</span>&#160;  <span class="comment">// table index.</span></div>
<div class="line"><a name="l06060"></a><span class="lineno"> 6060</span>&#160;  <span class="keywordflow">if</span> (isa&lt;IntegerType&gt;(<a class="code" href="classllvm_1_1PointerUnion.html">ValueType</a>)) {</div>
<div class="line"><a name="l06061"></a><span class="lineno"> 6061</span>&#160;    <span class="keywordtype">bool</span> LinearMappingPossible = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06062"></a><span class="lineno"> 6062</span>&#160;    <a class="code" href="classllvm_1_1APInt.html">APInt</a> PrevVal;</div>
<div class="line"><a name="l06063"></a><span class="lineno"> 6063</span>&#160;    <a class="code" href="classllvm_1_1APInt.html">APInt</a> DistToPrev;</div>
<div class="line"><a name="l06064"></a><span class="lineno"> 6064</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TableSize &gt;= 2 &amp;&amp; <span class="stringliteral">&quot;Should be a SingleValue table.&quot;</span>);</div>
<div class="line"><a name="l06065"></a><span class="lineno"> 6065</span>&#160;    <span class="comment">// Check if there is the same distance between two consecutive values.</span></div>
<div class="line"><a name="l06066"></a><span class="lineno"> 6066</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; TableSize; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l06067"></a><span class="lineno"> 6067</span>&#160;      <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *ConstVal = dyn_cast&lt;ConstantInt&gt;(TableContents[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]);</div>
<div class="line"><a name="l06068"></a><span class="lineno"> 6068</span>&#160;      <span class="keywordflow">if</span> (!ConstVal) {</div>
<div class="line"><a name="l06069"></a><span class="lineno"> 6069</span>&#160;        <span class="comment">// This is an undef. We could deal with it, but undefs in lookup tables</span></div>
<div class="line"><a name="l06070"></a><span class="lineno"> 6070</span>&#160;        <span class="comment">// are very seldom. It&#39;s probably not worth the additional complexity.</span></div>
<div class="line"><a name="l06071"></a><span class="lineno"> 6071</span>&#160;        LinearMappingPossible = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06072"></a><span class="lineno"> 6072</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06073"></a><span class="lineno"> 6073</span>&#160;      }</div>
<div class="line"><a name="l06074"></a><span class="lineno"> 6074</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;Val = ConstVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>();</div>
<div class="line"><a name="l06075"></a><span class="lineno"> 6075</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != 0) {</div>
<div class="line"><a name="l06076"></a><span class="lineno"> 6076</span>&#160;        <a class="code" href="classllvm_1_1APInt.html">APInt</a> Dist = Val - PrevVal;</div>
<div class="line"><a name="l06077"></a><span class="lineno"> 6077</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> == 1) {</div>
<div class="line"><a name="l06078"></a><span class="lineno"> 6078</span>&#160;          DistToPrev = Dist;</div>
<div class="line"><a name="l06079"></a><span class="lineno"> 6079</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Dist != DistToPrev) {</div>
<div class="line"><a name="l06080"></a><span class="lineno"> 6080</span>&#160;          LinearMappingPossible = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06081"></a><span class="lineno"> 6081</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06082"></a><span class="lineno"> 6082</span>&#160;        }</div>
<div class="line"><a name="l06083"></a><span class="lineno"> 6083</span>&#160;      }</div>
<div class="line"><a name="l06084"></a><span class="lineno"> 6084</span>&#160;      PrevVal = Val;</div>
<div class="line"><a name="l06085"></a><span class="lineno"> 6085</span>&#160;    }</div>
<div class="line"><a name="l06086"></a><span class="lineno"> 6086</span>&#160;    <span class="keywordflow">if</span> (LinearMappingPossible) {</div>
<div class="line"><a name="l06087"></a><span class="lineno"> 6087</span>&#160;      LinearOffset = cast&lt;ConstantInt&gt;(TableContents[0]);</div>
<div class="line"><a name="l06088"></a><span class="lineno"> 6088</span>&#160;      LinearMultiplier = <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.getContext(), DistToPrev);</div>
<div class="line"><a name="l06089"></a><span class="lineno"> 6089</span>&#160;      <a class="code" href="namespacellvm_1_1lltok.html#af353621f14cb4b4b3af5ffaff84076b1">Kind</a> = LinearMapKind;</div>
<div class="line"><a name="l06090"></a><span class="lineno"> 6090</span>&#160;      ++NumLinearMaps;</div>
<div class="line"><a name="l06091"></a><span class="lineno"> 6091</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l06092"></a><span class="lineno"> 6092</span>&#160;    }</div>
<div class="line"><a name="l06093"></a><span class="lineno"> 6093</span>&#160;  }</div>
<div class="line"><a name="l06094"></a><span class="lineno"> 6094</span>&#160; </div>
<div class="line"><a name="l06095"></a><span class="lineno"> 6095</span>&#160;  <span class="comment">// If the type is integer and the table fits in a register, build a bitmap.</span></div>
<div class="line"><a name="l06096"></a><span class="lineno"> 6096</span>&#160;  <span class="keywordflow">if</span> (WouldFitInRegister(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TableSize, <a class="code" href="classllvm_1_1PointerUnion.html">ValueType</a>)) {</div>
<div class="line"><a name="l06097"></a><span class="lineno"> 6097</span>&#160;    <a class="code" href="classllvm_1_1IntegerType.html">IntegerType</a> *<a class="code" href="ARMSubtarget_8cpp.html#a6a14930b01ccb1cf446cd96395284102">IT</a> = cast&lt;IntegerType&gt;(<a class="code" href="classllvm_1_1PointerUnion.html">ValueType</a>);</div>
<div class="line"><a name="l06098"></a><span class="lineno"> 6098</span>&#160;    <a class="code" href="classllvm_1_1APInt.html">APInt</a> TableInt(TableSize * <a class="code" href="ARMSubtarget_8cpp.html#a6a14930b01ccb1cf446cd96395284102">IT</a>-&gt;getBitWidth(), 0);</div>
<div class="line"><a name="l06099"></a><span class="lineno"> 6099</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = TableSize; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &gt; 0; --<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l06100"></a><span class="lineno"> 6100</span>&#160;      TableInt &lt;&lt;= <a class="code" href="ARMSubtarget_8cpp.html#a6a14930b01ccb1cf446cd96395284102">IT</a>-&gt;getBitWidth();</div>
<div class="line"><a name="l06101"></a><span class="lineno"> 6101</span>&#160;      <span class="comment">// Insert values into the bitmap. Undef values are set to zero.</span></div>
<div class="line"><a name="l06102"></a><span class="lineno"> 6102</span>&#160;      <span class="keywordflow">if</span> (!isa&lt;UndefValue&gt;(TableContents[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> - 1])) {</div>
<div class="line"><a name="l06103"></a><span class="lineno"> 6103</span>&#160;        <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *Val = cast&lt;ConstantInt&gt;(TableContents[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> - 1]);</div>
<div class="line"><a name="l06104"></a><span class="lineno"> 6104</span>&#160;        TableInt |= Val-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#a1dc76cc8bf703e6ada68bededcbb9573">zext</a>(TableInt.getBitWidth());</div>
<div class="line"><a name="l06105"></a><span class="lineno"> 6105</span>&#160;      }</div>
<div class="line"><a name="l06106"></a><span class="lineno"> 6106</span>&#160;    }</div>
<div class="line"><a name="l06107"></a><span class="lineno"> 6107</span>&#160;    BitMap = <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.getContext(), TableInt);</div>
<div class="line"><a name="l06108"></a><span class="lineno"> 6108</span>&#160;    BitMapElementTy = <a class="code" href="ARMSubtarget_8cpp.html#a6a14930b01ccb1cf446cd96395284102">IT</a>;</div>
<div class="line"><a name="l06109"></a><span class="lineno"> 6109</span>&#160;    <a class="code" href="namespacellvm_1_1lltok.html#af353621f14cb4b4b3af5ffaff84076b1">Kind</a> = BitMapKind;</div>
<div class="line"><a name="l06110"></a><span class="lineno"> 6110</span>&#160;    ++NumBitMaps;</div>
<div class="line"><a name="l06111"></a><span class="lineno"> 6111</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l06112"></a><span class="lineno"> 6112</span>&#160;  }</div>
<div class="line"><a name="l06113"></a><span class="lineno"> 6113</span>&#160; </div>
<div class="line"><a name="l06114"></a><span class="lineno"> 6114</span>&#160;  <span class="comment">// Store the table in an array.</span></div>
<div class="line"><a name="l06115"></a><span class="lineno"> 6115</span>&#160;  <a class="code" href="classllvm_1_1ArrayType.html">ArrayType</a> *ArrayTy = <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ArrayType::get</a>(<a class="code" href="classllvm_1_1PointerUnion.html">ValueType</a>, TableSize);</div>
<div class="line"><a name="l06116"></a><span class="lineno"> 6116</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Initializer = <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantArray::get</a>(ArrayTy, TableContents);</div>
<div class="line"><a name="l06117"></a><span class="lineno"> 6117</span>&#160; </div>
<div class="line"><a name="l06118"></a><span class="lineno"> 6118</span>&#160;  <a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a4410ec34d9e6c1a68100ca0ce033fb17">Array</a> = <span class="keyword">new</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a>(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, ArrayTy, <span class="comment">/*isConstant=*/</span><span class="keyword">true</span>,</div>
<div class="line"><a name="l06119"></a><span class="lineno"> 6119</span>&#160;                             GlobalVariable::PrivateLinkage, Initializer,</div>
<div class="line"><a name="l06120"></a><span class="lineno"> 6120</span>&#160;                             <span class="stringliteral">&quot;switch.table.&quot;</span> + FuncName);</div>
<div class="line"><a name="l06121"></a><span class="lineno"> 6121</span>&#160;  <a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a4410ec34d9e6c1a68100ca0ce033fb17">Array</a>-&gt;setUnnamedAddr(GlobalValue::UnnamedAddr::Global);</div>
<div class="line"><a name="l06122"></a><span class="lineno"> 6122</span>&#160;  <span class="comment">// Set the alignment to that of an array items. We will be only loading one</span></div>
<div class="line"><a name="l06123"></a><span class="lineno"> 6123</span>&#160;  <span class="comment">// value out of it.</span></div>
<div class="line"><a name="l06124"></a><span class="lineno"> 6124</span>&#160;  <a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a4410ec34d9e6c1a68100ca0ce033fb17">Array</a>-&gt;setAlignment(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getPrefTypeAlign(<a class="code" href="classllvm_1_1PointerUnion.html">ValueType</a>));</div>
<div class="line"><a name="l06125"></a><span class="lineno"> 6125</span>&#160;  <a class="code" href="namespacellvm_1_1lltok.html#af353621f14cb4b4b3af5ffaff84076b1">Kind</a> = ArrayKind;</div>
<div class="line"><a name="l06126"></a><span class="lineno"> 6126</span>&#160;}</div>
<div class="line"><a name="l06127"></a><span class="lineno"> 6127</span>&#160; </div>
<div class="line"><a name="l06128"></a><span class="lineno"> 6128</span>&#160;<a class="code" href="classllvm_1_1Value.html">Value</a> *SwitchLookupTable::BuildLookup(<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>) {</div>
<div class="line"><a name="l06129"></a><span class="lineno"> 6129</span>&#160;  <span class="keywordflow">switch</span> (<a class="code" href="namespacellvm_1_1lltok.html#af353621f14cb4b4b3af5ffaff84076b1">Kind</a>) {</div>
<div class="line"><a name="l06130"></a><span class="lineno"> 6130</span>&#160;  <span class="keywordflow">case</span> SingleValueKind:</div>
<div class="line"><a name="l06131"></a><span class="lineno"> 6131</span>&#160;    <span class="keywordflow">return</span> SingleValue;</div>
<div class="line"><a name="l06132"></a><span class="lineno"> 6132</span>&#160;  <span class="keywordflow">case</span> LinearMapKind: {</div>
<div class="line"><a name="l06133"></a><span class="lineno"> 6133</span>&#160;    <span class="comment">// Derive the result value from the input value.</span></div>
<div class="line"><a name="l06134"></a><span class="lineno"> 6134</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntCast(<a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>, LinearMultiplier-&gt;getType(),</div>
<div class="line"><a name="l06135"></a><span class="lineno"> 6135</span>&#160;                                          <span class="keyword">false</span>, <span class="stringliteral">&quot;switch.idx.cast&quot;</span>);</div>
<div class="line"><a name="l06136"></a><span class="lineno"> 6136</span>&#160;    <span class="keywordflow">if</span> (!LinearMultiplier-&gt;isOne())</div>
<div class="line"><a name="l06137"></a><span class="lineno"> 6137</span>&#160;      <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateMul(Result, LinearMultiplier, <span class="stringliteral">&quot;switch.idx.mult&quot;</span>);</div>
<div class="line"><a name="l06138"></a><span class="lineno"> 6138</span>&#160;    <span class="keywordflow">if</span> (!LinearOffset-&gt;isZero())</div>
<div class="line"><a name="l06139"></a><span class="lineno"> 6139</span>&#160;      <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAdd(Result, LinearOffset, <span class="stringliteral">&quot;switch.offset&quot;</span>);</div>
<div class="line"><a name="l06140"></a><span class="lineno"> 6140</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>;</div>
<div class="line"><a name="l06141"></a><span class="lineno"> 6141</span>&#160;  }</div>
<div class="line"><a name="l06142"></a><span class="lineno"> 6142</span>&#160;  <span class="keywordflow">case</span> BitMapKind: {</div>
<div class="line"><a name="l06143"></a><span class="lineno"> 6143</span>&#160;    <span class="comment">// Type of the bitmap (e.g. i59).</span></div>
<div class="line"><a name="l06144"></a><span class="lineno"> 6144</span>&#160;    <a class="code" href="classllvm_1_1IntegerType.html">IntegerType</a> *MapTy = BitMap-&gt;getType();</div>
<div class="line"><a name="l06145"></a><span class="lineno"> 6145</span>&#160; </div>
<div class="line"><a name="l06146"></a><span class="lineno"> 6146</span>&#160;    <span class="comment">// Cast Index to the same type as the bitmap.</span></div>
<div class="line"><a name="l06147"></a><span class="lineno"> 6147</span>&#160;    <span class="comment">// Note: The Index is &lt;= the number of elements in the table, so</span></div>
<div class="line"><a name="l06148"></a><span class="lineno"> 6148</span>&#160;    <span class="comment">// truncating it to the width of the bitmask is safe.</span></div>
<div class="line"><a name="l06149"></a><span class="lineno"> 6149</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *ShiftAmt = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateZExtOrTrunc(<a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>, MapTy, <span class="stringliteral">&quot;switch.cast&quot;</span>);</div>
<div class="line"><a name="l06150"></a><span class="lineno"> 6150</span>&#160; </div>
<div class="line"><a name="l06151"></a><span class="lineno"> 6151</span>&#160;    <span class="comment">// Multiply the shift amount by the element width.</span></div>
<div class="line"><a name="l06152"></a><span class="lineno"> 6152</span>&#160;    ShiftAmt = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateMul(</div>
<div class="line"><a name="l06153"></a><span class="lineno"> 6153</span>&#160;        ShiftAmt, <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(MapTy, BitMapElementTy-&gt;getBitWidth()),</div>
<div class="line"><a name="l06154"></a><span class="lineno"> 6154</span>&#160;        <span class="stringliteral">&quot;switch.shiftamt&quot;</span>);</div>
<div class="line"><a name="l06155"></a><span class="lineno"> 6155</span>&#160; </div>
<div class="line"><a name="l06156"></a><span class="lineno"> 6156</span>&#160;    <span class="comment">// Shift down.</span></div>
<div class="line"><a name="l06157"></a><span class="lineno"> 6157</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *DownShifted =</div>
<div class="line"><a name="l06158"></a><span class="lineno"> 6158</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateLShr(BitMap, ShiftAmt, <span class="stringliteral">&quot;switch.downshift&quot;</span>);</div>
<div class="line"><a name="l06159"></a><span class="lineno"> 6159</span>&#160;    <span class="comment">// Mask off.</span></div>
<div class="line"><a name="l06160"></a><span class="lineno"> 6160</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateTrunc(DownShifted, BitMapElementTy, <span class="stringliteral">&quot;switch.masked&quot;</span>);</div>
<div class="line"><a name="l06161"></a><span class="lineno"> 6161</span>&#160;  }</div>
<div class="line"><a name="l06162"></a><span class="lineno"> 6162</span>&#160;  <span class="keywordflow">case</span> ArrayKind: {</div>
<div class="line"><a name="l06163"></a><span class="lineno"> 6163</span>&#160;    <span class="comment">// Make sure the table index will not overflow when treated as signed.</span></div>
<div class="line"><a name="l06164"></a><span class="lineno"> 6164</span>&#160;    <a class="code" href="classllvm_1_1IntegerType.html">IntegerType</a> *<a class="code" href="ARMSubtarget_8cpp.html#a6a14930b01ccb1cf446cd96395284102">IT</a> = cast&lt;IntegerType&gt;(<a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>-&gt;getType());</div>
<div class="line"><a name="l06165"></a><span class="lineno"> 6165</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> TableSize =</div>
<div class="line"><a name="l06166"></a><span class="lineno"> 6166</span>&#160;        <a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a4410ec34d9e6c1a68100ca0ce033fb17">Array</a>-&gt;getInitializer()-&gt;getType()-&gt;getArrayNumElements();</div>
<div class="line"><a name="l06167"></a><span class="lineno"> 6167</span>&#160;    <span class="keywordflow">if</span> (TableSize &gt; (1ULL &lt;&lt; <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(<a class="code" href="ARMSubtarget_8cpp.html#a6a14930b01ccb1cf446cd96395284102">IT</a>-&gt;getBitWidth() - 1, 63u)))</div>
<div class="line"><a name="l06168"></a><span class="lineno"> 6168</span>&#160;      <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateZExt(</div>
<div class="line"><a name="l06169"></a><span class="lineno"> 6169</span>&#160;          <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>, <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">IntegerType::get</a>(<a class="code" href="ARMSubtarget_8cpp.html#a6a14930b01ccb1cf446cd96395284102">IT</a>-&gt;getContext(), <a class="code" href="ARMSubtarget_8cpp.html#a6a14930b01ccb1cf446cd96395284102">IT</a>-&gt;getBitWidth() + 1),</div>
<div class="line"><a name="l06170"></a><span class="lineno"> 6170</span>&#160;          <span class="stringliteral">&quot;switch.tableidx.zext&quot;</span>);</div>
<div class="line"><a name="l06171"></a><span class="lineno"> 6171</span>&#160; </div>
<div class="line"><a name="l06172"></a><span class="lineno"> 6172</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *GEPIndices[] = {<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt32(0), <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>};</div>
<div class="line"><a name="l06173"></a><span class="lineno"> 6173</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateInBoundsGEP(<a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a4410ec34d9e6c1a68100ca0ce033fb17">Array</a>-&gt;getValueType(), Array,</div>
<div class="line"><a name="l06174"></a><span class="lineno"> 6174</span>&#160;                                           GEPIndices, <span class="stringliteral">&quot;switch.gep&quot;</span>);</div>
<div class="line"><a name="l06175"></a><span class="lineno"> 6175</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateLoad(</div>
<div class="line"><a name="l06176"></a><span class="lineno"> 6176</span>&#160;        cast&lt;ArrayType&gt;(<a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a4410ec34d9e6c1a68100ca0ce033fb17">Array</a>-&gt;getValueType())-&gt;getElementType(), <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>,</div>
<div class="line"><a name="l06177"></a><span class="lineno"> 6177</span>&#160;        <span class="stringliteral">&quot;switch.load&quot;</span>);</div>
<div class="line"><a name="l06178"></a><span class="lineno"> 6178</span>&#160;  }</div>
<div class="line"><a name="l06179"></a><span class="lineno"> 6179</span>&#160;  }</div>
<div class="line"><a name="l06180"></a><span class="lineno"> 6180</span>&#160;  <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Unknown lookup table kind!&quot;</span>);</div>
<div class="line"><a name="l06181"></a><span class="lineno"> 6181</span>&#160;}</div>
<div class="line"><a name="l06182"></a><span class="lineno"> 6182</span>&#160; </div>
<div class="line"><a name="l06183"></a><span class="lineno"> 6183</span>&#160;<span class="keywordtype">bool</span> SwitchLookupTable::WouldFitInRegister(<span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</div>
<div class="line"><a name="l06184"></a><span class="lineno"> 6184</span>&#160;                                           <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> TableSize,</div>
<div class="line"><a name="l06185"></a><span class="lineno"> 6185</span>&#160;                                           <a class="code" href="classllvm_1_1Type.html">Type</a> *ElementType) {</div>
<div class="line"><a name="l06186"></a><span class="lineno"> 6186</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="ARMSubtarget_8cpp.html#a6a14930b01ccb1cf446cd96395284102">IT</a> = dyn_cast&lt;IntegerType&gt;(ElementType);</div>
<div class="line"><a name="l06187"></a><span class="lineno"> 6187</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="ARMSubtarget_8cpp.html#a6a14930b01ccb1cf446cd96395284102">IT</a>)</div>
<div class="line"><a name="l06188"></a><span class="lineno"> 6188</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06189"></a><span class="lineno"> 6189</span>&#160;  <span class="comment">// FIXME: If the type is wider than it needs to be, e.g. i8 but all values</span></div>
<div class="line"><a name="l06190"></a><span class="lineno"> 6190</span>&#160;  <span class="comment">// are &lt;= 15, we could try to narrow the type.</span></div>
<div class="line"><a name="l06191"></a><span class="lineno"> 6191</span>&#160; </div>
<div class="line"><a name="l06192"></a><span class="lineno"> 6192</span>&#160;  <span class="comment">// Avoid overflow, fitsInLegalInteger uses unsigned int for the width.</span></div>
<div class="line"><a name="l06193"></a><span class="lineno"> 6193</span>&#160;  <span class="keywordflow">if</span> (TableSize &gt;= UINT_MAX / <a class="code" href="ARMSubtarget_8cpp.html#a6a14930b01ccb1cf446cd96395284102">IT</a>-&gt;getBitWidth())</div>
<div class="line"><a name="l06194"></a><span class="lineno"> 6194</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06195"></a><span class="lineno"> 6195</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.fitsInLegalInteger(TableSize * <a class="code" href="ARMSubtarget_8cpp.html#a6a14930b01ccb1cf446cd96395284102">IT</a>-&gt;getBitWidth());</div>
<div class="line"><a name="l06196"></a><span class="lineno"> 6196</span>&#160;}</div>
<div class="line"><a name="l06197"></a><span class="lineno"> 6197</span>&#160; </div>
<div class="line"><a name="l06198"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a7ef36c3b9f5334218cf1b3b7e8e33569"> 6198</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a7ef36c3b9f5334218cf1b3b7e8e33569">isTypeLegalForLookupTable</a>(<a class="code" href="classllvm_1_1Type.html">Type</a> *Ty, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>,</div>
<div class="line"><a name="l06199"></a><span class="lineno"> 6199</span>&#160;                                      <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>) {</div>
<div class="line"><a name="l06200"></a><span class="lineno"> 6200</span>&#160;  <span class="comment">// Allow any legal type.</span></div>
<div class="line"><a name="l06201"></a><span class="lineno"> 6201</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a7a84209b8495d8fd3d2799eb01f1ab2b">isTypeLegal</a>(Ty))</div>
<div class="line"><a name="l06202"></a><span class="lineno"> 6202</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06203"></a><span class="lineno"> 6203</span>&#160; </div>
<div class="line"><a name="l06204"></a><span class="lineno"> 6204</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="ARMSubtarget_8cpp.html#a6a14930b01ccb1cf446cd96395284102">IT</a> = dyn_cast&lt;IntegerType&gt;(Ty);</div>
<div class="line"><a name="l06205"></a><span class="lineno"> 6205</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="ARMSubtarget_8cpp.html#a6a14930b01ccb1cf446cd96395284102">IT</a>)</div>
<div class="line"><a name="l06206"></a><span class="lineno"> 6206</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06207"></a><span class="lineno"> 6207</span>&#160; </div>
<div class="line"><a name="l06208"></a><span class="lineno"> 6208</span>&#160;  <span class="comment">// Also allow power of 2 integer types that have at least 8 bits and fit in</span></div>
<div class="line"><a name="l06209"></a><span class="lineno"> 6209</span>&#160;  <span class="comment">// a register. These types are common in frontend languages and targets</span></div>
<div class="line"><a name="l06210"></a><span class="lineno"> 6210</span>&#160;  <span class="comment">// usually support loads of these types.</span></div>
<div class="line"><a name="l06211"></a><span class="lineno"> 6211</span>&#160;  <span class="comment">// TODO: We could relax this to any integer that fits in a register and rely</span></div>
<div class="line"><a name="l06212"></a><span class="lineno"> 6212</span>&#160;  <span class="comment">// on ABI alignment and padding in the table to allow the load to be widened.</span></div>
<div class="line"><a name="l06213"></a><span class="lineno"> 6213</span>&#160;  <span class="comment">// Or we could widen the constants and truncate the load.</span></div>
<div class="line"><a name="l06214"></a><span class="lineno"> 6214</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = <a class="code" href="ARMSubtarget_8cpp.html#a6a14930b01ccb1cf446cd96395284102">IT</a>-&gt;getBitWidth();</div>
<div class="line"><a name="l06215"></a><span class="lineno"> 6215</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> &gt;= 8 &amp;&amp; <a class="code" href="namespacellvm.html#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2_32</a>(<a class="code" href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>) &amp;&amp;</div>
<div class="line"><a name="l06216"></a><span class="lineno"> 6216</span>&#160;         <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.fitsInLegalInteger(<a class="code" href="ARMSubtarget_8cpp.html#a6a14930b01ccb1cf446cd96395284102">IT</a>-&gt;getBitWidth());</div>
<div class="line"><a name="l06217"></a><span class="lineno"> 6217</span>&#160;}</div>
<div class="line"><a name="l06218"></a><span class="lineno"> 6218</span>&#160; </div>
<div class="line"><a name="l06219"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a7c6e64e4a4dbba951d47fe2b1d188b2c"> 6219</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a7c6e64e4a4dbba951d47fe2b1d188b2c">isSwitchDense</a>(<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> NumCases, <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> CaseRange) {</div>
<div class="line"><a name="l06220"></a><span class="lineno"> 6220</span>&#160;  <span class="comment">// 40% is the default density for building a jump table in optsize/minsize</span></div>
<div class="line"><a name="l06221"></a><span class="lineno"> 6221</span>&#160;  <span class="comment">// mode. See also TargetLoweringBase::isSuitableForJumpTable(), which this</span></div>
<div class="line"><a name="l06222"></a><span class="lineno"> 6222</span>&#160;  <span class="comment">// function was based on.</span></div>
<div class="line"><a name="l06223"></a><span class="lineno"> 6223</span>&#160;  <span class="keyword">const</span> <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> MinDensity = 40;</div>
<div class="line"><a name="l06224"></a><span class="lineno"> 6224</span>&#160; </div>
<div class="line"><a name="l06225"></a><span class="lineno"> 6225</span>&#160;  <span class="keywordflow">if</span> (CaseRange &gt;= <a class="code" href="c_2DataTypes_8h.html#a30654b4b67d97c42ca3f9b6052dda916">UINT64_MAX</a> / 100)</div>
<div class="line"><a name="l06226"></a><span class="lineno"> 6226</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Avoid multiplication overflows below.</span></div>
<div class="line"><a name="l06227"></a><span class="lineno"> 6227</span>&#160; </div>
<div class="line"><a name="l06228"></a><span class="lineno"> 6228</span>&#160;  <span class="keywordflow">return</span> NumCases * 100 &gt;= CaseRange * MinDensity;</div>
<div class="line"><a name="l06229"></a><span class="lineno"> 6229</span>&#160;}</div>
<div class="line"><a name="l06230"></a><span class="lineno"> 6230</span>&#160; </div>
<div class="line"><a name="l06231"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#aa28651c1e85585ae702f652a8df06019"> 6231</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a7c6e64e4a4dbba951d47fe2b1d188b2c">isSwitchDense</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int64_t&gt;</a> Values) {</div>
<div class="line"><a name="l06232"></a><span class="lineno"> 6232</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Diff = (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a>)Values.<a class="code" href="classllvm_1_1ArrayRef.html#adb38eaaa53c1d9c57b6fe11cf84bd7a4">back</a>() - (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a>)Values.<a class="code" href="classllvm_1_1ArrayRef.html#a6bc2b53fce3b1d8975eea027d8a8eb90">front</a>();</div>
<div class="line"><a name="l06233"></a><span class="lineno"> 6233</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Range = Diff + 1;</div>
<div class="line"><a name="l06234"></a><span class="lineno"> 6234</span>&#160;  <span class="keywordflow">if</span> (Range &lt; Diff)</div>
<div class="line"><a name="l06235"></a><span class="lineno"> 6235</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Overflow.</span></div>
<div class="line"><a name="l06236"></a><span class="lineno"> 6236</span>&#160; </div>
<div class="line"><a name="l06237"></a><span class="lineno"> 6237</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="SimplifyCFG_8cpp.html#a7c6e64e4a4dbba951d47fe2b1d188b2c">isSwitchDense</a>(Values.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(), Range);</div>
<div class="line"><a name="l06238"></a><span class="lineno"> 6238</span>&#160;}</div>
<div class="line"><a name="l06239"></a><span class="lineno"> 6239</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l06240"></a><span class="lineno"> 6240</span>&#160;<span class="comment">/// Determine whether a lookup table should be built for this switch, based on</span></div>
<div class="line"><a name="l06241"></a><span class="lineno"> 6241</span>&#160;<span class="comment">/// the number of cases, size of the table, and the types of the results.</span></div>
<div class="line"><a name="l06242"></a><span class="lineno"> 6242</span>&#160;<span class="comment"></span><span class="comment">// TODO: We could support larger than legal types by limiting based on the</span></div>
<div class="line"><a name="l06243"></a><span class="lineno"> 6243</span>&#160;<span class="comment">// number of loads required and/or table size. If the constants are small we</span></div>
<div class="line"><a name="l06244"></a><span class="lineno"> 6244</span>&#160;<span class="comment">// could use smaller table entries and extend after the load.</span></div>
<div class="line"><a name="l06245"></a><span class="lineno"> 6245</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="line"><a name="l06246"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a60140c11a583d97cc18631485559f237"> 6246</a></span>&#160;<a class="code" href="SimplifyCFG_8cpp.html#a60140c11a583d97cc18631485559f237">ShouldBuildLookupTable</a>(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> TableSize,</div>
<div class="line"><a name="l06247"></a><span class="lineno"> 6247</span>&#160;                       <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</div>
<div class="line"><a name="l06248"></a><span class="lineno"> 6248</span>&#160;                       <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;PHINode *, Type *&gt;</a> &amp;ResultTypes) {</div>
<div class="line"><a name="l06249"></a><span class="lineno"> 6249</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getNumCases() &gt; TableSize)</div>
<div class="line"><a name="l06250"></a><span class="lineno"> 6250</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// TableSize overflowed.</span></div>
<div class="line"><a name="l06251"></a><span class="lineno"> 6251</span>&#160; </div>
<div class="line"><a name="l06252"></a><span class="lineno"> 6252</span>&#160;  <span class="keywordtype">bool</span> AllTablesFitInRegister = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06253"></a><span class="lineno"> 6253</span>&#160;  <span class="keywordtype">bool</span> HasIllegalType = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06254"></a><span class="lineno"> 6254</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : ResultTypes) {</div>
<div class="line"><a name="l06255"></a><span class="lineno"> 6255</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.second;</div>
<div class="line"><a name="l06256"></a><span class="lineno"> 6256</span>&#160; </div>
<div class="line"><a name="l06257"></a><span class="lineno"> 6257</span>&#160;    <span class="comment">// Saturate this flag to true.</span></div>
<div class="line"><a name="l06258"></a><span class="lineno"> 6258</span>&#160;    HasIllegalType = HasIllegalType || !<a class="code" href="SimplifyCFG_8cpp.html#a7ef36c3b9f5334218cf1b3b7e8e33569">isTypeLegalForLookupTable</a>(Ty, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l06259"></a><span class="lineno"> 6259</span>&#160; </div>
<div class="line"><a name="l06260"></a><span class="lineno"> 6260</span>&#160;    <span class="comment">// Saturate this flag to false.</span></div>
<div class="line"><a name="l06261"></a><span class="lineno"> 6261</span>&#160;    AllTablesFitInRegister =</div>
<div class="line"><a name="l06262"></a><span class="lineno"> 6262</span>&#160;        AllTablesFitInRegister &amp;&amp;</div>
<div class="line"><a name="l06263"></a><span class="lineno"> 6263</span>&#160;        SwitchLookupTable::WouldFitInRegister(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TableSize, Ty);</div>
<div class="line"><a name="l06264"></a><span class="lineno"> 6264</span>&#160; </div>
<div class="line"><a name="l06265"></a><span class="lineno"> 6265</span>&#160;    <span class="comment">// If both flags saturate, we&#39;re done. NOTE: This *only* works with</span></div>
<div class="line"><a name="l06266"></a><span class="lineno"> 6266</span>&#160;    <span class="comment">// saturating flags, and all flags have to saturate first due to the</span></div>
<div class="line"><a name="l06267"></a><span class="lineno"> 6267</span>&#160;    <span class="comment">// non-deterministic behavior of iterating over a dense map.</span></div>
<div class="line"><a name="l06268"></a><span class="lineno"> 6268</span>&#160;    <span class="keywordflow">if</span> (HasIllegalType &amp;&amp; !AllTablesFitInRegister)</div>
<div class="line"><a name="l06269"></a><span class="lineno"> 6269</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06270"></a><span class="lineno"> 6270</span>&#160;  }</div>
<div class="line"><a name="l06271"></a><span class="lineno"> 6271</span>&#160; </div>
<div class="line"><a name="l06272"></a><span class="lineno"> 6272</span>&#160;  <span class="comment">// If each table would fit in a register, we should build it anyway.</span></div>
<div class="line"><a name="l06273"></a><span class="lineno"> 6273</span>&#160;  <span class="keywordflow">if</span> (AllTablesFitInRegister)</div>
<div class="line"><a name="l06274"></a><span class="lineno"> 6274</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06275"></a><span class="lineno"> 6275</span>&#160; </div>
<div class="line"><a name="l06276"></a><span class="lineno"> 6276</span>&#160;  <span class="comment">// Don&#39;t build a table that doesn&#39;t fit in-register if it has illegal types.</span></div>
<div class="line"><a name="l06277"></a><span class="lineno"> 6277</span>&#160;  <span class="keywordflow">if</span> (HasIllegalType)</div>
<div class="line"><a name="l06278"></a><span class="lineno"> 6278</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06279"></a><span class="lineno"> 6279</span>&#160; </div>
<div class="line"><a name="l06280"></a><span class="lineno"> 6280</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="SimplifyCFG_8cpp.html#a7c6e64e4a4dbba951d47fe2b1d188b2c">isSwitchDense</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getNumCases(), TableSize);</div>
<div class="line"><a name="l06281"></a><span class="lineno"> 6281</span>&#160;}</div>
<div class="line"><a name="l06282"></a><span class="lineno"> 6282</span>&#160; </div>
<div class="line"><a name="l06283"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#ad65ca7ae85d9efe841f0c2f71cf5ee59"> 6283</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#ad65ca7ae85d9efe841f0c2f71cf5ee59">ShouldUseSwitchConditionAsTableIndex</a>(</div>
<div class="line"><a name="l06284"></a><span class="lineno"> 6284</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> &amp;MinCaseVal, <span class="keyword">const</span> <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> &amp;MaxCaseVal,</div>
<div class="line"><a name="l06285"></a><span class="lineno"> 6285</span>&#160;    <span class="keywordtype">bool</span> HasDefaultResults, <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;PHINode *, Type *&gt;</a> &amp;ResultTypes,</div>
<div class="line"><a name="l06286"></a><span class="lineno"> 6286</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) {</div>
<div class="line"><a name="l06287"></a><span class="lineno"> 6287</span>&#160;  <span class="keywordflow">if</span> (MinCaseVal.<a class="code" href="classllvm_1_1Constant.html#ae4b6abe77abf42fb02081a6cc41a0132">isNullValue</a>())</div>
<div class="line"><a name="l06288"></a><span class="lineno"> 6288</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06289"></a><span class="lineno"> 6289</span>&#160;  <span class="keywordflow">if</span> (MinCaseVal.<a class="code" href="classllvm_1_1ConstantInt.html#a2a8c8be274f3bd351e083ab3828c14c7">isNegative</a>() ||</div>
<div class="line"><a name="l06290"></a><span class="lineno"> 6290</span>&#160;      MaxCaseVal.<a class="code" href="classllvm_1_1ConstantInt.html#a31e8da5adf63afd38b4ab94bca823150">getLimitedValue</a>() == <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::numeric_limits&lt;uint64_t&gt;::max</a>() ||</div>
<div class="line"><a name="l06291"></a><span class="lineno"> 6291</span>&#160;      !HasDefaultResults)</div>
<div class="line"><a name="l06292"></a><span class="lineno"> 6292</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06293"></a><span class="lineno"> 6293</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(ResultTypes, [&amp;](<span class="keyword">const</span> <span class="keyword">auto</span> &amp;KV) {</div>
<div class="line"><a name="l06294"></a><span class="lineno"> 6294</span>&#160;    <span class="keywordflow">return</span> SwitchLookupTable::WouldFitInRegister(</div>
<div class="line"><a name="l06295"></a><span class="lineno"> 6295</span>&#160;        <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, MaxCaseVal.<a class="code" href="classllvm_1_1ConstantInt.html#a31e8da5adf63afd38b4ab94bca823150">getLimitedValue</a>() + 1 <span class="comment">/* TableSize */</span>,</div>
<div class="line"><a name="l06296"></a><span class="lineno"> 6296</span>&#160;        KV.second <span class="comment">/* ResultType */</span>);</div>
<div class="line"><a name="l06297"></a><span class="lineno"> 6297</span>&#160;  });</div>
<div class="line"><a name="l06298"></a><span class="lineno"> 6298</span>&#160;}</div>
<div class="line"><a name="l06299"></a><span class="lineno"> 6299</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l06300"></a><span class="lineno"> 6300</span>&#160;<span class="comment">/// Try to reuse the switch table index compare. Following pattern:</span></div>
<div class="line"><a name="l06301"></a><span class="lineno"> 6301</span>&#160;<span class="comment">/// \code</span></div>
<div class="line"><a name="l06302"></a><span class="lineno"> 6302</span>&#160;<span class="comment">///     if (idx &lt; tablesize)</span></div>
<div class="line"><a name="l06303"></a><span class="lineno"> 6303</span>&#160;<span class="comment">///        r = table[idx]; // table does not contain default_value</span></div>
<div class="line"><a name="l06304"></a><span class="lineno"> 6304</span>&#160;<span class="comment">///     else</span></div>
<div class="line"><a name="l06305"></a><span class="lineno"> 6305</span>&#160;<span class="comment">///        r = default_value;</span></div>
<div class="line"><a name="l06306"></a><span class="lineno"> 6306</span>&#160;<span class="comment">///     if (r != default_value)</span></div>
<div class="line"><a name="l06307"></a><span class="lineno"> 6307</span>&#160;<span class="comment">///        ...</span></div>
<div class="line"><a name="l06308"></a><span class="lineno"> 6308</span>&#160;<span class="comment">/// \endcode</span></div>
<div class="line"><a name="l06309"></a><span class="lineno"> 6309</span>&#160;<span class="comment">/// Is optimized to:</span></div>
<div class="line"><a name="l06310"></a><span class="lineno"> 6310</span>&#160;<span class="comment">/// \code</span></div>
<div class="line"><a name="l06311"></a><span class="lineno"> 6311</span>&#160;<span class="comment">///     cond = idx &lt; tablesize;</span></div>
<div class="line"><a name="l06312"></a><span class="lineno"> 6312</span>&#160;<span class="comment">///     if (cond)</span></div>
<div class="line"><a name="l06313"></a><span class="lineno"> 6313</span>&#160;<span class="comment">///        r = table[idx];</span></div>
<div class="line"><a name="l06314"></a><span class="lineno"> 6314</span>&#160;<span class="comment">///     else</span></div>
<div class="line"><a name="l06315"></a><span class="lineno"> 6315</span>&#160;<span class="comment">///        r = default_value;</span></div>
<div class="line"><a name="l06316"></a><span class="lineno"> 6316</span>&#160;<span class="comment">///     if (cond)</span></div>
<div class="line"><a name="l06317"></a><span class="lineno"> 6317</span>&#160;<span class="comment">///        ...</span></div>
<div class="line"><a name="l06318"></a><span class="lineno"> 6318</span>&#160;<span class="comment">/// \endcode</span></div>
<div class="line"><a name="l06319"></a><span class="lineno"> 6319</span>&#160;<span class="comment">/// Jump threading will then eliminate the second if(cond).</span></div>
<div class="line"><a name="l06320"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#ade535503b3e25a50c34919be8081e6f3"> 6320</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="SimplifyCFG_8cpp.html#ade535503b3e25a50c34919be8081e6f3">reuseTableCompare</a>(</div>
<div class="line"><a name="l06321"></a><span class="lineno"> 6321</span>&#160;    <a class="code" href="classllvm_1_1User.html">User</a> *PhiUser, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PhiBlock, <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *RangeCheckBranch,</div>
<div class="line"><a name="l06322"></a><span class="lineno"> 6322</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *DefaultValue,</div>
<div class="line"><a name="l06323"></a><span class="lineno"> 6323</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl</a>&lt;std::pair&lt;ConstantInt *, Constant *&gt;&gt; &amp;Values) {</div>
<div class="line"><a name="l06324"></a><span class="lineno"> 6324</span>&#160;  <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *<a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a> = dyn_cast&lt;ICmpInst&gt;(PhiUser);</div>
<div class="line"><a name="l06325"></a><span class="lineno"> 6325</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a>)</div>
<div class="line"><a name="l06326"></a><span class="lineno"> 6326</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l06327"></a><span class="lineno"> 6327</span>&#160; </div>
<div class="line"><a name="l06328"></a><span class="lineno"> 6328</span>&#160;  <span class="comment">// We require that the compare is in the same block as the phi so that jump</span></div>
<div class="line"><a name="l06329"></a><span class="lineno"> 6329</span>&#160;  <span class="comment">// threading can do its work afterwards.</span></div>
<div class="line"><a name="l06330"></a><span class="lineno"> 6330</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a>-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() != PhiBlock)</div>
<div class="line"><a name="l06331"></a><span class="lineno"> 6331</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l06332"></a><span class="lineno"> 6332</span>&#160; </div>
<div class="line"><a name="l06333"></a><span class="lineno"> 6333</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *CmpOp1 = dyn_cast&lt;Constant&gt;(<a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a>-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1));</div>
<div class="line"><a name="l06334"></a><span class="lineno"> 6334</span>&#160;  <span class="keywordflow">if</span> (!CmpOp1)</div>
<div class="line"><a name="l06335"></a><span class="lineno"> 6335</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l06336"></a><span class="lineno"> 6336</span>&#160; </div>
<div class="line"><a name="l06337"></a><span class="lineno"> 6337</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *RangeCmp = RangeCheckBranch-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>();</div>
<div class="line"><a name="l06338"></a><span class="lineno"> 6338</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *TrueConst = <a class="code" href="InstructionSimplify_8cpp.html#a565dd825f238fa0a8c4bbfe562635f7c">ConstantInt::getTrue</a>(RangeCmp-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l06339"></a><span class="lineno"> 6339</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *FalseConst = <a class="code" href="InstructionSimplify_8cpp.html#adb39181b87dffcd61082d08e02bf314e">ConstantInt::getFalse</a>(RangeCmp-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l06340"></a><span class="lineno"> 6340</span>&#160; </div>
<div class="line"><a name="l06341"></a><span class="lineno"> 6341</span>&#160;  <span class="comment">// Check if the compare with the default value is constant true or false.</span></div>
<div class="line"><a name="l06342"></a><span class="lineno"> 6342</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *DefaultConst = ConstantExpr::getICmp(<a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a>-&gt;<a class="code" href="classllvm_1_1CmpInst.html#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>(),</div>
<div class="line"><a name="l06343"></a><span class="lineno"> 6343</span>&#160;                                                 DefaultValue, CmpOp1, <span class="keyword">true</span>);</div>
<div class="line"><a name="l06344"></a><span class="lineno"> 6344</span>&#160;  <span class="keywordflow">if</span> (DefaultConst != TrueConst &amp;&amp; DefaultConst != FalseConst)</div>
<div class="line"><a name="l06345"></a><span class="lineno"> 6345</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l06346"></a><span class="lineno"> 6346</span>&#160; </div>
<div class="line"><a name="l06347"></a><span class="lineno"> 6347</span>&#160;  <span class="comment">// Check if the compare with the case values is distinct from the default</span></div>
<div class="line"><a name="l06348"></a><span class="lineno"> 6348</span>&#160;  <span class="comment">// compare result.</span></div>
<div class="line"><a name="l06349"></a><span class="lineno"> 6349</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> ValuePair : Values) {</div>
<div class="line"><a name="l06350"></a><span class="lineno"> 6350</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *CaseConst = ConstantExpr::getICmp(<a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a>-&gt;<a class="code" href="classllvm_1_1CmpInst.html#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>(),</div>
<div class="line"><a name="l06351"></a><span class="lineno"> 6351</span>&#160;                                                ValuePair.second, CmpOp1, <span class="keyword">true</span>);</div>
<div class="line"><a name="l06352"></a><span class="lineno"> 6352</span>&#160;    <span class="keywordflow">if</span> (!CaseConst || CaseConst == DefaultConst ||</div>
<div class="line"><a name="l06353"></a><span class="lineno"> 6353</span>&#160;        (CaseConst != TrueConst &amp;&amp; CaseConst != FalseConst))</div>
<div class="line"><a name="l06354"></a><span class="lineno"> 6354</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l06355"></a><span class="lineno"> 6355</span>&#160;  }</div>
<div class="line"><a name="l06356"></a><span class="lineno"> 6356</span>&#160; </div>
<div class="line"><a name="l06357"></a><span class="lineno"> 6357</span>&#160;  <span class="comment">// Check if the branch instruction dominates the phi node. It&#39;s a simple</span></div>
<div class="line"><a name="l06358"></a><span class="lineno"> 6358</span>&#160;  <span class="comment">// dominance check, but sufficient for our needs.</span></div>
<div class="line"><a name="l06359"></a><span class="lineno"> 6359</span>&#160;  <span class="comment">// Although this check is invariant in the calling loops, it&#39;s better to do it</span></div>
<div class="line"><a name="l06360"></a><span class="lineno"> 6360</span>&#160;  <span class="comment">// at this late stage. Practically we do it at most once for a switch.</span></div>
<div class="line"><a name="l06361"></a><span class="lineno"> 6361</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BranchBlock = RangeCheckBranch-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l06362"></a><span class="lineno"> 6362</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred : <a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(PhiBlock)) {</div>
<div class="line"><a name="l06363"></a><span class="lineno"> 6363</span>&#160;    <span class="keywordflow">if</span> (Pred != BranchBlock &amp;&amp; Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a74aa9daea070e2ad3394a3ec58b7316a">getUniquePredecessor</a>() != BranchBlock)</div>
<div class="line"><a name="l06364"></a><span class="lineno"> 6364</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l06365"></a><span class="lineno"> 6365</span>&#160;  }</div>
<div class="line"><a name="l06366"></a><span class="lineno"> 6366</span>&#160; </div>
<div class="line"><a name="l06367"></a><span class="lineno"> 6367</span>&#160;  <span class="keywordflow">if</span> (DefaultConst == FalseConst) {</div>
<div class="line"><a name="l06368"></a><span class="lineno"> 6368</span>&#160;    <span class="comment">// The compare yields the same result. We can replace it.</span></div>
<div class="line"><a name="l06369"></a><span class="lineno"> 6369</span>&#160;    <a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a>-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(RangeCmp);</div>
<div class="line"><a name="l06370"></a><span class="lineno"> 6370</span>&#160;    ++NumTableCmpReuses;</div>
<div class="line"><a name="l06371"></a><span class="lineno"> 6371</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06372"></a><span class="lineno"> 6372</span>&#160;    <span class="comment">// The compare yields the same result, just inverted. We can replace it.</span></div>
<div class="line"><a name="l06373"></a><span class="lineno"> 6373</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *InvertedTableCmp = BinaryOperator::CreateXor(</div>
<div class="line"><a name="l06374"></a><span class="lineno"> 6374</span>&#160;        RangeCmp, <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(RangeCmp-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), 1), <span class="stringliteral">&quot;inverted.cmp&quot;</span>,</div>
<div class="line"><a name="l06375"></a><span class="lineno"> 6375</span>&#160;        RangeCheckBranch);</div>
<div class="line"><a name="l06376"></a><span class="lineno"> 6376</span>&#160;    <a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a>-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(InvertedTableCmp);</div>
<div class="line"><a name="l06377"></a><span class="lineno"> 6377</span>&#160;    ++NumTableCmpReuses;</div>
<div class="line"><a name="l06378"></a><span class="lineno"> 6378</span>&#160;  }</div>
<div class="line"><a name="l06379"></a><span class="lineno"> 6379</span>&#160;}</div>
<div class="line"><a name="l06380"></a><span class="lineno"> 6380</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l06381"></a><span class="lineno"> 6381</span>&#160;<span class="comment">/// If the switch is only used to initialize one or more phi nodes in a common</span></div>
<div class="line"><a name="l06382"></a><span class="lineno"> 6382</span>&#160;<span class="comment">/// successor block with different constant values, replace the switch with</span></div>
<div class="line"><a name="l06383"></a><span class="lineno"> 6383</span>&#160;<span class="comment">/// lookup tables.</span></div>
<div class="line"><a name="l06384"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#ac35d942f5e82c11d2f1752829b5b21de"> 6384</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#ac35d942f5e82c11d2f1752829b5b21de">SwitchToLookupTable</a>(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>,</div>
<div class="line"><a name="l06385"></a><span class="lineno"> 6385</span>&#160;                                <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> *DTU, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</div>
<div class="line"><a name="l06386"></a><span class="lineno"> 6386</span>&#160;                                <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) {</div>
<div class="line"><a name="l06387"></a><span class="lineno"> 6387</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getNumCases() &gt; 1 &amp;&amp; <span class="stringliteral">&quot;Degenerate switch?&quot;</span>);</div>
<div class="line"><a name="l06388"></a><span class="lineno"> 6388</span>&#160; </div>
<div class="line"><a name="l06389"></a><span class="lineno"> 6389</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getParent();</div>
<div class="line"><a name="l06390"></a><span class="lineno"> 6390</span>&#160;  <a class="code" href="classllvm_1_1Function.html">Function</a> *Fn = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getParent();</div>
<div class="line"><a name="l06391"></a><span class="lineno"> 6391</span>&#160;  <span class="comment">// Only build lookup table when we have a target that supports it or the</span></div>
<div class="line"><a name="l06392"></a><span class="lineno"> 6392</span>&#160;  <span class="comment">// attribute is not set.</span></div>
<div class="line"><a name="l06393"></a><span class="lineno"> 6393</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a0d5b47e1f017620a784b726852915d58">shouldBuildLookupTables</a>() ||</div>
<div class="line"><a name="l06394"></a><span class="lineno"> 6394</span>&#160;      (Fn-&gt;<a class="code" href="classllvm_1_1Function.html#a4c319db4fe05c27cfe55bd133a87414d">getFnAttribute</a>(<span class="stringliteral">&quot;no-jump-tables&quot;</span>).<a class="code" href="classllvm_1_1Attribute.html#a70f42ed02a8993b84bdf97da5d54d097">getValueAsBool</a>()))</div>
<div class="line"><a name="l06395"></a><span class="lineno"> 6395</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06396"></a><span class="lineno"> 6396</span>&#160; </div>
<div class="line"><a name="l06397"></a><span class="lineno"> 6397</span>&#160;  <span class="comment">// FIXME: If the switch is too sparse for a lookup table, perhaps we could</span></div>
<div class="line"><a name="l06398"></a><span class="lineno"> 6398</span>&#160;  <span class="comment">// split off a dense part and build a lookup table for that.</span></div>
<div class="line"><a name="l06399"></a><span class="lineno"> 6399</span>&#160; </div>
<div class="line"><a name="l06400"></a><span class="lineno"> 6400</span>&#160;  <span class="comment">// FIXME: This creates arrays of GEPs to constant strings, which means each</span></div>
<div class="line"><a name="l06401"></a><span class="lineno"> 6401</span>&#160;  <span class="comment">// GEP needs a runtime relocation in PIC code. We should just build one big</span></div>
<div class="line"><a name="l06402"></a><span class="lineno"> 6402</span>&#160;  <span class="comment">// string and lookup indices into that.</span></div>
<div class="line"><a name="l06403"></a><span class="lineno"> 6403</span>&#160; </div>
<div class="line"><a name="l06404"></a><span class="lineno"> 6404</span>&#160;  <span class="comment">// Ignore switches with less than three cases. Lookup tables will not make</span></div>
<div class="line"><a name="l06405"></a><span class="lineno"> 6405</span>&#160;  <span class="comment">// them faster, so we don&#39;t analyze them.</span></div>
<div class="line"><a name="l06406"></a><span class="lineno"> 6406</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getNumCases() &lt; 3)</div>
<div class="line"><a name="l06407"></a><span class="lineno"> 6407</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06408"></a><span class="lineno"> 6408</span>&#160; </div>
<div class="line"><a name="l06409"></a><span class="lineno"> 6409</span>&#160;  <span class="comment">// Figure out the corresponding result for each case value and phi node in the</span></div>
<div class="line"><a name="l06410"></a><span class="lineno"> 6410</span>&#160;  <span class="comment">// common destination, as well as the min and max case values.</span></div>
<div class="line"><a name="l06411"></a><span class="lineno"> 6411</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;cases().empty());</div>
<div class="line"><a name="l06412"></a><span class="lineno"> 6412</span>&#160;  <a class="code" href="classllvm_1_1SwitchInst_1_1CaseIteratorImpl.html">SwitchInst::CaseIt</a> CI = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;case_begin();</div>
<div class="line"><a name="l06413"></a><span class="lineno"> 6413</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *MinCaseVal = CI-&gt;getCaseValue();</div>
<div class="line"><a name="l06414"></a><span class="lineno"> 6414</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *MaxCaseVal = CI-&gt;getCaseValue();</div>
<div class="line"><a name="l06415"></a><span class="lineno"> 6415</span>&#160; </div>
<div class="line"><a name="l06416"></a><span class="lineno"> 6416</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *CommonDest = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06417"></a><span class="lineno"> 6417</span>&#160; </div>
<div class="line"><a name="l06418"></a><span class="lineno"> 6418</span>&#160;  <span class="keyword">using</span> ResultListTy = <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;ConstantInt *, Constant *&gt;</a>, 4&gt;;</div>
<div class="line"><a name="l06419"></a><span class="lineno"> 6419</span>&#160;  <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;PHINode *, ResultListTy&gt;</a> ResultLists;</div>
<div class="line"><a name="l06420"></a><span class="lineno"> 6420</span>&#160; </div>
<div class="line"><a name="l06421"></a><span class="lineno"> 6421</span>&#160;  <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;PHINode *, Constant *&gt;</a> DefaultResults;</div>
<div class="line"><a name="l06422"></a><span class="lineno"> 6422</span>&#160;  <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;PHINode *, Type *&gt;</a> ResultTypes;</div>
<div class="line"><a name="l06423"></a><span class="lineno"> 6423</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;PHINode *, 4&gt;</a> PHIs;</div>
<div class="line"><a name="l06424"></a><span class="lineno"> 6424</span>&#160; </div>
<div class="line"><a name="l06425"></a><span class="lineno"> 6425</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SwitchInst_1_1CaseIteratorImpl.html">SwitchInst::CaseIt</a> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;case_end(); CI != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++CI) {</div>
<div class="line"><a name="l06426"></a><span class="lineno"> 6426</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CaseVal = CI-&gt;getCaseValue();</div>
<div class="line"><a name="l06427"></a><span class="lineno"> 6427</span>&#160;    <span class="keywordflow">if</span> (CaseVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#adafa9575780f9246d1df0b7e2a619356">slt</a>(MinCaseVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>()))</div>
<div class="line"><a name="l06428"></a><span class="lineno"> 6428</span>&#160;      MinCaseVal = CaseVal;</div>
<div class="line"><a name="l06429"></a><span class="lineno"> 6429</span>&#160;    <span class="keywordflow">if</span> (CaseVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#a3d430216d32f4363e4df154599b98055">sgt</a>(MaxCaseVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>()))</div>
<div class="line"><a name="l06430"></a><span class="lineno"> 6430</span>&#160;      MaxCaseVal = CaseVal;</div>
<div class="line"><a name="l06431"></a><span class="lineno"> 6431</span>&#160; </div>
<div class="line"><a name="l06432"></a><span class="lineno"> 6432</span>&#160;    <span class="comment">// Resulting value at phi nodes for this case value.</span></div>
<div class="line"><a name="l06433"></a><span class="lineno"> 6433</span>&#160;    <span class="keyword">using</span> ResultsTy = <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;PHINode *, Constant *&gt;</a>, 4&gt;;</div>
<div class="line"><a name="l06434"></a><span class="lineno"> 6434</span>&#160;    ResultsTy <a class="code" href="AliasAnalysis_8cpp.html#a7e344cff0feadf0b02223fee63cc7475">Results</a>;</div>
<div class="line"><a name="l06435"></a><span class="lineno"> 6435</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#a3e42eb8e250f1bfc825a58cbd042342d">getCaseResults</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, CaseVal, CI-&gt;getCaseSuccessor(), &amp;CommonDest,</div>
<div class="line"><a name="l06436"></a><span class="lineno"> 6436</span>&#160;                        <a class="code" href="AliasAnalysis_8cpp.html#a7e344cff0feadf0b02223fee63cc7475">Results</a>, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>))</div>
<div class="line"><a name="l06437"></a><span class="lineno"> 6437</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06438"></a><span class="lineno"> 6438</span>&#160; </div>
<div class="line"><a name="l06439"></a><span class="lineno"> 6439</span>&#160;    <span class="comment">// Append the result from this case to the list for each phi.</span></div>
<div class="line"><a name="l06440"></a><span class="lineno"> 6440</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="AliasAnalysis_8cpp.html#a7e344cff0feadf0b02223fee63cc7475">Results</a>) {</div>
<div class="line"><a name="l06441"></a><span class="lineno"> 6441</span>&#160;      <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.first;</div>
<div class="line"><a name="l06442"></a><span class="lineno"> 6442</span>&#160;      <a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="classllvm_1_1Value.html">Value</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.second;</div>
<div class="line"><a name="l06443"></a><span class="lineno"> 6443</span>&#160;      <span class="keywordflow">if</span> (!ResultLists.<a class="code" href="classllvm_1_1DenseMapBase.html#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>))</div>
<div class="line"><a name="l06444"></a><span class="lineno"> 6444</span>&#160;        PHIs.push_back(<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>);</div>
<div class="line"><a name="l06445"></a><span class="lineno"> 6445</span>&#160;      ResultLists[<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>].push_back(std::make_pair(CaseVal, <a class="code" href="classllvm_1_1Value.html">Value</a>));</div>
<div class="line"><a name="l06446"></a><span class="lineno"> 6446</span>&#160;    }</div>
<div class="line"><a name="l06447"></a><span class="lineno"> 6447</span>&#160;  }</div>
<div class="line"><a name="l06448"></a><span class="lineno"> 6448</span>&#160; </div>
<div class="line"><a name="l06449"></a><span class="lineno"> 6449</span>&#160;  <span class="comment">// Keep track of the result types.</span></div>
<div class="line"><a name="l06450"></a><span class="lineno"> 6450</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> : PHIs) {</div>
<div class="line"><a name="l06451"></a><span class="lineno"> 6451</span>&#160;    ResultTypes[<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>] = ResultLists[<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>][0].second-&gt;getType();</div>
<div class="line"><a name="l06452"></a><span class="lineno"> 6452</span>&#160;  }</div>
<div class="line"><a name="l06453"></a><span class="lineno"> 6453</span>&#160; </div>
<div class="line"><a name="l06454"></a><span class="lineno"> 6454</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> NumResults = ResultLists[PHIs[0]].<a class="code" href="classllvm_1_1DenseMapBase.html#a3d95cc2d359b8d9ed5bd9504b44930b5">size</a>();</div>
<div class="line"><a name="l06455"></a><span class="lineno"> 6455</span>&#160; </div>
<div class="line"><a name="l06456"></a><span class="lineno"> 6456</span>&#160;  <span class="comment">// If the table has holes, we need a constant result for the default case</span></div>
<div class="line"><a name="l06457"></a><span class="lineno"> 6457</span>&#160;  <span class="comment">// or a bitmask that fits in a register.</span></div>
<div class="line"><a name="l06458"></a><span class="lineno"> 6458</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;PHINode *, Constant *&gt;</a>, 4&gt; DefaultResultsList;</div>
<div class="line"><a name="l06459"></a><span class="lineno"> 6459</span>&#160;  <span class="keywordtype">bool</span> HasDefaultResults =</div>
<div class="line"><a name="l06460"></a><span class="lineno"> 6460</span>&#160;      <a class="code" href="SimplifyCFG_8cpp.html#a3e42eb8e250f1bfc825a58cbd042342d">getCaseResults</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <span class="keyword">nullptr</span>, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDefaultDest(), &amp;CommonDest,</div>
<div class="line"><a name="l06461"></a><span class="lineno"> 6461</span>&#160;                     DefaultResultsList, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>);</div>
<div class="line"><a name="l06462"></a><span class="lineno"> 6462</span>&#160; </div>
<div class="line"><a name="l06463"></a><span class="lineno"> 6463</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : DefaultResultsList) {</div>
<div class="line"><a name="l06464"></a><span class="lineno"> 6464</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.first;</div>
<div class="line"><a name="l06465"></a><span class="lineno"> 6465</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Result = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.second;</div>
<div class="line"><a name="l06466"></a><span class="lineno"> 6466</span>&#160;    DefaultResults[<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>] = Result;</div>
<div class="line"><a name="l06467"></a><span class="lineno"> 6467</span>&#160;  }</div>
<div class="line"><a name="l06468"></a><span class="lineno"> 6468</span>&#160; </div>
<div class="line"><a name="l06469"></a><span class="lineno"> 6469</span>&#160;  <span class="keywordtype">bool</span> UseSwitchConditionAsTableIndex = <a class="code" href="SimplifyCFG_8cpp.html#ad65ca7ae85d9efe841f0c2f71cf5ee59">ShouldUseSwitchConditionAsTableIndex</a>(</div>
<div class="line"><a name="l06470"></a><span class="lineno"> 6470</span>&#160;      *MinCaseVal, *MaxCaseVal, HasDefaultResults, ResultTypes, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>);</div>
<div class="line"><a name="l06471"></a><span class="lineno"> 6471</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> TableSize;</div>
<div class="line"><a name="l06472"></a><span class="lineno"> 6472</span>&#160;  <span class="keywordflow">if</span> (UseSwitchConditionAsTableIndex)</div>
<div class="line"><a name="l06473"></a><span class="lineno"> 6473</span>&#160;    TableSize = MaxCaseVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a31e8da5adf63afd38b4ab94bca823150">getLimitedValue</a>() + 1;</div>
<div class="line"><a name="l06474"></a><span class="lineno"> 6474</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l06475"></a><span class="lineno"> 6475</span>&#160;    TableSize =</div>
<div class="line"><a name="l06476"></a><span class="lineno"> 6476</span>&#160;        (MaxCaseVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>() - MinCaseVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>()).getLimitedValue() + 1;</div>
<div class="line"><a name="l06477"></a><span class="lineno"> 6477</span>&#160; </div>
<div class="line"><a name="l06478"></a><span class="lineno"> 6478</span>&#160;  <span class="keywordtype">bool</span> TableHasHoles = (NumResults &lt; TableSize);</div>
<div class="line"><a name="l06479"></a><span class="lineno"> 6479</span>&#160;  <span class="keywordtype">bool</span> NeedMask = (TableHasHoles &amp;&amp; !HasDefaultResults);</div>
<div class="line"><a name="l06480"></a><span class="lineno"> 6480</span>&#160;  <span class="keywordflow">if</span> (NeedMask) {</div>
<div class="line"><a name="l06481"></a><span class="lineno"> 6481</span>&#160;    <span class="comment">// As an extra penalty for the validity test we require more cases.</span></div>
<div class="line"><a name="l06482"></a><span class="lineno"> 6482</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getNumCases() &lt; 4) <span class="comment">// FIXME: Find best threshold value (benchmark).</span></div>
<div class="line"><a name="l06483"></a><span class="lineno"> 6483</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06484"></a><span class="lineno"> 6484</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.fitsInLegalInteger(TableSize))</div>
<div class="line"><a name="l06485"></a><span class="lineno"> 6485</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06486"></a><span class="lineno"> 6486</span>&#160;  }</div>
<div class="line"><a name="l06487"></a><span class="lineno"> 6487</span>&#160; </div>
<div class="line"><a name="l06488"></a><span class="lineno"> 6488</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#a60140c11a583d97cc18631485559f237">ShouldBuildLookupTable</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, TableSize, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, ResultTypes))</div>
<div class="line"><a name="l06489"></a><span class="lineno"> 6489</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06490"></a><span class="lineno"> 6490</span>&#160; </div>
<div class="line"><a name="l06491"></a><span class="lineno"> 6491</span>&#160;  std::vector&lt;DominatorTree::UpdateType&gt; Updates;</div>
<div class="line"><a name="l06492"></a><span class="lineno"> 6492</span>&#160; </div>
<div class="line"><a name="l06493"></a><span class="lineno"> 6493</span>&#160;  <span class="comment">// Create the BB that does the lookups.</span></div>
<div class="line"><a name="l06494"></a><span class="lineno"> 6494</span>&#160;  <a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="PassBuilderBindings_8cpp.html#a76adb4549f349676de0a703a497ca5a5">Mod</a> = *CommonDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">getParent</a>()-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">getParent</a>();</div>
<div class="line"><a name="l06495"></a><span class="lineno"> 6495</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *LookupBB = BasicBlock::Create(</div>
<div class="line"><a name="l06496"></a><span class="lineno"> 6496</span>&#160;      <a class="code" href="PassBuilderBindings_8cpp.html#a76adb4549f349676de0a703a497ca5a5">Mod</a>.<a class="code" href="classllvm_1_1Module.html#a9c00c70121af456007404bd456047766">getContext</a>(), <span class="stringliteral">&quot;switch.lookup&quot;</span>, CommonDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">getParent</a>(), CommonDest);</div>
<div class="line"><a name="l06497"></a><span class="lineno"> 6497</span>&#160; </div>
<div class="line"><a name="l06498"></a><span class="lineno"> 6498</span>&#160;  <span class="comment">// Compute the table index value.</span></div>
<div class="line"><a name="l06499"></a><span class="lineno"> 6499</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l06500"></a><span class="lineno"> 6500</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *TableIndex;</div>
<div class="line"><a name="l06501"></a><span class="lineno"> 6501</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *TableIndexOffset;</div>
<div class="line"><a name="l06502"></a><span class="lineno"> 6502</span>&#160;  <span class="keywordflow">if</span> (UseSwitchConditionAsTableIndex) {</div>
<div class="line"><a name="l06503"></a><span class="lineno"> 6503</span>&#160;    TableIndexOffset = <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(MaxCaseVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#afe3ce7fc89f36474eb0369cbb792c05a">getType</a>(), 0);</div>
<div class="line"><a name="l06504"></a><span class="lineno"> 6504</span>&#160;    TableIndex = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition();</div>
<div class="line"><a name="l06505"></a><span class="lineno"> 6505</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06506"></a><span class="lineno"> 6506</span>&#160;    TableIndexOffset = MinCaseVal;</div>
<div class="line"><a name="l06507"></a><span class="lineno"> 6507</span>&#160;    TableIndex =</div>
<div class="line"><a name="l06508"></a><span class="lineno"> 6508</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSub(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition(), TableIndexOffset, <span class="stringliteral">&quot;switch.tableidx&quot;</span>);</div>
<div class="line"><a name="l06509"></a><span class="lineno"> 6509</span>&#160;  }</div>
<div class="line"><a name="l06510"></a><span class="lineno"> 6510</span>&#160; </div>
<div class="line"><a name="l06511"></a><span class="lineno"> 6511</span>&#160;  <span class="comment">// Compute the maximum table size representable by the integer type we are</span></div>
<div class="line"><a name="l06512"></a><span class="lineno"> 6512</span>&#160;  <span class="comment">// switching upon.</span></div>
<div class="line"><a name="l06513"></a><span class="lineno"> 6513</span>&#160;  <span class="keywordtype">unsigned</span> CaseSize = MinCaseVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#afe3ce7fc89f36474eb0369cbb792c05a">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a833daf718a49c5cd637d8c9ddeaebe07">getPrimitiveSizeInBits</a>();</div>
<div class="line"><a name="l06514"></a><span class="lineno"> 6514</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> MaxTableSize = CaseSize &gt; 63 ? <a class="code" href="c_2DataTypes_8h.html#a30654b4b67d97c42ca3f9b6052dda916">UINT64_MAX</a> : 1ULL &lt;&lt; CaseSize;</div>
<div class="line"><a name="l06515"></a><span class="lineno"> 6515</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MaxTableSize &gt;= TableSize &amp;&amp;</div>
<div class="line"><a name="l06516"></a><span class="lineno"> 6516</span>&#160;         <span class="stringliteral">&quot;It is impossible for a switch to have more entries than the max &quot;</span></div>
<div class="line"><a name="l06517"></a><span class="lineno"> 6517</span>&#160;         <span class="stringliteral">&quot;representable value of its input integer type&#39;s size.&quot;</span>);</div>
<div class="line"><a name="l06518"></a><span class="lineno"> 6518</span>&#160; </div>
<div class="line"><a name="l06519"></a><span class="lineno"> 6519</span>&#160;  <span class="comment">// If the default destination is unreachable, or if the lookup table covers</span></div>
<div class="line"><a name="l06520"></a><span class="lineno"> 6520</span>&#160;  <span class="comment">// all values of the conditional variable, branch directly to the lookup table</span></div>
<div class="line"><a name="l06521"></a><span class="lineno"> 6521</span>&#160;  <span class="comment">// BB. Otherwise, check that the condition is within the case range.</span></div>
<div class="line"><a name="l06522"></a><span class="lineno"> 6522</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> DefaultIsReachable =</div>
<div class="line"><a name="l06523"></a><span class="lineno"> 6523</span>&#160;      !isa&lt;UnreachableInst&gt;(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDefaultDest()-&gt;getFirstNonPHIOrDbg());</div>
<div class="line"><a name="l06524"></a><span class="lineno"> 6524</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> GeneratingCoveredLookupTable = (MaxTableSize == TableSize);</div>
<div class="line"><a name="l06525"></a><span class="lineno"> 6525</span>&#160;  <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *RangeCheckBranch = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06526"></a><span class="lineno"> 6526</span>&#160; </div>
<div class="line"><a name="l06527"></a><span class="lineno"> 6527</span>&#160;  <span class="keywordflow">if</span> (!DefaultIsReachable || GeneratingCoveredLookupTable) {</div>
<div class="line"><a name="l06528"></a><span class="lineno"> 6528</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBr(LookupBB);</div>
<div class="line"><a name="l06529"></a><span class="lineno"> 6529</span>&#160;    <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l06530"></a><span class="lineno"> 6530</span>&#160;      Updates.push_back({<a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">DominatorTree::Insert</a>, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, LookupBB});</div>
<div class="line"><a name="l06531"></a><span class="lineno"> 6531</span>&#160;    <span class="comment">// Note: We call removeProdecessor later since we need to be able to get the</span></div>
<div class="line"><a name="l06532"></a><span class="lineno"> 6532</span>&#160;    <span class="comment">// PHI value for the default case in case we&#39;re using a bit mask.</span></div>
<div class="line"><a name="l06533"></a><span class="lineno"> 6533</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06534"></a><span class="lineno"> 6534</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Cmp = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateICmpULT(</div>
<div class="line"><a name="l06535"></a><span class="lineno"> 6535</span>&#160;        TableIndex, <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(MinCaseVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#afe3ce7fc89f36474eb0369cbb792c05a">getType</a>(), TableSize));</div>
<div class="line"><a name="l06536"></a><span class="lineno"> 6536</span>&#160;    RangeCheckBranch =</div>
<div class="line"><a name="l06537"></a><span class="lineno"> 6537</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCondBr(Cmp, LookupBB, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDefaultDest());</div>
<div class="line"><a name="l06538"></a><span class="lineno"> 6538</span>&#160;    <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l06539"></a><span class="lineno"> 6539</span>&#160;      Updates.push_back({<a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">DominatorTree::Insert</a>, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, LookupBB});</div>
<div class="line"><a name="l06540"></a><span class="lineno"> 6540</span>&#160;  }</div>
<div class="line"><a name="l06541"></a><span class="lineno"> 6541</span>&#160; </div>
<div class="line"><a name="l06542"></a><span class="lineno"> 6542</span>&#160;  <span class="comment">// Populate the BB that does the lookups.</span></div>
<div class="line"><a name="l06543"></a><span class="lineno"> 6543</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(LookupBB);</div>
<div class="line"><a name="l06544"></a><span class="lineno"> 6544</span>&#160; </div>
<div class="line"><a name="l06545"></a><span class="lineno"> 6545</span>&#160;  <span class="keywordflow">if</span> (NeedMask) {</div>
<div class="line"><a name="l06546"></a><span class="lineno"> 6546</span>&#160;    <span class="comment">// Before doing the lookup, we do the hole check. The LookupBB is therefore</span></div>
<div class="line"><a name="l06547"></a><span class="lineno"> 6547</span>&#160;    <span class="comment">// re-purposed to do the hole check, and we create a new LookupBB.</span></div>
<div class="line"><a name="l06548"></a><span class="lineno"> 6548</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *MaskBB = LookupBB;</div>
<div class="line"><a name="l06549"></a><span class="lineno"> 6549</span>&#160;    MaskBB-&gt;<a class="code" href="classllvm_1_1Value.html#a35ee267850af7c235474a8c46c7ac5af">setName</a>(<span class="stringliteral">&quot;switch.hole_check&quot;</span>);</div>
<div class="line"><a name="l06550"></a><span class="lineno"> 6550</span>&#160;    LookupBB = BasicBlock::Create(<a class="code" href="PassBuilderBindings_8cpp.html#a76adb4549f349676de0a703a497ca5a5">Mod</a>.<a class="code" href="classllvm_1_1Module.html#a9c00c70121af456007404bd456047766">getContext</a>(), <span class="stringliteral">&quot;switch.lookup&quot;</span>,</div>
<div class="line"><a name="l06551"></a><span class="lineno"> 6551</span>&#160;                                  CommonDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">getParent</a>(), CommonDest);</div>
<div class="line"><a name="l06552"></a><span class="lineno"> 6552</span>&#160; </div>
<div class="line"><a name="l06553"></a><span class="lineno"> 6553</span>&#160;    <span class="comment">// Make the mask&#39;s bitwidth at least 8-bit and a power-of-2 to avoid</span></div>
<div class="line"><a name="l06554"></a><span class="lineno"> 6554</span>&#160;    <span class="comment">// unnecessary illegal types.</span></div>
<div class="line"><a name="l06555"></a><span class="lineno"> 6555</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> TableSizePowOf2 = <a class="code" href="namespacellvm.html#afb65eef479f0473d0fe1666b80155237">NextPowerOf2</a>(<a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(7ULL, TableSize - 1ULL));</div>
<div class="line"><a name="l06556"></a><span class="lineno"> 6556</span>&#160;    <a class="code" href="classllvm_1_1APInt.html">APInt</a> MaskInt(TableSizePowOf2, 0);</div>
<div class="line"><a name="l06557"></a><span class="lineno"> 6557</span>&#160;    <a class="code" href="classllvm_1_1APInt.html">APInt</a> One(TableSizePowOf2, 1);</div>
<div class="line"><a name="l06558"></a><span class="lineno"> 6558</span>&#160;    <span class="comment">// Build bitmask; fill in a 1 bit for every case.</span></div>
<div class="line"><a name="l06559"></a><span class="lineno"> 6559</span>&#160;    <span class="keyword">const</span> ResultListTy &amp;ResultList = ResultLists[PHIs[0]];</div>
<div class="line"><a name="l06560"></a><span class="lineno"> 6560</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = ResultList.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l06561"></a><span class="lineno"> 6561</span>&#160;      <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Idx = (ResultList[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].first-&gt;getValue() - TableIndexOffset-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>())</div>
<div class="line"><a name="l06562"></a><span class="lineno"> 6562</span>&#160;                         .getLimitedValue();</div>
<div class="line"><a name="l06563"></a><span class="lineno"> 6563</span>&#160;      MaskInt |= One &lt;&lt; Idx;</div>
<div class="line"><a name="l06564"></a><span class="lineno"> 6564</span>&#160;    }</div>
<div class="line"><a name="l06565"></a><span class="lineno"> 6565</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *TableMask = <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(<a class="code" href="PassBuilderBindings_8cpp.html#a76adb4549f349676de0a703a497ca5a5">Mod</a>.<a class="code" href="classllvm_1_1Module.html#a9c00c70121af456007404bd456047766">getContext</a>(), MaskInt);</div>
<div class="line"><a name="l06566"></a><span class="lineno"> 6566</span>&#160; </div>
<div class="line"><a name="l06567"></a><span class="lineno"> 6567</span>&#160;    <span class="comment">// Get the TableIndex&#39;th bit of the bitmask.</span></div>
<div class="line"><a name="l06568"></a><span class="lineno"> 6568</span>&#160;    <span class="comment">// If this bit is 0 (meaning hole) jump to the default destination,</span></div>
<div class="line"><a name="l06569"></a><span class="lineno"> 6569</span>&#160;    <span class="comment">// else continue with table lookup.</span></div>
<div class="line"><a name="l06570"></a><span class="lineno"> 6570</span>&#160;    <a class="code" href="classllvm_1_1IntegerType.html">IntegerType</a> *MapTy = TableMask-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#afe3ce7fc89f36474eb0369cbb792c05a">getType</a>();</div>
<div class="line"><a name="l06571"></a><span class="lineno"> 6571</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *MaskIndex =</div>
<div class="line"><a name="l06572"></a><span class="lineno"> 6572</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateZExtOrTrunc(TableIndex, MapTy, <span class="stringliteral">&quot;switch.maskindex&quot;</span>);</div>
<div class="line"><a name="l06573"></a><span class="lineno"> 6573</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Shifted = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateLShr(TableMask, MaskIndex, <span class="stringliteral">&quot;switch.shifted&quot;</span>);</div>
<div class="line"><a name="l06574"></a><span class="lineno"> 6574</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *LoBit = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateTrunc(</div>
<div class="line"><a name="l06575"></a><span class="lineno"> 6575</span>&#160;        Shifted, Type::getInt1Ty(<a class="code" href="PassBuilderBindings_8cpp.html#a76adb4549f349676de0a703a497ca5a5">Mod</a>.<a class="code" href="classllvm_1_1Module.html#a9c00c70121af456007404bd456047766">getContext</a>()), <span class="stringliteral">&quot;switch.lobit&quot;</span>);</div>
<div class="line"><a name="l06576"></a><span class="lineno"> 6576</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCondBr(LoBit, LookupBB, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDefaultDest());</div>
<div class="line"><a name="l06577"></a><span class="lineno"> 6577</span>&#160;    <span class="keywordflow">if</span> (DTU) {</div>
<div class="line"><a name="l06578"></a><span class="lineno"> 6578</span>&#160;      Updates.push_back({<a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">DominatorTree::Insert</a>, MaskBB, LookupBB});</div>
<div class="line"><a name="l06579"></a><span class="lineno"> 6579</span>&#160;      Updates.push_back({<a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">DominatorTree::Insert</a>, MaskBB, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDefaultDest()});</div>
<div class="line"><a name="l06580"></a><span class="lineno"> 6580</span>&#160;    }</div>
<div class="line"><a name="l06581"></a><span class="lineno"> 6581</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(LookupBB);</div>
<div class="line"><a name="l06582"></a><span class="lineno"> 6582</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#a41a075ef4b76f72591e86e1fe13f096d">AddPredecessorToBlock</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDefaultDest(), MaskBB, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l06583"></a><span class="lineno"> 6583</span>&#160;  }</div>
<div class="line"><a name="l06584"></a><span class="lineno"> 6584</span>&#160; </div>
<div class="line"><a name="l06585"></a><span class="lineno"> 6585</span>&#160;  <span class="keywordflow">if</span> (!DefaultIsReachable || GeneratingCoveredLookupTable) {</div>
<div class="line"><a name="l06586"></a><span class="lineno"> 6586</span>&#160;    <span class="comment">// We cached PHINodes in PHIs. To avoid accessing deleted PHINodes later,</span></div>
<div class="line"><a name="l06587"></a><span class="lineno"> 6587</span>&#160;    <span class="comment">// do not delete PHINodes here.</span></div>
<div class="line"><a name="l06588"></a><span class="lineno"> 6588</span>&#160;    <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDefaultDest()-&gt;removePredecessor(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>,</div>
<div class="line"><a name="l06589"></a><span class="lineno"> 6589</span>&#160;                                            <span class="comment">/*KeepOneInputPHIs=*/</span><span class="keyword">true</span>);</div>
<div class="line"><a name="l06590"></a><span class="lineno"> 6590</span>&#160;    <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l06591"></a><span class="lineno"> 6591</span>&#160;      Updates.push_back({DominatorTree::Delete, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDefaultDest()});</div>
<div class="line"><a name="l06592"></a><span class="lineno"> 6592</span>&#160;  }</div>
<div class="line"><a name="l06593"></a><span class="lineno"> 6593</span>&#160; </div>
<div class="line"><a name="l06594"></a><span class="lineno"> 6594</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> : PHIs) {</div>
<div class="line"><a name="l06595"></a><span class="lineno"> 6595</span>&#160;    <span class="keyword">const</span> ResultListTy &amp;ResultList = ResultLists[<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>];</div>
<div class="line"><a name="l06596"></a><span class="lineno"> 6596</span>&#160; </div>
<div class="line"><a name="l06597"></a><span class="lineno"> 6597</span>&#160;    <span class="comment">// If using a bitmask, use any value to fill the lookup table holes.</span></div>
<div class="line"><a name="l06598"></a><span class="lineno"> 6598</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *DV = NeedMask ? ResultLists[<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>][0].second : DefaultResults[<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>];</div>
<div class="line"><a name="l06599"></a><span class="lineno"> 6599</span>&#160;    <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> FuncName = Fn-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>();</div>
<div class="line"><a name="l06600"></a><span class="lineno"> 6600</span>&#160;    SwitchLookupTable Table(<a class="code" href="PassBuilderBindings_8cpp.html#a76adb4549f349676de0a703a497ca5a5">Mod</a>, TableSize, TableIndexOffset, ResultList, DV,</div>
<div class="line"><a name="l06601"></a><span class="lineno"> 6601</span>&#160;                            <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, FuncName);</div>
<div class="line"><a name="l06602"></a><span class="lineno"> 6602</span>&#160; </div>
<div class="line"><a name="l06603"></a><span class="lineno"> 6603</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Result = Table.BuildLookup(TableIndex, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l06604"></a><span class="lineno"> 6604</span>&#160; </div>
<div class="line"><a name="l06605"></a><span class="lineno"> 6605</span>&#160;    <span class="comment">// Do a small peephole optimization: re-use the switch table compare if</span></div>
<div class="line"><a name="l06606"></a><span class="lineno"> 6606</span>&#160;    <span class="comment">// possible.</span></div>
<div class="line"><a name="l06607"></a><span class="lineno"> 6607</span>&#160;    <span class="keywordflow">if</span> (!TableHasHoles &amp;&amp; HasDefaultResults &amp;&amp; RangeCheckBranch) {</div>
<div class="line"><a name="l06608"></a><span class="lineno"> 6608</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PhiBlock = <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getParent();</div>
<div class="line"><a name="l06609"></a><span class="lineno"> 6609</span>&#160;      <span class="comment">// Search for compare instructions which use the phi.</span></div>
<div class="line"><a name="l06610"></a><span class="lineno"> 6610</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="classllvm_1_1User.html">User</a> : <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;users()) {</div>
<div class="line"><a name="l06611"></a><span class="lineno"> 6611</span>&#160;        <a class="code" href="SimplifyCFG_8cpp.html#ade535503b3e25a50c34919be8081e6f3">reuseTableCompare</a>(<a class="code" href="classllvm_1_1User.html">User</a>, PhiBlock, RangeCheckBranch, DV, ResultList);</div>
<div class="line"><a name="l06612"></a><span class="lineno"> 6612</span>&#160;      }</div>
<div class="line"><a name="l06613"></a><span class="lineno"> 6613</span>&#160;    }</div>
<div class="line"><a name="l06614"></a><span class="lineno"> 6614</span>&#160; </div>
<div class="line"><a name="l06615"></a><span class="lineno"> 6615</span>&#160;    <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;addIncoming(Result, LookupBB);</div>
<div class="line"><a name="l06616"></a><span class="lineno"> 6616</span>&#160;  }</div>
<div class="line"><a name="l06617"></a><span class="lineno"> 6617</span>&#160; </div>
<div class="line"><a name="l06618"></a><span class="lineno"> 6618</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBr(CommonDest);</div>
<div class="line"><a name="l06619"></a><span class="lineno"> 6619</span>&#160;  <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l06620"></a><span class="lineno"> 6620</span>&#160;    Updates.push_back({<a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">DominatorTree::Insert</a>, LookupBB, CommonDest});</div>
<div class="line"><a name="l06621"></a><span class="lineno"> 6621</span>&#160; </div>
<div class="line"><a name="l06622"></a><span class="lineno"> 6622</span>&#160;  <span class="comment">// Remove the switch.</span></div>
<div class="line"><a name="l06623"></a><span class="lineno"> 6623</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BasicBlock *, 8&gt;</a> RemovedSuccessors;</div>
<div class="line"><a name="l06624"></a><span class="lineno"> 6624</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getNumSuccessors(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l06625"></a><span class="lineno"> 6625</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getSuccessor(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l06626"></a><span class="lineno"> 6626</span>&#160; </div>
<div class="line"><a name="l06627"></a><span class="lineno"> 6627</span>&#160;    <span class="keywordflow">if</span> (Succ == <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDefaultDest())</div>
<div class="line"><a name="l06628"></a><span class="lineno"> 6628</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06629"></a><span class="lineno"> 6629</span>&#160;    Succ-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l06630"></a><span class="lineno"> 6630</span>&#160;    <span class="keywordflow">if</span> (DTU &amp;&amp; RemovedSuccessors.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(Succ).second)</div>
<div class="line"><a name="l06631"></a><span class="lineno"> 6631</span>&#160;      Updates.push_back({DominatorTree::Delete, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, Succ});</div>
<div class="line"><a name="l06632"></a><span class="lineno"> 6632</span>&#160;  }</div>
<div class="line"><a name="l06633"></a><span class="lineno"> 6633</span>&#160;  <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l06634"></a><span class="lineno"> 6634</span>&#160; </div>
<div class="line"><a name="l06635"></a><span class="lineno"> 6635</span>&#160;  <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l06636"></a><span class="lineno"> 6636</span>&#160;    DTU-&gt;<a class="code" href="classllvm_1_1DomTreeUpdater.html#aae522cd1928cfac6850b50c7a3e22185">applyUpdates</a>(Updates);</div>
<div class="line"><a name="l06637"></a><span class="lineno"> 6637</span>&#160; </div>
<div class="line"><a name="l06638"></a><span class="lineno"> 6638</span>&#160;  ++NumLookupTables;</div>
<div class="line"><a name="l06639"></a><span class="lineno"> 6639</span>&#160;  <span class="keywordflow">if</span> (NeedMask)</div>
<div class="line"><a name="l06640"></a><span class="lineno"> 6640</span>&#160;    ++NumLookupTablesHoles;</div>
<div class="line"><a name="l06641"></a><span class="lineno"> 6641</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06642"></a><span class="lineno"> 6642</span>&#160;}</div>
<div class="line"><a name="l06643"></a><span class="lineno"> 6643</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l06644"></a><span class="lineno"> 6644</span>&#160;<span class="comment">/// Try to transform a switch that has &quot;holes&quot; in it to a contiguous sequence</span></div>
<div class="line"><a name="l06645"></a><span class="lineno"> 6645</span>&#160;<span class="comment">/// of cases.</span></div>
<div class="line"><a name="l06646"></a><span class="lineno"> 6646</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l06647"></a><span class="lineno"> 6647</span>&#160;<span class="comment">/// A switch such as: switch(i) {case 5: case 9: case 13: case 17:} can be</span></div>
<div class="line"><a name="l06648"></a><span class="lineno"> 6648</span>&#160;<span class="comment">/// range-reduced to: switch ((i-5) / 4) {case 0: case 1: case 2: case 3:}.</span></div>
<div class="line"><a name="l06649"></a><span class="lineno"> 6649</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l06650"></a><span class="lineno"> 6650</span>&#160;<span class="comment">/// This converts a sparse switch into a dense switch which allows better</span></div>
<div class="line"><a name="l06651"></a><span class="lineno"> 6651</span>&#160;<span class="comment">/// lowering and could also allow transforming into a lookup table.</span></div>
<div class="line"><a name="l06652"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a2b4678191aecb0ae9e493024c15c6c81"> 6652</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a2b4678191aecb0ae9e493024c15c6c81">ReduceSwitchRange</a>(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>,</div>
<div class="line"><a name="l06653"></a><span class="lineno"> 6653</span>&#160;                              <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</div>
<div class="line"><a name="l06654"></a><span class="lineno"> 6654</span>&#160;                              <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) {</div>
<div class="line"><a name="l06655"></a><span class="lineno"> 6655</span>&#160;  <span class="keyword">auto</span> *CondTy = cast&lt;IntegerType&gt;(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition()-&gt;getType());</div>
<div class="line"><a name="l06656"></a><span class="lineno"> 6656</span>&#160;  <span class="keywordflow">if</span> (CondTy-&gt;getIntegerBitWidth() &gt; 64 ||</div>
<div class="line"><a name="l06657"></a><span class="lineno"> 6657</span>&#160;      !<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.fitsInLegalInteger(CondTy-&gt;getIntegerBitWidth()))</div>
<div class="line"><a name="l06658"></a><span class="lineno"> 6658</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06659"></a><span class="lineno"> 6659</span>&#160;  <span class="comment">// Only bother with this optimization if there are more than 3 switch cases;</span></div>
<div class="line"><a name="l06660"></a><span class="lineno"> 6660</span>&#160;  <span class="comment">// SDAG will only bother creating jump tables for 4 or more cases.</span></div>
<div class="line"><a name="l06661"></a><span class="lineno"> 6661</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getNumCases() &lt; 4)</div>
<div class="line"><a name="l06662"></a><span class="lineno"> 6662</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06663"></a><span class="lineno"> 6663</span>&#160; </div>
<div class="line"><a name="l06664"></a><span class="lineno"> 6664</span>&#160;  <span class="comment">// This transform is agnostic to the signedness of the input or case values. We</span></div>
<div class="line"><a name="l06665"></a><span class="lineno"> 6665</span>&#160;  <span class="comment">// can treat the case values as signed or unsigned. We can optimize more common</span></div>
<div class="line"><a name="l06666"></a><span class="lineno"> 6666</span>&#160;  <span class="comment">// cases such as a sequence crossing zero {-4,0,4,8} if we interpret case values</span></div>
<div class="line"><a name="l06667"></a><span class="lineno"> 6667</span>&#160;  <span class="comment">// as signed.</span></div>
<div class="line"><a name="l06668"></a><span class="lineno"> 6668</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int64_t,4&gt;</a> Values;</div>
<div class="line"><a name="l06669"></a><span class="lineno"> 6669</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> : <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;cases())</div>
<div class="line"><a name="l06670"></a><span class="lineno"> 6670</span>&#160;    Values.push_back(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>.getCaseValue()-&gt;getValue().getSExtValue());</div>
<div class="line"><a name="l06671"></a><span class="lineno"> 6671</span>&#160;  <a class="code" href="namespacellvm.html#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a>(Values);</div>
<div class="line"><a name="l06672"></a><span class="lineno"> 6672</span>&#160; </div>
<div class="line"><a name="l06673"></a><span class="lineno"> 6673</span>&#160;  <span class="comment">// If the switch is already dense, there&#39;s nothing useful to do here.</span></div>
<div class="line"><a name="l06674"></a><span class="lineno"> 6674</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a7c6e64e4a4dbba951d47fe2b1d188b2c">isSwitchDense</a>(Values))</div>
<div class="line"><a name="l06675"></a><span class="lineno"> 6675</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06676"></a><span class="lineno"> 6676</span>&#160; </div>
<div class="line"><a name="l06677"></a><span class="lineno"> 6677</span>&#160;  <span class="comment">// First, transform the values such that they start at zero and ascend.</span></div>
<div class="line"><a name="l06678"></a><span class="lineno"> 6678</span>&#160;  int64_t <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = Values[0];</div>
<div class="line"><a name="l06679"></a><span class="lineno"> 6679</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;V : Values)</div>
<div class="line"><a name="l06680"></a><span class="lineno"> 6680</span>&#160;    V -= (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a>)(<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>);</div>
<div class="line"><a name="l06681"></a><span class="lineno"> 6681</span>&#160; </div>
<div class="line"><a name="l06682"></a><span class="lineno"> 6682</span>&#160;  <span class="comment">// Now we have signed numbers that have been shifted so that, given enough</span></div>
<div class="line"><a name="l06683"></a><span class="lineno"> 6683</span>&#160;  <span class="comment">// precision, there are no negative values. Since the rest of the transform</span></div>
<div class="line"><a name="l06684"></a><span class="lineno"> 6684</span>&#160;  <span class="comment">// is bitwise only, we switch now to an unsigned representation.</span></div>
<div class="line"><a name="l06685"></a><span class="lineno"> 6685</span>&#160; </div>
<div class="line"><a name="l06686"></a><span class="lineno"> 6686</span>&#160;  <span class="comment">// This transform can be done speculatively because it is so cheap - it</span></div>
<div class="line"><a name="l06687"></a><span class="lineno"> 6687</span>&#160;  <span class="comment">// results in a single rotate operation being inserted.</span></div>
<div class="line"><a name="l06688"></a><span class="lineno"> 6688</span>&#160;  <span class="comment">// FIXME: It&#39;s possible that optimizing a switch on powers of two might also</span></div>
<div class="line"><a name="l06689"></a><span class="lineno"> 6689</span>&#160;  <span class="comment">// be beneficial - flag values are often powers of two and we could use a CLZ</span></div>
<div class="line"><a name="l06690"></a><span class="lineno"> 6690</span>&#160;  <span class="comment">// as the key function.</span></div>
<div class="line"><a name="l06691"></a><span class="lineno"> 6691</span>&#160; </div>
<div class="line"><a name="l06692"></a><span class="lineno"> 6692</span>&#160;  <span class="comment">// countTrailingZeros(0) returns 64. As Values is guaranteed to have more than</span></div>
<div class="line"><a name="l06693"></a><span class="lineno"> 6693</span>&#160;  <span class="comment">// one element and LLVM disallows duplicate cases, Shift is guaranteed to be</span></div>
<div class="line"><a name="l06694"></a><span class="lineno"> 6694</span>&#160;  <span class="comment">// less than 64.</span></div>
<div class="line"><a name="l06695"></a><span class="lineno"> 6695</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a> = 64;</div>
<div class="line"><a name="l06696"></a><span class="lineno"> 6696</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;V : Values)</div>
<div class="line"><a name="l06697"></a><span class="lineno"> 6697</span>&#160;    <a class="code" href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a> = <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(<a class="code" href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a>, (<span class="keywordtype">unsigned</span>)<a class="code" href="namespacellvm.html#a57d2f9ee99e9e68cff564d0d579c8163">llvm::countr_zero</a>((<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a>)V));</div>
<div class="line"><a name="l06698"></a><span class="lineno"> 6698</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a> &lt; 64);</div>
<div class="line"><a name="l06699"></a><span class="lineno"> 6699</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a> &gt; 0)</div>
<div class="line"><a name="l06700"></a><span class="lineno"> 6700</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;V : Values)</div>
<div class="line"><a name="l06701"></a><span class="lineno"> 6701</span>&#160;      V = (int64_t)((<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a>)V &gt;&gt; <a class="code" href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a>);</div>
<div class="line"><a name="l06702"></a><span class="lineno"> 6702</span>&#160; </div>
<div class="line"><a name="l06703"></a><span class="lineno"> 6703</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#a7c6e64e4a4dbba951d47fe2b1d188b2c">isSwitchDense</a>(Values))</div>
<div class="line"><a name="l06704"></a><span class="lineno"> 6704</span>&#160;    <span class="comment">// Transform didn&#39;t create a dense switch.</span></div>
<div class="line"><a name="l06705"></a><span class="lineno"> 6705</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06706"></a><span class="lineno"> 6706</span>&#160; </div>
<div class="line"><a name="l06707"></a><span class="lineno"> 6707</span>&#160;  <span class="comment">// The obvious transform is to shift the switch condition right and emit a</span></div>
<div class="line"><a name="l06708"></a><span class="lineno"> 6708</span>&#160;  <span class="comment">// check that the condition actually cleanly divided by GCD, i.e.</span></div>
<div class="line"><a name="l06709"></a><span class="lineno"> 6709</span>&#160;  <span class="comment">//   C &amp; (1 &lt;&lt; Shift - 1) == 0</span></div>
<div class="line"><a name="l06710"></a><span class="lineno"> 6710</span>&#160;  <span class="comment">// inserting a new CFG edge to handle the case where it didn&#39;t divide cleanly.</span></div>
<div class="line"><a name="l06711"></a><span class="lineno"> 6711</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l06712"></a><span class="lineno"> 6712</span>&#160;  <span class="comment">// A cheaper way of doing this is a simple ROTR(C, Shift). This performs the</span></div>
<div class="line"><a name="l06713"></a><span class="lineno"> 6713</span>&#160;  <span class="comment">// shift and puts the shifted-off bits in the uppermost bits. If any of these</span></div>
<div class="line"><a name="l06714"></a><span class="lineno"> 6714</span>&#160;  <span class="comment">// are nonzero then the switch condition will be very large and will hit the</span></div>
<div class="line"><a name="l06715"></a><span class="lineno"> 6715</span>&#160;  <span class="comment">// default case.</span></div>
<div class="line"><a name="l06716"></a><span class="lineno"> 6716</span>&#160; </div>
<div class="line"><a name="l06717"></a><span class="lineno"> 6717</span>&#160;  <span class="keyword">auto</span> *Ty = cast&lt;IntegerType&gt;(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition()-&gt;getType());</div>
<div class="line"><a name="l06718"></a><span class="lineno"> 6718</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l06719"></a><span class="lineno"> 6719</span>&#160;  <span class="keyword">auto</span> *ShiftC = <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(Ty, <a class="code" href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a>);</div>
<div class="line"><a name="l06720"></a><span class="lineno"> 6720</span>&#160;  <span class="keyword">auto</span> *Sub = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSub(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition(), <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(Ty, <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>));</div>
<div class="line"><a name="l06721"></a><span class="lineno"> 6721</span>&#160;  <span class="keyword">auto</span> *LShr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateLShr(Sub, ShiftC);</div>
<div class="line"><a name="l06722"></a><span class="lineno"> 6722</span>&#160;  <span class="keyword">auto</span> *Shl = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShl(Sub, Ty-&gt;getBitWidth() - <a class="code" href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a>);</div>
<div class="line"><a name="l06723"></a><span class="lineno"> 6723</span>&#160;  <span class="keyword">auto</span> *Rot = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateOr(LShr, Shl);</div>
<div class="line"><a name="l06724"></a><span class="lineno"> 6724</span>&#160;  <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;replaceUsesOfWith(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition(), Rot);</div>
<div class="line"><a name="l06725"></a><span class="lineno"> 6725</span>&#160; </div>
<div class="line"><a name="l06726"></a><span class="lineno"> 6726</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> Case : <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;cases()) {</div>
<div class="line"><a name="l06727"></a><span class="lineno"> 6727</span>&#160;    <span class="keyword">auto</span> *Orig = Case.getCaseValue();</div>
<div class="line"><a name="l06728"></a><span class="lineno"> 6728</span>&#160;    <span class="keyword">auto</span> Sub = Orig-&gt;getValue() - <a class="code" href="classllvm_1_1APInt.html">APInt</a>(Ty-&gt;getBitWidth(), <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>);</div>
<div class="line"><a name="l06729"></a><span class="lineno"> 6729</span>&#160;    Case.setValue(</div>
<div class="line"><a name="l06730"></a><span class="lineno"> 6730</span>&#160;        cast&lt;ConstantInt&gt;(<a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(Ty, Sub.lshr(ShiftC-&gt;getValue()))));</div>
<div class="line"><a name="l06731"></a><span class="lineno"> 6731</span>&#160;  }</div>
<div class="line"><a name="l06732"></a><span class="lineno"> 6732</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06733"></a><span class="lineno"> 6733</span>&#160;}</div>
<div class="line"><a name="l06734"></a><span class="lineno"> 6734</span>&#160; </div>
<div class="line"><a name="l06735"></a><span class="lineno"> 6735</span>&#160;<span class="keywordtype">bool</span> SimplifyCFGOpt::simplifySwitch(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>) {</div>
<div class="line"><a name="l06736"></a><span class="lineno"> 6736</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getParent();</div>
<div class="line"><a name="l06737"></a><span class="lineno"> 6737</span>&#160; </div>
<div class="line"><a name="l06738"></a><span class="lineno"> 6738</span>&#160;  <span class="keywordflow">if</span> (isValueEqualityComparison(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>)) {</div>
<div class="line"><a name="l06739"></a><span class="lineno"> 6739</span>&#160;    <span class="comment">// If we only have one predecessor, and if it is a branch on this value,</span></div>
<div class="line"><a name="l06740"></a><span class="lineno"> 6740</span>&#160;    <span class="comment">// see if that predecessor totally determines the outcome of this switch.</span></div>
<div class="line"><a name="l06741"></a><span class="lineno"> 6741</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *OnlyPred = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getSinglePredecessor())</div>
<div class="line"><a name="l06742"></a><span class="lineno"> 6742</span>&#160;      <span class="keywordflow">if</span> (SimplifyEqualityComparisonWithOnlyPredecessor(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, OnlyPred, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>))</div>
<div class="line"><a name="l06743"></a><span class="lineno"> 6743</span>&#160;        <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l06744"></a><span class="lineno"> 6744</span>&#160; </div>
<div class="line"><a name="l06745"></a><span class="lineno"> 6745</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a> = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition();</div>
<div class="line"><a name="l06746"></a><span class="lineno"> 6746</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a> = dyn_cast&lt;SelectInst&gt;(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>))</div>
<div class="line"><a name="l06747"></a><span class="lineno"> 6747</span>&#160;      <span class="keywordflow">if</span> (SimplifySwitchOnSelect(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a>))</div>
<div class="line"><a name="l06748"></a><span class="lineno"> 6748</span>&#160;        <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l06749"></a><span class="lineno"> 6749</span>&#160; </div>
<div class="line"><a name="l06750"></a><span class="lineno"> 6750</span>&#160;    <span class="comment">// If the block only contains the switch, see if we can fold the block</span></div>
<div class="line"><a name="l06751"></a><span class="lineno"> 6751</span>&#160;    <span class="comment">// away into any preds.</span></div>
<div class="line"><a name="l06752"></a><span class="lineno"> 6752</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> == &amp;*<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;instructionsWithoutDebug(<span class="keyword">false</span>).begin())</div>
<div class="line"><a name="l06753"></a><span class="lineno"> 6753</span>&#160;      <span class="keywordflow">if</span> (FoldValueComparisonIntoPredecessors(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>))</div>
<div class="line"><a name="l06754"></a><span class="lineno"> 6754</span>&#160;        <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l06755"></a><span class="lineno"> 6755</span>&#160;  }</div>
<div class="line"><a name="l06756"></a><span class="lineno"> 6756</span>&#160; </div>
<div class="line"><a name="l06757"></a><span class="lineno"> 6757</span>&#160;  <span class="comment">// Try to transform the switch into an icmp and a branch.</span></div>
<div class="line"><a name="l06758"></a><span class="lineno"> 6758</span>&#160;  <span class="comment">// The conversion from switch to comparison may lose information on</span></div>
<div class="line"><a name="l06759"></a><span class="lineno"> 6759</span>&#160;  <span class="comment">// impossible switch values, so disable it early in the pipeline.</span></div>
<div class="line"><a name="l06760"></a><span class="lineno"> 6760</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="PassBuilderBindings_8cpp.html#a47c521bf7ba0bb2147b96d068af30d04">Options</a>.ConvertSwitchRangeToICmp &amp;&amp; TurnSwitchRangeIntoICmp(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>))</div>
<div class="line"><a name="l06761"></a><span class="lineno"> 6761</span>&#160;    <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l06762"></a><span class="lineno"> 6762</span>&#160; </div>
<div class="line"><a name="l06763"></a><span class="lineno"> 6763</span>&#160;  <span class="comment">// Remove unreachable cases.</span></div>
<div class="line"><a name="l06764"></a><span class="lineno"> 6764</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a83b0a34d940365e97b9a531c1f13f3b9">eliminateDeadSwitchCases</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, DTU, <a class="code" href="PassBuilderBindings_8cpp.html#a47c521bf7ba0bb2147b96d068af30d04">Options</a>.AC, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</div>
<div class="line"><a name="l06765"></a><span class="lineno"> 6765</span>&#160;    <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l06766"></a><span class="lineno"> 6766</span>&#160; </div>
<div class="line"><a name="l06767"></a><span class="lineno"> 6767</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a794d3a5f46134c24aade41b327d8418e">trySwitchToSelect</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, DTU, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>))</div>
<div class="line"><a name="l06768"></a><span class="lineno"> 6768</span>&#160;    <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l06769"></a><span class="lineno"> 6769</span>&#160; </div>
<div class="line"><a name="l06770"></a><span class="lineno"> 6770</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="PassBuilderBindings_8cpp.html#a47c521bf7ba0bb2147b96d068af30d04">Options</a>.ForwardSwitchCondToPhi &amp;&amp; <a class="code" href="SimplifyCFG_8cpp.html#a819fe08329be34252ffde1e710574a34">ForwardSwitchConditionToPHI</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>))</div>
<div class="line"><a name="l06771"></a><span class="lineno"> 6771</span>&#160;    <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l06772"></a><span class="lineno"> 6772</span>&#160; </div>
<div class="line"><a name="l06773"></a><span class="lineno"> 6773</span>&#160;  <span class="comment">// The conversion from switch to lookup tables results in difficult-to-analyze</span></div>
<div class="line"><a name="l06774"></a><span class="lineno"> 6774</span>&#160;  <span class="comment">// code and makes pruning branches much harder. This is a problem if the</span></div>
<div class="line"><a name="l06775"></a><span class="lineno"> 6775</span>&#160;  <span class="comment">// switch expression itself can still be restricted as a result of inlining or</span></div>
<div class="line"><a name="l06776"></a><span class="lineno"> 6776</span>&#160;  <span class="comment">// CVP. Therefore, only apply this transformation during late stages of the</span></div>
<div class="line"><a name="l06777"></a><span class="lineno"> 6777</span>&#160;  <span class="comment">// optimisation pipeline.</span></div>
<div class="line"><a name="l06778"></a><span class="lineno"> 6778</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="PassBuilderBindings_8cpp.html#a47c521bf7ba0bb2147b96d068af30d04">Options</a>.ConvertSwitchToLookupTable &amp;&amp;</div>
<div class="line"><a name="l06779"></a><span class="lineno"> 6779</span>&#160;      <a class="code" href="SimplifyCFG_8cpp.html#ac35d942f5e82c11d2f1752829b5b21de">SwitchToLookupTable</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, DTU, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>))</div>
<div class="line"><a name="l06780"></a><span class="lineno"> 6780</span>&#160;    <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l06781"></a><span class="lineno"> 6781</span>&#160; </div>
<div class="line"><a name="l06782"></a><span class="lineno"> 6782</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a2b4678191aecb0ae9e493024c15c6c81">ReduceSwitchRange</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>))</div>
<div class="line"><a name="l06783"></a><span class="lineno"> 6783</span>&#160;    <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l06784"></a><span class="lineno"> 6784</span>&#160; </div>
<div class="line"><a name="l06785"></a><span class="lineno"> 6785</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06786"></a><span class="lineno"> 6786</span>&#160;}</div>
<div class="line"><a name="l06787"></a><span class="lineno"> 6787</span>&#160; </div>
<div class="line"><a name="l06788"></a><span class="lineno"> 6788</span>&#160;<span class="keywordtype">bool</span> SimplifyCFGOpt::simplifyIndirectBr(<a class="code" href="classllvm_1_1IndirectBrInst.html">IndirectBrInst</a> *IBI) {</div>
<div class="line"><a name="l06789"></a><span class="lineno"> 6789</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = IBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l06790"></a><span class="lineno"> 6790</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06791"></a><span class="lineno"> 6791</span>&#160; </div>
<div class="line"><a name="l06792"></a><span class="lineno"> 6792</span>&#160;  <span class="comment">// Eliminate redundant destinations.</span></div>
<div class="line"><a name="l06793"></a><span class="lineno"> 6793</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value *, 8&gt;</a> Succs;</div>
<div class="line"><a name="l06794"></a><span class="lineno"> 6794</span>&#160;  <a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;BasicBlock *, 8&gt;</a> RemovedSuccs;</div>
<div class="line"><a name="l06795"></a><span class="lineno"> 6795</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = IBI-&gt;<a class="code" href="classllvm_1_1IndirectBrInst.html#abd4f6893d4f810f4162a70f89b2452fe">getNumDestinations</a>(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l06796"></a><span class="lineno"> 6796</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Dest = IBI-&gt;<a class="code" href="classllvm_1_1IndirectBrInst.html#a45656d5a2f380720a7618495fceed01e">getDestination</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l06797"></a><span class="lineno"> 6797</span>&#160;    <span class="keywordflow">if</span> (!Dest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a315f26c899f5ea8a780db4740ba95ef4">hasAddressTaken</a>() || !Succs.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(Dest).second) {</div>
<div class="line"><a name="l06798"></a><span class="lineno"> 6798</span>&#160;      <span class="keywordflow">if</span> (!Dest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a315f26c899f5ea8a780db4740ba95ef4">hasAddressTaken</a>())</div>
<div class="line"><a name="l06799"></a><span class="lineno"> 6799</span>&#160;        RemovedSuccs.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(Dest);</div>
<div class="line"><a name="l06800"></a><span class="lineno"> 6800</span>&#160;      Dest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l06801"></a><span class="lineno"> 6801</span>&#160;      IBI-&gt;<a class="code" href="classllvm_1_1IndirectBrInst.html#ac0cc9b34e16910d245245642350d4456">removeDestination</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l06802"></a><span class="lineno"> 6802</span>&#160;      --<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l06803"></a><span class="lineno"> 6803</span>&#160;      --<a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>;</div>
<div class="line"><a name="l06804"></a><span class="lineno"> 6804</span>&#160;      Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06805"></a><span class="lineno"> 6805</span>&#160;    }</div>
<div class="line"><a name="l06806"></a><span class="lineno"> 6806</span>&#160;  }</div>
<div class="line"><a name="l06807"></a><span class="lineno"> 6807</span>&#160; </div>
<div class="line"><a name="l06808"></a><span class="lineno"> 6808</span>&#160;  <span class="keywordflow">if</span> (DTU) {</div>
<div class="line"><a name="l06809"></a><span class="lineno"> 6809</span>&#160;    std::vector&lt;DominatorTree::UpdateType&gt; Updates;</div>
<div class="line"><a name="l06810"></a><span class="lineno"> 6810</span>&#160;    Updates.reserve(RemovedSuccs.<a class="code" href="classllvm_1_1SetVector.html#a18b9d328d2490f447589ba60345eba6e">size</a>());</div>
<div class="line"><a name="l06811"></a><span class="lineno"> 6811</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *RemovedSucc : RemovedSuccs)</div>
<div class="line"><a name="l06812"></a><span class="lineno"> 6812</span>&#160;      Updates.push_back({DominatorTree::Delete, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, RemovedSucc});</div>
<div class="line"><a name="l06813"></a><span class="lineno"> 6813</span>&#160;    DTU-&gt;applyUpdates(Updates);</div>
<div class="line"><a name="l06814"></a><span class="lineno"> 6814</span>&#160;  }</div>
<div class="line"><a name="l06815"></a><span class="lineno"> 6815</span>&#160; </div>
<div class="line"><a name="l06816"></a><span class="lineno"> 6816</span>&#160;  <span class="keywordflow">if</span> (IBI-&gt;<a class="code" href="classllvm_1_1IndirectBrInst.html#abd4f6893d4f810f4162a70f89b2452fe">getNumDestinations</a>() == 0) {</div>
<div class="line"><a name="l06817"></a><span class="lineno"> 6817</span>&#160;    <span class="comment">// If the indirectbr has no successors, change it to unreachable.</span></div>
<div class="line"><a name="l06818"></a><span class="lineno"> 6818</span>&#160;    <span class="keyword">new</span> <a class="code" href="classllvm_1_1UnreachableInst.html">UnreachableInst</a>(IBI-&gt;<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), IBI);</div>
<div class="line"><a name="l06819"></a><span class="lineno"> 6819</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#aa4641512b28a6e42a40bda7576fe43cb">EraseTerminatorAndDCECond</a>(IBI);</div>
<div class="line"><a name="l06820"></a><span class="lineno"> 6820</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06821"></a><span class="lineno"> 6821</span>&#160;  }</div>
<div class="line"><a name="l06822"></a><span class="lineno"> 6822</span>&#160; </div>
<div class="line"><a name="l06823"></a><span class="lineno"> 6823</span>&#160;  <span class="keywordflow">if</span> (IBI-&gt;<a class="code" href="classllvm_1_1IndirectBrInst.html#abd4f6893d4f810f4162a70f89b2452fe">getNumDestinations</a>() == 1) {</div>
<div class="line"><a name="l06824"></a><span class="lineno"> 6824</span>&#160;    <span class="comment">// If the indirectbr has one successor, change it to a direct branch.</span></div>
<div class="line"><a name="l06825"></a><span class="lineno"> 6825</span>&#160;    BranchInst::Create(IBI-&gt;<a class="code" href="classllvm_1_1IndirectBrInst.html#a45656d5a2f380720a7618495fceed01e">getDestination</a>(0), IBI);</div>
<div class="line"><a name="l06826"></a><span class="lineno"> 6826</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#aa4641512b28a6e42a40bda7576fe43cb">EraseTerminatorAndDCECond</a>(IBI);</div>
<div class="line"><a name="l06827"></a><span class="lineno"> 6827</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06828"></a><span class="lineno"> 6828</span>&#160;  }</div>
<div class="line"><a name="l06829"></a><span class="lineno"> 6829</span>&#160; </div>
<div class="line"><a name="l06830"></a><span class="lineno"> 6830</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;SelectInst&gt;(IBI-&gt;<a class="code" href="classllvm_1_1IndirectBrInst.html#a1ce0a14a79ac73a91f38aa91899bb377">getAddress</a>())) {</div>
<div class="line"><a name="l06831"></a><span class="lineno"> 6831</span>&#160;    <span class="keywordflow">if</span> (SimplifyIndirectBrOnSelect(IBI, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>))</div>
<div class="line"><a name="l06832"></a><span class="lineno"> 6832</span>&#160;      <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l06833"></a><span class="lineno"> 6833</span>&#160;  }</div>
<div class="line"><a name="l06834"></a><span class="lineno"> 6834</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l06835"></a><span class="lineno"> 6835</span>&#160;}</div>
<div class="line"><a name="l06836"></a><span class="lineno"> 6836</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l06837"></a><span class="lineno"> 6837</span>&#160;<span class="comment">/// Given an block with only a single landing pad and a unconditional branch</span></div>
<div class="line"><a name="l06838"></a><span class="lineno"> 6838</span>&#160;<span class="comment">/// try to find another basic block which this one can be merged with.  This</span></div>
<div class="line"><a name="l06839"></a><span class="lineno"> 6839</span>&#160;<span class="comment">/// handles cases where we have multiple invokes with unique landing pads, but</span></div>
<div class="line"><a name="l06840"></a><span class="lineno"> 6840</span>&#160;<span class="comment">/// a shared handler.</span></div>
<div class="line"><a name="l06841"></a><span class="lineno"> 6841</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l06842"></a><span class="lineno"> 6842</span>&#160;<span class="comment">/// We specifically choose to not worry about merging non-empty blocks</span></div>
<div class="line"><a name="l06843"></a><span class="lineno"> 6843</span>&#160;<span class="comment">/// here.  That is a PRE/scheduling problem and is best solved elsewhere.  In</span></div>
<div class="line"><a name="l06844"></a><span class="lineno"> 6844</span>&#160;<span class="comment">/// practice, the optimizer produces empty landing pad blocks quite frequently</span></div>
<div class="line"><a name="l06845"></a><span class="lineno"> 6845</span>&#160;<span class="comment">/// when dealing with exception dense code.  (see: instcombine, gvn, if-else</span></div>
<div class="line"><a name="l06846"></a><span class="lineno"> 6846</span>&#160;<span class="comment">/// sinking in this file)</span></div>
<div class="line"><a name="l06847"></a><span class="lineno"> 6847</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l06848"></a><span class="lineno"> 6848</span>&#160;<span class="comment">/// This is primarily a code size optimization.  We need to avoid performing</span></div>
<div class="line"><a name="l06849"></a><span class="lineno"> 6849</span>&#160;<span class="comment">/// any transform which might inhibit optimization (such as our ability to</span></div>
<div class="line"><a name="l06850"></a><span class="lineno"> 6850</span>&#160;<span class="comment">/// specialize a particular handler via tail commoning).  We do this by not</span></div>
<div class="line"><a name="l06851"></a><span class="lineno"> 6851</span>&#160;<span class="comment">/// merging any blocks which require us to introduce a phi.  Since the same</span></div>
<div class="line"><a name="l06852"></a><span class="lineno"> 6852</span>&#160;<span class="comment">/// values are flowing through both blocks, we don&#39;t lose any ability to</span></div>
<div class="line"><a name="l06853"></a><span class="lineno"> 6853</span>&#160;<span class="comment">/// specialize.  If anything, we make such specialization more likely.</span></div>
<div class="line"><a name="l06854"></a><span class="lineno"> 6854</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l06855"></a><span class="lineno"> 6855</span>&#160;<span class="comment">/// TODO - This transformation could remove entries from a phi in the target</span></div>
<div class="line"><a name="l06856"></a><span class="lineno"> 6856</span>&#160;<span class="comment">/// block when the inputs in the phi are the same for the two blocks being</span></div>
<div class="line"><a name="l06857"></a><span class="lineno"> 6857</span>&#160;<span class="comment">/// merged.  In some cases, this could result in removal of the PHI entirely.</span></div>
<div class="line"><a name="l06858"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#ae21e8db12165e2f7d6337b75800ff91c"> 6858</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#ae21e8db12165e2f7d6337b75800ff91c">TryToMergeLandingPad</a>(<a class="code" href="classllvm_1_1LandingPadInst.html">LandingPadInst</a> *LPad, <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI,</div>
<div class="line"><a name="l06859"></a><span class="lineno"> 6859</span>&#160;                                 <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> *DTU) {</div>
<div class="line"><a name="l06860"></a><span class="lineno"> 6860</span>&#160;  <span class="keyword">auto</span> Succ = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getUniqueSuccessor();</div>
<div class="line"><a name="l06861"></a><span class="lineno"> 6861</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Succ);</div>
<div class="line"><a name="l06862"></a><span class="lineno"> 6862</span>&#160;  <span class="comment">// If there&#39;s a phi in the successor block, we&#39;d likely have to introduce</span></div>
<div class="line"><a name="l06863"></a><span class="lineno"> 6863</span>&#160;  <span class="comment">// a phi into the merged landing pad block.</span></div>
<div class="line"><a name="l06864"></a><span class="lineno"> 6864</span>&#160;  <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(*Succ-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>()))</div>
<div class="line"><a name="l06865"></a><span class="lineno"> 6865</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06866"></a><span class="lineno"> 6866</span>&#160; </div>
<div class="line"><a name="l06867"></a><span class="lineno"> 6867</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *OtherPred : <a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(Succ)) {</div>
<div class="line"><a name="l06868"></a><span class="lineno"> 6868</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> == OtherPred)</div>
<div class="line"><a name="l06869"></a><span class="lineno"> 6869</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06870"></a><span class="lineno"> 6870</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = OtherPred-&gt;begin();</div>
<div class="line"><a name="l06871"></a><span class="lineno"> 6871</span>&#160;    <a class="code" href="classllvm_1_1LandingPadInst.html">LandingPadInst</a> *LPad2 = dyn_cast&lt;LandingPadInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l06872"></a><span class="lineno"> 6872</span>&#160;    <span class="keywordflow">if</span> (!LPad2 || !LPad2-&gt;<a class="code" href="classllvm_1_1Instruction.html#ad848bd0184fc7bcb7b71e19248f08f34">isIdenticalTo</a>(LPad))</div>
<div class="line"><a name="l06873"></a><span class="lineno"> 6873</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06874"></a><span class="lineno"> 6874</span>&#160;    <span class="keywordflow">for</span> (++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>; isa&lt;DbgInfoIntrinsic&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>); ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l06875"></a><span class="lineno"> 6875</span>&#160;      ;</div>
<div class="line"><a name="l06876"></a><span class="lineno"> 6876</span>&#160;    <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI2 = dyn_cast&lt;BranchInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l06877"></a><span class="lineno"> 6877</span>&#160;    <span class="keywordflow">if</span> (!BI2 || !BI2-&gt;<a class="code" href="classllvm_1_1Instruction.html#ad848bd0184fc7bcb7b71e19248f08f34">isIdenticalTo</a>(BI))</div>
<div class="line"><a name="l06878"></a><span class="lineno"> 6878</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06879"></a><span class="lineno"> 6879</span>&#160; </div>
<div class="line"><a name="l06880"></a><span class="lineno"> 6880</span>&#160;    std::vector&lt;DominatorTree::UpdateType&gt; Updates;</div>
<div class="line"><a name="l06881"></a><span class="lineno"> 6881</span>&#160; </div>
<div class="line"><a name="l06882"></a><span class="lineno"> 6882</span>&#160;    <span class="comment">// We&#39;ve found an identical block.  Update our predecessors to take that</span></div>
<div class="line"><a name="l06883"></a><span class="lineno"> 6883</span>&#160;    <span class="comment">// path instead and make ourselves dead.</span></div>
<div class="line"><a name="l06884"></a><span class="lineno"> 6884</span>&#160;    <a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;BasicBlock *, 16&gt;</a> UniquePreds(<a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>), <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>));</div>
<div class="line"><a name="l06885"></a><span class="lineno"> 6885</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred : UniquePreds) {</div>
<div class="line"><a name="l06886"></a><span class="lineno"> 6886</span>&#160;      <a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II = cast&lt;InvokeInst&gt;(Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>());</div>
<div class="line"><a name="l06887"></a><span class="lineno"> 6887</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(II-&gt;<a class="code" href="classllvm_1_1InvokeInst.html#a100bd3005ea84bf47f3b4021e8022633">getNormalDest</a>() != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> &amp;&amp; II-&gt;<a class="code" href="classllvm_1_1InvokeInst.html#a5ba379c3251d99b4c23c8f2e6abe4a6c">getUnwindDest</a>() == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> &amp;&amp;</div>
<div class="line"><a name="l06888"></a><span class="lineno"> 6888</span>&#160;             <span class="stringliteral">&quot;unexpected successor&quot;</span>);</div>
<div class="line"><a name="l06889"></a><span class="lineno"> 6889</span>&#160;      II-&gt;<a class="code" href="classllvm_1_1InvokeInst.html#a800a96a12d974cf7f73a96777d27f974">setUnwindDest</a>(OtherPred);</div>
<div class="line"><a name="l06890"></a><span class="lineno"> 6890</span>&#160;      <span class="keywordflow">if</span> (DTU) {</div>
<div class="line"><a name="l06891"></a><span class="lineno"> 6891</span>&#160;        Updates.push_back({<a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">DominatorTree::Insert</a>, Pred, OtherPred});</div>
<div class="line"><a name="l06892"></a><span class="lineno"> 6892</span>&#160;        Updates.push_back({DominatorTree::Delete, Pred, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>});</div>
<div class="line"><a name="l06893"></a><span class="lineno"> 6893</span>&#160;      }</div>
<div class="line"><a name="l06894"></a><span class="lineno"> 6894</span>&#160;    }</div>
<div class="line"><a name="l06895"></a><span class="lineno"> 6895</span>&#160; </div>
<div class="line"><a name="l06896"></a><span class="lineno"> 6896</span>&#160;    <span class="comment">// The debug info in OtherPred doesn&#39;t cover the merged control flow that</span></div>
<div class="line"><a name="l06897"></a><span class="lineno"> 6897</span>&#160;    <span class="comment">// used to go through BB.  We need to delete it or update it.</span></div>
<div class="line"><a name="l06898"></a><span class="lineno"> 6898</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;Inst : <a class="code" href="namespacellvm.html#a8154638df88e4eaa568b67b23d463dac">llvm::make_early_inc_range</a>(*OtherPred))</div>
<div class="line"><a name="l06899"></a><span class="lineno"> 6899</span>&#160;      <span class="keywordflow">if</span> (isa&lt;DbgInfoIntrinsic&gt;(Inst))</div>
<div class="line"><a name="l06900"></a><span class="lineno"> 6900</span>&#160;        Inst.<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l06901"></a><span class="lineno"> 6901</span>&#160; </div>
<div class="line"><a name="l06902"></a><span class="lineno"> 6902</span>&#160;    <a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;BasicBlock *, 16&gt;</a> UniqueSuccs(<a class="code" href="namespacellvm.html#a3720211f6e6389ab53734b989bfb6fce">succ_begin</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>), <a class="code" href="namespacellvm.html#a069c4ae2290101bde0f8d6a5074dc72b">succ_end</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>));</div>
<div class="line"><a name="l06903"></a><span class="lineno"> 6903</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ : UniqueSuccs) {</div>
<div class="line"><a name="l06904"></a><span class="lineno"> 6904</span>&#160;      Succ-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l06905"></a><span class="lineno"> 6905</span>&#160;      <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l06906"></a><span class="lineno"> 6906</span>&#160;        Updates.push_back({DominatorTree::Delete, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, Succ});</div>
<div class="line"><a name="l06907"></a><span class="lineno"> 6907</span>&#160;    }</div>
<div class="line"><a name="l06908"></a><span class="lineno"> 6908</span>&#160; </div>
<div class="line"><a name="l06909"></a><span class="lineno"> 6909</span>&#160;    <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(BI);</div>
<div class="line"><a name="l06910"></a><span class="lineno"> 6910</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateUnreachable();</div>
<div class="line"><a name="l06911"></a><span class="lineno"> 6911</span>&#160;    BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l06912"></a><span class="lineno"> 6912</span>&#160;    <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l06913"></a><span class="lineno"> 6913</span>&#160;      DTU-&gt;<a class="code" href="classllvm_1_1DomTreeUpdater.html#aae522cd1928cfac6850b50c7a3e22185">applyUpdates</a>(Updates);</div>
<div class="line"><a name="l06914"></a><span class="lineno"> 6914</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06915"></a><span class="lineno"> 6915</span>&#160;  }</div>
<div class="line"><a name="l06916"></a><span class="lineno"> 6916</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06917"></a><span class="lineno"> 6917</span>&#160;}</div>
<div class="line"><a name="l06918"></a><span class="lineno"> 6918</span>&#160; </div>
<div class="line"><a name="l06919"></a><span class="lineno"> 6919</span>&#160;<span class="keywordtype">bool</span> SimplifyCFGOpt::simplifyBranch(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a>, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>) {</div>
<div class="line"><a name="l06920"></a><span class="lineno"> 6920</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a>-&gt;isUnconditional() ? simplifyUncondBranch(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a>, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>)</div>
<div class="line"><a name="l06921"></a><span class="lineno"> 6921</span>&#160;                                   : simplifyCondBranch(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a>, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l06922"></a><span class="lineno"> 6922</span>&#160;}</div>
<div class="line"><a name="l06923"></a><span class="lineno"> 6923</span>&#160; </div>
<div class="line"><a name="l06924"></a><span class="lineno"> 6924</span>&#160;<span class="keywordtype">bool</span> SimplifyCFGOpt::simplifyUncondBranch(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI,</div>
<div class="line"><a name="l06925"></a><span class="lineno"> 6925</span>&#160;                                          <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>) {</div>
<div class="line"><a name="l06926"></a><span class="lineno"> 6926</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l06927"></a><span class="lineno"> 6927</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0);</div>
<div class="line"><a name="l06928"></a><span class="lineno"> 6928</span>&#160; </div>
<div class="line"><a name="l06929"></a><span class="lineno"> 6929</span>&#160;  <span class="comment">// If the Terminator is the only non-phi instruction, simplify the block.</span></div>
<div class="line"><a name="l06930"></a><span class="lineno"> 6930</span>&#160;  <span class="comment">// If LoopHeader is provided, check if the block or its successor is a loop</span></div>
<div class="line"><a name="l06931"></a><span class="lineno"> 6931</span>&#160;  <span class="comment">// header. (This is for early invocations before loop simplify and</span></div>
<div class="line"><a name="l06932"></a><span class="lineno"> 6932</span>&#160;  <span class="comment">// vectorization to keep canonical loop forms for nested loops. These blocks</span></div>
<div class="line"><a name="l06933"></a><span class="lineno"> 6933</span>&#160;  <span class="comment">// can be eliminated when the pass is invoked later in the back-end.)</span></div>
<div class="line"><a name="l06934"></a><span class="lineno"> 6934</span>&#160;  <span class="comment">// Note that if BB has only one predecessor then we do not introduce new</span></div>
<div class="line"><a name="l06935"></a><span class="lineno"> 6935</span>&#160;  <span class="comment">// backedge, so we can eliminate BB.</span></div>
<div class="line"><a name="l06936"></a><span class="lineno"> 6936</span>&#160;  <span class="keywordtype">bool</span> NeedCanonicalLoop =</div>
<div class="line"><a name="l06937"></a><span class="lineno"> 6937</span>&#160;      <a class="code" href="PassBuilderBindings_8cpp.html#a47c521bf7ba0bb2147b96d068af30d04">Options</a>.NeedCanonicalLoop &amp;&amp;</div>
<div class="line"><a name="l06938"></a><span class="lineno"> 6938</span>&#160;      (!LoopHeaders.empty() &amp;&amp; <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;hasNPredecessorsOrMore(2) &amp;&amp;</div>
<div class="line"><a name="l06939"></a><span class="lineno"> 6939</span>&#160;       (<a class="code" href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">is_contained</a>(LoopHeaders, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) || <a class="code" href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">is_contained</a>(LoopHeaders, Succ)));</div>
<div class="line"><a name="l06940"></a><span class="lineno"> 6940</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getFirstNonPHIOrDbg(<span class="keyword">true</span>)-&gt;getIterator();</div>
<div class="line"><a name="l06941"></a><span class="lineno"> 6941</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isTerminator() &amp;&amp; <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> != &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getParent()-&gt;getEntryBlock() &amp;&amp;</div>
<div class="line"><a name="l06942"></a><span class="lineno"> 6942</span>&#160;      !NeedCanonicalLoop &amp;&amp; <a class="code" href="namespacellvm.html#a67474fe1bb82a093f3ad2e9ad2d7f7c4">TryToSimplifyUncondBranchFromEmptyBlock</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, DTU))</div>
<div class="line"><a name="l06943"></a><span class="lineno"> 6943</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06944"></a><span class="lineno"> 6944</span>&#160; </div>
<div class="line"><a name="l06945"></a><span class="lineno"> 6945</span>&#160;  <span class="comment">// If the only instruction in the block is a seteq/setne comparison against a</span></div>
<div class="line"><a name="l06946"></a><span class="lineno"> 6946</span>&#160;  <span class="comment">// constant, try to simplify the block.</span></div>
<div class="line"><a name="l06947"></a><span class="lineno"> 6947</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *ICI = dyn_cast&lt;ICmpInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l06948"></a><span class="lineno"> 6948</span>&#160;    <span class="keywordflow">if</span> (ICI-&gt;<a class="code" href="classllvm_1_1ICmpInst.html#abe8988eef2e6fc2baba032cb22afedd7">isEquality</a>() &amp;&amp; isa&lt;ConstantInt&gt;(ICI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1))) {</div>
<div class="line"><a name="l06949"></a><span class="lineno"> 6949</span>&#160;      <span class="keywordflow">for</span> (++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>; isa&lt;DbgInfoIntrinsic&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>); ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l06950"></a><span class="lineno"> 6950</span>&#160;        ;</div>
<div class="line"><a name="l06951"></a><span class="lineno"> 6951</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isTerminator() &amp;&amp;</div>
<div class="line"><a name="l06952"></a><span class="lineno"> 6952</span>&#160;          tryToSimplifyUncondBranchWithICmpInIt(ICI, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>))</div>
<div class="line"><a name="l06953"></a><span class="lineno"> 6953</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06954"></a><span class="lineno"> 6954</span>&#160;    }</div>
<div class="line"><a name="l06955"></a><span class="lineno"> 6955</span>&#160; </div>
<div class="line"><a name="l06956"></a><span class="lineno"> 6956</span>&#160;  <span class="comment">// See if we can merge an empty landing pad block with another which is</span></div>
<div class="line"><a name="l06957"></a><span class="lineno"> 6957</span>&#160;  <span class="comment">// equivalent.</span></div>
<div class="line"><a name="l06958"></a><span class="lineno"> 6958</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LandingPadInst.html">LandingPadInst</a> *LPad = dyn_cast&lt;LandingPadInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l06959"></a><span class="lineno"> 6959</span>&#160;    <span class="keywordflow">for</span> (++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>; isa&lt;DbgInfoIntrinsic&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>); ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l06960"></a><span class="lineno"> 6960</span>&#160;      ;</div>
<div class="line"><a name="l06961"></a><span class="lineno"> 6961</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isTerminator() &amp;&amp; <a class="code" href="SimplifyCFG_8cpp.html#ae21e8db12165e2f7d6337b75800ff91c">TryToMergeLandingPad</a>(LPad, BI, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, DTU))</div>
<div class="line"><a name="l06962"></a><span class="lineno"> 6962</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06963"></a><span class="lineno"> 6963</span>&#160;  }</div>
<div class="line"><a name="l06964"></a><span class="lineno"> 6964</span>&#160; </div>
<div class="line"><a name="l06965"></a><span class="lineno"> 6965</span>&#160;  <span class="comment">// If this basic block is ONLY a compare and a branch, and if a predecessor</span></div>
<div class="line"><a name="l06966"></a><span class="lineno"> 6966</span>&#160;  <span class="comment">// branches to us and our successor, fold the comparison into the</span></div>
<div class="line"><a name="l06967"></a><span class="lineno"> 6967</span>&#160;  <span class="comment">// predecessor and use logical operations to update the incoming value</span></div>
<div class="line"><a name="l06968"></a><span class="lineno"> 6968</span>&#160;  <span class="comment">// for PHI nodes in common successor.</span></div>
<div class="line"><a name="l06969"></a><span class="lineno"> 6969</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a6713fe2f5fca7c6e1109392b28c21c17">FoldBranchToCommonDest</a>(BI, DTU, <span class="comment">/*MSSAU=*/</span><span class="keyword">nullptr</span>, &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>,</div>
<div class="line"><a name="l06970"></a><span class="lineno"> 6970</span>&#160;                             <a class="code" href="PassBuilderBindings_8cpp.html#a47c521bf7ba0bb2147b96d068af30d04">Options</a>.BonusInstThreshold))</div>
<div class="line"><a name="l06971"></a><span class="lineno"> 6971</span>&#160;    <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l06972"></a><span class="lineno"> 6972</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06973"></a><span class="lineno"> 6973</span>&#160;}</div>
<div class="line"><a name="l06974"></a><span class="lineno"> 6974</span>&#160; </div>
<div class="line"><a name="l06975"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#aea84738a371d95e7d9d00386801ed182"> 6975</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="SimplifyCFG_8cpp.html#aea84738a371d95e7d9d00386801ed182">allPredecessorsComeFromSameSource</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l06976"></a><span class="lineno"> 6976</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PredPred = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06977"></a><span class="lineno"> 6977</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> : <a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)) {</div>
<div class="line"><a name="l06978"></a><span class="lineno"> 6978</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PPred = <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>-&gt;getSinglePredecessor();</div>
<div class="line"><a name="l06979"></a><span class="lineno"> 6979</span>&#160;    <span class="keywordflow">if</span> (!PPred || (PredPred &amp;&amp; PredPred != PPred))</div>
<div class="line"><a name="l06980"></a><span class="lineno"> 6980</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06981"></a><span class="lineno"> 6981</span>&#160;    PredPred = PPred;</div>
<div class="line"><a name="l06982"></a><span class="lineno"> 6982</span>&#160;  }</div>
<div class="line"><a name="l06983"></a><span class="lineno"> 6983</span>&#160;  <span class="keywordflow">return</span> PredPred;</div>
<div class="line"><a name="l06984"></a><span class="lineno"> 6984</span>&#160;}</div>
<div class="line"><a name="l06985"></a><span class="lineno"> 6985</span>&#160; </div>
<div class="line"><a name="l06986"></a><span class="lineno"> 6986</span>&#160;<span class="keywordtype">bool</span> SimplifyCFGOpt::simplifyCondBranch(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>) {</div>
<div class="line"><a name="l06987"></a><span class="lineno"> 6987</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</div>
<div class="line"><a name="l06988"></a><span class="lineno"> 6988</span>&#160;      !isa&lt;ConstantInt&gt;(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>()) &amp;&amp;</div>
<div class="line"><a name="l06989"></a><span class="lineno"> 6989</span>&#160;      BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0) != BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1) &amp;&amp;</div>
<div class="line"><a name="l06990"></a><span class="lineno"> 6990</span>&#160;      <span class="stringliteral">&quot;Tautological conditional branch should have been eliminated already.&quot;</span>);</div>
<div class="line"><a name="l06991"></a><span class="lineno"> 6991</span>&#160; </div>
<div class="line"><a name="l06992"></a><span class="lineno"> 6992</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l06993"></a><span class="lineno"> 6993</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="PassBuilderBindings_8cpp.html#a47c521bf7ba0bb2147b96d068af30d04">Options</a>.SimplifyCondBranch)</div>
<div class="line"><a name="l06994"></a><span class="lineno"> 6994</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06995"></a><span class="lineno"> 6995</span>&#160; </div>
<div class="line"><a name="l06996"></a><span class="lineno"> 6996</span>&#160;  <span class="comment">// Conditional branch</span></div>
<div class="line"><a name="l06997"></a><span class="lineno"> 6997</span>&#160;  <span class="keywordflow">if</span> (isValueEqualityComparison(BI)) {</div>
<div class="line"><a name="l06998"></a><span class="lineno"> 6998</span>&#160;    <span class="comment">// If we only have one predecessor, and if it is a branch on this value,</span></div>
<div class="line"><a name="l06999"></a><span class="lineno"> 6999</span>&#160;    <span class="comment">// see if that predecessor totally determines the outcome of this</span></div>
<div class="line"><a name="l07000"></a><span class="lineno"> 7000</span>&#160;    <span class="comment">// switch.</span></div>
<div class="line"><a name="l07001"></a><span class="lineno"> 7001</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *OnlyPred = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getSinglePredecessor())</div>
<div class="line"><a name="l07002"></a><span class="lineno"> 7002</span>&#160;      <span class="keywordflow">if</span> (SimplifyEqualityComparisonWithOnlyPredecessor(BI, OnlyPred, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>))</div>
<div class="line"><a name="l07003"></a><span class="lineno"> 7003</span>&#160;        <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l07004"></a><span class="lineno"> 7004</span>&#160; </div>
<div class="line"><a name="l07005"></a><span class="lineno"> 7005</span>&#160;    <span class="comment">// This block must be empty, except for the setcond inst, if it exists.</span></div>
<div class="line"><a name="l07006"></a><span class="lineno"> 7006</span>&#160;    <span class="comment">// Ignore dbg and pseudo intrinsics.</span></div>
<div class="line"><a name="l07007"></a><span class="lineno"> 7007</span>&#160;    <span class="keyword">auto</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;instructionsWithoutDebug(<span class="keyword">true</span>).begin();</div>
<div class="line"><a name="l07008"></a><span class="lineno"> 7008</span>&#160;    <span class="keywordflow">if</span> (&amp;*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> == BI) {</div>
<div class="line"><a name="l07009"></a><span class="lineno"> 7009</span>&#160;      <span class="keywordflow">if</span> (FoldValueComparisonIntoPredecessors(BI, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>))</div>
<div class="line"><a name="l07010"></a><span class="lineno"> 7010</span>&#160;        <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l07011"></a><span class="lineno"> 7011</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (&amp;*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> == cast&lt;Instruction&gt;(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>())) {</div>
<div class="line"><a name="l07012"></a><span class="lineno"> 7012</span>&#160;      ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l07013"></a><span class="lineno"> 7013</span>&#160;      <span class="keywordflow">if</span> (&amp;*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> == BI &amp;&amp; FoldValueComparisonIntoPredecessors(BI, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>))</div>
<div class="line"><a name="l07014"></a><span class="lineno"> 7014</span>&#160;        <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l07015"></a><span class="lineno"> 7015</span>&#160;    }</div>
<div class="line"><a name="l07016"></a><span class="lineno"> 7016</span>&#160;  }</div>
<div class="line"><a name="l07017"></a><span class="lineno"> 7017</span>&#160; </div>
<div class="line"><a name="l07018"></a><span class="lineno"> 7018</span>&#160;  <span class="comment">// Try to turn &quot;br (X == 0 | X == 1), T, F&quot; into a switch instruction.</span></div>
<div class="line"><a name="l07019"></a><span class="lineno"> 7019</span>&#160;  <span class="keywordflow">if</span> (SimplifyBranchOnICmpChain(BI, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</div>
<div class="line"><a name="l07020"></a><span class="lineno"> 7020</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07021"></a><span class="lineno"> 7021</span>&#160; </div>
<div class="line"><a name="l07022"></a><span class="lineno"> 7022</span>&#160;  <span class="comment">// If this basic block has dominating predecessor blocks and the dominating</span></div>
<div class="line"><a name="l07023"></a><span class="lineno"> 7023</span>&#160;  <span class="comment">// blocks&#39; conditions imply BI&#39;s condition, we know the direction of BI.</span></div>
<div class="line"><a name="l07024"></a><span class="lineno"> 7024</span>&#160;  std::optional&lt;bool&gt; Imp = <a class="code" href="namespacellvm.html#adbc4e5b23d7154e30b03717a470e8178">isImpliedByDomCondition</a>(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>(), BI, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l07025"></a><span class="lineno"> 7025</span>&#160;  <span class="keywordflow">if</span> (Imp) {</div>
<div class="line"><a name="l07026"></a><span class="lineno"> 7026</span>&#160;    <span class="comment">// Turn this into a branch on constant.</span></div>
<div class="line"><a name="l07027"></a><span class="lineno"> 7027</span>&#160;    <span class="keyword">auto</span> *OldCond = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>();</div>
<div class="line"><a name="l07028"></a><span class="lineno"> 7028</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *TorF = *Imp ? <a class="code" href="InstructionSimplify_8cpp.html#a565dd825f238fa0a8c4bbfe562635f7c">ConstantInt::getTrue</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getContext())</div>
<div class="line"><a name="l07029"></a><span class="lineno"> 7029</span>&#160;                             : <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a>::<a class="code" href="InstructionSimplify_8cpp.html#adb39181b87dffcd61082d08e02bf314e">getFalse</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getContext());</div>
<div class="line"><a name="l07030"></a><span class="lineno"> 7030</span>&#160;    BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a3505dab06f59c36142a234321cdc3411">setCondition</a>(TorF);</div>
<div class="line"><a name="l07031"></a><span class="lineno"> 7031</span>&#160;    <a class="code" href="namespacellvm.html#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(OldCond);</div>
<div class="line"><a name="l07032"></a><span class="lineno"> 7032</span>&#160;    <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l07033"></a><span class="lineno"> 7033</span>&#160;  }</div>
<div class="line"><a name="l07034"></a><span class="lineno"> 7034</span>&#160; </div>
<div class="line"><a name="l07035"></a><span class="lineno"> 7035</span>&#160;  <span class="comment">// If this basic block is ONLY a compare and a branch, and if a predecessor</span></div>
<div class="line"><a name="l07036"></a><span class="lineno"> 7036</span>&#160;  <span class="comment">// branches to us and one of our successors, fold the comparison into the</span></div>
<div class="line"><a name="l07037"></a><span class="lineno"> 7037</span>&#160;  <span class="comment">// predecessor and use logical operations to pick the right destination.</span></div>
<div class="line"><a name="l07038"></a><span class="lineno"> 7038</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a6713fe2f5fca7c6e1109392b28c21c17">FoldBranchToCommonDest</a>(BI, DTU, <span class="comment">/*MSSAU=*/</span><span class="keyword">nullptr</span>, &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>,</div>
<div class="line"><a name="l07039"></a><span class="lineno"> 7039</span>&#160;                             <a class="code" href="PassBuilderBindings_8cpp.html#a47c521bf7ba0bb2147b96d068af30d04">Options</a>.BonusInstThreshold))</div>
<div class="line"><a name="l07040"></a><span class="lineno"> 7040</span>&#160;    <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l07041"></a><span class="lineno"> 7041</span>&#160; </div>
<div class="line"><a name="l07042"></a><span class="lineno"> 7042</span>&#160;  <span class="comment">// We have a conditional branch to two blocks that are only reachable</span></div>
<div class="line"><a name="l07043"></a><span class="lineno"> 7043</span>&#160;  <span class="comment">// from BI.  We know that the condbr dominates the two blocks, so see if</span></div>
<div class="line"><a name="l07044"></a><span class="lineno"> 7044</span>&#160;  <span class="comment">// there is any identical code in the &quot;then&quot; and &quot;else&quot; blocks.  If so, we</span></div>
<div class="line"><a name="l07045"></a><span class="lineno"> 7045</span>&#160;  <span class="comment">// can hoist it up to the branching block.</span></div>
<div class="line"><a name="l07046"></a><span class="lineno"> 7046</span>&#160;  <span class="keywordflow">if</span> (BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0)-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>()) {</div>
<div class="line"><a name="l07047"></a><span class="lineno"> 7047</span>&#160;    <span class="keywordflow">if</span> (BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1)-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>()) {</div>
<div class="line"><a name="l07048"></a><span class="lineno"> 7048</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#aa254de6a643d4e97c3a9930f360a4987">HoistCommon</a> &amp;&amp;</div>
<div class="line"><a name="l07049"></a><span class="lineno"> 7049</span>&#160;          HoistThenElseCodeToIf(BI, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, !<a class="code" href="PassBuilderBindings_8cpp.html#a47c521bf7ba0bb2147b96d068af30d04">Options</a>.HoistCommonInsts))</div>
<div class="line"><a name="l07050"></a><span class="lineno"> 7050</span>&#160;        <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l07051"></a><span class="lineno"> 7051</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l07052"></a><span class="lineno"> 7052</span>&#160;      <span class="comment">// If Successor #1 has multiple preds, we may be able to conditionally</span></div>
<div class="line"><a name="l07053"></a><span class="lineno"> 7053</span>&#160;      <span class="comment">// execute Successor #0 if it branches to Successor #1.</span></div>
<div class="line"><a name="l07054"></a><span class="lineno"> 7054</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Succ0TI = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0)-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>();</div>
<div class="line"><a name="l07055"></a><span class="lineno"> 7055</span>&#160;      <span class="keywordflow">if</span> (Succ0TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a3287172f2d13af086e6d66364e8c6de3">getNumSuccessors</a>() == 1 &amp;&amp;</div>
<div class="line"><a name="l07056"></a><span class="lineno"> 7056</span>&#160;          Succ0TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6e5d2e18c81baaeec7dadc81a0dea993">getSuccessor</a>(0) == BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1))</div>
<div class="line"><a name="l07057"></a><span class="lineno"> 7057</span>&#160;        <span class="keywordflow">if</span> (SpeculativelyExecuteBB(BI, BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0), <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>))</div>
<div class="line"><a name="l07058"></a><span class="lineno"> 7058</span>&#160;          <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l07059"></a><span class="lineno"> 7059</span>&#160;    }</div>
<div class="line"><a name="l07060"></a><span class="lineno"> 7060</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1)-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>()) {</div>
<div class="line"><a name="l07061"></a><span class="lineno"> 7061</span>&#160;    <span class="comment">// If Successor #0 has multiple preds, we may be able to conditionally</span></div>
<div class="line"><a name="l07062"></a><span class="lineno"> 7062</span>&#160;    <span class="comment">// execute Successor #1 if it branches to Successor #0.</span></div>
<div class="line"><a name="l07063"></a><span class="lineno"> 7063</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Succ1TI = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1)-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>();</div>
<div class="line"><a name="l07064"></a><span class="lineno"> 7064</span>&#160;    <span class="keywordflow">if</span> (Succ1TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a3287172f2d13af086e6d66364e8c6de3">getNumSuccessors</a>() == 1 &amp;&amp;</div>
<div class="line"><a name="l07065"></a><span class="lineno"> 7065</span>&#160;        Succ1TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6e5d2e18c81baaeec7dadc81a0dea993">getSuccessor</a>(0) == BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0))</div>
<div class="line"><a name="l07066"></a><span class="lineno"> 7066</span>&#160;      <span class="keywordflow">if</span> (SpeculativelyExecuteBB(BI, BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1), <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>))</div>
<div class="line"><a name="l07067"></a><span class="lineno"> 7067</span>&#160;        <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l07068"></a><span class="lineno"> 7068</span>&#160;  }</div>
<div class="line"><a name="l07069"></a><span class="lineno"> 7069</span>&#160; </div>
<div class="line"><a name="l07070"></a><span class="lineno"> 7070</span>&#160;  <span class="comment">// If this is a branch on something for which we know the constant value in</span></div>
<div class="line"><a name="l07071"></a><span class="lineno"> 7071</span>&#160;  <span class="comment">// predecessors (e.g. a phi node in the current block), thread control</span></div>
<div class="line"><a name="l07072"></a><span class="lineno"> 7072</span>&#160;  <span class="comment">// through this block.</span></div>
<div class="line"><a name="l07073"></a><span class="lineno"> 7073</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a77b36b0c3d9cdfab87304f5181154f9b">FoldCondBranchOnValueKnownInPredecessor</a>(BI, DTU, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="PassBuilderBindings_8cpp.html#a47c521bf7ba0bb2147b96d068af30d04">Options</a>.AC))</div>
<div class="line"><a name="l07074"></a><span class="lineno"> 7074</span>&#160;    <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l07075"></a><span class="lineno"> 7075</span>&#160; </div>
<div class="line"><a name="l07076"></a><span class="lineno"> 7076</span>&#160;  <span class="comment">// Scan predecessor blocks for conditional branches.</span></div>
<div class="line"><a name="l07077"></a><span class="lineno"> 7077</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred : <a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>))</div>
<div class="line"><a name="l07078"></a><span class="lineno"> 7078</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *PBI = dyn_cast&lt;BranchInst&gt;(Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>()))</div>
<div class="line"><a name="l07079"></a><span class="lineno"> 7079</span>&#160;      <span class="keywordflow">if</span> (PBI != BI &amp;&amp; PBI-&gt;isConditional())</div>
<div class="line"><a name="l07080"></a><span class="lineno"> 7080</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a40f7c70fc970f25f1c32e8b2c28662ec">SimplifyCondBranchToCondBranch</a>(PBI, BI, DTU, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>))</div>
<div class="line"><a name="l07081"></a><span class="lineno"> 7081</span>&#160;          <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l07082"></a><span class="lineno"> 7082</span>&#160; </div>
<div class="line"><a name="l07083"></a><span class="lineno"> 7083</span>&#160;  <span class="comment">// Look for diamond patterns.</span></div>
<div class="line"><a name="l07084"></a><span class="lineno"> 7084</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#aeb1d8a382ce658ab7dbbbbcd06def17a">MergeCondStores</a>)</div>
<div class="line"><a name="l07085"></a><span class="lineno"> 7085</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PrevBB = <a class="code" href="SimplifyCFG_8cpp.html#aea84738a371d95e7d9d00386801ed182">allPredecessorsComeFromSameSource</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>))</div>
<div class="line"><a name="l07086"></a><span class="lineno"> 7086</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *PBI = dyn_cast&lt;BranchInst&gt;(PrevBB-&gt;getTerminator()))</div>
<div class="line"><a name="l07087"></a><span class="lineno"> 7087</span>&#160;        <span class="keywordflow">if</span> (PBI != BI &amp;&amp; PBI-&gt;isConditional())</div>
<div class="line"><a name="l07088"></a><span class="lineno"> 7088</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a6a58dfc629e1b208cdd7b2bd76203184">mergeConditionalStores</a>(PBI, BI, DTU, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>))</div>
<div class="line"><a name="l07089"></a><span class="lineno"> 7089</span>&#160;            <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l07090"></a><span class="lineno"> 7090</span>&#160; </div>
<div class="line"><a name="l07091"></a><span class="lineno"> 7091</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07092"></a><span class="lineno"> 7092</span>&#160;}</div>
<div class="line"><a name="l07093"></a><span class="lineno"> 7093</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07094"></a><span class="lineno"> 7094</span>&#160;<span class="comment">/// Check if passing a value to an instruction will cause undefined behavior.</span></div>
<div class="line"><a name="l07095"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a32c2973fa0babdd440d3ab7dd160664a"> 7095</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a32c2973fa0babdd440d3ab7dd160664a">passingValueIsAlwaysUndefined</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="keywordtype">bool</span> PtrValueMayBeModified) {</div>
<div class="line"><a name="l07096"></a><span class="lineno"> 7096</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;Constant&gt;(V);</div>
<div class="line"><a name="l07097"></a><span class="lineno"> 7097</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>)</div>
<div class="line"><a name="l07098"></a><span class="lineno"> 7098</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07099"></a><span class="lineno"> 7099</span>&#160; </div>
<div class="line"><a name="l07100"></a><span class="lineno"> 7100</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;use_empty())</div>
<div class="line"><a name="l07101"></a><span class="lineno"> 7101</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07102"></a><span class="lineno"> 7102</span>&#160; </div>
<div class="line"><a name="l07103"></a><span class="lineno"> 7103</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;isNullValue() || isa&lt;UndefValue&gt;(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>)) {</div>
<div class="line"><a name="l07104"></a><span class="lineno"> 7104</span>&#160;    <span class="comment">// Only look at the first use, avoid hurting compile time with long uselists</span></div>
<div class="line"><a name="l07105"></a><span class="lineno"> 7105</span>&#160;    <span class="keyword">auto</span> *<a class="code" href="classllvm_1_1Use.html">Use</a> = cast&lt;Instruction&gt;(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;user_begin());</div>
<div class="line"><a name="l07106"></a><span class="lineno"> 7106</span>&#160;    <span class="comment">// Bail out if Use is not in the same BB as I or Use == I or Use comes</span></div>
<div class="line"><a name="l07107"></a><span class="lineno"> 7107</span>&#160;    <span class="comment">// before I in the block. The latter two can be the case if Use is a PHI</span></div>
<div class="line"><a name="l07108"></a><span class="lineno"> 7108</span>&#160;    <span class="comment">// node.</span></div>
<div class="line"><a name="l07109"></a><span class="lineno"> 7109</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Use.html">Use</a>-&gt;getParent() != <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() || <a class="code" href="classllvm_1_1Use.html">Use</a> == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> || <a class="code" href="classllvm_1_1Use.html">Use</a>-&gt;comesBefore(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l07110"></a><span class="lineno"> 7110</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07111"></a><span class="lineno"> 7111</span>&#160; </div>
<div class="line"><a name="l07112"></a><span class="lineno"> 7112</span>&#160;    <span class="comment">// Now make sure that there are no instructions in between that can alter</span></div>
<div class="line"><a name="l07113"></a><span class="lineno"> 7113</span>&#160;    <span class="comment">// control flow (eg. calls)</span></div>
<div class="line"><a name="l07114"></a><span class="lineno"> 7114</span>&#160;    <span class="keyword">auto</span> InstrRange =</div>
<div class="line"><a name="l07115"></a><span class="lineno"> 7115</span>&#160;        <a class="code" href="namespacellvm.html#ad1a91b49e0c092818a0b82f6cc130a1b">make_range</a>(std::next(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getIterator()), <a class="code" href="classllvm_1_1Use.html">Use</a>-&gt;getIterator());</div>
<div class="line"><a name="l07116"></a><span class="lineno"> 7116</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(InstrRange, [](<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l07117"></a><span class="lineno"> 7117</span>&#160;          <span class="keywordflow">return</span> !<a class="code" href="namespacellvm.html#abff5a423c1f45e23958dde8ee695c9a9">isGuaranteedToTransferExecutionToSuccessor</a>(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l07118"></a><span class="lineno"> 7118</span>&#160;        }))</div>
<div class="line"><a name="l07119"></a><span class="lineno"> 7119</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07120"></a><span class="lineno"> 7120</span>&#160; </div>
<div class="line"><a name="l07121"></a><span class="lineno"> 7121</span>&#160;    <span class="comment">// Look through GEPs. A load from a GEP derived from NULL is still undefined</span></div>
<div class="line"><a name="l07122"></a><span class="lineno"> 7122</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = dyn_cast&lt;GetElementPtrInst&gt;(<a class="code" href="classllvm_1_1Use.html">Use</a>))</div>
<div class="line"><a name="l07123"></a><span class="lineno"> 7123</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getPointerOperand() == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l07124"></a><span class="lineno"> 7124</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;isInBounds() || !<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;hasAllZeroIndices())</div>
<div class="line"><a name="l07125"></a><span class="lineno"> 7125</span>&#160;          PtrValueMayBeModified = <span class="keyword">true</span>;</div>
<div class="line"><a name="l07126"></a><span class="lineno"> 7126</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="SimplifyCFG_8cpp.html#a32c2973fa0babdd440d3ab7dd160664a">passingValueIsAlwaysUndefined</a>(V, <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, PtrValueMayBeModified);</div>
<div class="line"><a name="l07127"></a><span class="lineno"> 7127</span>&#160;      }</div>
<div class="line"><a name="l07128"></a><span class="lineno"> 7128</span>&#160; </div>
<div class="line"><a name="l07129"></a><span class="lineno"> 7129</span>&#160;    <span class="comment">// Look through bitcasts.</span></div>
<div class="line"><a name="l07130"></a><span class="lineno"> 7130</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *BC = dyn_cast&lt;BitCastInst&gt;(<a class="code" href="classllvm_1_1Use.html">Use</a>))</div>
<div class="line"><a name="l07131"></a><span class="lineno"> 7131</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="SimplifyCFG_8cpp.html#a32c2973fa0babdd440d3ab7dd160664a">passingValueIsAlwaysUndefined</a>(V, BC, PtrValueMayBeModified);</div>
<div class="line"><a name="l07132"></a><span class="lineno"> 7132</span>&#160; </div>
<div class="line"><a name="l07133"></a><span class="lineno"> 7133</span>&#160;    <span class="comment">// Load from null is undefined.</span></div>
<div class="line"><a name="l07134"></a><span class="lineno"> 7134</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(<a class="code" href="classllvm_1_1Use.html">Use</a>))</div>
<div class="line"><a name="l07135"></a><span class="lineno"> 7135</span>&#160;      <span class="keywordflow">if</span> (!LI-&gt;isVolatile())</div>
<div class="line"><a name="l07136"></a><span class="lineno"> 7136</span>&#160;        <span class="keywordflow">return</span> !<a class="code" href="namespacellvm.html#a7b03ed78a8e299bde6d26a8793cd4e06">NullPointerIsDefined</a>(LI-&gt;getFunction(),</div>
<div class="line"><a name="l07137"></a><span class="lineno"> 7137</span>&#160;                                     LI-&gt;getPointerAddressSpace());</div>
<div class="line"><a name="l07138"></a><span class="lineno"> 7138</span>&#160; </div>
<div class="line"><a name="l07139"></a><span class="lineno"> 7139</span>&#160;    <span class="comment">// Store to null is undefined.</span></div>
<div class="line"><a name="l07140"></a><span class="lineno"> 7140</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;StoreInst&gt;(<a class="code" href="classllvm_1_1Use.html">Use</a>))</div>
<div class="line"><a name="l07141"></a><span class="lineno"> 7141</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;isVolatile())</div>
<div class="line"><a name="l07142"></a><span class="lineno"> 7142</span>&#160;        <span class="keywordflow">return</span> (!<a class="code" href="namespacellvm.html#a7b03ed78a8e299bde6d26a8793cd4e06">NullPointerIsDefined</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getFunction(),</div>
<div class="line"><a name="l07143"></a><span class="lineno"> 7143</span>&#160;                                      <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getPointerAddressSpace())) &amp;&amp;</div>
<div class="line"><a name="l07144"></a><span class="lineno"> 7144</span>&#160;               <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getPointerOperand() == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l07145"></a><span class="lineno"> 7145</span>&#160; </div>
<div class="line"><a name="l07146"></a><span class="lineno"> 7146</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *CB = dyn_cast&lt;CallBase&gt;(<a class="code" href="classllvm_1_1Use.html">Use</a>)) {</div>
<div class="line"><a name="l07147"></a><span class="lineno"> 7147</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;isNullValue() &amp;&amp; <a class="code" href="namespacellvm.html#a7b03ed78a8e299bde6d26a8793cd4e06">NullPointerIsDefined</a>(CB-&gt;getFunction()))</div>
<div class="line"><a name="l07148"></a><span class="lineno"> 7148</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07149"></a><span class="lineno"> 7149</span>&#160;      <span class="comment">// A call to null is undefined.</span></div>
<div class="line"><a name="l07150"></a><span class="lineno"> 7150</span>&#160;      <span class="keywordflow">if</span> (CB-&gt;getCalledOperand() == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l07151"></a><span class="lineno"> 7151</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07152"></a><span class="lineno"> 7152</span>&#160; </div>
<div class="line"><a name="l07153"></a><span class="lineno"> 7153</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;isNullValue()) {</div>
<div class="line"><a name="l07154"></a><span class="lineno"> 7154</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1Use.html">llvm::Use</a> &amp;<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a> : CB-&gt;args())</div>
<div class="line"><a name="l07155"></a><span class="lineno"> 7155</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a> == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l07156"></a><span class="lineno"> 7156</span>&#160;            <span class="keywordtype">unsigned</span> ArgIdx = CB-&gt;getArgOperandNo(&amp;<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a>);</div>
<div class="line"><a name="l07157"></a><span class="lineno"> 7157</span>&#160;            <span class="keywordflow">if</span> (CB-&gt;isPassingUndefUB(ArgIdx) &amp;&amp;</div>
<div class="line"><a name="l07158"></a><span class="lineno"> 7158</span>&#160;                CB-&gt;paramHasAttr(ArgIdx, Attribute::NonNull)) {</div>
<div class="line"><a name="l07159"></a><span class="lineno"> 7159</span>&#160;              <span class="comment">// Passing null to a nonnnull+noundef argument is undefined.</span></div>
<div class="line"><a name="l07160"></a><span class="lineno"> 7160</span>&#160;              <span class="keywordflow">return</span> !PtrValueMayBeModified;</div>
<div class="line"><a name="l07161"></a><span class="lineno"> 7161</span>&#160;            }</div>
<div class="line"><a name="l07162"></a><span class="lineno"> 7162</span>&#160;          }</div>
<div class="line"><a name="l07163"></a><span class="lineno"> 7163</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;UndefValue&gt;(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>)) {</div>
<div class="line"><a name="l07164"></a><span class="lineno"> 7164</span>&#160;        <span class="comment">// Passing undef to a noundef argument is undefined.</span></div>
<div class="line"><a name="l07165"></a><span class="lineno"> 7165</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1Use.html">llvm::Use</a> &amp;<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a> : CB-&gt;args())</div>
<div class="line"><a name="l07166"></a><span class="lineno"> 7166</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a> == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l07167"></a><span class="lineno"> 7167</span>&#160;            <span class="keywordtype">unsigned</span> ArgIdx = CB-&gt;getArgOperandNo(&amp;<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a>);</div>
<div class="line"><a name="l07168"></a><span class="lineno"> 7168</span>&#160;            <span class="keywordflow">if</span> (CB-&gt;isPassingUndefUB(ArgIdx)) {</div>
<div class="line"><a name="l07169"></a><span class="lineno"> 7169</span>&#160;              <span class="comment">// Passing undef to a noundef argument is undefined.</span></div>
<div class="line"><a name="l07170"></a><span class="lineno"> 7170</span>&#160;              <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07171"></a><span class="lineno"> 7171</span>&#160;            }</div>
<div class="line"><a name="l07172"></a><span class="lineno"> 7172</span>&#160;          }</div>
<div class="line"><a name="l07173"></a><span class="lineno"> 7173</span>&#160;      }</div>
<div class="line"><a name="l07174"></a><span class="lineno"> 7174</span>&#160;    }</div>
<div class="line"><a name="l07175"></a><span class="lineno"> 7175</span>&#160;  }</div>
<div class="line"><a name="l07176"></a><span class="lineno"> 7176</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07177"></a><span class="lineno"> 7177</span>&#160;}</div>
<div class="line"><a name="l07178"></a><span class="lineno"> 7178</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07179"></a><span class="lineno"> 7179</span>&#160;<span class="comment">/// If BB has an incoming value that will always trigger undefined behavior</span></div>
<div class="line"><a name="l07180"></a><span class="lineno"> 7180</span>&#160;<span class="comment">/// (eg. null pointer dereference), remove the branch leading here.</span></div>
<div class="line"><a name="l07181"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#abcb8065aab78b9142ec8a5a3d56c27bb"> 7181</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#abcb8065aab78b9142ec8a5a3d56c27bb">removeUndefIntroducingPredecessor</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>,</div>
<div class="line"><a name="l07182"></a><span class="lineno"> 7182</span>&#160;                                              <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> *DTU) {</div>
<div class="line"><a name="l07183"></a><span class="lineno"> 7183</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> &amp;<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> : <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;phis())</div>
<div class="line"><a name="l07184"></a><span class="lineno"> 7184</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getNumIncomingValues(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l07185"></a><span class="lineno"> 7185</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a32c2973fa0babdd440d3ab7dd160664a">passingValueIsAlwaysUndefined</a>(<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getIncomingValue(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>), &amp;<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>)) {</div>
<div class="line"><a name="l07186"></a><span class="lineno"> 7186</span>&#160;        <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Predecessor = <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getIncomingBlock(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l07187"></a><span class="lineno"> 7187</span>&#160;        <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classT.html">T</a> = Predecessor-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>();</div>
<div class="line"><a name="l07188"></a><span class="lineno"> 7188</span>&#160;        <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="classT.html">T</a>);</div>
<div class="line"><a name="l07189"></a><span class="lineno"> 7189</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = dyn_cast&lt;BranchInst&gt;(<a class="code" href="classT.html">T</a>)) {</div>
<div class="line"><a name="l07190"></a><span class="lineno"> 7190</span>&#160;          <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;removePredecessor(Predecessor);</div>
<div class="line"><a name="l07191"></a><span class="lineno"> 7191</span>&#160;          <span class="comment">// Turn unconditional branches into unreachables and remove the dead</span></div>
<div class="line"><a name="l07192"></a><span class="lineno"> 7192</span>&#160;          <span class="comment">// destination from conditional branches.</span></div>
<div class="line"><a name="l07193"></a><span class="lineno"> 7193</span>&#160;          <span class="keywordflow">if</span> (BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad56f6a9b5cd05940017c4544df48bc30">isUnconditional</a>())</div>
<div class="line"><a name="l07194"></a><span class="lineno"> 7194</span>&#160;            <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateUnreachable();</div>
<div class="line"><a name="l07195"></a><span class="lineno"> 7195</span>&#160;          <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l07196"></a><span class="lineno"> 7196</span>&#160;            <span class="comment">// Preserve guarding condition in assume, because it might not be</span></div>
<div class="line"><a name="l07197"></a><span class="lineno"> 7197</span>&#160;            <span class="comment">// inferrable from any dominating condition.</span></div>
<div class="line"><a name="l07198"></a><span class="lineno"> 7198</span>&#160;            <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a> = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">getCondition</a>();</div>
<div class="line"><a name="l07199"></a><span class="lineno"> 7199</span>&#160;            <span class="keywordflow">if</span> (BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0) == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l07200"></a><span class="lineno"> 7200</span>&#160;              <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAssumption(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateNot(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>));</div>
<div class="line"><a name="l07201"></a><span class="lineno"> 7201</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l07202"></a><span class="lineno"> 7202</span>&#160;              <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAssumption(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>);</div>
<div class="line"><a name="l07203"></a><span class="lineno"> 7203</span>&#160;            <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBr(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0) == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> ? BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1)</div>
<div class="line"><a name="l07204"></a><span class="lineno"> 7204</span>&#160;                                                       : BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0));</div>
<div class="line"><a name="l07205"></a><span class="lineno"> 7205</span>&#160;          }</div>
<div class="line"><a name="l07206"></a><span class="lineno"> 7206</span>&#160;          BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l07207"></a><span class="lineno"> 7207</span>&#160;          <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l07208"></a><span class="lineno"> 7208</span>&#160;            DTU-&gt;<a class="code" href="classllvm_1_1DomTreeUpdater.html#aae522cd1928cfac6850b50c7a3e22185">applyUpdates</a>({{DominatorTree::Delete, Predecessor, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>}});</div>
<div class="line"><a name="l07209"></a><span class="lineno"> 7209</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07210"></a><span class="lineno"> 7210</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;SwitchInst&gt;(<a class="code" href="classT.html">T</a>)) {</div>
<div class="line"><a name="l07211"></a><span class="lineno"> 7211</span>&#160;          <span class="comment">// Redirect all branches leading to UB into</span></div>
<div class="line"><a name="l07212"></a><span class="lineno"> 7212</span>&#160;          <span class="comment">// a newly created unreachable block.</span></div>
<div class="line"><a name="l07213"></a><span class="lineno"> 7213</span>&#160;          <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Unreachable = BasicBlock::Create(</div>
<div class="line"><a name="l07214"></a><span class="lineno"> 7214</span>&#160;              Predecessor-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(), <span class="stringliteral">&quot;unreachable&quot;</span>, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getParent(), <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l07215"></a><span class="lineno"> 7215</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(Unreachable);</div>
<div class="line"><a name="l07216"></a><span class="lineno"> 7216</span>&#160;          <span class="comment">// The new block contains only one instruction: Unreachable</span></div>
<div class="line"><a name="l07217"></a><span class="lineno"> 7217</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateUnreachable();</div>
<div class="line"><a name="l07218"></a><span class="lineno"> 7218</span>&#160;          <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;Case : <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;cases())</div>
<div class="line"><a name="l07219"></a><span class="lineno"> 7219</span>&#160;            <span class="keywordflow">if</span> (Case.getCaseSuccessor() == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l07220"></a><span class="lineno"> 7220</span>&#160;              <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;removePredecessor(Predecessor);</div>
<div class="line"><a name="l07221"></a><span class="lineno"> 7221</span>&#160;              Case.setSuccessor(Unreachable);</div>
<div class="line"><a name="l07222"></a><span class="lineno"> 7222</span>&#160;            }</div>
<div class="line"><a name="l07223"></a><span class="lineno"> 7223</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDefaultDest() == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l07224"></a><span class="lineno"> 7224</span>&#160;            <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;removePredecessor(Predecessor);</div>
<div class="line"><a name="l07225"></a><span class="lineno"> 7225</span>&#160;            <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;setDefaultDest(Unreachable);</div>
<div class="line"><a name="l07226"></a><span class="lineno"> 7226</span>&#160;          }</div>
<div class="line"><a name="l07227"></a><span class="lineno"> 7227</span>&#160; </div>
<div class="line"><a name="l07228"></a><span class="lineno"> 7228</span>&#160;          <span class="keywordflow">if</span> (DTU)</div>
<div class="line"><a name="l07229"></a><span class="lineno"> 7229</span>&#160;            DTU-&gt;<a class="code" href="classllvm_1_1DomTreeUpdater.html#aae522cd1928cfac6850b50c7a3e22185">applyUpdates</a>(</div>
<div class="line"><a name="l07230"></a><span class="lineno"> 7230</span>&#160;                { { <a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">DominatorTree::Insert</a>, Predecessor, Unreachable },</div>
<div class="line"><a name="l07231"></a><span class="lineno"> 7231</span>&#160;                  { DominatorTree::Delete, Predecessor, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> } });</div>
<div class="line"><a name="l07232"></a><span class="lineno"> 7232</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07233"></a><span class="lineno"> 7233</span>&#160;        }</div>
<div class="line"><a name="l07234"></a><span class="lineno"> 7234</span>&#160;      }</div>
<div class="line"><a name="l07235"></a><span class="lineno"> 7235</span>&#160; </div>
<div class="line"><a name="l07236"></a><span class="lineno"> 7236</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07237"></a><span class="lineno"> 7237</span>&#160;}</div>
<div class="line"><a name="l07238"></a><span class="lineno"> 7238</span>&#160; </div>
<div class="line"><a name="l07239"></a><span class="lineno"> 7239</span>&#160;<span class="keywordtype">bool</span> SimplifyCFGOpt::simplifyOnce(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l07240"></a><span class="lineno"> 7240</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l07241"></a><span class="lineno"> 7241</span>&#160; </div>
<div class="line"><a name="l07242"></a><span class="lineno"> 7242</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> &amp;&amp; <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getParent() &amp;&amp; <span class="stringliteral">&quot;Block not embedded in function!&quot;</span>);</div>
<div class="line"><a name="l07243"></a><span class="lineno"> 7243</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getTerminator() &amp;&amp; <span class="stringliteral">&quot;Degenerate basic block encountered!&quot;</span>);</div>
<div class="line"><a name="l07244"></a><span class="lineno"> 7244</span>&#160; </div>
<div class="line"><a name="l07245"></a><span class="lineno"> 7245</span>&#160;  <span class="comment">// Remove basic blocks that have no predecessors (except the entry block)...</span></div>
<div class="line"><a name="l07246"></a><span class="lineno"> 7246</span>&#160;  <span class="comment">// or that just have themself as a predecessor.  These are unreachable.</span></div>
<div class="line"><a name="l07247"></a><span class="lineno"> 7247</span>&#160;  <span class="keywordflow">if</span> ((<a class="code" href="namespacellvm.html#ad66c4759666aab78529658362b498c74">pred_empty</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) &amp;&amp; <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> != &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getParent()-&gt;getEntryBlock()) ||</div>
<div class="line"><a name="l07248"></a><span class="lineno"> 7248</span>&#160;      <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getSinglePredecessor() == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l07249"></a><span class="lineno"> 7249</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Removing BB: \n&quot;</span> &lt;&lt; *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l07250"></a><span class="lineno"> 7250</span>&#160;    <a class="code" href="namespacellvm.html#a458b4709ebedccb846a179f1e422265b">DeleteDeadBlock</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, DTU);</div>
<div class="line"><a name="l07251"></a><span class="lineno"> 7251</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07252"></a><span class="lineno"> 7252</span>&#160;  }</div>
<div class="line"><a name="l07253"></a><span class="lineno"> 7253</span>&#160; </div>
<div class="line"><a name="l07254"></a><span class="lineno"> 7254</span>&#160;  <span class="comment">// Check to see if we can constant propagate this terminator instruction</span></div>
<div class="line"><a name="l07255"></a><span class="lineno"> 7255</span>&#160;  <span class="comment">// away...</span></div>
<div class="line"><a name="l07256"></a><span class="lineno"> 7256</span>&#160;  Changed |= <a class="code" href="namespacellvm.html#a152d8c380cc937c9dceb402ceec943b6">ConstantFoldTerminator</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <span class="comment">/*DeleteDeadConditions=*/</span><span class="keyword">true</span>,</div>
<div class="line"><a name="l07257"></a><span class="lineno"> 7257</span>&#160;                                    <span class="comment">/*TLI=*/</span><span class="keyword">nullptr</span>, DTU);</div>
<div class="line"><a name="l07258"></a><span class="lineno"> 7258</span>&#160; </div>
<div class="line"><a name="l07259"></a><span class="lineno"> 7259</span>&#160;  <span class="comment">// Check for and eliminate duplicate PHI nodes in this block.</span></div>
<div class="line"><a name="l07260"></a><span class="lineno"> 7260</span>&#160;  Changed |= <a class="code" href="namespacellvm.html#aed498f056a09006219c59ee9fab0450f">EliminateDuplicatePHINodes</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l07261"></a><span class="lineno"> 7261</span>&#160; </div>
<div class="line"><a name="l07262"></a><span class="lineno"> 7262</span>&#160;  <span class="comment">// Check for and remove branches that will always cause undefined behavior.</span></div>
<div class="line"><a name="l07263"></a><span class="lineno"> 7263</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#abcb8065aab78b9142ec8a5a3d56c27bb">removeUndefIntroducingPredecessor</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, DTU))</div>
<div class="line"><a name="l07264"></a><span class="lineno"> 7264</span>&#160;    <span class="keywordflow">return</span> requestResimplify();</div>
<div class="line"><a name="l07265"></a><span class="lineno"> 7265</span>&#160; </div>
<div class="line"><a name="l07266"></a><span class="lineno"> 7266</span>&#160;  <span class="comment">// Merge basic blocks into their predecessor if there is only one distinct</span></div>
<div class="line"><a name="l07267"></a><span class="lineno"> 7267</span>&#160;  <span class="comment">// pred, and if there is only one distinct successor of the predecessor, and</span></div>
<div class="line"><a name="l07268"></a><span class="lineno"> 7268</span>&#160;  <span class="comment">// if there are no PHI nodes.</span></div>
<div class="line"><a name="l07269"></a><span class="lineno"> 7269</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#aa76a2cf19b821f320ab439d5659ef4b9">MergeBlockIntoPredecessor</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, DTU))</div>
<div class="line"><a name="l07270"></a><span class="lineno"> 7270</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07271"></a><span class="lineno"> 7271</span>&#160; </div>
<div class="line"><a name="l07272"></a><span class="lineno"> 7272</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#ac7707bcaec113d0d136467c7b97a62f1">SinkCommon</a> &amp;&amp; <a class="code" href="PassBuilderBindings_8cpp.html#a47c521bf7ba0bb2147b96d068af30d04">Options</a>.SinkCommonInsts)</div>
<div class="line"><a name="l07273"></a><span class="lineno"> 7273</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a483d3fcb928be402adb5c42809db8e58">SinkCommonCodeFromPredecessors</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, DTU) ||</div>
<div class="line"><a name="l07274"></a><span class="lineno"> 7274</span>&#160;        <a class="code" href="SimplifyCFG_8cpp.html#aead732ab028930952db3ce9c38165276">MergeCompatibleInvokes</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, DTU)) {</div>
<div class="line"><a name="l07275"></a><span class="lineno"> 7275</span>&#160;      <span class="comment">// SinkCommonCodeFromPredecessors() does not automatically CSE PHI&#39;s,</span></div>
<div class="line"><a name="l07276"></a><span class="lineno"> 7276</span>&#160;      <span class="comment">// so we may now how duplicate PHI&#39;s.</span></div>
<div class="line"><a name="l07277"></a><span class="lineno"> 7277</span>&#160;      <span class="comment">// Let&#39;s rerun EliminateDuplicatePHINodes() first,</span></div>
<div class="line"><a name="l07278"></a><span class="lineno"> 7278</span>&#160;      <span class="comment">// before FoldTwoEntryPHINode() potentially converts them into select&#39;s,</span></div>
<div class="line"><a name="l07279"></a><span class="lineno"> 7279</span>&#160;      <span class="comment">// after which we&#39;d need a whole EarlyCSE pass run to cleanup them.</span></div>
<div class="line"><a name="l07280"></a><span class="lineno"> 7280</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07281"></a><span class="lineno"> 7281</span>&#160;    }</div>
<div class="line"><a name="l07282"></a><span class="lineno"> 7282</span>&#160; </div>
<div class="line"><a name="l07283"></a><span class="lineno"> 7283</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l07284"></a><span class="lineno"> 7284</span>&#160; </div>
<div class="line"><a name="l07285"></a><span class="lineno"> 7285</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="PassBuilderBindings_8cpp.html#a47c521bf7ba0bb2147b96d068af30d04">Options</a>.FoldTwoEntryPHINode) {</div>
<div class="line"><a name="l07286"></a><span class="lineno"> 7286</span>&#160;    <span class="comment">// If there is a trivial two-entry PHI node in this basic block, and we can</span></div>
<div class="line"><a name="l07287"></a><span class="lineno"> 7287</span>&#160;    <span class="comment">// eliminate it, do so now.</span></div>
<div class="line"><a name="l07288"></a><span class="lineno"> 7288</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *PN = dyn_cast&lt;PHINode&gt;(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;begin()))</div>
<div class="line"><a name="l07289"></a><span class="lineno"> 7289</span>&#160;      <span class="keywordflow">if</span> (PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>() == 2)</div>
<div class="line"><a name="l07290"></a><span class="lineno"> 7290</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#adf89b508645e361807eecee2e70a4852">FoldTwoEntryPHINode</a>(PN, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, DTU, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</div>
<div class="line"><a name="l07291"></a><span class="lineno"> 7291</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07292"></a><span class="lineno"> 7292</span>&#160;  }</div>
<div class="line"><a name="l07293"></a><span class="lineno"> 7293</span>&#160; </div>
<div class="line"><a name="l07294"></a><span class="lineno"> 7294</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023af121d798d2c14b32e81d537a1f0cff8d">Terminator</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getTerminator();</div>
<div class="line"><a name="l07295"></a><span class="lineno"> 7295</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023af121d798d2c14b32e81d537a1f0cff8d">Terminator</a>);</div>
<div class="line"><a name="l07296"></a><span class="lineno"> 7296</span>&#160;  <span class="keywordflow">switch</span> (<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023af121d798d2c14b32e81d537a1f0cff8d">Terminator</a>-&gt;getOpcode()) {</div>
<div class="line"><a name="l07297"></a><span class="lineno"> 7297</span>&#160;  <span class="keywordflow">case</span> Instruction::Br:</div>
<div class="line"><a name="l07298"></a><span class="lineno"> 7298</span>&#160;    Changed |= simplifyBranch(cast&lt;BranchInst&gt;(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023af121d798d2c14b32e81d537a1f0cff8d">Terminator</a>), <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l07299"></a><span class="lineno"> 7299</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l07300"></a><span class="lineno"> 7300</span>&#160;  <span class="keywordflow">case</span> Instruction::Resume:</div>
<div class="line"><a name="l07301"></a><span class="lineno"> 7301</span>&#160;    Changed |= simplifyResume(cast&lt;ResumeInst&gt;(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023af121d798d2c14b32e81d537a1f0cff8d">Terminator</a>), <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l07302"></a><span class="lineno"> 7302</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l07303"></a><span class="lineno"> 7303</span>&#160;  <span class="keywordflow">case</span> Instruction::CleanupRet:</div>
<div class="line"><a name="l07304"></a><span class="lineno"> 7304</span>&#160;    Changed |= simplifyCleanupReturn(cast&lt;CleanupReturnInst&gt;(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023af121d798d2c14b32e81d537a1f0cff8d">Terminator</a>));</div>
<div class="line"><a name="l07305"></a><span class="lineno"> 7305</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l07306"></a><span class="lineno"> 7306</span>&#160;  <span class="keywordflow">case</span> Instruction::Switch:</div>
<div class="line"><a name="l07307"></a><span class="lineno"> 7307</span>&#160;    Changed |= simplifySwitch(cast&lt;SwitchInst&gt;(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023af121d798d2c14b32e81d537a1f0cff8d">Terminator</a>), <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l07308"></a><span class="lineno"> 7308</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l07309"></a><span class="lineno"> 7309</span>&#160;  <span class="keywordflow">case</span> Instruction::Unreachable:</div>
<div class="line"><a name="l07310"></a><span class="lineno"> 7310</span>&#160;    Changed |= simplifyUnreachable(cast&lt;UnreachableInst&gt;(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023af121d798d2c14b32e81d537a1f0cff8d">Terminator</a>));</div>
<div class="line"><a name="l07311"></a><span class="lineno"> 7311</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l07312"></a><span class="lineno"> 7312</span>&#160;  <span class="keywordflow">case</span> Instruction::IndirectBr:</div>
<div class="line"><a name="l07313"></a><span class="lineno"> 7313</span>&#160;    Changed |= simplifyIndirectBr(cast&lt;IndirectBrInst&gt;(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023af121d798d2c14b32e81d537a1f0cff8d">Terminator</a>));</div>
<div class="line"><a name="l07314"></a><span class="lineno"> 7314</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l07315"></a><span class="lineno"> 7315</span>&#160;  }</div>
<div class="line"><a name="l07316"></a><span class="lineno"> 7316</span>&#160; </div>
<div class="line"><a name="l07317"></a><span class="lineno"> 7317</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l07318"></a><span class="lineno"> 7318</span>&#160;}</div>
<div class="line"><a name="l07319"></a><span class="lineno"> 7319</span>&#160; </div>
<div class="line"><a name="l07320"></a><span class="lineno"> 7320</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="namespacellvm_1_1dxil_1_1PointerTypeAnalysis.html#ae574a4c1d84b9e67bc94489f356805b4">SimplifyCFGOpt::run</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l07321"></a><span class="lineno"> 7321</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l07322"></a><span class="lineno"> 7322</span>&#160; </div>
<div class="line"><a name="l07323"></a><span class="lineno"> 7323</span>&#160;  <span class="comment">// Repeated simplify BB as long as resimplification is requested.</span></div>
<div class="line"><a name="l07324"></a><span class="lineno"> 7324</span>&#160;  <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l07325"></a><span class="lineno"> 7325</span>&#160;    Resimplify = <span class="keyword">false</span>;</div>
<div class="line"><a name="l07326"></a><span class="lineno"> 7326</span>&#160; </div>
<div class="line"><a name="l07327"></a><span class="lineno"> 7327</span>&#160;    <span class="comment">// Perform one round of simplifcation. Resimplify flag will be set if</span></div>
<div class="line"><a name="l07328"></a><span class="lineno"> 7328</span>&#160;    <span class="comment">// another iteration is requested.</span></div>
<div class="line"><a name="l07329"></a><span class="lineno"> 7329</span>&#160;    Changed |= simplifyOnce(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l07330"></a><span class="lineno"> 7330</span>&#160;  } <span class="keywordflow">while</span> (Resimplify);</div>
<div class="line"><a name="l07331"></a><span class="lineno"> 7331</span>&#160; </div>
<div class="line"><a name="l07332"></a><span class="lineno"> 7332</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l07333"></a><span class="lineno"> 7333</span>&#160;}</div>
<div class="line"><a name="l07334"></a><span class="lineno"> 7334</span>&#160; </div>
<div class="line"><a name="l07335"></a><span class="lineno"><a class="line" href="namespacellvm.html#ac2a5d254b5ec303b4d47ac3f0f578f09"> 7335</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#ac2a5d254b5ec303b4d47ac3f0f578f09">llvm::simplifyCFG</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>,</div>
<div class="line"><a name="l07336"></a><span class="lineno"> 7336</span>&#160;                       <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> *DTU, <span class="keyword">const</span> <a class="code" href="structllvm_1_1SimplifyCFGOptions.html">SimplifyCFGOptions</a> &amp;<a class="code" href="PassBuilderBindings_8cpp.html#a47c521bf7ba0bb2147b96d068af30d04">Options</a>,</div>
<div class="line"><a name="l07337"></a><span class="lineno"> 7337</span>&#160;                       <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;WeakVH&gt;</a> LoopHeaders) {</div>
<div class="line"><a name="l07338"></a><span class="lineno"> 7338</span>&#160;  <span class="keywordflow">return</span> SimplifyCFGOpt(<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, DTU, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getModule()-&gt;getDataLayout(), LoopHeaders,</div>
<div class="line"><a name="l07339"></a><span class="lineno"> 7339</span>&#160;                        <a class="code" href="PassBuilderBindings_8cpp.html#a47c521bf7ba0bb2147b96d068af30d04">Options</a>)</div>
<div class="line"><a name="l07340"></a><span class="lineno"> 7340</span>&#160;      .run(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l07341"></a><span class="lineno"> 7341</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="anamespacellvm_1_1Check_html_a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396"><div class="ttname"><a href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">llvm::Check::Size</a></div><div class="ttdeci">@ Size</div><div class="ttdef"><b>Definition:</b> <a href="FileCheck_8h_source.html#l00077">FileCheck.h:77</a></div></div>
<div class="ttc" id="alib_2Target_2README_8txt_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2README_8txt_source.html#l00029">README.txt:29</a></div></div>
<div class="ttc" id="aclassllvm_1_1InvokeInst_html_a100bd3005ea84bf47f3b4021e8022633"><div class="ttname"><a href="classllvm_1_1InvokeInst.html#a100bd3005ea84bf47f3b4021e8022633">llvm::InvokeInst::getNormalDest</a></div><div class="ttdeci">BasicBlock * getNormalDest() const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03946">Instructions.h:3946</a></div></div>
<div class="ttc" id="aclassllvm_1_1InstructionCost_html"><div class="ttname"><a href="classllvm_1_1InstructionCost.html">llvm::InstructionCost</a></div><div class="ttdef"><b>Definition:</b> <a href="InstructionCost_8h_source.html#l00029">InstructionCost.h:29</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a6796a84f02394ce6ebef227c866cd5eb"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a6796a84f02394ce6ebef227c866cd5eb">llvm::BasicBlock::getTerminatingDeoptimizeCall</a></div><div class="ttdeci">const CallInst * getTerminatingDeoptimizeCall() const</div><div class="ttdoc">Returns the call instruction calling @llvm.experimental.deoptimize prior to the terminating return in...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00181">BasicBlock.cpp:181</a></div></div>
<div class="ttc" id="anamespacellvm_html_add1eb5637dd671428b6f138ed3db6428"><div class="ttname"><a href="namespacellvm.html#add1eb5637dd671428b6f138ed3db6428">llvm::array_pod_sort</a></div><div class="ttdeci">void array_pod_sort(IteratorTy Start, IteratorTy End)</div><div class="ttdoc">array_pod_sort - This sorts an array with the specified start and end extent.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01643">STLExtras.h:1643</a></div></div>
<div class="ttc" id="anamespacellvm_html_a1106b8a15061e8494873e10bb8a364e5"><div class="ttname"><a href="namespacellvm.html#a1106b8a15061e8494873e10bb8a364e5">llvm::RecursivelyDeleteTriviallyDeadInstructions</a></div><div class="ttdeci">bool RecursivelyDeleteTriviallyDeadInstructions(Value *V, const TargetLibraryInfo *TLI=nullptr, MemorySSAUpdater *MSSAU=nullptr, std::function&lt; void(Value *)&gt; AboutToDeleteCallback=std::function&lt; void(Value *)&gt;())</div><div class="ttdoc">If the specified value is a trivially dead instruction, delete it.</div><div class="ttdef"><b>Definition:</b> <a href="Transforms_2Utils_2Local_8cpp_source.html#l00537">Local.cpp:537</a></div></div>
<div class="ttc" id="aAssumptionCache_8h_html"><div class="ttname"><a href="AssumptionCache_8h.html">AssumptionCache.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_af29f89e91dfd0ae90950f0b1bf49798d"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#af29f89e91dfd0ae90950f0b1bf49798d">llvm::BasicBlock::splice</a></div><div class="ttdeci">void splice(BasicBlock::iterator ToIt, BasicBlock *FromBB)</div><div class="ttdoc">Transfer all instructions from FromBB to this basic block at ToIt.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00468">BasicBlock.h:468</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a0b4e7bee9b8575cc7db73329f1a561bd"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">llvm::BasicBlock::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00316">BasicBlock.h:316</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a794d3a5f46134c24aade41b327d8418e"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a794d3a5f46134c24aade41b327d8418e">trySwitchToSelect</a></div><div class="ttdeci">static bool trySwitchToSelect(SwitchInst *SI, IRBuilder&lt;&gt; &amp;Builder, DomTreeUpdater *DTU, const DataLayout &amp;DL, const TargetTransformInfo &amp;TTI)</div><div class="ttdoc">If a switch is only used to initialize one or more phi nodes in a common successor block with only tw...</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l05926">SimplifyCFG.cpp:5926</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a2b4678191aecb0ae9e493024c15c6c81"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a2b4678191aecb0ae9e493024c15c6c81">ReduceSwitchRange</a></div><div class="ttdeci">static bool ReduceSwitchRange(SwitchInst *SI, IRBuilder&lt;&gt; &amp;Builder, const DataLayout &amp;DL, const TargetTransformInfo &amp;TTI)</div><div class="ttdoc">Try to transform a switch that has &quot;holes&quot; in it to a contiguous sequence of cases.</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l06652">SimplifyCFG.cpp:6652</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a706f223f760b55668fbae74202b816bb"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bb">llvm::TargetTransformInfo::TargetCostKind</a></div><div class="ttdeci">TargetCostKind</div><div class="ttdoc">The kind of cost model.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00241">TargetTransformInfo.h:241</a></div></div>
<div class="ttc" id="aclassllvm_1_1IRBuilderBase_html_a7d1a18dc150da601587ccc716e0e4b41"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html#a7d1a18dc150da601587ccc716e0e4b41">llvm::IRBuilderBase::CreateStore</a></div><div class="ttdeci">StoreInst * CreateStore(Value *Val, Value *Ptr, bool isVolatile=false)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l01718">IRBuilder.h:1718</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_afe11668c8bd8d29c005ca8e66ba9ef6b"><div class="ttname"><a href="SimplifyCFG_8cpp.html#afe11668c8bd8d29c005ca8e66ba9ef6b">LookupConstant</a></div><div class="ttdeci">static Constant * LookupConstant(Value *V, const SmallDenseMap&lt; Value *, Constant * &gt; &amp;ConstantPool)</div><div class="ttdoc">If V is a Constant, return it.</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l05626">SimplifyCFG.cpp:5626</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a3287172f2d13af086e6d66364e8c6de3"><div class="ttname"><a href="classllvm_1_1Instruction.html#a3287172f2d13af086e6d66364e8c6de3">llvm::Instruction::getNumSuccessors</a></div><div class="ttdeci">unsigned getNumSuccessors() const LLVM_READONLY</div><div class="ttdoc">Return the number of successors that this instruction has.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00823">Instruction.cpp:823</a></div></div>
<div class="ttc" id="aMathExtras_8h_html"><div class="ttname"><a href="MathExtras_8h.html">MathExtras.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1IRBuilderBase_html_ace45cae6925c65e9d6916e09dd5b17cc"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html#ace45cae6925c65e9d6916e09dd5b17cc">llvm::IRBuilderBase::SetInsertPoint</a></div><div class="ttdeci">void SetInsertPoint(BasicBlock *TheBB)</div><div class="ttdoc">This specifies that created instructions should be appended to the end of the specified block.</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00180">IRBuilder.h:180</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a396eac919c9ac7907275e770a8cd37cf"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a396eac919c9ac7907275e770a8cd37cf">isSafeToHoistInstr</a></div><div class="ttdeci">static bool isSafeToHoistInstr(Instruction *I, unsigned Flags)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01457">SimplifyCFG.cpp:1457</a></div></div>
<div class="ttc" id="anamespacellvm_html_a929b458d1b5080256b6f6c8141bbdfea"><div class="ttname"><a href="namespacellvm.html#a929b458d1b5080256b6f6c8141bbdfea">llvm::combineMetadata</a></div><div class="ttdeci">void combineMetadata(Instruction *K, const Instruction *J, ArrayRef&lt; unsigned &gt; KnownIDs, bool DoesKMove)</div><div class="ttdoc">Combine the metadata of two instructions so that K can replace J.</div><div class="ttdef"><b>Definition:</b> <a href="Transforms_2Utils_2Local_8cpp_source.html#l02651">Local.cpp:2651</a></div></div>
<div class="ttc" id="anamespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">This is an optimization pass for GlobalISel generic memory operations.</div><div class="ttdef"><b>Definition:</b> <a href="AddressRanges_8h_source.html#l00018">AddressRanges.h:18</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a563ffc2ff61c499b3be2e00100cb72fa"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a563ffc2ff61c499b3be2e00100cb72fa">llvm::SmallVectorImpl::erase</a></div><div class="ttdeci">iterator erase(const_iterator CI)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00741">SmallVector.h:741</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_aedfe10b7b8a1008ddaa4104f54e0b483"><div class="ttname"><a href="SimplifyCFG_8cpp.html#aedfe10b7b8a1008ddaa4104f54e0b483">removeEmptyCleanup</a></div><div class="ttdeci">static bool removeEmptyCleanup(CleanupReturnInst *RI, DomTreeUpdater *DTU)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l04934">SimplifyCFG.cpp:4934</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_ac77dbedcfd916a5c9b58e753b2678a98"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#ac77dbedcfd916a5c9b58e753b2678a98">llvm::TargetTransformInfo::getInstructionCost</a></div><div class="ttdeci">InstructionCost getInstructionCost(const User *U, ArrayRef&lt; const Value * &gt; Operands, TargetCostKind CostKind) const</div><div class="ttdoc">Estimate the cost of a given IR user when lowered.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00230">TargetTransformInfo.cpp:230</a></div></div>
<div class="ttc" id="alib_2Target_2X86_2README_8txt_html_ac88fe1d3a61b056a4f64fbbb156a62ff"><div class="ttname"><a href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a></div><div class="ttdeci">We currently emits eax Perhaps this is what we really should generate is Is imull three or four cycles eax eax The current instruction priority is based on pattern complexity The former is more complex because it folds a load so the latter will not be emitted Perhaps we should use AddedComplexity to give LEA32r a higher priority We should always try to match LEA first since the LEA matching code does some estimate to determine whether the match is profitable if we care more about code then imull is better It s two bytes shorter than movl leal On a Pentium M</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2X86_2README_8txt_source.html#l00252">README.txt:252</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">llvm::CmpInst::ICMP_EQ</a></div><div class="ttdeci">@ ICMP_EQ</div><div class="ttdoc">equal</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00739">InstrTypes.h:739</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7dc3069afa2ce5ea62ac2eb183e51c00"><div class="ttname"><a href="namespacellvm.html#a7dc3069afa2ce5ea62ac2eb183e51c00">llvm::none_of</a></div><div class="ttdeci">bool none_of(R &amp;&amp;Range, UnaryPredicate P)</div><div class="ttdoc">Provide wrappers to std::none_of which take ranges instead of having to pass begin/end explicitly.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01749">STLExtras.h:1749</a></div></div>
<div class="ttc" id="anamespacellvm_html_ad1a91b49e0c092818a0b82f6cc130a1b"><div class="ttname"><a href="namespacellvm.html#ad1a91b49e0c092818a0b82f6cc130a1b">llvm::make_range</a></div><div class="ttdeci">iterator_range&lt; T &gt; make_range(T x, T y)</div><div class="ttdoc">Convenience function for iterating over sub-ranges.</div><div class="ttdef"><b>Definition:</b> <a href="iterator__range_8h_source.html#l00053">iterator_range.h:53</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImpl_html_a11045c7973ab24a8d6315b61fa337d4e"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#a11045c7973ab24a8d6315b61fa337d4e">llvm::SmallPtrSetImpl::erase</a></div><div class="ttdeci">bool erase(PtrType Ptr)</div><div class="ttdoc">erase - If the set contains the specified pointer, remove it and return true, otherwise return false.</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00379">SmallPtrSet.h:379</a></div></div>
<div class="ttc" id="aNoFolder_8h_html"><div class="ttname"><a href="NoFolder_8h.html">NoFolder.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1BranchInst_html_ad37b3ffc4c5f3cbe9248d587a2efb850"><div class="ttname"><a href="classllvm_1_1BranchInst.html#ad37b3ffc4c5f3cbe9248d587a2efb850">llvm::BranchInst::successors</a></div><div class="ttdeci">iterator_range&lt; succ_op_iterator &gt; successors()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03249">Instructions.h:3249</a></div></div>
<div class="ttc" id="aValueMapper_8h_html"><div class="ttname"><a href="ValueMapper_8h.html">ValueMapper.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_a1f0ff79b64a40d383b891f1baba89c6b"><div class="ttname"><a href="classllvm_1_1PHINode.html#a1f0ff79b64a40d383b891f1baba89c6b">llvm::PHINode::incoming_values</a></div><div class="ttdeci">op_range incoming_values()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02784">Instructions.h:2784</a></div></div>
<div class="ttc" id="aclassllvm_1_1DataLayout_html"><div class="ttname"><a href="classllvm_1_1DataLayout.html">llvm::DataLayout</a></div><div class="ttdoc">A parsed version of the target data layout string in and methods for querying it.</div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00110">DataLayout.h:110</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a404f7a1827e4eb8c5ded5ce6dafecf07"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a404f7a1827e4eb8c5ded5ce6dafecf07">extractPredSuccWeights</a></div><div class="ttdeci">static bool extractPredSuccWeights(BranchInst *PBI, BranchInst *BI, uint64_t &amp;PredTrueWeight, uint64_t &amp;PredFalseWeight, uint64_t &amp;SuccTrueWeight, uint64_t &amp;SuccFalseWeight)</div><div class="ttdoc">Return true if either PBI or BI has branch weight available, and store the weights in {Pred|Succ}{Tru...</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03506">SimplifyCFG.cpp:3506</a></div></div>
<div class="ttc" id="anamespacellvm_1_1dxil_html_af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b"><div class="ttname"><a href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">llvm::dxil::ParameterKind::I1</a></div><div class="ttdeci">@ I1</div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a3a402430a1bbe70a9282dcb0e0b6a2cd"><div class="ttname"><a href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">llvm::Value::hasOneUse</a></div><div class="ttdeci">bool hasOneUse() const</div><div class="ttdoc">Return true if there is exactly one use of this value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00434">Value.h:434</a></div></div>
<div class="ttc" id="aMetadata_8h_html"><div class="ttname"><a href="Metadata_8h.html">Metadata.h</a></div></div>
<div class="ttc" id="aREADME__P9_8txt_html_aa793083a95c48c23abfa352d4335685a"><div class="ttname"><a href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">Insert</a></div><div class="ttdeci">Vector Rotate Left Mask Mask Insert</div><div class="ttdef"><b>Definition:</b> <a href="README__P9_8txt_source.html#l00112">README_P9.txt:112</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a98c0a84a5dfa8bce341c829709f171e5"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">llvm::BasicBlock::iterator</a></div><div class="ttdeci">InstListType::iterator iterator</div><div class="ttdoc">Instruction iterators...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00087">BasicBlock.h:87</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_afe3ce7fc89f36474eb0369cbb792c05a"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#afe3ce7fc89f36474eb0369cbb792c05a">llvm::ConstantInt::getType</a></div><div class="ttdeci">IntegerType * getType() const</div><div class="ttdoc">getType - Specialize the getType() method to always return an IntegerType, which reduces the amount o...</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00172">Constants.h:172</a></div></div>
<div class="ttc" id="aclassllvm_1_1SwitchInstProfUpdateWrapper_html"><div class="ttname"><a href="classllvm_1_1SwitchInstProfUpdateWrapper.html">llvm::SwitchInstProfUpdateWrapper</a></div><div class="ttdoc">A wrapper class to simplify modification of SwitchInst cases along with their prof branch_weights met...</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03625">Instructions.h:3625</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a6a58dfc629e1b208cdd7b2bd76203184"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a6a58dfc629e1b208cdd7b2bd76203184">mergeConditionalStores</a></div><div class="ttdeci">static bool mergeConditionalStores(BranchInst *PBI, BranchInst *QBI, DomTreeUpdater *DTU, const DataLayout &amp;DL, const TargetTransformInfo &amp;TTI)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l04038">SimplifyCFG.cpp:4038</a></div></div>
<div class="ttc" id="aAMDGPURewriteUndefForPHI_8cpp_html_a2e83cb1bc3f5e8986cbd14575755a134"><div class="ttname"><a href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a></div><div class="ttdeci">Rewrite undef for PHI</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPURewriteUndefForPHI_8cpp_source.html#l00101">AMDGPURewriteUndefForPHI.cpp:101</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a38bee869ad41aebfef3de2641b12004c"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">llvm::BasicBlock::getParent</a></div><div class="ttdeci">const Function * getParent() const</div><div class="ttdoc">Return the enclosing method, or null if none.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00112">BasicBlock.h:112</a></div></div>
<div class="ttc" id="aIntrinsicInst_8h_html"><div class="ttname"><a href="IntrinsicInst_8h.html">IntrinsicInst.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a3b996fbf8458aafffc86cb98a68d0a47"><div class="ttname"><a href="classllvm_1_1Type.html#a3b996fbf8458aafffc86cb98a68d0a47">llvm::Type::isPointerTy</a></div><div class="ttdeci">bool isPointerTy() const</div><div class="ttdoc">True if this is an instance of PointerType.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00249">Type.h:249</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a5e90675655fa07e4ac14c4c39f4c338a"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a5e90675655fa07e4ac14c4c39f4c338a">HoistCommonSkipLimit</a></div><div class="ttdeci">static cl::opt&lt; unsigned &gt; HoistCommonSkipLimit(&quot;simplifycfg-hoist-common-skip-limit&quot;, cl::Hidden, cl::init(20), cl::desc(&quot;Allow reordering across at most this many &quot; &quot;instructions when hoisting&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1DILocation_html_accc5dccb020fb7b324fcfb2d221c1a19"><div class="ttname"><a href="classllvm_1_1DILocation.html#accc5dccb020fb7b324fcfb2d221c1a19">llvm::DILocation::getMergedLocation</a></div><div class="ttdeci">static const DILocation * getMergedLocation(const DILocation *LocA, const DILocation *LocB)</div><div class="ttdoc">When two instructions are combined into a single instruction we also need to combine the original loc...</div><div class="ttdef"><b>Definition:</b> <a href="DebugInfoMetadata_8cpp_source.html#l00108">DebugInfoMetadata.cpp:108</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a3aaba0277f5dd5636e099fa81c20c533"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a3aaba0277f5dd5636e099fa81c20c533">isSafeToHoistInvoke</a></div><div class="ttdeci">static bool isSafeToHoistInvoke(BasicBlock *BB1, BasicBlock *BB2, Instruction *I1, Instruction *I2)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01419">SimplifyCFG.cpp:1419</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_ab240d0d30dfa9b392ef9d813f3f9e4be"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#ab240d0d30dfa9b392ef9d813f3f9e4be">llvm::ConstantInt::getBitWidth</a></div><div class="ttdeci">unsigned getBitWidth() const</div><div class="ttdoc">getBitWidth - Return the bitwidth of this constant.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00135">Constants.h:135</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a1f70470f7a7722fd55c58c81358107f2"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a1f70470f7a7722fd55c58c81358107f2">mergeCleanupPad</a></div><div class="ttdeci">static bool mergeCleanupPad(CleanupReturnInst *RI)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l05052">SimplifyCFG.cpp:5052</a></div></div>
<div class="ttc" id="aclassllvm_1_1DomTreeUpdater_html_aae522cd1928cfac6850b50c7a3e22185"><div class="ttname"><a href="classllvm_1_1DomTreeUpdater.html#aae522cd1928cfac6850b50c7a3e22185">llvm::DomTreeUpdater::applyUpdates</a></div><div class="ttdeci">void applyUpdates(ArrayRef&lt; DominatorTree::UpdateType &gt; Updates)</div><div class="ttdoc">Submit updates to all available trees.</div><div class="ttdef"><b>Definition:</b> <a href="DomTreeUpdater_8cpp_source.html#l00230">DomTreeUpdater.cpp:230</a></div></div>
<div class="ttc" id="aSetOperations_8h_html"><div class="ttname"><a href="SetOperations_8h.html">SetOperations.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_af89277d8bd76d6348291e29b6076796a"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#af89277d8bd76d6348291e29b6076796a">llvm::TargetTransformInfo::getCmpSelInstrCost</a></div><div class="ttdeci">InstructionCost getCmpSelInstrCost(unsigned Opcode, Type *ValTy, Type *CondTy, CmpInst::Predicate VecPred, TTI::TargetCostKind CostKind=TTI::TCK_RecipThroughput, const Instruction *I=nullptr) const</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00897">TargetTransformInfo.cpp:897</a></div></div>
<div class="ttc" id="anamespacellvm_html_a069c4ae2290101bde0f8d6a5074dc72b"><div class="ttname"><a href="namespacellvm.html#a069c4ae2290101bde0f8d6a5074dc72b">llvm::succ_end</a></div><div class="ttdeci">Interval::succ_iterator succ_end(Interval *I)</div><div class="ttdef"><b>Definition:</b> <a href="Interval_8h_source.html#l00102">Interval.h:102</a></div></div>
<div class="ttc" id="aclassT_html"><div class="ttname"><a href="classT.html">T</a></div></div>
<div class="ttc" id="aMemorySSAUpdater_8h_html"><div class="ttname"><a href="MemorySSAUpdater_8h.html">MemorySSAUpdater.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Function_html"><div class="ttname"><a href="classllvm_1_1Function.html">llvm::Function</a></div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00059">Function.h:59</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a7ef36c3b9f5334218cf1b3b7e8e33569"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a7ef36c3b9f5334218cf1b3b7e8e33569">isTypeLegalForLookupTable</a></div><div class="ttdeci">static bool isTypeLegalForLookupTable(Type *Ty, const TargetTransformInfo &amp;TTI, const DataLayout &amp;DL)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l06198">SimplifyCFG.cpp:6198</a></div></div>
<div class="ttc" id="aStringRef_8h_html"><div class="ttname"><a href="StringRef_8h.html">StringRef.h</a></div></div>
<div class="ttc" id="aREADME-SSE_8txt_html_a63d206a063eefcdf8c318ded97b65020"><div class="ttname"><a href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a></div><div class="ttdeci">This currently compiles esp xmm0 movsd esp eax eax esp ret We should use not the dag combiner This is because dagcombine2 needs to be able to see through the X86ISD::Wrapper which DAGCombine can t really do The code for turning x load into a single vector load is target independent and should be moved to the dag combiner The code for turning x load into a vector load can only handle a direct load from a global or a direct load from the stack It should be generalized to handle any load from P</div><div class="ttdef"><b>Definition:</b> <a href="README-SSE_8txt_source.html#l00411">README-SSE.txt:411</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a9ac94808486f1c47e5cc9ba62dcc6fae"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a9ac94808486f1c47e5cc9ba62dcc6fae">computeSpeculationCost</a></div><div class="ttdeci">static InstructionCost computeSpeculationCost(const User *I, const TargetTransformInfo &amp;TTI)</div><div class="ttdoc">Compute an abstract &quot;cost&quot; of speculating the given instruction, which is assumed to be safe to specu...</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00386">SimplifyCFG.cpp:386</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_a18b9d328d2490f447589ba60345eba6e"><div class="ttname"><a href="classllvm_1_1SetVector.html#a18b9d328d2490f447589ba60345eba6e">llvm::SetVector&lt; T, SmallVector&lt; T, N &gt;, SmallDenseSet&lt; T, N &gt; &gt;::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdoc">Determine the number of elements in the SetVector.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00077">SetVector.h:77</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a2069641f358ef416658a2f321ca19d74"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a2069641f358ef416658a2f321ca19d74">llvm::BasicBlock::instructionsWithoutDebug</a></div><div class="ttdeci">iterator_range&lt; filter_iterator&lt; BasicBlock::const_iterator, std::function&lt; bool(const Instruction &amp;)&gt; &gt; &gt; instructionsWithoutDebug(bool SkipPseudoOp=true) const</div><div class="ttdoc">Return a const iterator range over the instructions in the block, skipping any debug instructions.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00103">BasicBlock.cpp:103</a></div></div>
<div class="ttc" id="aclassllvm_1_1BitCastInst_html"><div class="ttname"><a href="classllvm_1_1BitCastInst.html">llvm::BitCastInst</a></div><div class="ttdoc">This class represents a no-op cast from one type to another.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l05258">Instructions.h:5258</a></div></div>
<div class="ttc" id="astructllvm_1_1KnownBits_html_ac67bca6c764da76f5e152330d92ed916"><div class="ttname"><a href="structllvm_1_1KnownBits.html#ac67bca6c764da76f5e152330d92ed916">llvm::KnownBits::Zero</a></div><div class="ttdeci">APInt Zero</div><div class="ttdef"><b>Definition:</b> <a href="KnownBits_8h_source.html#l00024">KnownBits.h:24</a></div></div>
<div class="ttc" id="alib_2Target_2README_8txt_html_a2a2df5a25b9c703e74e82b48a75d0c3d"><div class="ttname"><a href="lib_2Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a></div><div class="ttdeci">instcombine should handle this C2 when C1</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2README_8txt_source.html#l00263">README.txt:263</a></div></div>
<div class="ttc" id="aAArch64AdvSIMDScalarPass_8cpp_html_a1112b818386ec01ddfdf3a5d0024eb17"><div class="ttname"><a href="AArch64AdvSIMDScalarPass_8cpp.html#a1112b818386ec01ddfdf3a5d0024eb17">contains</a></div><div class="ttdeci">return AArch64::GPR64RegClass contains(Reg)</div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a1c9300bfa022ac28948bd4336376e3c1"><div class="ttname"><a href="classllvm_1_1APInt.html#a1c9300bfa022ac28948bd4336376e3c1">llvm::APInt::getMinSignedBits</a></div><div class="ttdeci">unsigned getMinSignedBits() const</div><div class="ttdoc">NOTE: This is soft-deprecated. Please use getSignificantBits() instead.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01487">APInt.h:1487</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a25175390eaee0646bcb8b30990ab723b"><div class="ttname"><a href="classllvm_1_1Instruction.html#a25175390eaee0646bcb8b30990ab723b">llvm::Instruction::isSameOperationAs</a></div><div class="ttdeci">bool isSameOperationAs(const Instruction *I, unsigned flags=0) const LLVM_READONLY</div><div class="ttdoc">This function determines if the specified instruction executes the same operation as the current one.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00584">Instruction.cpp:584</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_a4b001d9b458035fbbfc154d52d354ee9"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">llvm::ConstantInt::getValue</a></div><div class="ttdeci">const APInt &amp; getValue() const</div><div class="ttdoc">Return the constant as an APInt value reference.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00132">Constants.h:132</a></div></div>
<div class="ttc" id="anamespacellvm_html_a26e2a938b431eaa6eca2beaa96410c9d"><div class="ttname"><a href="namespacellvm.html#a26e2a938b431eaa6eca2beaa96410c9d">llvm::successors</a></div><div class="ttdeci">auto successors(const MachineBasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l01265">MachineBasicBlock.h:1265</a></div></div>
<div class="ttc" id="aclassllvm_1_1ilist__node__with__parent_html_a26708685cc8b94fe3d7092ee080dbb34"><div class="ttname"><a href="classllvm_1_1ilist__node__with__parent.html#a26708685cc8b94fe3d7092ee080dbb34">llvm::ilist_node_with_parent::getNextNode</a></div><div class="ttdeci">NodeTy * getNextNode()</div><div class="ttdoc">Get the next node, or nullptr for the list tail.</div><div class="ttdef"><b>Definition:</b> <a href="ilist__node_8h_source.html#l00289">ilist_node.h:289</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdoc">This is a 'vector' (really, a variable-sized array), optimized for the case when the array is small.</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l01199">SmallVector.h:1199</a></div></div>
<div class="ttc" id="aStatistic_8h_html"><div class="ttname"><a href="Statistic_8h.html">Statistic.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1RISCVFenceField_html_a147be9e9780c1e33363ea572d4c7b25fa05c79fbfc58d9dd2851c467a1ef166bf"><div class="ttname"><a href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa05c79fbfc58d9dd2851c467a1ef166bf">llvm::RISCVFenceField::W</a></div><div class="ttdeci">@ W</div><div class="ttdef"><b>Definition:</b> <a href="RISCVBaseInfo_8h_source.html#l00279">RISCVBaseInfo.h:279</a></div></div>
<div class="ttc" id="aclassllvm_1_1LandingPadInst_html"><div class="ttname"><a href="classllvm_1_1LandingPadInst.html">llvm::LandingPadInst</a></div><div class="ttdoc">The landingpad instruction holds all of the information necessary to generate correct exception handl...</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02956">Instructions.h:2956</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a944c25ac9b73b02a17a20a08a25b9b21"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a944c25ac9b73b02a17a20a08a25b9b21">llvm::PatternMatch::m_Add</a></div><div class="ttdeci">BinaryOp_match&lt; LHS, RHS, Instruction::Add &gt; m_Add(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00979">PatternMatch.h:979</a></div></div>
<div class="ttc" id="aCaptureTracking_8h_html"><div class="ttname"><a href="CaptureTracking_8h.html">CaptureTracking.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_a018f0394a375233d538109968b76a05a"><div class="ttname"><a href="classllvm_1_1CallBase.html#a018f0394a375233d538109968b76a05a">llvm::CallBase::isInlineAsm</a></div><div class="ttdeci">bool isInlineAsm() const</div><div class="ttdoc">Check if this call is an inline asm statement.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01474">InstrTypes.h:1474</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a69c17ef87a64dfcb3e5795b870cf69fa"><div class="ttname"><a href="classllvm_1_1Instruction.html#a69c17ef87a64dfcb3e5795b870cf69fa">llvm::Instruction::isIdenticalToWhenDefined</a></div><div class="ttdeci">bool isIdenticalToWhenDefined(const Instruction *I) const LLVM_READONLY</div><div class="ttdoc">This is like isIdenticalTo, except that it ignores the SubclassOptionalData flags,...</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00557">Instruction.cpp:557</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ad8c5093a18a40f863d4fc5fa6eefefa8"><div class="ttname"><a href="classllvm_1_1Instruction.html#ad8c5093a18a40f863d4fc5fa6eefefa8">llvm::Instruction::insertInto</a></div><div class="ttdeci">SymbolTableList&lt; Instruction &gt;::iterator insertInto(BasicBlock *ParentBB, SymbolTableList&lt; Instruction &gt;::iterator It)</div><div class="ttdoc">Inserts an unlinked instruction into ParentBB at position It and returns the iterator of the inserted...</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00098">Instruction.cpp:98</a></div></div>
<div class="ttc" id="aSupport_2ErrorHandling_8h_html"><div class="ttname"><a href="Support_2ErrorHandling_8h.html">ErrorHandling.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_af4feec45578e32fe65d8efc59112bc8e"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#af4feec45578e32fe65d8efc59112bc8e">llvm::PatternMatch::m_CombineOr</a></div><div class="ttdeci">match_combine_or&lt; LTy, RTy &gt; m_CombineOr(const LTy &amp;L, const RTy &amp;R)</div><div class="ttdoc">Combine two pattern matchers matching L || R.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00218">PatternMatch.h:218</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html">llvm::TargetTransformInfo</a></div><div class="ttdoc">This pass provides access to the codegen interfaces that are needed for IR-level transformations.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00196">TargetTransformInfo.h:196</a></div></div>
<div class="ttc" id="aclassllvm_1_1IRBuilder_html"><div class="ttname"><a href="classllvm_1_1IRBuilder.html">llvm::IRBuilder&lt;&gt;</a></div></div>
<div class="ttc" id="aMapVector_8h_html"><div class="ttname"><a href="MapVector_8h.html">MapVector.h</a></div></div>
<div class="ttc" id="aDomTreeUpdater_8h_html"><div class="ttname"><a href="DomTreeUpdater_8h.html">DomTreeUpdater.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1GlobalVariable_html"><div class="ttname"><a href="classllvm_1_1GlobalVariable.html">llvm::GlobalVariable</a></div><div class="ttdef"><b>Definition:</b> <a href="GlobalVariable_8h_source.html#l00039">GlobalVariable.h:39</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallDenseMap_html"><div class="ttname"><a href="classllvm_1_1SmallDenseMap.html">llvm::SmallDenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00880">DenseMap.h:880</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">llvm::CmpInst::ICMP_NE</a></div><div class="ttdeci">@ ICMP_NE</div><div class="ttdoc">not equal</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00740">InstrTypes.h:740</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_aa2a54b545d237ecfe450fd1292f7675e"><div class="ttname"><a href="classllvm_1_1CmpInst.html#aa2a54b545d237ecfe450fd1292f7675e">llvm::CmpInst::getInversePredicate</a></div><div class="ttdeci">Predicate getInversePredicate() const</div><div class="ttdoc">For example, EQ -&gt; NE, UGT -&gt; ULE, SLT -&gt; SGE, OEQ -&gt; UNE, UGT -&gt; OLE, OLT -&gt; UGE,...</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00832">InstrTypes.h:832</a></div></div>
<div class="ttc" id="aclassllvm_1_1BlockAddress_html_a5d6c0fe3482091758c3978229f6b5852"><div class="ttname"><a href="classllvm_1_1BlockAddress.html#a5d6c0fe3482091758c3978229f6b5852">llvm::BlockAddress::getBasicBlock</a></div><div class="ttdeci">BasicBlock * getBasicBlock() const</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00904">Constants.h:904</a></div></div>
<div class="ttc" id="aValueTracking_8h_html"><div class="ttname"><a href="ValueTracking_8h.html">ValueTracking.h</a></div></div>
<div class="ttc" id="aTransforms_2Utils_2Local_8h_html"><div class="ttname"><a href="Transforms_2Utils_2Local_8h.html">Local.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a482498a1c760122fd33c7fc8190dd277"><div class="ttname"><a href="classllvm_1_1Instruction.html#a482498a1c760122fd33c7fc8190dd277">llvm::Instruction::insertBefore</a></div><div class="ttdeci">void insertBefore(Instruction *InsertPos)</div><div class="ttdoc">Insert an unlinked instruction into a basic block immediately before the specified instruction.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00088">Instruction.cpp:88</a></div></div>
<div class="ttc" id="anamespacellvm_html_ae95177e7337984f5bc961723ecf67169"><div class="ttname"><a href="namespacellvm.html#ae95177e7337984f5bc961723ecf67169">llvm::ComputeMaxSignificantBits</a></div><div class="ttdeci">unsigned ComputeMaxSignificantBits(const Value *Op, const DataLayout &amp;DL, unsigned Depth=0, AssumptionCache *AC=nullptr, const Instruction *CxtI=nullptr, const DominatorTree *DT=nullptr)</div><div class="ttdoc">Get the upper bound on bit size for this Value Op as a signed integer.</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l00391">ValueTracking.cpp:391</a></div></div>
<div class="ttc" id="aclassllvm_1_1IRBuilderBase_html_ad31917a381a26d6857d63e9f4bf4e1fa"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html#ad31917a381a26d6857d63e9f4bf4e1fa">llvm::IRBuilderBase::CreateOr</a></div><div class="ttdeci">Value * CreateOr(Value *LHS, Value *RHS, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l01412">IRBuilder.h:1412</a></div></div>
<div class="ttc" id="aAArch64Disassembler_8cpp_html_aae15979c93f7f0929116b975b5c46cd6"><div class="ttname"><a href="AArch64Disassembler_8cpp.html#aae15979c93f7f0929116b975b5c46cd6">Fail</a></div><div class="ttdeci">#define Fail</div><div class="ttdef"><b>Definition:</b> <a href="AArch64Disassembler_8cpp_source.html#l00301">AArch64Disassembler.cpp:301</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantPool_html"><div class="ttname"><a href="classllvm_1_1ConstantPool.html">llvm::ConstantPool</a></div><div class="ttdef"><b>Definition:</b> <a href="ConstantPools_8h_source.html#l00043">ConstantPools.h:43</a></div></div>
<div class="ttc" id="anamespacellvm_1_1cl_html_a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6"><div class="ttname"><a href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">llvm::cl::Hidden</a></div><div class="ttdeci">@ Hidden</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00138">CommandLine.h:138</a></div></div>
<div class="ttc" id="aARMSubtarget_8cpp_html_a6a14930b01ccb1cf446cd96395284102"><div class="ttname"><a href="ARMSubtarget_8cpp.html#a6a14930b01ccb1cf446cd96395284102">IT</a></div><div class="ttdeci">static cl::opt&lt; ITMode &gt; IT(cl::desc(&quot;IT block support&quot;), cl::Hidden, cl::init(DefaultIT), cl::values(clEnumValN(DefaultIT, &quot;arm-default-it&quot;, &quot;Generate any type of IT block&quot;), clEnumValN(RestrictedIT, &quot;arm-restrict-it&quot;, &quot;Disallow complex IT blocks&quot;)))</div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a0d5b47e1f017620a784b726852915d58"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a0d5b47e1f017620a784b726852915d58">llvm::TargetTransformInfo::shouldBuildLookupTables</a></div><div class="ttdeci">bool shouldBuildLookupTables() const</div><div class="ttdoc">Return true if switches should be turned into lookup tables for the target.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00506">TargetTransformInfo.cpp:506</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_a31e8da5adf63afd38b4ab94bca823150"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a31e8da5adf63afd38b4ab94bca823150">llvm::ConstantInt::getLimitedValue</a></div><div class="ttdeci">uint64_t getLimitedValue(uint64_t Limit=~0ULL) const</div><div class="ttdoc">getLimitedValue - If the value is smaller than the specified limit, return it, otherwise return the l...</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00243">Constants.h:243</a></div></div>
<div class="ttc" id="aAPInt_8h_html"><div class="ttname"><a href="APInt_8h.html">APInt.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639"><div class="ttname"><a href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">llvm::Depth</a></div><div class="ttdeci">@ Depth</div><div class="ttdef"><b>Definition:</b> <a href="SIMachineScheduler_8h_source.html#l00036">SIMachineScheduler.h:36</a></div></div>
<div class="ttc" id="aclassllvm_1_1DILocation_html"><div class="ttname"><a href="classllvm_1_1DILocation.html">llvm::DILocation</a></div><div class="ttdoc">Debug location.</div><div class="ttdef"><b>Definition:</b> <a href="DebugInfoMetadata_8h_source.html#l01605">DebugInfoMetadata.h:1605</a></div></div>
<div class="ttc" id="alib_2Target_2README_8txt_html_a8db36c82f32d6f6a4d35a00e55be03a8"><div class="ttname"><a href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a></div><div class="ttdeci">bool Shift</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2README_8txt_source.html#l00468">README.txt:468</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_aa67a8bc0841ad57e26ed447bb99ea15d"><div class="ttname"><a href="SimplifyCFG_8cpp.html#aa67a8bc0841ad57e26ed447bb99ea15d">skippedInstrFlags</a></div><div class="ttdeci">static unsigned skippedInstrFlags(Instruction *I)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01442">SimplifyCFG.cpp:1442</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html"><div class="ttname"><a href="classllvm_1_1Type.html">llvm::Type</a></div><div class="ttdoc">The instances of the Type class are immutable: once they are created, they are never changed.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00045">Type.h:45</a></div></div>
<div class="ttc" id="aDenseMap_8h_html"><div class="ttname"><a href="DenseMap_8h.html">DenseMap.h</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a31a4e5663521fd6944605496cbc32bbb"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a31a4e5663521fd6944605496cbc32bbb">performBranchToCommonDestFolding</a></div><div class="ttdeci">static bool performBranchToCommonDestFolding(BranchInst *BI, BranchInst *PBI, DomTreeUpdater *DTU, MemorySSAUpdater *MSSAU, const TargetTransformInfo *TTI)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03569">SimplifyCFG.cpp:3569</a></div></div>
<div class="ttc" id="aModule_8h_html"><div class="ttname"><a href="Module_8h.html">Module.h</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_abf7c0c7b7ca80941f61578f1d6691d01"><div class="ttname"><a href="SimplifyCFG_8cpp.html#abf7c0c7b7ca80941f61578f1d6691d01">foldSwitchToSelect</a></div><div class="ttdeci">static Value * foldSwitchToSelect(const SwitchCaseResultVectorTy &amp;ResultVector, Constant *DefaultResult, Value *Condition, IRBuilder&lt;&gt; &amp;Builder)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l05813">SimplifyCFG.cpp:5813</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a79c007dcf9fff57e1569e778d7885b5e"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a79c007dcf9fff57e1569e778d7885b5e">llvm::BasicBlock::getSingleSuccessor</a></div><div class="ttdeci">const BasicBlock * getSingleSuccessor() const</div><div class="ttdoc">Return the successor of this block if it has a single successor.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00314">BasicBlock.cpp:314</a></div></div>
<div class="ttc" id="aclassllvm_1_1DominatorTreeBase_html_a9aeeca2833810f01b20545a46fe22503"><div class="ttname"><a href="classllvm_1_1DominatorTreeBase.html#a9aeeca2833810f01b20545a46fe22503">llvm::DominatorTreeBase&lt; BasicBlock, false &gt;::Insert</a></div><div class="ttdeci">static constexpr UpdateKind Insert</div><div class="ttdef"><b>Definition:</b> <a href="GenericDomTree_8h_source.html#l00258">GenericDomTree.h:258</a></div></div>
<div class="ttc" id="aclassllvm_1_1ResumeInst_html_ac882730953c5fd70cfac11d3508b42f4"><div class="ttname"><a href="classllvm_1_1ResumeInst.html#ac882730953c5fd70cfac11d3508b42f4">llvm::ResumeInst::getValue</a></div><div class="ttdeci">Value * getValue() const</div><div class="ttdoc">Convenience accessor.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l04281">Instructions.h:4281</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_ac35d942f5e82c11d2f1752829b5b21de"><div class="ttname"><a href="SimplifyCFG_8cpp.html#ac35d942f5e82c11d2f1752829b5b21de">SwitchToLookupTable</a></div><div class="ttdeci">static bool SwitchToLookupTable(SwitchInst *SI, IRBuilder&lt;&gt; &amp;Builder, DomTreeUpdater *DTU, const DataLayout &amp;DL, const TargetTransformInfo &amp;TTI)</div><div class="ttdoc">If the switch is only used to initialize one or more phi nodes in a common successor block with diffe...</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l06384">SimplifyCFG.cpp:6384</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a53408c95a7bfb5443b43fb2134c3eb23"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a53408c95a7bfb5443b43fb2134c3eb23">llvm::DenseMapBase&lt; SmallDenseMap&lt; KeyT, ValueT, 4, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::count</a></div><div class="ttdeci">size_type count(const_arg_type_t&lt; KeyT &gt; Val) const</div><div class="ttdoc">Return 1 if the specified key is in the map, 0 otherwise.</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00145">DenseMap.h:145</a></div></div>
<div class="ttc" id="aREADME__P9_8txt_html_a9679eda65da04e63b0fc49644be06685"><div class="ttname"><a href="README__P9_8txt.html#a9679eda65da04e63b0fc49644be06685">i1</a></div><div class="ttdeci">Decimal Convert From to National Zoned Signed int_ppc_altivec_bcdcfno i1</div><div class="ttdef"><b>Definition:</b> <a href="README__P9_8txt_source.html#l00147">README_P9.txt:147</a></div></div>
<div class="ttc" id="aclassllvm_1_1mapped__iterator_html"><div class="ttname"><a href="classllvm_1_1mapped__iterator.html">llvm::mapped_iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00404">STLExtras.h:404</a></div></div>
<div class="ttc" id="aELFObjHandler_8cpp_html_a250e66aa31a03567cc345ca1bc463b8c"><div class="ttname"><a href="ELFObjHandler_8cpp.html#a250e66aa31a03567cc345ca1bc463b8c">Offset</a></div><div class="ttdeci">uint64_t Offset</div><div class="ttdef"><b>Definition:</b> <a href="ELFObjHandler_8cpp_source.html#l00080">ELFObjHandler.cpp:80</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSet_html"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html">llvm::SmallPtrSet</a></div><div class="ttdoc">SmallPtrSet - This class implements a set which is optimized for holding SmallSize or less elements.</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00450">SmallPtrSet.h:450</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a99b320fd35acaf648a0a7826a0bdd777"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a99b320fd35acaf648a0a7826a0bdd777">llvm::TargetTransformInfo::getPredictableBranchThreshold</a></div><div class="ttdeci">BranchProbability getPredictableBranchThreshold() const</div><div class="ttdoc">If a branch or a select condition is skewed in one direction by more than this factor,...</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00239">TargetTransformInfo.cpp:239</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ore_html_a8f5533240c6722d987a2443cba42019d"><div class="ttname"><a href="namespacellvm_1_1ore.html#a8f5533240c6722d987a2443cba42019d">llvm::ore::NV</a></div><div class="ttdeci">DiagnosticInfoOptimizationBase::Argument NV</div><div class="ttdef"><b>Definition:</b> <a href="OptimizationRemarkEmitter_8h_source.html#l00136">OptimizationRemarkEmitter.h:136</a></div></div>
<div class="ttc" id="aValueTracking_8cpp_html_af00585087cddeeb1e8995d4647966cfe"><div class="ttname"><a href="ValueTracking_8cpp.html#af00585087cddeeb1e8995d4647966cfe">isGuaranteedNotToBeUndefOrPoison</a></div><div class="ttdeci">static bool isGuaranteedNotToBeUndefOrPoison(const Value *V, AssumptionCache *AC, const Instruction *CtxI, const DominatorTree *DT, unsigned Depth, bool PoisonOnly)</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l05449">ValueTracking.cpp:5449</a></div></div>
<div class="ttc" id="anamespacellvm_1_1tgtok_html_abbc5259d649363016626e2529fabe0c5aeb5a2908109c763377832cbb4726b6d4"><div class="ttname"><a href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aeb5a2908109c763377832cbb4726b6d4">llvm::tgtok::FalseVal</a></div><div class="ttdeci">@ FalseVal</div><div class="ttdef"><b>Definition:</b> <a href="TGLexer_8h_source.html#l00062">TGLexer.h:62</a></div></div>
<div class="ttc" id="anamespacellvm_1_1msgpack_html_afdae9da66bac09f4b2bfc0fd9f0559e6a4410ec34d9e6c1a68100ca0ce033fb17"><div class="ttname"><a href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a4410ec34d9e6c1a68100ca0ce033fb17">llvm::msgpack::Type::Array</a></div><div class="ttdeci">@ Array</div></div>
<div class="ttc" id="aAliasAnalysis_8cpp_html_a7e344cff0feadf0b02223fee63cc7475"><div class="ttname"><a href="AliasAnalysis_8cpp.html#a7e344cff0feadf0b02223fee63cc7475">Results</a></div><div class="ttdeci">Function Alias Analysis Results</div><div class="ttdef"><b>Definition:</b> <a href="AliasAnalysis_8cpp_source.html#l00769">AliasAnalysis.cpp:769</a></div></div>
<div class="ttc" id="aOperator_8h_html"><div class="ttname"><a href="Operator_8h.html">Operator.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a158da2b6d3d938aaa15b6acd00150e2c"><div class="ttname"><a href="classllvm_1_1Value.html#a158da2b6d3d938aaa15b6acd00150e2c">llvm::Value::user_begin</a></div><div class="ttdeci">user_iterator user_begin()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00397">Value.h:397</a></div></div>
<div class="ttc" id="anamespacellvm_html_ab4d4bc901fedd8857f647dcc2c0d71de"><div class="ttname"><a href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">llvm::max</a></div><div class="ttdeci">Expected&lt; ExpressionValue &gt; max(const ExpressionValue &amp;Lhs, const ExpressionValue &amp;Rhs)</div><div class="ttdef"><b>Definition:</b> <a href="FileCheck_8cpp_source.html#l00337">FileCheck.cpp:337</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a6da514c588b2668280a861a59bfc9fa5"><div class="ttname"><a href="classllvm_1_1APInt.html#a6da514c588b2668280a861a59bfc9fa5">llvm::APInt::intersects</a></div><div class="ttdeci">bool intersects(const APInt &amp;RHS) const</div><div class="ttdoc">This operation tests if there are any pairs of corresponding bits between this APInt and RHS that are...</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01227">APInt.h:1227</a></div></div>
<div class="ttc" id="aclassllvm_1_1SwitchInstProfUpdateWrapper_html_adf90515665080eadf537aff00bbf0594"><div class="ttname"><a href="classllvm_1_1SwitchInstProfUpdateWrapper.html#adf90515665080eadf537aff00bbf0594">llvm::SwitchInstProfUpdateWrapper::removeCase</a></div><div class="ttdeci">SwitchInst::CaseIt removeCase(SwitchInst::CaseIt I)</div><div class="ttdoc">Delegate the call to the underlying SwitchInst::removeCase() and remove correspondent branch weight.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l04614">Instructions.cpp:4614</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a59fb91d1691350f7d1b8e8a114e3f2a4"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a59fb91d1691350f7d1b8e8a114e3f2a4">llvm::BasicBlock::getSinglePredecessor</a></div><div class="ttdeci">const BasicBlock * getSinglePredecessor() const</div><div class="ttdoc">Return the predecessor of this block if it has a single predecessor block.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00284">BasicBlock.cpp:284</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a91dbffd0cc6b209fd2bfe9a0236d779c"><div class="ttname"><a href="classllvm_1_1Instruction.html#a91dbffd0cc6b209fd2bfe9a0236d779c">llvm::Instruction::isUsedOutsideOfBlock</a></div><div class="ttdeci">bool isUsedOutsideOfBlock(const BasicBlock *BB) const LLVM_READONLY</div><div class="ttdoc">Return true if there are any uses of this instruction in blocks other than the specified block.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00608">Instruction.cpp:608</a></div></div>
<div class="ttc" id="aAMDGPURegBankSelect_8cpp_html_a14e0c000ed52e5fc187d4a885914cc1a"><div class="ttname"><a href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a></div><div class="ttdeci">amdgpu AMDGPU Register Bank Select</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPURegBankSelect_8cpp_source.html#l00045">AMDGPURegBankSelect.cpp:45</a></div></div>
<div class="ttc" id="aSTLExtras_8h_html"><div class="ttname"><a href="STLExtras_8h.html">STLExtras.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a526630ff85b48f29ac5b4c519c6c2243"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a526630ff85b48f29ac5b4c519c6c2243">llvm::BasicBlock::hasNPredecessors</a></div><div class="ttdeci">bool hasNPredecessors(unsigned N) const</div><div class="ttdoc">Return true if this block has exactly N predecessors.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00306">BasicBlock.cpp:306</a></div></div>
<div class="ttc" id="aX86PartialReduction_8cpp_html_a87b8bfbbe9d8f7146d7f20a5fb42efd0"><div class="ttname"><a href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a></div><div class="ttdeci">Value * RHS</div><div class="ttdef"><b>Definition:</b> <a href="X86PartialReduction_8cpp_source.html#l00076">X86PartialReduction.cpp:76</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayType_html"><div class="ttname"><a href="classllvm_1_1ArrayType.html">llvm::ArrayType</a></div><div class="ttdoc">Class to represent array types.</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00357">DerivedTypes.h:357</a></div></div>
<div class="ttc" id="anamespacellvm_html_a6dec2b5d3e04b47adf4d918d678e81c9"><div class="ttname"><a href="namespacellvm.html#a6dec2b5d3e04b47adf4d918d678e81c9">llvm::isPowerOf2_32</a></div><div class="ttdeci">constexpr bool isPowerOf2_32(uint32_t Value)</div><div class="ttdoc">Return true if the argument is a power of two &gt; 0.</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00292">MathExtras.h:292</a></div></div>
<div class="ttc" id="anamespacellvm_html_a126a78caf2176eb39d879c899bdd749c"><div class="ttname"><a href="namespacellvm.html#a126a78caf2176eb39d879c899bdd749c">llvm::succ_empty</a></div><div class="ttdeci">bool succ_empty(const Instruction *I)</div><div class="ttdef"><b>Definition:</b> <a href="IR_2CFG_8h_source.html#l00255">CFG.h:255</a></div></div>
<div class="ttc" id="aSequence_8h_html"><div class="ttname"><a href="Sequence_8h.html">Sequence.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1SwitchInst_html_a90d8c814f871c58dbda5dccce5c4110e"><div class="ttname"><a href="classllvm_1_1SwitchInst.html#a90d8c814f871c58dbda5dccce5c4110e">llvm::SwitchInst::getNumSuccessors</a></div><div class="ttdeci">unsigned getNumSuccessors() const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03604">Instructions.h:3604</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_a88cdefb709309eddc6e5daca0be6a7b4"><div class="ttname"><a href="classllvm_1_1PHINode.html#a88cdefb709309eddc6e5daca0be6a7b4">llvm::PHINode::setIncomingValue</a></div><div class="ttdeci">void setIncomingValue(unsigned i, Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02797">Instructions.h:2797</a></div></div>
<div class="ttc" id="aConstantFolding_8h_html"><div class="ttname"><a href="ConstantFolding_8h.html">ConstantFolding.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Attribute_html_a70f42ed02a8993b84bdf97da5d54d097"><div class="ttname"><a href="classllvm_1_1Attribute.html#a70f42ed02a8993b84bdf97da5d54d097">llvm::Attribute::getValueAsBool</a></div><div class="ttdeci">bool getValueAsBool() const</div><div class="ttdoc">Return the attribute's value as a boolean.</div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8cpp_source.html#l00298">Attributes.cpp:298</a></div></div>
<div class="ttc" id="aUse_8h_html"><div class="ttname"><a href="Use_8h.html">Use.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_a9b43098c569ea8289ed1ab70ee9a00af"><div class="ttname"><a href="namespacellvm.html#a9b43098c569ea8289ed1ab70ee9a00af">llvm::combineMetadataForCSE</a></div><div class="ttdeci">void combineMetadataForCSE(Instruction *K, const Instruction *J, bool DoesKMove)</div><div class="ttdoc">Combine the metadata of two instructions so that K can replace J.</div><div class="ttdef"><b>Definition:</b> <a href="Transforms_2Utils_2Local_8cpp_source.html#l02740">Local.cpp:2740</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a006522c92584fa9c362c0b3add3bbf8a"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a006522c92584fa9c362c0b3add3bbf8a">ValidLookupTableConstant</a></div><div class="ttdeci">static bool ValidLookupTableConstant(Constant *C, const TargetTransformInfo &amp;TTI)</div><div class="ttdoc">Return true if the backend will be able to handle initializing an array of constants like C.</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l05598">SimplifyCFG.cpp:5598</a></div></div>
<div class="ttc" id="aDebug_8h_html_a08efc68d15935eb8889400a46c3749ba"><div class="ttname"><a href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a></div><div class="ttdeci">#define LLVM_DEBUG(X)</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8h_source.html#l00101">Debug.h:101</a></div></div>
<div class="ttc" id="aclassllvm_1_1BranchInst_html_a6550fe5bd437c1c3c6e237d726e36b90"><div class="ttname"><a href="classllvm_1_1BranchInst.html#a6550fe5bd437c1c3c6e237d726e36b90">llvm::BranchInst::swapSuccessors</a></div><div class="ttdeci">void swapSuccessors()</div><div class="ttdoc">Swap the successors of this branch instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l01427">Instructions.cpp:1427</a></div></div>
<div class="ttc" id="anamespacellvm_1_1at_html_a3c90899e8f022656e511630de42b916c"><div class="ttname"><a href="namespacellvm_1_1at.html#a3c90899e8f022656e511630de42b916c">llvm::at::getAssignmentMarkers</a></div><div class="ttdeci">AssignmentMarkerRange getAssignmentMarkers(DIAssignID *ID)</div><div class="ttdoc">Return a range of dbg.assign intrinsics which use \ID as an operand.</div><div class="ttdef"><b>Definition:</b> <a href="DebugInfo_8cpp_source.html#l01754">DebugInfo.cpp:1754</a></div></div>
<div class="ttc" id="aclassllvm_1_1BranchInst_html_adc5e7f9c460c68455e826783d77f9a99"><div class="ttname"><a href="classllvm_1_1BranchInst.html#adc5e7f9c460c68455e826783d77f9a99">llvm::BranchInst::setSuccessor</a></div><div class="ttdeci">void setSuccessor(unsigned idx, BasicBlock *NewSucc)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03237">Instructions.h:3237</a></div></div>
<div class="ttc" id="anamespacellvm_1_1RISCVFenceField_html_a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731"><div class="ttname"><a href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">llvm::RISCVFenceField::R</a></div><div class="ttdeci">@ R</div><div class="ttdef"><b>Definition:</b> <a href="RISCVBaseInfo_8h_source.html#l00278">RISCVBaseInfo.h:278</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_a88c1c3dd33d232dc889a5d29c75b75f3"><div class="ttname"><a href="classllvm_1_1PHINode.html#a88c1c3dd33d232dc889a5d29c75b75f3">llvm::PHINode::blocks</a></div><div class="ttdeci">iterator_range&lt; const_block_iterator &gt; blocks() const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02780">Instructions.h:2780</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a7237782a64e78d98366d51252b16ca07"><div class="ttname"><a href="classllvm_1_1APInt.html#a7237782a64e78d98366d51252b16ca07">llvm::APInt::countPopulation</a></div><div class="ttdeci">unsigned countPopulation() const</div><div class="ttdoc">Count the number of bits set.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01619">APInt.h:1619</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a9247a212ea89acc9573fa7e7f557eaba"><div class="ttname"><a href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">llvm::Instruction::setMetadata</a></div><div class="ttdeci">void setMetadata(unsigned KindID, MDNode *Node)</div><div class="ttdoc">Set the metadata of the specified kind to the specified node.</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8cpp_source.html#l01455">Metadata.cpp:1455</a></div></div>
<div class="ttc" id="aKnownBits_8h_html"><div class="ttname"><a href="KnownBits_8h.html">KnownBits.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1SwitchInst_1_1CaseIteratorImpl_html"><div class="ttname"><a href="classllvm_1_1SwitchInst_1_1CaseIteratorImpl.html">llvm::SwitchInst::CaseIteratorImpl</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03324">Instructions.h:3324</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html"><div class="ttname"><a href="classllvm_1_1BasicBlock.html">llvm::BasicBlock</a></div><div class="ttdoc">LLVM Basic Block Representation.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00055">BasicBlock.h:55</a></div></div>
<div class="ttc" id="aclassllvm_1_1MDNode_html_aa4068e37ec583962685e3567dc102ae5"><div class="ttname"><a href="classllvm_1_1MDNode.html#aa4068e37ec583962685e3567dc102ae5">llvm::MDNode::getNumOperands</a></div><div class="ttdeci">unsigned getNumOperands() const</div><div class="ttdoc">Return number of MDNode operands.</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8h_source.html#l01297">Metadata.h:1297</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_aa85a3c04f64695265702d0b3c3d6ea1c"><div class="ttname"><a href="SimplifyCFG_8cpp.html#aa85a3c04f64695265702d0b3c3d6ea1c">replacingOperandWithVariableIsCheap</a></div><div class="ttdeci">static bool replacingOperandWithVariableIsCheap(const Instruction *I, int OpIdx)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01780">SimplifyCFG.cpp:1780</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7c46c742c31be54870e2038048e6b391"><div class="ttname"><a href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">llvm::dbgs</a></div><div class="ttdeci">raw_ostream &amp; dbgs()</div><div class="ttdoc">dbgs() - This returns a reference to a raw_ostream for debugging messages.</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8cpp_source.html#l00163">Debug.cpp:163</a></div></div>
<div class="ttc" id="anamespacellvm_html_aa76a2cf19b821f320ab439d5659ef4b9"><div class="ttname"><a href="namespacellvm.html#aa76a2cf19b821f320ab439d5659ef4b9">llvm::MergeBlockIntoPredecessor</a></div><div class="ttdeci">bool MergeBlockIntoPredecessor(BasicBlock *BB, DomTreeUpdater *DTU=nullptr, LoopInfo *LI=nullptr, MemorySSAUpdater *MSSAU=nullptr, MemoryDependenceResults *MemDep=nullptr, bool PredecessorWithTwoSuccessors=false, DominatorTree *DT=nullptr)</div><div class="ttdoc">Attempts to merge a block into its predecessor, if possible.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l00179">BasicBlockUtils.cpp:179</a></div></div>
<div class="ttc" id="aAMDGPULibCalls_8cpp_html_afecf1cc1292b07f57d343c0f4d682044"><div class="ttname"><a href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a></div><div class="ttdeci">amdgpu Simplify well known AMD library false FunctionCallee Value * Arg</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPULibCalls_8cpp_source.html#l00187">AMDGPULibCalls.cpp:187</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_a53d4e14158c5056fd1ed8f7b3da82f8a"><div class="ttname"><a href="classllvm_1_1User.html#a53d4e14158c5056fd1ed8f7b3da82f8a">llvm::User::getOperandUse</a></div><div class="ttdeci">const Use &amp; getOperandUse(unsigned i) const</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00182">User.h:182</a></div></div>
<div class="ttc" id="anamespacellvm_1_1BitmaskEnumDetail_html_a91efa71de05b0c2d00730a0279f58658"><div class="ttname"><a href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">llvm::BitmaskEnumDetail::Mask</a></div><div class="ttdeci">constexpr std::underlying_type_t&lt; E &gt; Mask()</div><div class="ttdoc">Get a bitmask with 1s in all places up to the high-order bit of E's largest value.</div><div class="ttdef"><b>Definition:</b> <a href="BitmaskEnum_8h_source.html#l00080">BitmaskEnum.h:80</a></div></div>
<div class="ttc" id="aIR_2Instruction_8h_html"><div class="ttname"><a href="IR_2Instruction_8h.html">Instruction.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_aac9e78b3aa02ec087c4621358f506718"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#aac9e78b3aa02ec087c4621358f506718">llvm::PatternMatch::m_APInt</a></div><div class="ttdeci">apint_match m_APInt(const APInt *&amp;Res)</div><div class="ttdoc">Match a ConstantInt or splatted ConstantVector, binding the specified pointer to the contained APInt.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00278">PatternMatch.h:278</a></div></div>
<div class="ttc" id="aCommandLine_8h_html"><div class="ttname"><a href="CommandLine_8h.html">CommandLine.h</a></div></div>
<div class="ttc" id="aX86PartialReduction_8cpp_html_a9e1483f7215664a2315c53c3558d9a8d"><div class="ttname"><a href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a></div><div class="ttdeci">Value * LHS</div><div class="ttdef"><b>Definition:</b> <a href="X86PartialReduction_8cpp_source.html#l00075">X86PartialReduction.cpp:75</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html"><div class="ttname"><a href="classllvm_1_1ConstantInt.html">llvm::ConstantInt</a></div><div class="ttdoc">This is the shared class of boolean and integer constants.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00078">Constants.h:78</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a7a84209b8495d8fd3d2799eb01f1ab2b"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a7a84209b8495d8fd3d2799eb01f1ab2b">llvm::TargetTransformInfo::isTypeLegal</a></div><div class="ttdeci">bool isTypeLegal(Type *Ty) const</div><div class="ttdoc">Return true if this type is legal.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00498">TargetTransformInfo.cpp:498</a></div></div>
<div class="ttc" id="anamespacellvm_html_a0d10fe510ced2849a8074fe81e5d04ce"><div class="ttname"><a href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all_of</a></div><div class="ttdeci">bool all_of(R &amp;&amp;range, UnaryPredicate P)</div><div class="ttdoc">Provide wrappers to std::all_of which take ranges instead of having to pass begin/end explicitly.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01735">STLExtras.h:1735</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a72d0db08ead54facf3e1e90aaae435baae768be164a586335f583dbafeecc1ea7"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a72d0db08ead54facf3e1e90aaae435baae768be164a586335f583dbafeecc1ea7">SkipImplicitControlFlow</a></div><div class="ttdeci">@ SkipImplicitControlFlow</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01439">SimplifyCFG.cpp:1439</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_aa4641512b28a6e42a40bda7576fe43cb"><div class="ttname"><a href="SimplifyCFG_8cpp.html#aa4641512b28a6e42a40bda7576fe43cb">EraseTerminatorAndDCECond</a></div><div class="ttdeci">static void EraseTerminatorAndDCECond(Instruction *TI, MemorySSAUpdater *MSSAU=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00755">SimplifyCFG.cpp:755</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_adb38eaaa53c1d9c57b6fe11cf84bd7a4"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#adb38eaaa53c1d9c57b6fe11cf84bd7a4">llvm::ArrayRef::back</a></div><div class="ttdeci">const T &amp; back() const</div><div class="ttdoc">back - Get the last element.</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00172">ArrayRef.h:172</a></div></div>
<div class="ttc" id="anamespacellvm_html_a8f2893ab869a806d78af17691eb97be3"><div class="ttname"><a href="namespacellvm.html#a8f2893ab869a806d78af17691eb97be3">llvm::RemapInstruction</a></div><div class="ttdeci">void RemapInstruction(Instruction *I, ValueToValueMapTy &amp;VM, RemapFlags Flags=RF_None, ValueMapTypeRemapper *TypeMapper=nullptr, ValueMaterializer *Materializer=nullptr)</div><div class="ttdoc">Convert the instruction operands from referencing the current values into those specified by VM.</div><div class="ttdef"><b>Definition:</b> <a href="ValueMapper_8h_source.html#l00254">ValueMapper.h:254</a></div></div>
<div class="ttc" id="aclassllvm_1_1StoreInst_html_a14298313bdf734e2db5a921cc6e861a0"><div class="ttname"><a href="classllvm_1_1StoreInst.html#a14298313bdf734e2db5a921cc6e861a0">llvm::StoreInst::getValueOperand</a></div><div class="ttdeci">Value * getValueOperand()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00390">Instructions.h:390</a></div></div>
<div class="ttc" id="aGlobalValue_8h_html"><div class="ttname"><a href="GlobalValue_8h.html">GlobalValue.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a9679969ae87f8a08d5f6948be6cf7210"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a9679969ae87f8a08d5f6948be6cf7210">llvm::TargetTransformInfo::getArithmeticInstrCost</a></div><div class="ttdeci">InstructionCost getArithmeticInstrCost(unsigned Opcode, Type *Ty, TTI::TargetCostKind CostKind=TTI::TCK_RecipThroughput, TTI::OperandValueInfo Opd1Info={TTI::OK_AnyValue, TTI::OP_None}, TTI::OperandValueInfo Opd2Info={TTI::OK_AnyValue, TTI::OP_None}, ArrayRef&lt; const Value * &gt; Args=ArrayRef&lt; const Value * &gt;(), const Instruction *CxtI=nullptr) const</div><div class="ttdoc">This is an approximation of reciprocal throughput of a math/logic op.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00803">TargetTransformInfo.cpp:803</a></div></div>
<div class="ttc" id="anamespacellvm_html_aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b"><div class="ttname"><a href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">llvm::RecurKind::And</a></div><div class="ttdeci">@ And</div><div class="ttdoc">Bitwise or logical AND of integers.</div></div>
<div class="ttc" id="aclassllvm_1_1MutableArrayRef_html_a9d959094f4544749c129c46034cbed67"><div class="ttname"><a href="classllvm_1_1MutableArrayRef.html#a9d959094f4544749c129c46034cbed67">llvm::MutableArrayRef::end</a></div><div class="ttdeci">iterator end() const</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00355">ArrayRef.h:355</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_addb87fe3f509b7803d3f5933ee24b560"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#addb87fe3f509b7803d3f5933ee24b560">llvm::PatternMatch::m_Select</a></div><div class="ttdeci">ThreeOps_match&lt; Cond, LHS, RHS, Instruction::Select &gt; m_Select(const Cond &amp;C, const LHS &amp;L, const RHS &amp;R)</div><div class="ttdoc">Matches SelectInst.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01462">PatternMatch.h:1462</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a23f9dbda493b589bf024813b2c7e8c41"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a23f9dbda493b589bf024813b2c7e8c41">GetBranchWeights</a></div><div class="ttdeci">static void GetBranchWeights(Instruction *TI, SmallVectorImpl&lt; uint64_t &gt; &amp;Weights)</div><div class="ttdoc">Get Weights of a given terminator, the default weight is at the front of the vector.</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01065">SimplifyCFG.cpp:1065</a></div></div>
<div class="ttc" id="aclassllvm_1_1MutableArrayRef_html"><div class="ttname"><a href="classllvm_1_1MutableArrayRef.html">llvm::MutableArrayRef</a></div><div class="ttdoc">MutableArrayRef - Represent a mutable reference to an array (0 or more elements consecutively in memo...</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00027">ArrayRef.h:27</a></div></div>
<div class="ttc" id="aConstants_8h_html"><div class="ttname"><a href="Constants_8h.html">Constants.h</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_aad3186d040aca408a1f8cbbd55aece95"><div class="ttname"><a href="SimplifyCFG_8cpp.html#aad3186d040aca408a1f8cbbd55aece95">findUniqueStoreInBlocks</a></div><div class="ttdeci">static StoreInst * findUniqueStoreInBlocks(BasicBlock *BB1, BasicBlock *BB2)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03828">SimplifyCFG.cpp:3828</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a25d956d9e0beadd47ce4bc255dfa811d"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">llvm::PatternMatch::match</a></div><div class="ttdeci">bool match(Val *V, const Pattern &amp;P)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00049">PatternMatch.h:49</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_a16c39eb6e60b42a40c399d8d65347bb6"><div class="ttname"><a href="classllvm_1_1PHINode.html#a16c39eb6e60b42a40c399d8d65347bb6">llvm::PHINode::getIncomingValue</a></div><div class="ttdeci">Value * getIncomingValue(unsigned i) const</div><div class="ttdoc">Return incoming value number x.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02794">Instructions.h:2794</a></div></div>
<div class="ttc" id="aclassllvm_1_1Constant_html_ae4b6abe77abf42fb02081a6cc41a0132"><div class="ttname"><a href="classllvm_1_1Constant.html#ae4b6abe77abf42fb02081a6cc41a0132">llvm::Constant::isNullValue</a></div><div class="ttdeci">bool isNullValue() const</div><div class="ttdoc">Return true if this is the value that would be returned by getNullValue.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00076">Constants.cpp:76</a></div></div>
<div class="ttc" id="aInlineOrder_8cpp_html_a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6"><div class="ttname"><a href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">InlinePriorityMode::Cost</a></div><div class="ttdeci">@ Cost</div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a8a7f7d7aa56a6449ae814f48b6a8ce6f"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a8a7f7d7aa56a6449ae814f48b6a8ce6f">ConstantIntSortPredicate</a></div><div class="ttdeci">static int ConstantIntSortPredicate(ConstantInt *const *P1, ConstantInt *const *P2)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01053">SimplifyCFG.cpp:1053</a></div></div>
<div class="ttc" id="aREADME-SSE_8txt_html_ae7fc2fb0e2d536219c1193f1a178e7db"><div class="ttname"><a href="README-SSE_8txt.html#ae7fc2fb0e2d536219c1193f1a178e7db">P2</a></div><div class="ttdeci">This might compile to this xmm1 xorps xmm0 movss xmm0 ret Now consider if the code caused xmm1 to get spilled This might produce this xmm1 movaps xmm0 movaps xmm1 movss xmm0 ret since the reload is only used by these we could fold it into the producing something like xmm1 movaps xmm0 ret saving two instructions The basic idea is that a reload from a spill if only one byte chunk is bring in zeros the one element instead of elements This can be used to simplify a variety of shuffle where the elements are fixed zeros This code generates ugly probably due to costs being off or&lt; 4 x float &gt; * P2</div><div class="ttdef"><b>Definition:</b> <a href="README-SSE_8txt_source.html#l00278">README-SSE.txt:278</a></div></div>
<div class="ttc" id="aBuiltinGCs_8cpp_html_a6742d2e0a668baf1196ec69e158d5f15"><div class="ttname"><a href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a></div><div class="ttdeci">static GCRegistry::Add&lt; CoreCLRGC &gt; E(&quot;coreclr&quot;, &quot;CoreCLR-compatible GC&quot;)</div></div>
<div class="ttc" id="anamespacellvm_html_adbc4e5b23d7154e30b03717a470e8178"><div class="ttname"><a href="namespacellvm.html#adbc4e5b23d7154e30b03717a470e8178">llvm::isImpliedByDomCondition</a></div><div class="ttdeci">std::optional&lt; bool &gt; isImpliedByDomCondition(const Value *Cond, const Instruction *ContextI, const DataLayout &amp;DL)</div><div class="ttdoc">Return the boolean condition value in the context of the given instruction if it is known based on do...</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l07044">ValueTracking.cpp:7044</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_ae21e8db12165e2f7d6337b75800ff91c"><div class="ttname"><a href="SimplifyCFG_8cpp.html#ae21e8db12165e2f7d6337b75800ff91c">TryToMergeLandingPad</a></div><div class="ttdeci">static bool TryToMergeLandingPad(LandingPadInst *LPad, BranchInst *BI, BasicBlock *BB, DomTreeUpdater *DTU)</div><div class="ttdoc">Given an block with only a single landing pad and a unconditional branch try to find another basic bl...</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l06858">SimplifyCFG.cpp:6858</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html"><div class="ttname"><a href="classllvm_1_1User.html">llvm::User</a></div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00044">User.h:44</a></div></div>
<div class="ttc" id="aREADME__ALTIVEC_8txt_html_a9aacd9146afe44bf656cd664e2a88c8c"><div class="ttname"><a href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a></div><div class="ttdeci">(vector float) vec_cmpeq(*A, *B) C</div><div class="ttdef"><b>Definition:</b> <a href="README__ALTIVEC_8txt_source.html#l00086">README_ALTIVEC.txt:86</a></div></div>
<div class="ttc" id="aInstrTypes_8h_html"><div class="ttname"><a href="InstrTypes_8h.html">InstrTypes.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a0ed5f3ab3c2e4196ee0cffffa080c062"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">llvm::BasicBlock::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdoc">Instruction iterator methods.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00314">BasicBlock.h:314</a></div></div>
<div class="ttc" id="astructllvm_1_1KnownBits_html_aba205f553f24c184ea47fc1a6cb56537"><div class="ttname"><a href="structllvm_1_1KnownBits.html#aba205f553f24c184ea47fc1a6cb56537">llvm::KnownBits::One</a></div><div class="ttdeci">APInt One</div><div class="ttdef"><b>Definition:</b> <a href="KnownBits_8h_source.html#l00025">KnownBits.h:25</a></div></div>
<div class="ttc" id="anamespacellvm_html_ab42e397923eec18d3ab8ea88d280b63c"><div class="ttname"><a href="namespacellvm.html#ab42e397923eec18d3ab8ea88d280b63c">llvm::canReplaceOperandWithVariable</a></div><div class="ttdeci">bool canReplaceOperandWithVariable(const Instruction *I, unsigned OpIdx)</div><div class="ttdoc">Given an instruction, is it legal to set operand OpIdx to a non-constant value?</div><div class="ttdef"><b>Definition:</b> <a href="Transforms_2Utils_2Local_8cpp_source.html#l03410">Local.cpp:3410</a></div></div>
<div class="ttc" id="anamespacellvm_html_a6713fe2f5fca7c6e1109392b28c21c17"><div class="ttname"><a href="namespacellvm.html#a6713fe2f5fca7c6e1109392b28c21c17">llvm::FoldBranchToCommonDest</a></div><div class="ttdeci">bool FoldBranchToCommonDest(BranchInst *BI, llvm::DomTreeUpdater *DTU=nullptr, MemorySSAUpdater *MSSAU=nullptr, const TargetTransformInfo *TTI=nullptr, unsigned BonusInstThreshold=1)</div><div class="ttdoc">If this basic block is ONLY a setcc and a branch, and if a predecessor branches to us and one of our ...</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03701">SimplifyCFG.cpp:3701</a></div></div>
<div class="ttc" id="aclassllvm_1_1MDBuilder_html_ad910125a9cfd76aaad7f69469df22f66"><div class="ttname"><a href="classllvm_1_1MDBuilder.html#ad910125a9cfd76aaad7f69469df22f66">llvm::MDBuilder::createBranchWeights</a></div><div class="ttdeci">MDNode * createBranchWeights(uint32_t TrueWeight, uint32_t FalseWeight)</div><div class="ttdoc">Return metadata containing two branch weights.</div><div class="ttdef"><b>Definition:</b> <a href="MDBuilder_8cpp_source.html#l00037">MDBuilder.cpp:37</a></div></div>
<div class="ttc" id="aSIInstrInfo_8cpp_html_a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791"><div class="ttname"><a href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a></div><div class="ttdeci">@ SI</div><div class="ttdef"><b>Definition:</b> <a href="SIInstrInfo_8cpp_source.html#l07993">SIInstrInfo.cpp:7993</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ms__demangle_html_afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e"><div class="ttname"><a href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">llvm::ms_demangle::QualifierMangleMode::Result</a></div><div class="ttdeci">@ Result</div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a7279ed8b15d2a6dc8d246a7de2e08604"><div class="ttname"><a href="classllvm_1_1Instruction.html#a7279ed8b15d2a6dc8d246a7de2e08604">llvm::Instruction::applyMergedLocation</a></div><div class="ttdeci">void applyMergedLocation(const DILocation *LocA, const DILocation *LocB)</div><div class="ttdoc">Merge 2 debug locations and apply it to the Instruction.</div><div class="ttdef"><b>Definition:</b> <a href="DebugInfo_8cpp_source.html#l00896">DebugInfo.cpp:896</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a40f7c70fc970f25f1c32e8b2c28662ec"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a40f7c70fc970f25f1c32e8b2c28662ec">SimplifyCondBranchToCondBranch</a></div><div class="ttdeci">static bool SimplifyCondBranchToCondBranch(BranchInst *PBI, BranchInst *BI, DomTreeUpdater *DTU, const DataLayout &amp;DL, const TargetTransformInfo &amp;TTI)</div><div class="ttdoc">If we have a conditional branch as a predecessor of another block, this function tries to simplify it...</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l04207">SimplifyCFG.cpp:4207</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a79048da023cea1bb91bc651c36ed6e32"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a79048da023cea1bb91bc651c36ed6e32">MergeCondStoresAggressively</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; MergeCondStoresAggressively(&quot;simplifycfg-merge-cond-stores-aggressively&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;When merging conditional stores, do so even if the resultant &quot; &quot;basic blocks are unlikely to be if-converted as a result&quot;))</div></div>
<div class="ttc" id="ac_2DataTypes_8h_html_a30654b4b67d97c42ca3f9b6052dda916"><div class="ttname"><a href="c_2DataTypes_8h.html#a30654b4b67d97c42ca3f9b6052dda916">UINT64_MAX</a></div><div class="ttdeci">#define UINT64_MAX</div><div class="ttdef"><b>Definition:</b> <a href="c_2DataTypes_8h_source.html#l00077">DataTypes.h:77</a></div></div>
<div class="ttc" id="aclassllvm_1_1StoreInst_html_a70f38e046a2d6f8d9b40e092eda2c919"><div class="ttname"><a href="classllvm_1_1StoreInst.html#a70f38e046a2d6f8d9b40e092eda2c919">llvm::StoreInst::isSimple</a></div><div class="ttdeci">bool isSimple() const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00382">Instructions.h:382</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a161fd4e9fa5367f64c2a4c9e921c3ad3"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a161fd4e9fa5367f64c2a4c9e921c3ad3">llvm::BasicBlock::getFirstInsertionPt</a></div><div class="ttdeci">const_iterator getFirstInsertionPt() const</div><div class="ttdoc">Returns an iterator to the first instruction in this block that is suitable for inserting a non-PHI i...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00245">BasicBlock.cpp:245</a></div></div>
<div class="ttc" id="anamespacellvm_html_afb65eef479f0473d0fe1666b80155237"><div class="ttname"><a href="namespacellvm.html#afb65eef479f0473d0fe1666b80155237">llvm::NextPowerOf2</a></div><div class="ttdeci">constexpr uint64_t NextPowerOf2(uint64_t A)</div><div class="ttdoc">Returns the next power of two (in 64-bits) that is strictly greater than A.</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00450">MathExtras.h:450</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a77b36b0c3d9cdfab87304f5181154f9b"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a77b36b0c3d9cdfab87304f5181154f9b">FoldCondBranchOnValueKnownInPredecessor</a></div><div class="ttdeci">static bool FoldCondBranchOnValueKnownInPredecessor(BranchInst *BI, DomTreeUpdater *DTU, const DataLayout &amp;DL, AssumptionCache *AC)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03281">SimplifyCFG.cpp:3281</a></div></div>
<div class="ttc" id="anamespacellvm_1_1dwarf_html_a5d3c920b66ea797d6adb243862fdf47a"><div class="ttname"><a href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">llvm::dwarf::Index</a></div><div class="ttdeci">Index</div><div class="ttdef"><b>Definition:</b> <a href="Dwarf_8h_source.html#l00550">Dwarf.h:550</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a83b0a34d940365e97b9a531c1f13f3b9"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a83b0a34d940365e97b9a531c1f13f3b9">eliminateDeadSwitchCases</a></div><div class="ttdeci">static bool eliminateDeadSwitchCases(SwitchInst *SI, DomTreeUpdater *DTU, AssumptionCache *AC, const DataLayout &amp;DL)</div><div class="ttdoc">Compute masked bits for the condition of a switch and use it to remove dead cases.</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l05431">SimplifyCFG.cpp:5431</a></div></div>
<div class="ttc" id="anamespacellvm_html_a646986783f35e0fef8988f0f28d2589f"><div class="ttname"><a href="namespacellvm.html#a646986783f35e0fef8988f0f28d2589f">llvm::Log2_32</a></div><div class="ttdeci">unsigned Log2_32(uint32_t Value)</div><div class="ttdoc">Return the floor log base 2 of the specified value, -1 if the value is zero.</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00382">MathExtras.h:382</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1CPol_html_a7d79a4b341da8ac60b91c1f4b1ea42c4a3795a38ac6eb8cb14191aaba99205a87"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1CPol.html#a7d79a4b341da8ac60b91c1f4b1ea42c4a3795a38ac6eb8cb14191aaba99205a87">llvm::AMDGPU::CPol::NT</a></div><div class="ttdeci">@ NT</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00319">SIDefines.h:319</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a94ec041c0e8d06efb0bd1998bcedec9f"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a94ec041c0e8d06efb0bd1998bcedec9f">GetConstantInt</a></div><div class="ttdeci">static ConstantInt * GetConstantInt(Value *V, const DataLayout &amp;DL)</div><div class="ttdoc">Extract ConstantInt from value, looking through IntToPtr and PointerNullValue.</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00480">SimplifyCFG.cpp:480</a></div></div>
<div class="ttc" id="aclassllvm_1_1Function_html_a4c319db4fe05c27cfe55bd133a87414d"><div class="ttname"><a href="classllvm_1_1Function.html#a4c319db4fe05c27cfe55bd133a87414d">llvm::Function::getFnAttribute</a></div><div class="ttdeci">Attribute getFnAttribute(Attribute::AttrKind Kind) const</div><div class="ttdoc">Return the attribute for the given attribute kind.</div><div class="ttdef"><b>Definition:</b> <a href="Function_8cpp_source.html#l00666">Function.cpp:666</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_adfb61ffe25c950c75c86310245b3ef39"><div class="ttname"><a href="classllvm_1_1PHINode.html#adfb61ffe25c950c75c86310245b3ef39">llvm::PHINode::getIncomingValueForBlock</a></div><div class="ttdeci">Value * getIncomingValueForBlock(const BasicBlock *BB) const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02889">Instructions.h:2889</a></div></div>
<div class="ttc" id="aclassllvm_1_1IntegerType_html"><div class="ttname"><a href="classllvm_1_1IntegerType.html">llvm::IntegerType</a></div><div class="ttdoc">Class to represent integer types.</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00040">DerivedTypes.h:40</a></div></div>
<div class="ttc" id="anamespacellvm_html_a6577ad74b2f1a18729c71543850d8616"><div class="ttname"><a href="namespacellvm.html#a6577ad74b2f1a18729c71543850d8616">llvm::skipDebugIntrinsics</a></div><div class="ttdeci">BasicBlock::iterator skipDebugIntrinsics(BasicBlock::iterator It)</div><div class="ttdoc">Advance It while it points to a debug instruction and return the result.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00534">BasicBlock.cpp:534</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_aa997f186d431ca191833917f6f8a7dd1"><div class="ttname"><a href="SimplifyCFG_8cpp.html#aa997f186d431ca191833917f6f8a7dd1">BranchFoldThreshold</a></div><div class="ttdeci">static cl::opt&lt; unsigned &gt; BranchFoldThreshold(&quot;simplifycfg-branch-fold-threshold&quot;, cl::Hidden, cl::init(2), cl::desc(&quot;Maximum cost of combining conditions when &quot; &quot;folding branches&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_ac9542ee3a689ae9574b7807c96107d89"><div class="ttname"><a href="classllvm_1_1Type.html#ac9542ee3a689ae9574b7807c96107d89">llvm::Type::isTokenTy</a></div><div class="ttdeci">bool isTokenTy() const</div><div class="ttdoc">Return true if this is 'token'.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00219">Type.h:219</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html"><div class="ttname"><a href="classllvm_1_1Instruction.html">llvm::Instruction</a></div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00041">Instruction.h:41</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_ad3975afbd39328614959fbada1ae5648"><div class="ttname"><a href="SimplifyCFG_8cpp.html#ad3975afbd39328614959fbada1ae5648">MaxSpeculationDepth</a></div><div class="ttdeci">static cl::opt&lt; unsigned &gt; MaxSpeculationDepth(&quot;max-speculation-depth&quot;, cl::Hidden, cl::init(10), cl::desc(&quot;Limit maximum recursion depth when calculating costs of &quot; &quot;speculatively executed instructions&quot;))</div></div>
<div class="ttc" id="anamespacellvm_html_adc4eb8be6f7a12ede962987fb9cabb47"><div class="ttname"><a href="namespacellvm.html#adc4eb8be6f7a12ede962987fb9cabb47">llvm::seq</a></div><div class="ttdeci">auto seq(T Begin, T End)</div><div class="ttdoc">Iterate over an integral type from Begin up to - but not including - End.</div><div class="ttdef"><b>Definition:</b> <a href="Sequence_8h_source.html#l00305">Sequence.h:305</a></div></div>
<div class="ttc" id="aclassllvm_1_1BranchInst_html_a3505dab06f59c36142a234321cdc3411"><div class="ttname"><a href="classllvm_1_1BranchInst.html#a3505dab06f59c36142a234321cdc3411">llvm::BranchInst::setCondition</a></div><div class="ttdeci">void setCondition(Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03225">Instructions.h:3225</a></div></div>
<div class="ttc" id="aMDBuilder_8h_html"><div class="ttname"><a href="MDBuilder_8h.html">MDBuilder.h</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a483d3fcb928be402adb5c42809db8e58"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a483d3fcb928be402adb5c42809db8e58">SinkCommonCodeFromPredecessors</a></div><div class="ttdeci">static bool SinkCommonCodeFromPredecessors(BasicBlock *BB, DomTreeUpdater *DTU)</div><div class="ttdoc">Check whether BB's predecessors end with unconditional branches.</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l02096">SimplifyCFG.cpp:2096</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a217e0207d9cc8e046c2dccbf0e4bb198"><div class="ttname"><a href="classllvm_1_1APInt.html#a217e0207d9cc8e046c2dccbf0e4bb198">llvm::APInt::getZExtValue</a></div><div class="ttdeci">uint64_t getZExtValue() const</div><div class="ttdoc">Get zero extended value.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01494">APInt.h:1494</a></div></div>
<div class="ttc" id="aPassBuilderBindings_8cpp_html_a47c521bf7ba0bb2147b96d068af30d04"><div class="ttname"><a href="PassBuilderBindings_8cpp.html#a47c521bf7ba0bb2147b96d068af30d04">Options</a></div><div class="ttdeci">const char LLVMTargetMachineRef LLVMPassBuilderOptionsRef Options</div><div class="ttdef"><b>Definition:</b> <a href="PassBuilderBindings_8cpp_source.html#l00048">PassBuilderBindings.cpp:48</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a72516971c5734dc0f7546e64affca425"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a72516971c5734dc0f7546e64affca425">llvm::BasicBlock::phis</a></div><div class="ttdeci">iterator_range&lt; const_phi_iterator &gt; phis() const</div><div class="ttdoc">Returns a range that iterates over the phis in the basic block.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00372">BasicBlock.h:372</a></div></div>
<div class="ttc" id="anamespacellvm_html_a0bf75467957937ad23ad7be19f489934"><div class="ttname"><a href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">llvm::STATISTIC</a></div><div class="ttdeci">STATISTIC(NumFunctions, &quot;Total number of functions&quot;)</div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a0b4c48d53ab1ddc5bf009cd4ddffdc5a"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a0b4c48d53ab1ddc5bf009cd4ddffdc5a">validateAndCostRequiredSelects</a></div><div class="ttdeci">static bool validateAndCostRequiredSelects(BasicBlock *BB, BasicBlock *ThenBB, BasicBlock *EndBB, unsigned &amp;SpeculatedInstructions, InstructionCost &amp;Cost, const TargetTransformInfo &amp;TTI)</div><div class="ttdoc">Estimate the cost of the insertion(s) and check that the PHI nodes can be converted to selects.</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l02762">SimplifyCFG.cpp:2762</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a35ee267850af7c235474a8c46c7ac5af"><div class="ttname"><a href="classllvm_1_1Value.html#a35ee267850af7c235474a8c46c7ac5af">llvm::Value::setName</a></div><div class="ttdeci">void setName(const Twine &amp;Name)</div><div class="ttdoc">Change the name of the value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00375">Value.cpp:375</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_ac46c68ef01d64ec7e21b62016818063a"><div class="ttname"><a href="SimplifyCFG_8cpp.html#ac46c68ef01d64ec7e21b62016818063a">mapCaseToResult</a></div><div class="ttdeci">static size_t mapCaseToResult(ConstantInt *CaseVal, SwitchCaseResultVectorTy &amp;UniqueResults, Constant *Result)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l05738">SimplifyCFG.cpp:5738</a></div></div>
<div class="ttc" id="aclassllvm_1_1DomTreeUpdater_html"><div class="ttname"><a href="classllvm_1_1DomTreeUpdater.html">llvm::DomTreeUpdater</a></div><div class="ttdef"><b>Definition:</b> <a href="DomTreeUpdater_8h_source.html#l00028">DomTreeUpdater.h:28</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_a969709dd49c28865a482d8b870f87c46"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">llvm::ConstantInt::get</a></div><div class="ttdeci">static Constant * get(Type *Ty, uint64_t V, bool IsSigned=false)</div><div class="ttdoc">If Ty is a vector type, return a Constant with a splat of the given value.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00887">Constants.cpp:887</a></div></div>
<div class="ttc" id="aclassllvm_1_1Use_html_a50a2e57da274f8d69b9f932977379cdf"><div class="ttname"><a href="classllvm_1_1Use.html#a50a2e57da274f8d69b9f932977379cdf">llvm::Use::getUser</a></div><div class="ttdeci">User * getUser() const</div><div class="ttdoc">Returns the User that contains this Use.</div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00072">Use.h:72</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_ae4337c482999ffe46512754ba3a077c7"><div class="ttname"><a href="SimplifyCFG_8cpp.html#ae4337c482999ffe46512754ba3a077c7">EnableMergeCompatibleInvokes</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; EnableMergeCompatibleInvokes(&quot;simplifycfg-merge-compatible-invokes&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Allow SimplifyCFG to merge invokes together when appropriate&quot;))</div></div>
<div class="ttc" id="anamespacellvm_html_a3b1c5788b85ffa254be0e834edf5cf8f"><div class="ttname"><a href="namespacellvm.html#a3b1c5788b85ffa254be0e834edf5cf8f">llvm::getUnderlyingObject</a></div><div class="ttdeci">const Value * getUnderlyingObject(const Value *V, unsigned MaxLookup=6)</div><div class="ttdoc">This method strips off any GEP address adjustments and pointer casts from the specified value,...</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l04567">ValueTracking.cpp:4567</a></div></div>
<div class="ttc" id="aSmallPtrSet_8h_html"><div class="ttname"><a href="SmallPtrSet_8h.html">SmallPtrSet.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_aade703948f2fdabdc65868bdf42d3141"><div class="ttname"><a href="classllvm_1_1Instruction.html#aade703948f2fdabdc65868bdf42d3141">llvm::Instruction::getAAMetadata</a></div><div class="ttdeci">AAMDNodes getAAMetadata() const</div><div class="ttdoc">Returns the AA metadata for this instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8cpp_source.html#l01499">Metadata.cpp:1499</a></div></div>
<div class="ttc" id="anamespacellvm_html_a9d391b6acc6d90c9b8a8442324b1aa6f"><div class="ttname"><a href="namespacellvm.html#a9d391b6acc6d90c9b8a8442324b1aa6f">llvm::SplitBlockPredecessors</a></div><div class="ttdeci">BasicBlock * SplitBlockPredecessors(BasicBlock *BB, ArrayRef&lt; BasicBlock * &gt; Preds, const char *Suffix, DominatorTree *DT, LoopInfo *LI=nullptr, MemorySSAUpdater *MSSAU=nullptr, bool PreserveLCSSA=false)</div><div class="ttdoc">This method introduces at least one new basic block into the function and moves some of the predecess...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l01272">BasicBlockUtils.cpp:1272</a></div></div>
<div class="ttc" id="aclassllvm_1_1DbgInfoIntrinsic_html"><div class="ttname"><a href="classllvm_1_1DbgInfoIntrinsic.html">llvm::DbgInfoIntrinsic</a></div><div class="ttdoc">This is the common base class for debug info intrinsics.</div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00167">IntrinsicInst.h:167</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ad848bd0184fc7bcb7b71e19248f08f34"><div class="ttname"><a href="classllvm_1_1Instruction.html#ad848bd0184fc7bcb7b71e19248f08f34">llvm::Instruction::isIdenticalTo</a></div><div class="ttdeci">bool isIdenticalTo(const Instruction *I) const LLVM_READONLY</div><div class="ttdoc">Return true if the specified instruction is exactly identical to the current one.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00552">Instruction.cpp:552</a></div></div>
<div class="ttc" id="aclassllvm_1_1CleanupReturnInst_html_a01bfb360ebaa795daa5623e2c1e3284e"><div class="ttname"><a href="classllvm_1_1CleanupReturnInst.html#a01bfb360ebaa795daa5623e2c1e3284e">llvm::CleanupReturnInst::getCleanupPad</a></div><div class="ttdeci">CleanupPadInst * getCleanupPad() const</div><div class="ttdoc">Convenience accessor.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l04712">Instructions.h:4712</a></div></div>
<div class="ttc" id="aclassllvm_1_1SwitchInstProfUpdateWrapper_html_acf60dfe9415b02d8da94b723e1ce87f8"><div class="ttname"><a href="classllvm_1_1SwitchInstProfUpdateWrapper.html#acf60dfe9415b02d8da94b723e1ce87f8">llvm::SwitchInstProfUpdateWrapper::CaseWeightOpt</a></div><div class="ttdeci">std::optional&lt; uint32_t &gt; CaseWeightOpt</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03636">Instructions.h:3636</a></div></div>
<div class="ttc" id="aPatternMatch_8h_html"><div class="ttname"><a href="PatternMatch_8h.html">PatternMatch.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a46ef6115027606b67adcf4d28f3dac17"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a46ef6115027606b67adcf4d28f3dac17">llvm::BasicBlock::getFirstNonPHI</a></div><div class="ttdeci">const Instruction * getFirstNonPHI() const</div><div class="ttdoc">Returns a pointer to the first instruction in this block that is not a PHINode instruction.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00208">BasicBlock.cpp:208</a></div></div>
<div class="ttc" id="anamespacellvm_html_a71a4a4e0f6178682ef05a0d85891e5a9"><div class="ttname"><a href="namespacellvm.html#a71a4a4e0f6178682ef05a0d85891e5a9">llvm::impliesPoison</a></div><div class="ttdeci">bool impliesPoison(const Value *ValAssumedPoison, const Value *V)</div><div class="ttdoc">Return true if V is poison given that ValAssumedPoison is already poison.</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l05442">ValueTracking.cpp:5442</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a38517d96538b847c6c3dbe58965c8053"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a38517d96538b847c6c3dbe58965c8053">EliminateBlockCases</a></div><div class="ttdeci">static void EliminateBlockCases(BasicBlock *BB, std::vector&lt; ValueEqualityComparisonCase &gt; &amp;Cases)</div><div class="ttdoc">Given a vector of bb/value pairs, remove any entries in the list that match the specified block.</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00822">SimplifyCFG.cpp:822</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_ac7707bcaec113d0d136467c7b97a62f1"><div class="ttname"><a href="SimplifyCFG_8cpp.html#ac7707bcaec113d0d136467c7b97a62f1">SinkCommon</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; SinkCommon(&quot;simplifycfg-sink-common&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Sink common instructions down to the end block&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1StoreInst_html_a3b47950858d6ed72efd1010a35b81caa"><div class="ttname"><a href="classllvm_1_1StoreInst.html#a3b47950858d6ed72efd1010a35b81caa">llvm::StoreInst::getAlign</a></div><div class="ttdeci">Align getAlign() const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00345">Instructions.h:345</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantRange_html_a688f2c4ca99eb7f935cab42c4f6398e7"><div class="ttname"><a href="classllvm_1_1ConstantRange.html#a688f2c4ca99eb7f935cab42c4f6398e7">llvm::ConstantRange::isSizeLargerThan</a></div><div class="ttdeci">bool isSizeLargerThan(uint64_t MaxSize) const</div><div class="ttdoc">Compare set size of this range with Value.</div><div class="ttdef"><b>Definition:</b> <a href="ConstantRange_8cpp_source.html#l00398">ConstantRange.cpp:398</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_adf89b508645e361807eecee2e70a4852"><div class="ttname"><a href="SimplifyCFG_8cpp.html#adf89b508645e361807eecee2e70a4852">FoldTwoEntryPHINode</a></div><div class="ttdeci">static bool FoldTwoEntryPHINode(PHINode *PN, const TargetTransformInfo &amp;TTI, DomTreeUpdater *DTU, const DataLayout &amp;DL)</div><div class="ttdoc">Given a BB that starts with the specified two-entry PHI node, see if we can eliminate it.</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03297">SimplifyCFG.cpp:3297</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_aaf9ee38b9973681c1720aaf03af3a069"><div class="ttname"><a href="classllvm_1_1SetVector.html#aaf9ee38b9973681c1720aaf03af3a069">llvm::SetVector&lt; T, SmallVector&lt; T, N &gt;, SmallDenseSet&lt; T, N &gt; &gt;::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdoc">Determine if the SetVector is empty or not.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00072">SetVector.h:72</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_aef51af4b490af6b3bf2dfbc8737a8f9f"><div class="ttname"><a href="classllvm_1_1PHINode.html#aef51af4b490af6b3bf2dfbc8737a8f9f">llvm::PHINode::getNumIncomingValues</a></div><div class="ttdeci">unsigned getNumIncomingValues() const</div><div class="ttdoc">Return the number of incoming edges.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02790">Instructions.h:2790</a></div></div>
<div class="ttc" id="anamespacellvm_html_a77724415203930efd07d7098cb1e437da9a24bd8dba1bef2753bc3f087435ae7f"><div class="ttname"><a href="namespacellvm.html#a77724415203930efd07d7098cb1e437da9a24bd8dba1bef2753bc3f087435ae7f">llvm::RF_NoModuleLevelChanges</a></div><div class="ttdeci">@ RF_NoModuleLevelChanges</div><div class="ttdoc">If this flag is set, the remapper knows that only local values within a function (such as an instruct...</div><div class="ttdef"><b>Definition:</b> <a href="ValueMapper_8h_source.html#l00071">ValueMapper.h:71</a></div></div>
<div class="ttc" id="anamespacellvm_1_1lltok_html_af353621f14cb4b4b3af5ffaff84076b1"><div class="ttname"><a href="namespacellvm_1_1lltok.html#af353621f14cb4b4b3af5ffaff84076b1">llvm::lltok::Kind</a></div><div class="ttdeci">Kind</div><div class="ttdef"><b>Definition:</b> <a href="LLToken_8h_source.html#l00018">LLToken.h:18</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ARM_html_ab9b10a990ed66fe22b902e50f13382ec"><div class="ttname"><a href="namespacellvm_1_1ARM.html#ab9b10a990ed66fe22b902e50f13382ec">llvm::ARM::operator--</a></div><div class="ttdeci">ArchKind &amp; operator--(ArchKind &amp;Kind)</div><div class="ttdef"><b>Definition:</b> <a href="ARMTargetParser_8h_source.html#l00201">ARMTargetParser.h:201</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_ae157392aa0ecec324802dc03211c354d"><div class="ttname"><a href="SimplifyCFG_8cpp.html#ae157392aa0ecec324802dc03211c354d">CasesAreContiguous</a></div><div class="ttdeci">static bool CasesAreContiguous(SmallVectorImpl&lt; ConstantInt * &gt; &amp;Cases)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l05268">SimplifyCFG.cpp:5268</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a9d7de807ebdfe1819df3ff6cb0f16158"><div class="ttname"><a href="classllvm_1_1Value.html#a9d7de807ebdfe1819df3ff6cb0f16158">llvm::Value::use_empty</a></div><div class="ttdeci">bool use_empty() const</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00344">Value.h:344</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_ad98f06eded5a01ee8704f7d7d9ca4c5b"><div class="ttname"><a href="SimplifyCFG_8cpp.html#ad98f06eded5a01ee8704f7d7d9ca4c5b">tryWidenCondBranchToCondBranch</a></div><div class="ttdeci">static bool tryWidenCondBranchToCondBranch(BranchInst *PBI, BranchInst *BI, DomTreeUpdater *DTU)</div><div class="ttdoc">If the previous block ended with a widenable branch, determine if reusing the target block is profita...</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l04150">SimplifyCFG.cpp:4150</a></div></div>
<div class="ttc" id="anamespacellvm_html_aa82bb12b2879425012b3742487e10964"><div class="ttname"><a href="namespacellvm.html#aa82bb12b2879425012b3742487e10964">llvm::erase_value</a></div><div class="ttdeci">void erase_value(Container &amp;C, ValueType V)</div><div class="ttdoc">Wrapper function to remove a value from a container:</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l02006">STLExtras.h:2006</a></div></div>
<div class="ttc" id="aType_8h_html"><div class="ttname"><a href="Type_8h.html">Type.h</a></div></div>
<div class="ttc" id="aBranchProbability_8h_html"><div class="ttname"><a href="BranchProbability_8h.html">BranchProbability.h</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a51d993ac59a51760ec7a9c7a1738755a"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a51d993ac59a51760ec7a9c7a1738755a">PHINodeFoldingThreshold</a></div><div class="ttdeci">static cl::opt&lt; unsigned &gt; PHINodeFoldingThreshold(&quot;phi-node-folding-threshold&quot;, cl::Hidden, cl::init(2), cl::desc(&quot;Control the amount of phi node folding to perform (default = 2)&quot;))</div></div>
<div class="ttc" id="anamespacellvm_html_add2fce2ce0e32b20e41b0aa9f8ca70c2"><div class="ttname"><a href="namespacellvm.html#add2fce2ce0e32b20e41b0aa9f8ca70c2">llvm::hasBranchWeightMD</a></div><div class="ttdeci">bool hasBranchWeightMD(const Instruction &amp;I)</div><div class="ttdoc">Checks if an instructions has Branch Weight Metadata.</div><div class="ttdef"><b>Definition:</b> <a href="ProfDataUtils_8cpp_source.html#l00099">ProfDataUtils.cpp:99</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ae22f493ba8327ce92e87d3b96bce7017"><div class="ttname"><a href="classllvm_1_1Instruction.html#ae22f493ba8327ce92e87d3b96bce7017">llvm::Instruction::getMetadata</a></div><div class="ttdeci">MDNode * getMetadata(unsigned KindID) const</div><div class="ttdoc">Get the metadata of given kind attached to this Instruction.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00275">Instruction.h:275</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_abd2252fac0a4e2ca5270c2ecbfcd3de2"><div class="ttname"><a href="SimplifyCFG_8cpp.html#abd2252fac0a4e2ca5270c2ecbfcd3de2">MaxSmallBlockSize</a></div><div class="ttdeci">static cl::opt&lt; int &gt; MaxSmallBlockSize(&quot;simplifycfg-max-small-block-size&quot;, cl::Hidden, cl::init(10), cl::desc(&quot;Max size of a block which is still considered &quot; &quot;small enough to thread through&quot;))</div></div>
<div class="ttc" id="aIR_2CFG_8h_html"><div class="ttname"><a href="IR_2CFG_8h.html">CFG.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1dxil_1_1PointerTypeAnalysis_html_ae574a4c1d84b9e67bc94489f356805b4"><div class="ttname"><a href="namespacellvm_1_1dxil_1_1PointerTypeAnalysis.html#ae574a4c1d84b9e67bc94489f356805b4">llvm::dxil::PointerTypeAnalysis::run</a></div><div class="ttdeci">PointerTypeMap run(const Module &amp;M)</div><div class="ttdoc">Compute the PointerTypeMap for the module M.</div><div class="ttdef"><b>Definition:</b> <a href="PointerTypeAnalysis_8cpp_source.html#l00189">PointerTypeAnalysis.cpp:189</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a2ced9ed2427730cd9b6903f00cd22e4d"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a2ced9ed2427730cd9b6903f00cd22e4d">isSafeToSpeculateStore</a></div><div class="ttdeci">static Value * isSafeToSpeculateStore(Instruction *I, BasicBlock *BrBB, BasicBlock *StoreBB, BasicBlock *EndBB)</div><div class="ttdoc">Determine if we can hoist sink a sole store instruction out of a conditional block.</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l02702">SimplifyCFG.cpp:2702</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a03a2d451a241c934af3405a7cfc8adb4"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a03a2d451a241c934af3405a7cfc8adb4">BlockIsSimpleEnoughToThreadThrough</a></div><div class="ttdeci">static bool BlockIsSimpleEnoughToThreadThrough(BasicBlock *BB)</div><div class="ttdoc">Return true if we can thread a branch across this block.</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03086">SimplifyCFG.cpp:3086</a></div></div>
<div class="ttc" id="aclassllvm_1_1BranchInst_html_aac456a62894c9f0f8e9f06373bbf40f0"><div class="ttname"><a href="classllvm_1_1BranchInst.html#aac456a62894c9f0f8e9f06373bbf40f0">llvm::BranchInst::getCondition</a></div><div class="ttdeci">Value * getCondition() const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03220">Instructions.h:3220</a></div></div>
<div class="ttc" id="aADT_2tmp_8txt_html_a07ed0bfaa124c15897944fe3eaa971ab"><div class="ttname"><a href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a></div><div class="ttdeci">Class for arbitrary precision integers APInt is a functional replacement for common case unsigned integer type like unsigned long or uint64_t</div><div class="ttdef"><b>Definition:</b> <a href="ADT_2tmp_8txt_source.html#l00001">tmp.txt:1</a></div></div>
<div class="ttc" id="aclassllvm_1_1InvokeInst_html"><div class="ttname"><a href="classllvm_1_1InvokeInst.html">llvm::InvokeInst</a></div><div class="ttdoc">Invoke instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03814">Instructions.h:3814</a></div></div>
<div class="ttc" id="anamespacellvm_html_a1a5751a2dd7306ff9a59eae6c1de8925"><div class="ttname"><a href="namespacellvm.html#a1a5751a2dd7306ff9a59eae6c1de8925">llvm::GetIfCondition</a></div><div class="ttdeci">BranchInst * GetIfCondition(BasicBlock *BB, BasicBlock *&amp;IfTrue, BasicBlock *&amp;IfFalse)</div><div class="ttdoc">Check whether BB is the merge point of a if-region.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l01602">BasicBlockUtils.cpp:1602</a></div></div>
<div class="ttc" id="anamespacellvm_html_acb22fb04083152eee862457e42e8dc31"><div class="ttname"><a href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">llvm::predecessors</a></div><div class="ttdeci">auto predecessors(const MachineBasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l01266">MachineBasicBlock.h:1266</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html"><div class="ttname"><a href="classllvm_1_1CmpInst.html">llvm::CmpInst</a></div><div class="ttdoc">This class is the base class for the comparison instructions.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00708">InstrTypes.h:708</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_ac6d28a9b11139182134a9618028a0d07"><div class="ttname"><a href="classllvm_1_1Type.html#ac6d28a9b11139182134a9618028a0d07">llvm::Type::isIntegerTy</a></div><div class="ttdeci">bool isIntegerTy() const</div><div class="ttdoc">True if this is an instance of IntegerType.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00222">Type.h:222</a></div></div>
<div class="ttc" id="anamespacellvm_html_a74cdbd1e4f731e7d7cd83461b8b1de0b"><div class="ttname"><a href="namespacellvm.html#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a></div><div class="ttdeci">void sort(IteratorTy Start, IteratorTy End)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01683">STLExtras.h:1683</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a650b03916ebf8e695751b1246cd6de0e"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a650b03916ebf8e695751b1246cd6de0e">IncomingValuesAreCompatible</a></div><div class="ttdeci">static bool IncomingValuesAreCompatible(BasicBlock *BB, ArrayRef&lt; BasicBlock * &gt; IncomingBlocks, SmallPtrSetImpl&lt; Value * &gt; *EquivalenceSet=nullptr)</div><div class="ttdoc">Return true if all the PHI nodes in the basic block BB receive compatible (identical) incoming values...</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00316">SimplifyCFG.cpp:316</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_acfae9bdee6027ffa8ffe244cc22e3a76"><div class="ttname"><a href="classllvm_1_1APInt.html#acfae9bdee6027ffa8ffe244cc22e3a76">llvm::APInt::isSubsetOf</a></div><div class="ttdeci">bool isSubsetOf(const APInt &amp;RHS) const</div><div class="ttdoc">This operation checks that all bits set in this APInt are also set in RHS.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01235">APInt.h:1235</a></div></div>
<div class="ttc" id="aclassllvm_1_1MDNode_html_a6cbc0453586a25c057a32161b38b8ce4"><div class="ttname"><a href="classllvm_1_1MDNode.html#a6cbc0453586a25c057a32161b38b8ce4">llvm::MDNode::getOperand</a></div><div class="ttdeci">const MDOperand &amp; getOperand(unsigned I) const</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8h_source.html#l01291">Metadata.h:1291</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_ab9f16e33daaafda2df2c0c79afe72e3e"><div class="ttname"><a href="SimplifyCFG_8cpp.html#ab9f16e33daaafda2df2c0c79afe72e3e">canSinkInstructions</a></div><div class="ttdeci">static bool canSinkInstructions(ArrayRef&lt; Instruction * &gt; Insts, DenseMap&lt; Instruction *, SmallVector&lt; Value *, 4 &gt;&gt; &amp;PHIOperands)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01790">SimplifyCFG.cpp:1790</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImplBase_html_af8a50544090e81ac83601aff8f4b0142"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImplBase.html#af8a50544090e81ac83601aff8f4b0142">llvm::SmallPtrSetImplBase::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00092">SmallPtrSet.h:92</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a4ea9acbe7fd20332ea6ccdb0183d6395"><div class="ttname"><a href="classllvm_1_1Instruction.html#a4ea9acbe7fd20332ea6ccdb0183d6395">llvm::Instruction::andIRFlags</a></div><div class="ttdeci">void andIRFlags(const Value *V)</div><div class="ttdoc">Logical 'and' of any supported wrapping, exact, and fast-math flags of V and this instruction.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00372">Instruction.cpp:372</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_ade535503b3e25a50c34919be8081e6f3"><div class="ttname"><a href="SimplifyCFG_8cpp.html#ade535503b3e25a50c34919be8081e6f3">reuseTableCompare</a></div><div class="ttdeci">static void reuseTableCompare(User *PhiUser, BasicBlock *PhiBlock, BranchInst *RangeCheckBranch, Constant *DefaultValue, const SmallVectorImpl&lt; std::pair&lt; ConstantInt *, Constant * &gt;&gt; &amp;Values)</div><div class="ttdoc">Try to reuse the switch table index compare.</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l06320">SimplifyCFG.cpp:6320</a></div></div>
<div class="ttc" id="astructllvm_1_1SmallMapVector_html"><div class="ttname"><a href="structllvm_1_1SmallMapVector.html">llvm::SmallMapVector</a></div><div class="ttdoc">A MapVector that performs no allocations if smaller than a certain size.</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00233">MapVector.h:233</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a18dbfcb332af7515599ee795cf462843"><div class="ttname"><a href="classllvm_1_1Value.html#a18dbfcb332af7515599ee795cf462843">llvm::Value::Value</a></div><div class="ttdeci">Value(Type *Ty, unsigned scid)</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00052">Value.cpp:52</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a315f26c899f5ea8a780db4740ba95ef4"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a315f26c899f5ea8a780db4740ba95ef4">llvm::BasicBlock::hasAddressTaken</a></div><div class="ttdeci">bool hasAddressTaken() const</div><div class="ttdoc">Returns true if there are any uses of this basic block other than direct branches,...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00495">BasicBlock.h:495</a></div></div>
<div class="ttc" id="aclassllvm_1_1Use_html_a40360b4fa7b8e6920a68e5a8a0814f1f"><div class="ttname"><a href="classllvm_1_1Use.html#a40360b4fa7b8e6920a68e5a8a0814f1f">llvm::Use::set</a></div><div class="ttdeci">void set(Value *Val)</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00865">Value.h:865</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a1a5189be752e56bf8343fd72f45720ee"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a1a5189be752e56bf8343fd72f45720ee">mergeConditionalStoreToAddress</a></div><div class="ttdeci">static bool mergeConditionalStoreToAddress(BasicBlock *PTB, BasicBlock *PFB, BasicBlock *QTB, BasicBlock *QFB, BasicBlock *PostBB, Value *Address, bool InvertPCond, bool InvertQCond, DomTreeUpdater *DTU, const DataLayout &amp;DL, const TargetTransformInfo &amp;TTI)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03894">SimplifyCFG.cpp:3894</a></div></div>
<div class="ttc" id="aBasicBlock_8h_html"><div class="ttname"><a href="BasicBlock_8h.html">BasicBlock.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1cl_1_1opt_html"><div class="ttname"><a href="classllvm_1_1cl_1_1opt.html">llvm::cl::opt&lt; bool &gt;</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_adafa9575780f9246d1df0b7e2a619356"><div class="ttname"><a href="classllvm_1_1APInt.html#adafa9575780f9246d1df0b7e2a619356">llvm::APInt::slt</a></div><div class="ttdeci">bool slt(const APInt &amp;RHS) const</div><div class="ttdoc">Signed less than comparison.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01108">APInt.h:1108</a></div></div>
<div class="ttc" id="anamespacellvm_html_a67474fe1bb82a093f3ad2e9ad2d7f7c4"><div class="ttname"><a href="namespacellvm.html#a67474fe1bb82a093f3ad2e9ad2d7f7c4">llvm::TryToSimplifyUncondBranchFromEmptyBlock</a></div><div class="ttdeci">bool TryToSimplifyUncondBranchFromEmptyBlock(BasicBlock *BB, DomTreeUpdater *DTU=nullptr)</div><div class="ttdoc">BB is known to contain an unconditional branch, and contains no instructions other than PHI nodes,...</div><div class="ttdef"><b>Definition:</b> <a href="Transforms_2Utils_2Local_8cpp_source.html#l01070">Local.cpp:1070</a></div></div>
<div class="ttc" id="anamespacellvm_1_1RISCVFenceField_html_a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb"><div class="ttname"><a href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">llvm::RISCVFenceField::O</a></div><div class="ttdeci">@ O</div><div class="ttdef"><b>Definition:</b> <a href="RISCVBaseInfo_8h_source.html#l00277">RISCVBaseInfo.h:277</a></div></div>
<div class="ttc" id="aclassllvm_1_1CleanupPadInst_html"><div class="ttname"><a href="classllvm_1_1CleanupPadInst.html">llvm::CleanupPadInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l04491">Instructions.h:4491</a></div></div>
<div class="ttc" id="aclassllvm_1_1StoreInst_html"><div class="ttname"><a href="classllvm_1_1StoreInst.html">llvm::StoreInst</a></div><div class="ttdoc">An instruction for storing to memory.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00301">Instructions.h:301</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantRange_html_aaaa2f5e2c6c3122d2b484f9e50950e18"><div class="ttname"><a href="classllvm_1_1ConstantRange.html#aaaa2f5e2c6c3122d2b484f9e50950e18">llvm::ConstantRange::inverse</a></div><div class="ttdeci">ConstantRange inverse() const</div><div class="ttdoc">Return a new range that is the logical not of the current set.</div><div class="ttdef"><b>Definition:</b> <a href="ConstantRange_8cpp_source.html#l01620">ConstantRange.cpp:1620</a></div></div>
<div class="ttc" id="aclassllvm_1_1Constant_html"><div class="ttname"><a href="classllvm_1_1Constant.html">llvm::Constant</a></div><div class="ttdoc">This is an important base class in LLVM.</div><div class="ttdef"><b>Definition:</b> <a href="Constant_8h_source.html#l00041">Constant.h:41</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a6e5d2e18c81baaeec7dadc81a0dea993"><div class="ttname"><a href="classllvm_1_1Instruction.html#a6e5d2e18c81baaeec7dadc81a0dea993">llvm::Instruction::getSuccessor</a></div><div class="ttdeci">BasicBlock * getSuccessor(unsigned Idx) const LLVM_READONLY</div><div class="ttdoc">Return the specified successor. This instruction must be a terminator.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00835">Instruction.cpp:835</a></div></div>
<div class="ttc" id="anamespacellvm_html_a99e12a4a954a95d45f52950d13a43fc6"><div class="ttname"><a href="namespacellvm.html#a99e12a4a954a95d45f52950d13a43fc6">llvm::countPopulation</a></div><div class="ttdeci">unsigned countPopulation(T Value)</div><div class="ttdoc">Count the number of set bits in a value.</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00336">MathExtras.h:336</a></div></div>
<div class="ttc" id="aclassllvm_1_1IRBuilderBase_html_a4e5c1b91bf5e2860398e3fa35c96b5af"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html#a4e5c1b91bf5e2860398e3fa35c96b5af">llvm::IRBuilderBase::GetInsertPoint</a></div><div class="ttdeci">BasicBlock::iterator GetInsertPoint() const</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00175">IRBuilder.h:175</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ae6b978645b8ac72d1a35e1298ffdd4f0"><div class="ttname"><a href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">llvm::Instruction::eraseFromParent</a></div><div class="ttdeci">SymbolTableList&lt; Instruction &gt;::iterator eraseFromParent()</div><div class="ttdoc">This method unlinks 'this' from the containing basic block and deletes it.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00082">Instruction.cpp:82</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a265e334c170d96e5cbcf8b420db520d4"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a265e334c170d96e5cbcf8b420db520d4">llvm::TargetTransformInfo::shouldBuildLookupTablesForConstant</a></div><div class="ttdeci">bool shouldBuildLookupTablesForConstant(Constant *C) const</div><div class="ttdoc">Return true if switches should be turned into lookup tables containing this constant value for the ta...</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00510">TargetTransformInfo.cpp:510</a></div></div>
<div class="ttc" id="aclassllvm_1_1ICmpInst_html"><div class="ttname"><a href="classllvm_1_1ICmpInst.html">llvm::ICmpInst</a></div><div class="ttdoc">This instruction compares its operands according to the predicate given to the constructor.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01197">Instructions.h:1197</a></div></div>
<div class="ttc" id="aclassllvm_1_1SwitchInst_html_a7e4fa2ce7bf583ac03ea538642067fe9"><div class="ttname"><a href="classllvm_1_1SwitchInst.html#a7e4fa2ce7bf583ac03ea538642067fe9">llvm::SwitchInst::getSuccessor</a></div><div class="ttdeci">BasicBlock * getSuccessor(unsigned idx) const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03605">Instructions.h:3605</a></div></div>
<div class="ttc" id="anamespacellvm_html_ab1772fd431decccb7926d484ea223db7"><div class="ttname"><a href="namespacellvm.html#ab1772fd431decccb7926d484ea223db7">llvm::count</a></div><div class="ttdeci">auto count(R &amp;&amp;Range, const E &amp;Element)</div><div class="ttdoc">Wrapper function around std::count to count the number of times an element Element occurs in the give...</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01896">STLExtras.h:1896</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a8750c95762a282001cd60e0e922b2c67"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a8750c95762a282001cd60e0e922b2c67">FoldCondBranchOnValueKnownInPredecessorImpl</a></div><div class="ttdeci">static std::optional&lt; bool &gt; FoldCondBranchOnValueKnownInPredecessorImpl(BranchInst *BI, DomTreeUpdater *DTU, const DataLayout &amp;DL, AssumptionCache *AC)</div><div class="ttdoc">If we have a conditional branch on something for which we know the constant value in predecessors (e....</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03142">SimplifyCFG.cpp:3142</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a1a06b1cff93069d7403ea03e6150e386"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a1a06b1cff93069d7403ea03e6150e386">llvm::PatternMatch::m_LogicalOr</a></div><div class="ttdeci">LogicalOp_match&lt; LHS, RHS, Instruction::Or &gt; m_LogicalOr(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdoc">Matches L || R either in the form of L | R or L ? true : R.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l02574">PatternMatch.h:2574</a></div></div>
<div class="ttc" id="aclassllvm_1_1MemorySSAUpdater_html"><div class="ttname"><a href="classllvm_1_1MemorySSAUpdater.html">llvm::MemorySSAUpdater</a></div><div class="ttdef"><b>Definition:</b> <a href="MemorySSAUpdater_8h_source.html#l00054">MemorySSAUpdater.h:54</a></div></div>
<div class="ttc" id="aclassllvm_1_1GlobalValue_html_a9e1fc23a17e97d2d1732e753ae9251ac"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">llvm::GlobalValue::getParent</a></div><div class="ttdeci">Module * getParent()</div><div class="ttdoc">Get the module that this global value is contained inside of...</div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00652">GlobalValue.h:652</a></div></div>
<div class="ttc" id="anamespacellvm_html_a086e9fbdb06276db7753101a08a63adf"><div class="ttname"><a href="namespacellvm.html#a086e9fbdb06276db7753101a08a63adf">llvm::find</a></div><div class="ttdeci">auto find(R &amp;&amp;Range, const T &amp;Val)</div><div class="ttdoc">Provide wrappers to std::find which take ranges instead of having to pass begin/end explicitly.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01755">STLExtras.h:1755</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a4953dfe289f5d9ad59a7964c4c63c2a9"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a4953dfe289f5d9ad59a7964c4c63c2a9">setBranchWeights</a></div><div class="ttdeci">static void setBranchWeights(SwitchInst *SI, ArrayRef&lt; uint32_t &gt; Weights)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00863">SimplifyCFG.cpp:863</a></div></div>
<div class="ttc" id="aclassllvm_1_1IndirectBrInst_html_ac0cc9b34e16910d245245642350d4456"><div class="ttname"><a href="classllvm_1_1IndirectBrInst.html#ac0cc9b34e16910d245245642350d4456">llvm::IndirectBrInst::removeDestination</a></div><div class="ttdeci">void removeDestination(unsigned i)</div><div class="ttdoc">This method removes the specified successor from the indirectbr instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l04756">Instructions.cpp:4756</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a2fd1d2dc14e22227cfa8238778ab87b8"><div class="ttname"><a href="classllvm_1_1Instruction.html#a2fd1d2dc14e22227cfa8238778ab87b8">llvm::Instruction::user_back</a></div><div class="ttdeci">Instruction * user_back()</div><div class="ttdoc">Specialize the methods defined in Value, as we know that an instruction can only be used by other ins...</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00087">Instruction.h:87</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a32c2973fa0babdd440d3ab7dd160664a"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a32c2973fa0babdd440d3ab7dd160664a">passingValueIsAlwaysUndefined</a></div><div class="ttdeci">static bool passingValueIsAlwaysUndefined(Value *V, Instruction *I, bool PtrValueMayBeModified=false)</div><div class="ttdoc">Check if passing a value to an instruction will cause undefined behavior.</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l07095">SimplifyCFG.cpp:7095</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_a089cccb6f231efee72abc76d0f9c695f"><div class="ttname"><a href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">llvm::PHINode::addIncoming</a></div><div class="ttdeci">void addIncoming(Value *V, BasicBlock *BB)</div><div class="ttdoc">Add an incoming value to the end of the PHI list.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02854">Instructions.h:2854</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a42569041ddafba7d40243e126af07f42"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a42569041ddafba7d40243e126af07f42">llvm::PatternMatch::m_Or</a></div><div class="ttdeci">BinaryOp_match&lt; LHS, RHS, Instruction::Or &gt; m_Or(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01099">PatternMatch.h:1099</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_ad2e3d83724bf6fb52cb43e94a467e0c6"><div class="ttname"><a href="SimplifyCFG_8cpp.html#ad2e3d83724bf6fb52cb43e94a467e0c6">MergeCompatibleInvokesImpl</a></div><div class="ttdeci">static void MergeCompatibleInvokesImpl(ArrayRef&lt; InvokeInst * &gt; Invokes, DomTreeUpdater *DTU)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l02474">SimplifyCFG.cpp:2474</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a583f07468003b1c19e8227f1c0e63fb7"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a583f07468003b1c19e8227f1c0e63fb7">isCleanupBlockEmpty</a></div><div class="ttdeci">static bool isCleanupBlockEmpty(iterator_range&lt; BasicBlock::iterator &gt; R)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l04821">SimplifyCFG.cpp:4821</a></div></div>
<div class="ttc" id="aProfDataUtils_8h_html"><div class="ttname"><a href="ProfDataUtils_8h.html">ProfDataUtils.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1LLVMContext_html"><div class="ttname"><a href="classllvm_1_1LLVMContext.html">llvm::LLVMContext</a></div><div class="ttdoc">This is an important class for using LLVM in a threaded context.</div><div class="ttdef"><b>Definition:</b> <a href="LLVMContext_8h_source.html#l00067">LLVMContext.h:67</a></div></div>
<div class="ttc" id="anamespacellvm_1_1numbers_html_a92f4283d4e0e2ea1776894b3ae93640f"><div class="ttname"><a href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">llvm::numbers::e</a></div><div class="ttdeci">constexpr double e</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00031">MathExtras.h:31</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a95851c48d68c2406ef12a7cca9c65f76"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a95851c48d68c2406ef12a7cca9c65f76">initializeUniqueCases</a></div><div class="ttdeci">static bool initializeUniqueCases(SwitchInst *SI, PHINode *&amp;PHI, BasicBlock *&amp;CommonDest, SwitchCaseResultVectorTy &amp;UniqueResults, Constant *&amp;DefaultResult, const DataLayout &amp;DL, const TargetTransformInfo &amp;TTI, uintptr_t MaxUniqueResults)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l05756">SimplifyCFG.cpp:5756</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_aec0ccdbde0581b3aae7f001634a34d8e"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#aec0ccdbde0581b3aae7f001634a34d8e">llvm::PatternMatch::m_ImmConstant</a></div><div class="ttdeci">match_combine_and&lt; class_match&lt; Constant &gt;, match_unless&lt; constantexpr_match &gt; &gt; m_ImmConstant()</div><div class="ttdoc">Match an arbitrary immediate Constant and ignore it.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00751">PatternMatch.h:751</a></div></div>
<div class="ttc" id="aclassllvm_1_1BranchInst_html_a38df51256d4b415b6a817b5e1c6d4d36"><div class="ttname"><a href="classllvm_1_1BranchInst.html#a38df51256d4b415b6a817b5e1c6d4d36">llvm::BranchInst::Create</a></div><div class="ttdeci">static BranchInst * Create(BasicBlock *IfTrue, Instruction *InsertBefore=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03195">Instructions.h:3195</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMap_html"><div class="ttname"><a href="classllvm_1_1DenseMap.html">llvm::DenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00714">DenseMap.h:714</a></div></div>
<div class="ttc" id="anamespacellvm_html_a061b224a1a3c3486fd854e5009a858c9"><div class="ttname"><a href="namespacellvm.html#a061b224a1a3c3486fd854e5009a858c9">llvm::operator&lt;</a></div><div class="ttdeci">bool operator&lt;(int64_t V1, const APSInt &amp;V2)</div><div class="ttdef"><b>Definition:</b> <a href="APSInt_8h_source.html#l00361">APSInt.h:361</a></div></div>
<div class="ttc" id="aIR_2DebugInfo_8h_html"><div class="ttname"><a href="IR_2DebugInfo_8h.html">DebugInfo.h</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00058">MD5.cpp:58</a></div></div>
<div class="ttc" id="anamespacellvm_html_a3720211f6e6389ab53734b989bfb6fce"><div class="ttname"><a href="namespacellvm.html#a3720211f6e6389ab53734b989bfb6fce">llvm::succ_begin</a></div><div class="ttdeci">Interval::succ_iterator succ_begin(Interval *I)</div><div class="ttdoc">succ_begin/succ_end - define methods so that Intervals may be used just like BasicBlocks can with the...</div><div class="ttdef"><b>Definition:</b> <a href="Interval_8h_source.html#l00099">Interval.h:99</a></div></div>
<div class="ttc" id="aclassllvm_1_1GetElementPtrInst_html"><div class="ttname"><a href="classllvm_1_1GetElementPtrInst.html">llvm::GetElementPtrInst</a></div><div class="ttdoc">an instruction for type-safe pointer arithmetic to access elements of arrays and structs</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00940">Instructions.h:940</a></div></div>
<div class="ttc" id="anamespacellvm_1_1cl_html_a10a041239ae1870cfcc064bfaa79fb65"><div class="ttname"><a href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">llvm::cl::init</a></div><div class="ttdeci">initializer&lt; Ty &gt; init(const Ty &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00445">CommandLine.h:445</a></div></div>
<div class="ttc" id="anamespacellvm_html_a8154638df88e4eaa568b67b23d463dac"><div class="ttname"><a href="namespacellvm.html#a8154638df88e4eaa568b67b23d463dac">llvm::make_early_inc_range</a></div><div class="ttdeci">iterator_range&lt; early_inc_iterator_impl&lt; detail::IterOfRange&lt; RangeT &gt; &gt; &gt; make_early_inc_range(RangeT &amp;&amp;Range)</div><div class="ttdoc">Make a range that does early increment to allow mutation of the underlying range without disrupting i...</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00721">STLExtras.h:721</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_ae9562b96f6f3fa41bd36538c080035ee"><div class="ttname"><a href="classllvm_1_1PHINode.html#ae9562b96f6f3fa41bd36538c080035ee">llvm::PHINode::getBasicBlockIndex</a></div><div class="ttdeci">int getBasicBlockIndex(const BasicBlock *BB) const</div><div class="ttdoc">Return the first index of the specified basic block in the value list for this PHI.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02882">Instructions.h:2882</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a427435d4da769ae680a8e77ef89520aa"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a427435d4da769ae680a8e77ef89520aa">llvm::PatternMatch::m_And</a></div><div class="ttdeci">BinaryOp_match&lt; LHS, RHS, Instruction::And &gt; m_And(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01093">PatternMatch.h:1093</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_a08daddd36adb2d47a22de9b6177c7110"><div class="ttname"><a href="classllvm_1_1CallBase.html#a08daddd36adb2d47a22de9b6177c7110">llvm::CallBase::cannotMerge</a></div><div class="ttdeci">bool cannotMerge() const</div><div class="ttdoc">Determine if the call cannot be tail merged.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01916">InstrTypes.h:1916</a></div></div>
<div class="ttc" id="anamespacellvm_html_acd1cd968cb420c82d70926920fcdc7d7"><div class="ttname"><a href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">llvm::is_contained</a></div><div class="ttdeci">bool is_contained(R &amp;&amp;Range, const E &amp;Element)</div><div class="ttdoc">Wrapper function around std::find to detect if an element exists in a container.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01869">STLExtras.h:1869</a></div></div>
<div class="ttc" id="anamespacellvm_html_aab02db480f387fca92956ef1c9a01941"><div class="ttname"><a href="namespacellvm.html#aab02db480f387fca92956ef1c9a01941">llvm::simplifyInstruction</a></div><div class="ttdeci">Value * simplifyInstruction(Instruction *I, const SimplifyQuery &amp;Q, OptimizationRemarkEmitter *ORE=nullptr)</div><div class="ttdoc">See if we can compute a simplified version of this instruction.</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8cpp_source.html#l06731">InstructionSimplify.cpp:6731</a></div></div>
<div class="ttc" id="aArrayRef_8h_html"><div class="ttname"><a href="ArrayRef_8h.html">ArrayRef.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1ICmpInst_html_abe8988eef2e6fc2baba032cb22afedd7"><div class="ttname"><a href="classllvm_1_1ICmpInst.html#abe8988eef2e6fc2baba032cb22afedd7">llvm::ICmpInst::isEquality</a></div><div class="ttdeci">static bool isEquality(Predicate P)</div><div class="ttdoc">Return true if this predicate is either EQ or NE.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01286">Instructions.h:1286</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ae8f5bf5cc06f696b52c709677df00fbf"><div class="ttname"><a href="classllvm_1_1Instruction.html#ae8f5bf5cc06f696b52c709677df00fbf">llvm::Instruction::setDebugLoc</a></div><div class="ttdeci">void setDebugLoc(DebugLoc Loc)</div><div class="ttdoc">Set the debug location information for this instruction.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00355">Instruction.h:355</a></div></div>
<div class="ttc" id="anamespacellvm_html_aab4d6b37c7f97bad2b1f441dc3fd43e0"><div class="ttname"><a href="namespacellvm.html#aab4d6b37c7f97bad2b1f441dc3fd43e0">llvm::hoistAllInstructionsInto</a></div><div class="ttdeci">void hoistAllInstructionsInto(BasicBlock *DomBlock, Instruction *InsertPt, BasicBlock *BB)</div><div class="ttdoc">Hoist all of the instructions in the IfBlock to the dominant block DomBlock, by moving its instructio...</div><div class="ttdef"><b>Definition:</b> <a href="Transforms_2Utils_2Local_8cpp_source.html#l02973">Local.cpp:2973</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_aef5d6c1653f6d85c8ee596904289fd94"><div class="ttname"><a href="SimplifyCFG_8cpp.html#aef5d6c1653f6d85c8ee596904289fd94">HoistCondStores</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; HoistCondStores(&quot;simplifycfg-hoist-cond-stores&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Hoist conditional stores if an unconditional store precedes&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a0c047f127ed4380a6f383d70bec4eb94"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::find</a></div><div class="ttdeci">iterator find(const_arg_type_t&lt; KeyT &gt; Val)</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00150">DenseMap.h:150</a></div></div>
<div class="ttc" id="anamespacellvm_html_aa1f8f0633edd8b9a1c5ec15bb9fc5640"><div class="ttname"><a href="namespacellvm.html#aa1f8f0633edd8b9a1c5ec15bb9fc5640">llvm::computeKnownBits</a></div><div class="ttdeci">void computeKnownBits(const Value *V, KnownBits &amp;Known, const DataLayout &amp;DL, unsigned Depth=0, AssumptionCache *AC=nullptr, const Instruction *CxtI=nullptr, const DominatorTree *DT=nullptr, OptimizationRemarkEmitter *ORE=nullptr, bool UseInstrInfo=true)</div><div class="ttdoc">Determine which bits of V are known to be either zero or one and return them in the KnownZero/KnownOn...</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l00186">ValueTracking.cpp:186</a></div></div>
<div class="ttc" id="aclassllvm_1_1BranchProbability_html_a7f41716b68c197b7cd7582d7a66201a3"><div class="ttname"><a href="classllvm_1_1BranchProbability.html#a7f41716b68c197b7cd7582d7a66201a3">llvm::BranchProbability::isUnknown</a></div><div class="ttdeci">bool isUnknown() const</div><div class="ttdef"><b>Definition:</b> <a href="BranchProbability_8h_source.html#l00047">BranchProbability.h:47</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a0ceff22bcbbcc85abecced9a3a395ccf"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a0ceff22bcbbcc85abecced9a3a395ccf">removeSwitchAfterSelectFold</a></div><div class="ttdeci">static void removeSwitchAfterSelectFold(SwitchInst *SI, PHINode *PHI, Value *SelectValue, IRBuilder&lt;&gt; &amp;Builder, DomTreeUpdater *DTU)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l05889">SimplifyCFG.cpp:5889</a></div></div>
<div class="ttc" id="aclassllvm_1_1IndirectBrInst_html_a45656d5a2f380720a7618495fceed01e"><div class="ttname"><a href="classllvm_1_1IndirectBrInst.html#a45656d5a2f380720a7618495fceed01e">llvm::IndirectBrInst::getDestination</a></div><div class="ttdeci">BasicBlock * getDestination(unsigned i)</div><div class="ttdoc">Return the specified destination.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03763">Instructions.h:3763</a></div></div>
<div class="ttc" id="aclassllvm_1_1ilist__node__with__parent_html_ae451867ac0034a201153b54cc466386d"><div class="ttname"><a href="classllvm_1_1ilist__node__with__parent.html#ae451867ac0034a201153b54cc466386d">llvm::ilist_node_with_parent::getPrevNode</a></div><div class="ttdeci">NodeTy * getPrevNode()</div><div class="ttdef"><b>Definition:</b> <a href="ilist__node_8h_source.html#l00275">ilist_node.h:275</a></div></div>
<div class="ttc" id="aIRBuilder_8h_html"><div class="ttname"><a href="IRBuilder_8h.html">IRBuilder.h</a></div></div>
<div class="ttc" id="aSILowerControlFlow_8cpp_html_a4868c5d81c5ccc98c47aeab6244346a0"><div class="ttname"><a href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a></div><div class="ttdeci">assert(ImpDefSCC.getReg()==AMDGPU::SCC &amp;&amp;ImpDefSCC.isDef())</div></div>
<div class="ttc" id="anamespacellvm_html_a9b64313b5c1907066b7bab1c60a2ea08"><div class="ttname"><a href="namespacellvm.html#a9b64313b5c1907066b7bab1c60a2ea08">llvm::drop_end</a></div><div class="ttdeci">auto drop_end(T &amp;&amp;RangeOrContainer, size_t N=1)</div><div class="ttdoc">Return a range covering RangeOrContainer with the last N elements excluded.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00393">STLExtras.h:393</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a176b027b36f2084a7d30439522a86b79"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a176b027b36f2084a7d30439522a86b79">SafeToMergeTerminators</a></div><div class="ttdeci">static bool SafeToMergeTerminators(Instruction *SI1, Instruction *SI2, SmallSetVector&lt; BasicBlock *, 4 &gt; *FailBlocks=nullptr)</div><div class="ttdoc">Return true if it is safe to merge these two terminator instructions together.</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00340">SimplifyCFG.cpp:340</a></div></div>
<div class="ttc" id="anamespacestd_html_ab8424022895aee3e366fb9a32f2883cb"><div class="ttname"><a href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a></div><div class="ttdeci">void swap(llvm::BitVector &amp;LHS, llvm::BitVector &amp;RHS)</div><div class="ttdoc">Implement std::swap in terms of BitVector swap.</div><div class="ttdef"><b>Definition:</b> <a href="BitVector_8h_source.html#l00853">BitVector.h:853</a></div></div>
<div class="ttc" id="aInstructionSimplify_8cpp_html_adb39181b87dffcd61082d08e02bf314e"><div class="ttname"><a href="InstructionSimplify_8cpp.html#adb39181b87dffcd61082d08e02bf314e">getFalse</a></div><div class="ttdeci">static Constant * getFalse(Type *Ty)</div><div class="ttdoc">For a boolean type or a vector of boolean type, return false or a vector with every element false.</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8cpp_source.html#l00122">InstructionSimplify.cpp:122</a></div></div>
<div class="ttc" id="aclassllvm_1_1DomTreeUpdater_html_a3bcb0f3fbf8288edc31eb9d80c2770ae"><div class="ttname"><a href="classllvm_1_1DomTreeUpdater.html#a3bcb0f3fbf8288edc31eb9d80c2770ae">llvm::DomTreeUpdater::hasPostDomTree</a></div><div class="ttdeci">bool hasPostDomTree() const</div><div class="ttdoc">Returns true if it holds a PostDominatorTree.</div><div class="ttdef"><b>Definition:</b> <a href="DomTreeUpdater_8h_source.html#l00060">DomTreeUpdater.h:60</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a9a167f91db810097d281b1ed627f4575"><div class="ttname"><a href="classllvm_1_1Instruction.html#a9a167f91db810097d281b1ed627f4575">llvm::Instruction::getFastMathFlags</a></div><div class="ttdeci">FastMathFlags getFastMathFlags() const LLVM_READONLY</div><div class="ttdoc">Convenience function for getting all the fast-math flags, which must be an operator which supports th...</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00339">Instruction.cpp:339</a></div></div>
<div class="ttc" id="aTargetLibraryInfo_8cpp_html_aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053"><div class="ttname"><a href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a></div><div class="ttdeci">@ Ptr</div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8cpp_source.html#l00062">TargetLibraryInfo.cpp:62</a></div></div>
<div class="ttc" id="aclassllvm_1_1SelectInst_html"><div class="ttname"><a href="classllvm_1_1SelectInst.html">llvm::SelectInst</a></div><div class="ttdoc">This class represents the LLVM 'select' instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01746">Instructions.h:1746</a></div></div>
<div class="ttc" id="anamespacellvm_html_aa0d69e81725c10fa5407f0bf34462068"><div class="ttname"><a href="namespacellvm.html#aa0d69e81725c10fa5407f0bf34462068">llvm::TTI</a></div><div class="ttdeci">TargetTransformInfo TTI</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00191">TargetTransformInfo.h:191</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_ab0f1f74f779f0c7d4247276585eb8eca"><div class="ttname"><a href="SimplifyCFG_8cpp.html#ab0f1f74f779f0c7d4247276585eb8eca">ensureValueAvailableInSuccessor</a></div><div class="ttdeci">static Value * ensureValueAvailableInSuccessor(Value *V, BasicBlock *BB, Value *AlternativeV=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03845">SimplifyCFG.cpp:3845</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a3e42eb8e250f1bfc825a58cbd042342d"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a3e42eb8e250f1bfc825a58cbd042342d">getCaseResults</a></div><div class="ttdeci">static bool getCaseResults(SwitchInst *SI, ConstantInt *CaseVal, BasicBlock *CaseDest, BasicBlock **CommonDest, SmallVectorImpl&lt; std::pair&lt; PHINode *, Constant * &gt;&gt; &amp;Res, const DataLayout &amp;DL, const TargetTransformInfo &amp;TTI)</div><div class="ttdoc">Try to determine the resulting constant values in phi nodes at the common destination basic block,...</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l05667">SimplifyCFG.cpp:5667</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_af21f61086e696a788f549768fdc26a93"><div class="ttname"><a href="classllvm_1_1Value.html#af21f61086e696a788f549768fdc26a93">llvm::Value::user_empty</a></div><div class="ttdeci">bool user_empty() const</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00385">Value.h:385</a></div></div>
<div class="ttc" id="aclassllvm_1_1AssumptionCache_html_a7f02822253b078960693acc2f30d4817"><div class="ttname"><a href="classllvm_1_1AssumptionCache.html#a7f02822253b078960693acc2f30d4817">llvm::AssumptionCache::registerAssumption</a></div><div class="ttdeci">void registerAssumption(CondGuardInst *CI)</div><div class="ttdoc">Add an @llvm.assume intrinsic to this function's cache.</div><div class="ttdef"><b>Definition:</b> <a href="AssumptionCache_8cpp_source.html#l00231">AssumptionCache.cpp:231</a></div></div>
<div class="ttc" id="aclassllvm_1_1MutableArrayRef_html_aae2bf8b46988a2fc0589e95903930c19"><div class="ttname"><a href="classllvm_1_1MutableArrayRef.html#aae2bf8b46988a2fc0589e95903930c19">llvm::MutableArrayRef::begin</a></div><div class="ttdeci">iterator begin() const</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00354">ArrayRef.h:354</a></div></div>
<div class="ttc" id="aclassllvm_1_1Module_html"><div class="ttname"><a href="classllvm_1_1Module.html">llvm::Module</a></div><div class="ttdoc">A Module instance is used to store all the information related to an LLVM module.</div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00065">Module.h:65</a></div></div>
<div class="ttc" id="aclassllvm_1_1MDNode_html"><div class="ttname"><a href="classllvm_1_1MDNode.html">llvm::MDNode</a></div><div class="ttdoc">Metadata node.</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8h_source.html#l00943">Metadata.h:943</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a2c4138bcbe89707f75ab7bc7717e377f"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a2c4138bcbe89707f75ab7bc7717e377f">TwoEntryPHINodeFoldingThreshold</a></div><div class="ttdeci">static cl::opt&lt; unsigned &gt; TwoEntryPHINodeFoldingThreshold(&quot;two-entry-phi-node-folding-threshold&quot;, cl::Hidden, cl::init(4), cl::desc(&quot;Control the maximal total instruction cost that we are willing &quot; &quot;to speculatively execute to fold a 2-entry PHI node into a &quot; &quot;select (default = 4)&quot;))</div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a95d324dd1b821acc61ba55ec642796c4"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a95d324dd1b821acc61ba55ec642796c4">MaxSwitchCasesPerResult</a></div><div class="ttdeci">static cl::opt&lt; unsigned &gt; MaxSwitchCasesPerResult(&quot;max-switch-cases-per-result&quot;, cl::Hidden, cl::init(16), cl::desc(&quot;Limit cases to analyze when converting a switch to select&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImpl_html_a1f475b0df44ebd7169e720fa1bf9169e"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#a1f475b0df44ebd7169e720fa1bf9169e">llvm::SmallPtrSetImpl::count</a></div><div class="ttdeci">size_type count(ConstPtrType Ptr) const</div><div class="ttdoc">count - Return 1 if the specified pointer is in the set, 0 otherwise.</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00383">SmallPtrSet.h:383</a></div></div>
<div class="ttc" id="anamespacellvm_html_ac2a5d254b5ec303b4d47ac3f0f578f09"><div class="ttname"><a href="namespacellvm.html#ac2a5d254b5ec303b4d47ac3f0f578f09">llvm::simplifyCFG</a></div><div class="ttdeci">bool simplifyCFG(BasicBlock *BB, const TargetTransformInfo &amp;TTI, DomTreeUpdater *DTU=nullptr, const SimplifyCFGOptions &amp;Options={}, ArrayRef&lt; WeakVH &gt; LoopHeaders={})</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l07335">SimplifyCFG.cpp:7335</a></div></div>
<div class="ttc" id="aAssumeBundleBuilder_8cpp_html_afb136e0532bcaed86521b462e6538d62"><div class="ttname"><a href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a></div><div class="ttdeci">assume Assume Builder</div><div class="ttdef"><b>Definition:</b> <a href="AssumeBundleBuilder_8cpp_source.html#l00651">AssumeBundleBuilder.cpp:651</a></div></div>
<div class="ttc" id="aclassllvm_1_1BranchInst_html_ad56f6a9b5cd05940017c4544df48bc30"><div class="ttname"><a href="classllvm_1_1BranchInst.html#ad56f6a9b5cd05940017c4544df48bc30">llvm::BranchInst::isUnconditional</a></div><div class="ttdeci">bool isUnconditional() const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03217">Instructions.h:3217</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a24bca8838396aa81b87de8e7ac774b19"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">llvm::PatternMatch::m_Value</a></div><div class="ttdeci">class_match&lt; Value &gt; m_Value()</div><div class="ttdoc">Match an arbitrary value and ignore it.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00076">PatternMatch.h:76</a></div></div>
<div class="ttc" id="aHexagonMCCodeEmitter_8cpp_html_ae4dfd7b0d66121016d6466d2ff10e8ba"><div class="ttname"><a href="HexagonMCCodeEmitter_8cpp.html#ae4dfd7b0d66121016d6466d2ff10e8ba">_</a></div><div class="ttdeci">#define _</div><div class="ttdef"><b>Definition:</b> <a href="HexagonMCCodeEmitter_8cpp_source.html#l00047">HexagonMCCodeEmitter.cpp:47</a></div></div>
<div class="ttc" id="anamespacellvm_html_a4d812a2dd18aa186c164447e20e348e7"><div class="ttname"><a href="namespacellvm.html#a4d812a2dd18aa186c164447e20e348e7">llvm::operator==</a></div><div class="ttdeci">bool operator==(const AddressRangeValuePair &amp;LHS, const AddressRangeValuePair &amp;RHS)</div><div class="ttdef"><b>Definition:</b> <a href="AddressRanges_8h_source.html#l00153">AddressRanges.h:153</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html"><div class="ttname"><a href="classllvm_1_1APInt.html">llvm::APInt</a></div><div class="ttdoc">Class for arbitrary precision integers.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00075">APInt.h:75</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_a5fa9b8e1842b354f64c1ba6be0a4a17f"><div class="ttname"><a href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">llvm::User::setOperand</a></div><div class="ttdeci">void setOperand(unsigned i, Value *Val)</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00174">User.h:174</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_a72d928b7fc2c5f2d56c6ac0265fd9c6e"><div class="ttname"><a href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">llvm::SetVector&lt; T, SmallVector&lt; T, N &gt;, SmallDenseSet&lt; T, N &gt; &gt;::insert</a></div><div class="ttdeci">bool insert(const value_type &amp;X)</div><div class="ttdoc">Insert a new element into the SetVector.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00141">SetVector.h:141</a></div></div>
<div class="ttc" id="aM68kELFObjectWriter_8cpp_html_ae4a8bc3879d2282eefd72b16b12c2a37"><div class="ttname"><a href="M68kELFObjectWriter_8cpp.html#ae4a8bc3879d2282eefd72b16b12c2a37">getType</a></div><div class="ttdeci">static M68kRelType getType(unsigned Kind, MCSymbolRefExpr::VariantKind &amp;Modifier, bool &amp;IsPCRel)</div><div class="ttdef"><b>Definition:</b> <a href="M68kELFObjectWriter_8cpp_source.html#l00048">M68kELFObjectWriter.cpp:48</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_ac62778065b99372cc62cf994b967e7e8"><div class="ttname"><a href="classllvm_1_1CallBase.html#ac62778065b99372cc62cf994b967e7e8">llvm::CallBase::getIntrinsicID</a></div><div class="ttdeci">Intrinsic::ID getIntrinsicID() const</div><div class="ttdoc">Returns the intrinsic ID of the intrinsic called or Intrinsic::not_intrinsic if the called function i...</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l00322">Instructions.cpp:322</a></div></div>
<div class="ttc" id="anamespacellvm_html_a72278be77e997abc4b0dbde1be280006"><div class="ttname"><a href="namespacellvm.html#a72278be77e997abc4b0dbde1be280006">llvm::ConstantFoldInstOperands</a></div><div class="ttdeci">Constant * ConstantFoldInstOperands(Instruction *I, ArrayRef&lt; Constant * &gt; Ops, const DataLayout &amp;DL, const TargetLibraryInfo *TLI=nullptr)</div><div class="ttdoc">ConstantFoldInstOperands - Attempt to constant fold an instruction with the specified operands.</div><div class="ttdef"><b>Definition:</b> <a href="ConstantFolding_8cpp_source.html#l01209">ConstantFolding.cpp:1209</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a72d0db08ead54facf3e1e90aaae435baa9b3138aebe4b75a1d2cf58ca3b2aaa9e"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a72d0db08ead54facf3e1e90aaae435baa9b3138aebe4b75a1d2cf58ca3b2aaa9e">SkipSideEffect</a></div><div class="ttdeci">@ SkipSideEffect</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01438">SimplifyCFG.cpp:1438</a></div></div>
<div class="ttc" id="aRelocation_8txt_html_a6837a23f15afcf10e8fbee3970ab6e9a"><div class="ttname"><a href="Relocation_8txt.html#a6837a23f15afcf10e8fbee3970ab6e9a">ConstantPool</a></div><div class="ttdeci">MIPS Relocation Principles In there are several elements of the llvm::ISD::NodeType enum that deal with addresses and or relocations These are defined in include llvm Target TargetSelectionDAG td ConstantPool</div><div class="ttdef"><b>Definition:</b> <a href="Relocation_8txt_source.html#l00006">Relocation.txt:6</a></div></div>
<div class="ttc" id="aclassllvm_1_1BlockAddress_html"><div class="ttname"><a href="classllvm_1_1BlockAddress.html">llvm::BlockAddress</a></div><div class="ttdoc">The address of a basic block.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00875">Constants.h:875</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a0a4d51e372293abe5e5f6dac133e80a6"><div class="ttname"><a href="classllvm_1_1Instruction.html#a0a4d51e372293abe5e5f6dac133e80a6">llvm::Instruction::clone</a></div><div class="ttdeci">Instruction * clone() const</div><div class="ttdoc">Create a copy of 'this' instruction that is identical in all ways except the following:</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00903">Instruction.cpp:903</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a7c6e64e4a4dbba951d47fe2b1d188b2c"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a7c6e64e4a4dbba951d47fe2b1d188b2c">isSwitchDense</a></div><div class="ttdeci">static bool isSwitchDense(uint64_t NumCases, uint64_t CaseRange)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l06219">SimplifyCFG.cpp:6219</a></div></div>
<div class="ttc" id="anamespacellvm_html_a2366b4a30c90d2207626fb717dfb778d"><div class="ttname"><a href="namespacellvm.html#a2366b4a30c90d2207626fb717dfb778d">llvm::operator*</a></div><div class="ttdeci">APInt operator*(APInt a, uint64_t RHS)</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l02162">APInt.h:2162</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_af5e7905012a683fe2ec8c51c2cd26ca9"><div class="ttname"><a href="classllvm_1_1Instruction.html#af5e7905012a683fe2ec8c51c2cd26ca9">llvm::Instruction::dropUndefImplyingAttrsAndUnknownMetadata</a></div><div class="ttdeci">void dropUndefImplyingAttrsAndUnknownMetadata(ArrayRef&lt; unsigned &gt; KnownIDs={})</div><div class="ttdoc">This function drops non-debug unknown metadata (through dropUnknownNonDebugMetadata).</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00226">Instruction.cpp:226</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a41a075ef4b76f72591e86e1fe13f096d"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a41a075ef4b76f72591e86e1fe13f096d">AddPredecessorToBlock</a></div><div class="ttdeci">static void AddPredecessorToBlock(BasicBlock *Succ, BasicBlock *NewPred, BasicBlock *ExistPred, MemorySSAUpdater *MSSAU=nullptr)</div><div class="ttdoc">Update PHI nodes in Succ to indicate that there will now be entries in it from the 'NewPred' block.</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00372">SimplifyCFG.cpp:372</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_aa254de6a643d4e97c3a9930f360a4987"><div class="ttname"><a href="SimplifyCFG_8cpp.html#aa254de6a643d4e97c3a9930f360a4987">HoistCommon</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; HoistCommon(&quot;simplifycfg-hoist-common&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Hoist common instructions up to the parent block&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html"><div class="ttname"><a href="classllvm_1_1ArrayRef.html">llvm::ArrayRef</a></div><div class="ttdoc">ArrayRef - Represent a constant reference to an array (0 or more elements consecutively in memory),...</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00033">APInt.h:33</a></div></div>
<div class="ttc" id="astructllvm_1_1AAMDNodes_html_a6b173e97523275314f3f2b433a5f71a9"><div class="ttname"><a href="structllvm_1_1AAMDNodes.html#a6b173e97523275314f3f2b433a5f71a9">llvm::AAMDNodes::merge</a></div><div class="ttdeci">AAMDNodes merge(const AAMDNodes &amp;Other) const</div><div class="ttdoc">Given two sets of AAMDNodes applying to potentially different locations, determine the best AAMDNodes...</div><div class="ttdef"><b>Definition:</b> <a href="TypeBasedAliasAnalysis_8cpp_source.html#l00522">TypeBasedAliasAnalysis.cpp:522</a></div></div>
<div class="ttc" id="anamespacellvm_html_a745200db7bc2a7a3c17fa379fb1b56c3"><div class="ttname"><a href="namespacellvm.html#a745200db7bc2a7a3c17fa379fb1b56c3">llvm::parseWidenableBranch</a></div><div class="ttdeci">bool parseWidenableBranch(const User *U, Value *&amp;Condition, Value *&amp;WidenableCondition, BasicBlock *&amp;IfTrueBB, BasicBlock *&amp;IfFalseBB)</div><div class="ttdoc">If U is widenable branch looking like: cond = ...</div><div class="ttdef"><b>Definition:</b> <a href="Analysis_2GuardUtils_8cpp_source.html#l00044">GuardUtils.cpp:44</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7912b6c9e7843ca9fd5a11e199bef617"><div class="ttname"><a href="namespacellvm.html#a7912b6c9e7843ca9fd5a11e199bef617">llvm::PointerMayBeCaptured</a></div><div class="ttdeci">bool PointerMayBeCaptured(const Value *V, bool ReturnCaptures, bool StoreCaptures, unsigned MaxUsesToExplore=0)</div><div class="ttdoc">PointerMayBeCaptured - Return true if this pointer value may be captured by the enclosing function (w...</div><div class="ttdef"><b>Definition:</b> <a href="CaptureTracking_8cpp_source.html#l00214">CaptureTracking.cpp:214</a></div></div>
<div class="ttc" id="aclassllvm_1_1StoreInst_html_a8e2e13588202d0d79ceff0f1d8d35d86"><div class="ttname"><a href="classllvm_1_1StoreInst.html#a8e2e13588202d0d79ceff0f1d8d35d86">llvm::StoreInst::isUnordered</a></div><div class="ttdeci">bool isUnordered() const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00384">Instructions.h:384</a></div></div>
<div class="ttc" id="anamespacellvm_html_a57f2ca0e57f4f7b13f56f9aa16af3e0d"><div class="ttname"><a href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">llvm::min</a></div><div class="ttdeci">Expected&lt; ExpressionValue &gt; min(const ExpressionValue &amp;Lhs, const ExpressionValue &amp;Rhs)</div><div class="ttdef"><b>Definition:</b> <a href="FileCheck_8cpp_source.html#l00357">FileCheck.cpp:357</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html_a9318649185cfc66ba4b4eb66d5968e00"><div class="ttname"><a href="classllvm_1_1MapVector.html#a9318649185cfc66ba4b4eb66d5968e00">llvm::MapVector&lt; KeyT, ValueT, SmallDenseMap&lt; KeyT, unsigned, N &gt;, SmallVector&lt; std::pair&lt; KeyT, ValueT &gt;, N &gt; &gt;::insert</a></div><div class="ttdeci">std::pair&lt; iterator, bool &gt; insert(const std::pair&lt; KeyT, ValueT &gt; &amp;KV)</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00118">MapVector.h:118</a></div></div>
<div class="ttc" id="anamespacellvm_html_a61d13d6824ec46c31260a4fd0997eda0"><div class="ttname"><a href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">llvm::any_of</a></div><div class="ttdeci">bool any_of(R &amp;&amp;range, UnaryPredicate P)</div><div class="ttdoc">Provide wrappers to std::any_of which take ranges instead of having to pass begin/end explicitly.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01742">STLExtras.h:1742</a></div></div>
<div class="ttc" id="aDataLayout_8h_html"><div class="ttname"><a href="DataLayout_8h.html">DataLayout.h</a></div></div>
<div class="ttc" id="aBasicBlockSections_8cpp_html_a5fd0741d696f28faf65b33f6c6af8fda"><div class="ttname"><a href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a></div><div class="ttdeci">SmallVector&lt; MachineOperand, 4 &gt; Cond</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockSections_8cpp_source.html#l00137">BasicBlockSections.cpp:137</a></div></div>
<div class="ttc" id="aclassllvm_1_1StringRef_html"><div class="ttname"><a href="classllvm_1_1StringRef.html">llvm::StringRef</a></div><div class="ttdoc">StringRef - Represent a constant reference to a string, i.e.</div><div class="ttdef"><b>Definition:</b> <a href="StringRef_8h_source.html#l00050">StringRef.h:50</a></div></div>
<div class="ttc" id="aclassllvm_1_1AssumptionCache_html"><div class="ttname"><a href="classllvm_1_1AssumptionCache.html">llvm::AssumptionCache</a></div><div class="ttdoc">A cache of @llvm.assume calls within a function.</div><div class="ttdef"><b>Definition:</b> <a href="AssumptionCache_8h_source.html#l00042">AssumptionCache.h:42</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8">llvm::TargetTransformInfo::TCK_SizeAndLatency</a></div><div class="ttdeci">@ TCK_SizeAndLatency</div><div class="ttdoc">The weighted sum of size and latency.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00245">TargetTransformInfo.h:245</a></div></div>
<div class="ttc" id="aSupport_2ErrorHandling_8h_html_ace243f5c25697a1107cce46626b3dc94"><div class="ttname"><a href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a></div><div class="ttdeci">#define llvm_unreachable(msg)</div><div class="ttdoc">Marks that the current location is not supposed to be reachable.</div><div class="ttdef"><b>Definition:</b> <a href="Support_2ErrorHandling_8h_source.html#l00143">ErrorHandling.h:143</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a6393a2d4fe7e10b28a0dcc35f881567b"><div class="ttname"><a href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">llvm::Value::getType</a></div><div class="ttdeci">Type * getType() const</div><div class="ttdoc">All values are typed, get the type of this value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00255">Value.h:255</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a72d0db08ead54facf3e1e90aaae435ba"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a72d0db08ead54facf3e1e90aaae435ba">SkipFlags</a></div><div class="ttdeci">SkipFlags</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01436">SimplifyCFG.cpp:1436</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a74aa9daea070e2ad3394a3ec58b7316a"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a74aa9daea070e2ad3394a3ec58b7316a">llvm::BasicBlock::getUniquePredecessor</a></div><div class="ttdeci">const BasicBlock * getUniquePredecessor() const</div><div class="ttdoc">Return the predecessor of this block if it has a unique predecessor block.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00292">BasicBlock.cpp:292</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a3ab5fc45117b450e8bb04e564cb6e5f2"><div class="ttname"><a href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">llvm::Value::replaceAllUsesWith</a></div><div class="ttdeci">void replaceAllUsesWith(Value *V)</div><div class="ttdoc">Change all uses of this to point to a new Value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00532">Value.cpp:532</a></div></div>
<div class="ttc" id="aREADME__ALTIVEC_8txt_html_a015846b6188ce15e08cd94c74a9df1a3"><div class="ttname"><a href="README__ALTIVEC_8txt.html#a015846b6188ce15e08cd94c74a9df1a3">A</a></div><div class="ttdeci">* A</div><div class="ttdef"><b>Definition:</b> <a href="README__ALTIVEC_8txt_source.html#l00089">README_ALTIVEC.txt:89</a></div></div>
<div class="ttc" id="aCostModel_8cpp_html_a263d4048026a7c0a91393b998181f16e"><div class="ttname"><a href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a></div><div class="ttdeci">static cl::opt&lt; TargetTransformInfo::TargetCostKind &gt; CostKind(&quot;cost-kind&quot;, cl::desc(&quot;Target cost kind&quot;), cl::init(TargetTransformInfo::TCK_RecipThroughput), cl::values(clEnumValN(TargetTransformInfo::TCK_RecipThroughput, &quot;throughput&quot;, &quot;Reciprocal throughput&quot;), clEnumValN(TargetTransformInfo::TCK_Latency, &quot;latency&quot;, &quot;Instruction latency&quot;), clEnumValN(TargetTransformInfo::TCK_CodeSize, &quot;code-size&quot;, &quot;Code size&quot;), clEnumValN(TargetTransformInfo::TCK_SizeAndLatency, &quot;size-latency&quot;, &quot;Code size and latency&quot;)))</div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_ace940beeee97c222f836fe0ac70f6cf5"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#ace940beeee97c222f836fe0ac70f6cf5">llvm::BasicBlock::Create</a></div><div class="ttdeci">static BasicBlock * Create(LLVMContext &amp;Context, const Twine &amp;Name=&quot;&quot;, Function *Parent=nullptr, BasicBlock *InsertBefore=nullptr)</div><div class="ttdoc">Creates a new BasicBlock.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00105">BasicBlock.h:105</a></div></div>
<div class="ttc" id="aBasicAliasAnalysis_8cpp_html_a2675de1d8479c7b00387979714da43f7"><div class="ttname"><a href="BasicAliasAnalysis_8cpp.html#a2675de1d8479c7b00387979714da43f7">getParent</a></div><div class="ttdeci">static const Function * getParent(const Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="BasicAliasAnalysis_8cpp_source.html#l00806">BasicAliasAnalysis.cpp:806</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ms__demangle_html_a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e"><div class="ttname"><a href="namespacellvm_1_1ms__demangle.html#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">llvm::ms_demangle::IntrinsicFunctionKind::New</a></div><div class="ttdeci">@ New</div></div>
<div class="ttc" id="aclassuint32__t_html"><div class="ttname"><a href="classuint32__t.html">uint32_t</a></div></div>
<div class="ttc" id="aclassllvm_1_1BranchProbability_html"><div class="ttname"><a href="classllvm_1_1BranchProbability.html">llvm::BranchProbability</a></div><div class="ttdef"><b>Definition:</b> <a href="BranchProbability_8h_source.html#l00030">BranchProbability.h:30</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_ab3fc0225d8aaf8434026c3573f961f2c"><div class="ttname"><a href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">llvm::Value::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const</div><div class="ttdoc">All values hold a context through their type.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00994">Value.cpp:994</a></div></div>
<div class="ttc" id="aclassllvm_1_1IRBuilderBase_html"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html">llvm::IRBuilderBase</a></div><div class="ttdoc">Common base class shared among various IRBuilders.</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00094">IRBuilder.h:94</a></div></div>
<div class="ttc" id="aclassllvm_1_1ilist__node__impl_html_af719fc783be6589465137d997701a432"><div class="ttname"><a href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">llvm::ilist_node_impl::getIterator</a></div><div class="ttdeci">self_iterator getIterator()</div><div class="ttdef"><b>Definition:</b> <a href="ilist__node_8h_source.html#l00082">ilist_node.h:82</a></div></div>
<div class="ttc" id="aAArch64SLSHardening_8cpp_html_ad467c4ab9119043f9b7750ab986be61a"><div class="ttname"><a href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a></div><div class="ttdeci">MachineBasicBlock MachineBasicBlock::iterator DebugLoc DL</div><div class="ttdef"><b>Definition:</b> <a href="AArch64SLSHardening_8cpp_source.html#l00076">AArch64SLSHardening.cpp:76</a></div></div>
<div class="ttc" id="aConstantRange_8h_html"><div class="ttname"><a href="ConstantRange_8h.html">ConstantRange.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1PtrToIntInst_html"><div class="ttname"><a href="classllvm_1_1PtrToIntInst.html">llvm::PtrToIntInst</a></div><div class="ttdoc">This class represents a cast from a pointer to an integer.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l05207">Instructions.h:5207</a></div></div>
<div class="ttc" id="alib_2Target_2ARM_2README_8txt_html_a1b45f45820a60c09244a87eb59824aec"><div class="ttname"><a href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a></div><div class="ttdeci">add sub stmia L5 ldr r0 bl L_printf $stub Instead of a and a wouldn t it be better to do three moves *Return an aggregate type is even return S</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2ARM_2README_8txt_source.html#l00210">README.txt:210</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantExpr_html_a90d84324b6b6aa2a60077a79b31a49e7"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#a90d84324b6b6aa2a60077a79b31a49e7">llvm::ConstantExpr::getIntegerCast</a></div><div class="ttdeci">static Constant * getIntegerCast(Constant *C, Type *Ty, bool IsSigned)</div><div class="ttdoc">Create a ZExt, Bitcast or Trunc for integer -&gt; integer casts.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l02067">Constants.cpp:2067</a></div></div>
<div class="ttc" id="anamespacellvm_html_a92be87f8a371f277f7260fb99592d5f4"><div class="ttname"><a href="namespacellvm.html#a92be87f8a371f277f7260fb99592d5f4">llvm::unique</a></div><div class="ttdeci">auto unique(Range &amp;&amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="GenericUniformityImpl_8h_source.html#l00056">GenericUniformityImpl.h:56</a></div></div>
<div class="ttc" id="anamespacellvm_html_ad66c4759666aab78529658362b498c74"><div class="ttname"><a href="namespacellvm.html#ad66c4759666aab78529658362b498c74">llvm::pred_empty</a></div><div class="ttdeci">bool pred_empty(const BasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="IR_2CFG_8h_source.html#l00118">CFG.h:118</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_af5ef3bceb3edbbdfe5fd25a42d5f3643"><div class="ttname"><a href="SimplifyCFG_8cpp.html#af5ef3bceb3edbbdfe5fd25a42d5f3643">SpeculateOneExpensiveInst</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; SpeculateOneExpensiveInst(&quot;speculate-one-expensive-inst&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Allow exactly one expensive instruction to be speculatively &quot; &quot;executed&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_adb5c319f5905c1d3ca9eb5df546388c5"><div class="ttname"><a href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">llvm::Value::getName</a></div><div class="ttdeci">StringRef getName() const</div><div class="ttdoc">Return a constant reference to the value's name.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00308">Value.cpp:308</a></div></div>
<div class="ttc" id="aclassllvm_1_1ValueMap_html"><div class="ttname"><a href="classllvm_1_1ValueMap.html">llvm::ValueMap&lt; const Value *, WeakTrackingVH &gt;</a></div></div>
<div class="ttc" id="anamespacellvm_html_a967725b39b57414036183e1384497b22"><div class="ttname"><a href="namespacellvm.html#a967725b39b57414036183e1384497b22">llvm::RequireAndPreserveDomTree</a></div><div class="ttdeci">cl::opt&lt; bool &gt; RequireAndPreserveDomTree</div><div class="ttdoc">This function is used to do simplification of a CFG.</div></div>
<div class="ttc" id="aclassllvm_1_1LoadInst_html"><div class="ttname"><a href="classllvm_1_1LoadInst.html">llvm::LoadInst</a></div><div class="ttdoc">An instruction for reading from memory.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00177">Instructions.h:177</a></div></div>
<div class="ttc" id="aValueHandle_8h_html"><div class="ttname"><a href="ValueHandle_8h.html">ValueHandle.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_a6bc2b53fce3b1d8975eea027d8a8eb90"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#a6bc2b53fce3b1d8975eea027d8a8eb90">llvm::ArrayRef::front</a></div><div class="ttdeci">const T &amp; front() const</div><div class="ttdoc">front - Get the first element.</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00166">ArrayRef.h:166</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_a1600c7959045cb6b6a5f5a1d427ec67e"><div class="ttname"><a href="classllvm_1_1User.html#a1600c7959045cb6b6a5f5a1d427ec67e">llvm::User::replaceUsesOfWith</a></div><div class="ttdeci">bool replaceUsesOfWith(Value *From, Value *To)</div><div class="ttdoc">Replace uses of one Value with another.</div><div class="ttdef"><b>Definition:</b> <a href="User_8cpp_source.html#l00021">User.cpp:21</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_aeb1d8a382ce658ab7dbbbbcd06def17a"><div class="ttname"><a href="SimplifyCFG_8cpp.html#aeb1d8a382ce658ab7dbbbbcd06def17a">MergeCondStores</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; MergeCondStores(&quot;simplifycfg-merge-cond-stores&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Hoist conditional stores even if an unconditional store does not &quot; &quot;precede - hoist multiple conditional stores into a single &quot; &quot;predicated store&quot;))</div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_aea84738a371d95e7d9d00386801ed182"><div class="ttname"><a href="SimplifyCFG_8cpp.html#aea84738a371d95e7d9d00386801ed182">allPredecessorsComeFromSameSource</a></div><div class="ttdeci">static BasicBlock * allPredecessorsComeFromSameSource(BasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l06975">SimplifyCFG.cpp:6975</a></div></div>
<div class="ttc" id="aclassllvm_1_1Function_html_a88a5e60837674780a9d812d661897ac5"><div class="ttname"><a href="classllvm_1_1Function.html#a88a5e60837674780a9d812d661897ac5">llvm::Function::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00751">Function.h:751</a></div></div>
<div class="ttc" id="aclassllvm_1_1InvokeInst_html_a800a96a12d974cf7f73a96777d27f974"><div class="ttname"><a href="classllvm_1_1InvokeInst.html#a800a96a12d974cf7f73a96777d27f974">llvm::InvokeInst::setUnwindDest</a></div><div class="ttdeci">void setUnwindDest(BasicBlock *B)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03955">Instructions.h:3955</a></div></div>
<div class="ttc" id="aclassllvm_1_1PointerUnion_html"><div class="ttname"><a href="classllvm_1_1PointerUnion.html">llvm::PointerUnion&lt; const Value *, const PseudoSourceValue * &gt;</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImplBase_html_a0e1c3175b0ac22fe3853651c28e1ecb8"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImplBase.html#a0e1c3175b0ac22fe3853651c28e1ecb8">llvm::SmallPtrSetImplBase::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00093">SmallPtrSet.h:93</a></div></div>
<div class="ttc" id="anamespacellvm_html_ab2e3dbebd68e69d77c227682fc8e3ba2"><div class="ttname"><a href="namespacellvm.html#ab2e3dbebd68e69d77c227682fc8e3ba2">llvm::make_scope_exit</a></div><div class="ttdeci">detail::scope_exit&lt; std::decay_t&lt; Callable &gt; &gt; make_scope_exit(Callable &amp;&amp;F)</div><div class="ttdef"><b>Definition:</b> <a href="ScopeExit_8h_source.html#l00059">ScopeExit.h:59</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_affd7c19ab0474d817d8cf0bd94f5ccad"><div class="ttname"><a href="SimplifyCFG_8cpp.html#affd7c19ab0474d817d8cf0bd94f5ccad">dominatesMergePoint</a></div><div class="ttdeci">static bool dominatesMergePoint(Value *V, BasicBlock *BB, SmallPtrSetImpl&lt; Instruction * &gt; &amp;AggressiveInsts, InstructionCost &amp;Cost, InstructionCost Budget, const TargetTransformInfo &amp;TTI, unsigned Depth=0)</div><div class="ttdoc">If we have a merge point of an &quot;if condition&quot; as accepted above, return true if the specified value d...</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00411">SimplifyCFG.cpp:411</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_ac09a21c371a9c535cbc13e8f82503aec"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#ac09a21c371a9c535cbc13e8f82503aec">llvm::ConstantInt::getZExtValue</a></div><div class="ttdeci">uint64_t getZExtValue() const</div><div class="ttdoc">Return the constant as a 64-bit unsigned integer value after it has been zero extended as appropriate...</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00141">Constants.h:141</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_ab706e7ebb1969c5e34f28bfcf2ff719e"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#ab706e7ebb1969c5e34f28bfcf2ff719e">llvm::BasicBlock::front</a></div><div class="ttdeci">const Instruction &amp; front() const</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00326">BasicBlock.h:326</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a9ff3ba9554f4e6ee2a870ca63d9a6923"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a9ff3ba9554f4e6ee2a870ca63d9a6923">ConstantFold</a></div><div class="ttdeci">static Constant * ConstantFold(Instruction *I, const DataLayout &amp;DL, const SmallDenseMap&lt; Value *, Constant * &gt; &amp;ConstantPool)</div><div class="ttdoc">Try to fold instruction I into a constant.</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l05638">SimplifyCFG.cpp:5638</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a1dc76cc8bf703e6ada68bededcbb9573"><div class="ttname"><a href="classllvm_1_1APInt.html#a1dc76cc8bf703e6ada68bededcbb9573">llvm::APInt::zext</a></div><div class="ttdeci">APInt zext(unsigned width) const</div><div class="ttdoc">Zero extend to a new width.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8cpp_source.html#l00973">APInt.cpp:973</a></div></div>
<div class="ttc" id="anamespacellvm_html_a77724415203930efd07d7098cb1e437da5633028bc27ffa8eab39cc5de65b3108"><div class="ttname"><a href="namespacellvm.html#a77724415203930efd07d7098cb1e437da5633028bc27ffa8eab39cc5de65b3108">llvm::RF_IgnoreMissingLocals</a></div><div class="ttdeci">@ RF_IgnoreMissingLocals</div><div class="ttdoc">If this flag is set, the remapper ignores missing function-local entries (Argument,...</div><div class="ttdef"><b>Definition:</b> <a href="ValueMapper_8h_source.html#l00089">ValueMapper.h:89</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a6ea260be710ac7b61309534308da3147"><div class="ttname"><a href="classllvm_1_1Instruction.html#a6ea260be710ac7b61309534308da3147">llvm::Instruction::mayHaveSideEffects</a></div><div class="ttdeci">bool mayHaveSideEffects() const LLVM_READONLY</div><div class="ttdoc">Return true if the instruction may have side effects.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00745">Instruction.cpp:745</a></div></div>
<div class="ttc" id="aAMDGPULibCalls_8cpp_html_a537c835c34f0b44b6ad2696643754390"><div class="ttname"><a href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a></div><div class="ttdeci">amdgpu Simplify well known AMD library false FunctionCallee Callee</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPULibCalls_8cpp_source.html#l00187">AMDGPULibCalls.cpp:187</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_aa286a0f7f5d38488d593bb7ef0ba183e"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#aa286a0f7f5d38488d593bb7ef0ba183e">llvm::BasicBlock::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const</div><div class="ttdoc">Get the context in which this basic block lives.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00035">BasicBlock.cpp:35</a></div></div>
<div class="ttc" id="anamespacellvm_html_aed498f056a09006219c59ee9fab0450f"><div class="ttname"><a href="namespacellvm.html#aed498f056a09006219c59ee9fab0450f">llvm::EliminateDuplicatePHINodes</a></div><div class="ttdeci">bool EliminateDuplicatePHINodes(BasicBlock *BB)</div><div class="ttdoc">Check for and eliminate duplicate PHI nodes in this block.</div><div class="ttdef"><b>Definition:</b> <a href="Transforms_2Utils_2Local_8cpp_source.html#l01374">Local.cpp:1374</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a819fe08329be34252ffde1e710574a34"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a819fe08329be34252ffde1e710574a34">ForwardSwitchConditionToPHI</a></div><div class="ttdeci">static bool ForwardSwitchConditionToPHI(SwitchInst *SI)</div><div class="ttdoc">Try to forward the condition of a switch instruction to a phi node dominated by the switch,...</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l05541">SimplifyCFG.cpp:5541</a></div></div>
<div class="ttc" id="anamespacellvm_html_a83cbd0aa1465957c50eaea8374875b27"><div class="ttname"><a href="namespacellvm.html#a83cbd0aa1465957c50eaea8374875b27">llvm::removeUnwindEdge</a></div><div class="ttdeci">Instruction * removeUnwindEdge(BasicBlock *BB, DomTreeUpdater *DTU=nullptr)</div><div class="ttdoc">Replace 'BB's terminator with one that does not have an unwind successor block.</div><div class="ttdef"><b>Definition:</b> <a href="Transforms_2Utils_2Local_8cpp_source.html#l02576">Local.cpp:2576</a></div></div>
<div class="ttc" id="aAttributes_8h_html"><div class="ttname"><a href="Attributes_8h.html">Attributes.h</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_abcb8065aab78b9142ec8a5a3d56c27bb"><div class="ttname"><a href="SimplifyCFG_8cpp.html#abcb8065aab78b9142ec8a5a3d56c27bb">removeUndefIntroducingPredecessor</a></div><div class="ttdeci">static bool removeUndefIntroducingPredecessor(BasicBlock *BB, DomTreeUpdater *DTU)</div><div class="ttdoc">If BB has an incoming value that will always trigger undefined behavior (eg.</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l07181">SimplifyCFG.cpp:7181</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_aead732ab028930952db3ce9c38165276"><div class="ttname"><a href="SimplifyCFG_8cpp.html#aead732ab028930952db3ce9c38165276">MergeCompatibleInvokes</a></div><div class="ttdeci">static bool MergeCompatibleInvokes(BasicBlock *BB, DomTreeUpdater *DTU)</div><div class="ttdoc">If this block is a landingpad exception handling block, categorize all the predecessor invokes into s...</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l02619">SimplifyCFG.cpp:2619</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html_a8da97c44f514ad1ae9ccf4518b0f88aa"><div class="ttname"><a href="classllvm_1_1MapVector.html#a8da97c44f514ad1ae9ccf4518b0f88aa">llvm::MapVector&lt; KeyT, ValueT, SmallDenseMap&lt; KeyT, unsigned, N &gt;, SmallVector&lt; std::pair&lt; KeyT, ValueT &gt;, N &gt; &gt;::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00080">MapVector.h:80</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_ac4fdfa685be0e2568187936221316c47"><div class="ttname"><a href="SimplifyCFG_8cpp.html#ac4fdfa685be0e2568187936221316c47">sinkLastInstruction</a></div><div class="ttdeci">static bool sinkLastInstruction(ArrayRef&lt; BasicBlock * &gt; Blocks)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01918">SimplifyCFG.cpp:1918</a></div></div>
<div class="ttc" id="aConstant_8h_html"><div class="ttname"><a href="Constant_8h.html">Constant.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1NVPTX_1_1PTXLdStInstCode_html_a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4"><div class="ttname"><a href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">llvm::NVPTX::PTXLdStInstCode::V2</a></div><div class="ttdeci">@ V2</div><div class="ttdef"><b>Definition:</b> <a href="NVPTX_8h_source.html#l00124">NVPTX.h:124</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantRange_html_a4c57cff33f93411b9c32991f3c5336ad"><div class="ttname"><a href="classllvm_1_1ConstantRange.html#a4c57cff33f93411b9c32991f3c5336ad">llvm::ConstantRange::getLower</a></div><div class="ttdeci">const APInt &amp; getLower() const</div><div class="ttdoc">Return the lower value for this range.</div><div class="ttdef"><b>Definition:</b> <a href="ConstantRange_8h_source.html#l00198">ConstantRange.h:198</a></div></div>
<div class="ttc" id="aclassllvm_1_1ResumeInst_html"><div class="ttname"><a href="classllvm_1_1ResumeInst.html">llvm::ResumeInst</a></div><div class="ttdoc">Resume the propagation of an exception.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l04256">Instructions.h:4256</a></div></div>
<div class="ttc" id="aclassllvm_1_1Twine_html"><div class="ttname"><a href="classllvm_1_1Twine.html">llvm::Twine</a></div><div class="ttdoc">Twine - A lightweight data structure for efficiently representing the concatenation of temporary valu...</div><div class="ttdef"><b>Definition:</b> <a href="Twine_8h_source.html#l00081">Twine.h:81</a></div></div>
<div class="ttc" id="anamespacellvm_html_a152d8c380cc937c9dceb402ceec943b6"><div class="ttname"><a href="namespacellvm.html#a152d8c380cc937c9dceb402ceec943b6">llvm::ConstantFoldTerminator</a></div><div class="ttdeci">bool ConstantFoldTerminator(BasicBlock *BB, bool DeleteDeadConditions=false, const TargetLibraryInfo *TLI=nullptr, DomTreeUpdater *DTU=nullptr)</div><div class="ttdoc">If a terminator instruction is predicated on a constant value, convert it into an unconditional branc...</div><div class="ttdef"><b>Definition:</b> <a href="Transforms_2Utils_2Local_8cpp_source.html#l00126">Local.cpp:126</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantExpr_html"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html">llvm::ConstantExpr</a></div><div class="ttdoc">A constant value that is initialized with an expression using other constant values.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00998">Constants.h:998</a></div></div>
<div class="ttc" id="anamespacellvm_1_1GraphProgram_html_a0ad4685976f8c4d4a697a53fbe05d10b"><div class="ttname"><a href="namespacellvm_1_1GraphProgram.html#a0ad4685976f8c4d4a697a53fbe05d10b">llvm::GraphProgram::Name</a></div><div class="ttdeci">Name</div><div class="ttdef"><b>Definition:</b> <a href="GraphWriter_8h_source.html#l00050">GraphWriter.h:50</a></div></div>
<div class="ttc" id="astructllvm_1_1KnownBits_html"><div class="ttname"><a href="structllvm_1_1KnownBits.html">llvm::KnownBits</a></div><div class="ttdef"><b>Definition:</b> <a href="KnownBits_8h_source.html#l00023">KnownBits.h:23</a></div></div>
<div class="ttc" id="anamespacellvm_html_a4d13fd05401d8eb0c97b9864a0eb6028"><div class="ttname"><a href="namespacellvm.html#a4d13fd05401d8eb0c97b9864a0eb6028">llvm::copy_if</a></div><div class="ttdeci">OutputIt copy_if(R &amp;&amp;Range, OutputIt Out, UnaryPredicate P)</div><div class="ttdoc">Provide wrappers to std::copy_if which take ranges instead of having to pass begin/end explicitly.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01781">STLExtras.h:1781</a></div></div>
<div class="ttc" id="aclassllvm_1_1IndirectBrInst_html_a1ce0a14a79ac73a91f38aa91899bb377"><div class="ttname"><a href="classllvm_1_1IndirectBrInst.html#a1ce0a14a79ac73a91f38aa91899bb377">llvm::IndirectBrInst::getAddress</a></div><div class="ttdeci">Value * getAddress()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03754">Instructions.h:3754</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a72d0db08ead54facf3e1e90aaae435baa45adf13243e382f733c98877e11c1e92"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a72d0db08ead54facf3e1e90aaae435baa45adf13243e382f733c98877e11c1e92">SkipReadMem</a></div><div class="ttdeci">@ SkipReadMem</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01437">SimplifyCFG.cpp:1437</a></div></div>
<div class="ttc" id="alib_2Target_2PowerPC_2README_8txt_html_aa91241c8c54738377749dc47ee489e0d"><div class="ttname"><a href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">get</a></div><div class="ttdeci">Should compile to something r4 addze r3 instead we get</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2PowerPC_2README_8txt_source.html#l00024">README.txt:24</a></div></div>
<div class="ttc" id="anamespacellvm_html_a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376"><div class="ttname"><a href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">llvm::Successor</a></div><div class="ttdeci">@ Successor</div><div class="ttdef"><b>Definition:</b> <a href="SIMachineScheduler_8h_source.html#l00035">SIMachineScheduler.h:35</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a65520b9c67759099e313d0f4e7b5ff9e"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00084">DenseMap.h:84</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a38c50aa8e3e9588f4f968c2e03a0cee0"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a38c50aa8e3e9588f4f968c2e03a0cee0">llvm::SmallVectorImpl::assign</a></div><div class="ttdeci">void assign(size_type NumElts, ValueParamT Elt)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00708">SmallVector.h:708</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1SendMsg_html_a8594419a4ddfad2c9a79279c490e466d"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">llvm::AMDGPU::SendMsg::Op</a></div><div class="ttdeci">Op</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00357">SIDefines.h:357</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_ab0ff669b12c20c07137705c38872ec63"><div class="ttname"><a href="classllvm_1_1PHINode.html#ab0ff669b12c20c07137705c38872ec63">llvm::PHINode::Create</a></div><div class="ttdeci">static PHINode * Create(Type *Ty, unsigned NumReservedValues, const Twine &amp;NameStr=&quot;&quot;, Instruction *InsertBefore=nullptr)</div><div class="ttdoc">Constructors - NumReservedValues is a hint for the number of incoming edges that this phi node will h...</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02750">Instructions.h:2750</a></div></div>
<div class="ttc" id="anamespacellvm_1_1X86_html_a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e"><div class="ttname"><a href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">llvm::X86::FirstMacroFusionInstKind::Cmp</a></div><div class="ttdeci">@ Cmp</div></div>
<div class="ttc" id="aclassllvm_1_1CleanupReturnInst_html_a4b5ae24ac77905557021989915dfd964"><div class="ttname"><a href="classllvm_1_1CleanupReturnInst.html#a4b5ae24ac77905557021989915dfd964">llvm::CleanupReturnInst::getUnwindDest</a></div><div class="ttdeci">BasicBlock * getUnwindDest() const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l04722">Instructions.h:4722</a></div></div>
<div class="ttc" id="aGlobalVariable_8h_html"><div class="ttname"><a href="GlobalVariable_8h.html">GlobalVariable.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_a5eeaf08e96168c2cac8960f87f0ef360"><div class="ttname"><a href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">llvm::pred_end</a></div><div class="ttdeci">Interval::pred_iterator pred_end(Interval *I)</div><div class="ttdef"><b>Definition:</b> <a href="Interval_8h_source.html#l00112">Interval.h:112</a></div></div>
<div class="ttc" id="anamespacellvm_html_abff5a423c1f45e23958dde8ee695c9a9"><div class="ttname"><a href="namespacellvm.html#abff5a423c1f45e23958dde8ee695c9a9">llvm::isGuaranteedToTransferExecutionToSuccessor</a></div><div class="ttdeci">bool isGuaranteedToTransferExecutionToSuccessor(const Instruction *I)</div><div class="ttdoc">Return true if this function can prove that the instruction I will always transfer execution to one o...</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l05612">ValueTracking.cpp:5612</a></div></div>
<div class="ttc" id="anamespacellvm_1_1MCID_html_ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c"><div class="ttname"><a href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">llvm::MCID::Branch</a></div><div class="ttdeci">@ Branch</div><div class="ttdef"><b>Definition:</b> <a href="MCInstrDesc_8h_source.html#l00159">MCInstrDesc.h:159</a></div></div>
<div class="ttc" id="aclassllvm_1_1Module_html_a9c00c70121af456007404bd456047766"><div class="ttname"><a href="classllvm_1_1Module.html#a9c00c70121af456007404bd456047766">llvm::Module::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const</div><div class="ttdoc">Get the global data context.</div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00262">Module.h:262</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a227525ceb37837d0076479b272b50aec"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a227525ceb37837d0076479b272b50aec">isVectorOp</a></div><div class="ttdeci">static bool isVectorOp(Instruction &amp;I)</div><div class="ttdoc">Return if an instruction's type or any of its operands' types are a vector type.</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03692">SimplifyCFG.cpp:3692</a></div></div>
<div class="ttc" id="aCasting_8h_html"><div class="ttname"><a href="Casting_8h.html">Casting.h</a></div></div>
<div class="ttc" id="aFunction_8h_html"><div class="ttname"><a href="Function_8h.html">Function.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a7c779ce2ba55bc94f52014fc25f3d520"><div class="ttname"><a href="classllvm_1_1Value.html#a7c779ce2ba55bc94f52014fc25f3d520">llvm::Value::hasNUses</a></div><div class="ttdeci">bool hasNUses(unsigned N) const</div><div class="ttdoc">Return true if this Value has exactly N uses.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00148">Value.cpp:148</a></div></div>
<div class="ttc" id="anamespacellvm_html_abee0df5f7f703bb4462aba260ba0a60f"><div class="ttname"><a href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">llvm::BitWidth</a></div><div class="ttdeci">constexpr unsigned BitWidth</div><div class="ttdef"><b>Definition:</b> <a href="BitmaskEnum_8h_source.html#l00147">BitmaskEnum.h:147</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a3d95cc2d359b8d9ed5bd9504b44930b5"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a3d95cc2d359b8d9ed5bd9504b44930b5">llvm::DenseMapBase&lt; SmallDenseMap&lt; KeyT, ValueT, 4, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::size</a></div><div class="ttdeci">unsigned size() const</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00099">DenseMap.h:99</a></div></div>
<div class="ttc" id="anamespacellvm_1_1TargetStackID_html_a71392100eb15ba746b1f898986f5d8a5"><div class="ttname"><a href="namespacellvm_1_1TargetStackID.html#a71392100eb15ba746b1f898986f5d8a5">llvm::TargetStackID::Value</a></div><div class="ttdeci">Value</div><div class="ttdef"><b>Definition:</b> <a href="TargetFrameLowering_8h_source.html#l00027">TargetFrameLowering.h:27</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_a574efc7d85ff014d5f15e077f3c82e6b"><div class="ttname"><a href="classllvm_1_1CallBase.html#a574efc7d85ff014d5f15e077f3c82e6b">llvm::CallBase::isIndirectCall</a></div><div class="ttdeci">bool isIndirectCall() const</div><div class="ttdoc">Return true if the callsite is an indirect call.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l00300">Instructions.cpp:300</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html_acf4c09e1f30cdd4e0b5b1b8a236ead34"><div class="ttname"><a href="classllvm_1_1MapVector.html#acf4c09e1f30cdd4e0b5b1b8a236ead34">llvm::MapVector&lt; KeyT, ValueT, SmallDenseMap&lt; KeyT, unsigned, N &gt;, SmallVector&lt; std::pair&lt; KeyT, ValueT &gt;, N &gt; &gt;::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00061">MapVector.h:61</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a6c682701ac0e49b730cc572959875d14"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a6c682701ac0e49b730cc572959875d14">getKnownValueOnEdge</a></div><div class="ttdeci">static ConstantInt * getKnownValueOnEdge(Value *V, BasicBlock *From, BasicBlock *To)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03120">SimplifyCFG.cpp:3120</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_aac0ea55010b7b1a301e65a0baea057aa"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">llvm::SmallVectorImpl::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00614">SmallVector.h:614</a></div></div>
<div class="ttc" id="anamespacellvm_html_a66191f0bcc8c62b784819e9e96ceeba2"><div class="ttname"><a href="namespacellvm.html#a66191f0bcc8c62b784819e9e96ceeba2">llvm::countl_zero</a></div><div class="ttdeci">int countl_zero(T Val)</div><div class="ttdoc">Count number of 0's from the most significant bit to the least stopping at the first 1.</div><div class="ttdef"><b>Definition:</b> <a href="bit_8h_source.html#l00245">bit.h:245</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a126a12b67fa620ad28ec0c919ca7a3e8"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a126a12b67fa620ad28ec0c919ca7a3e8">llvm::CmpInst::setPredicate</a></div><div class="ttdeci">void setPredicate(Predicate P)</div><div class="ttdoc">Set the predicate for this instruction to the specified value.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00811">InstrTypes.h:811</a></div></div>
<div class="ttc" id="aclassllvm_1_1CleanupReturnInst_html"><div class="ttname"><a href="classllvm_1_1CleanupReturnInst.html">llvm::CleanupReturnInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l04665">Instructions.h:4665</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_a7ac9329ef7292ee640d87f45ce7ae05c"><div class="ttname"><a href="classllvm_1_1CallBase.html#a7ac9329ef7292ee640d87f45ce7ae05c">llvm::CallBase::getCalledOperand</a></div><div class="ttdeci">Value * getCalledOperand() const</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01399">InstrTypes.h:1399</a></div></div>
<div class="ttc" id="aclassllvm_1_1IndirectBrInst_html_abd4f6893d4f810f4162a70f89b2452fe"><div class="ttname"><a href="classllvm_1_1IndirectBrInst.html#abd4f6893d4f810f4162a70f89b2452fe">llvm::IndirectBrInst::getNumDestinations</a></div><div class="ttdeci">unsigned getNumDestinations() const</div><div class="ttdoc">return the number of possible destinations in this indirectbr instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03760">Instructions.h:3760</a></div></div>
<div class="ttc" id="anamespacellvm_html_ab7e8be1d1ae7e526ea156b60c51c10e5"><div class="ttname"><a href="namespacellvm.html#ab7e8be1d1ae7e526ea156b60c51c10e5">llvm::FoldSingleEntryPHINodes</a></div><div class="ttdeci">bool FoldSingleEntryPHINodes(BasicBlock *BB, MemoryDependenceResults *MemDep=nullptr)</div><div class="ttdoc">We know that BB has one predecessor.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l00144">BasicBlockUtils.cpp:144</a></div></div>
<div class="ttc" id="aclassllvm_1_1IndirectBrInst_html"><div class="ttname"><a href="classllvm_1_1IndirectBrInst.html">llvm::IndirectBrInst</a></div><div class="ttdoc">Indirect Branch Instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03679">Instructions.h:3679</a></div></div>
<div class="ttc" id="aclassllvm_1_1BranchProbability_html_aaee6034264d5d0782e5d1489360730d9"><div class="ttname"><a href="classllvm_1_1BranchProbability.html#aaee6034264d5d0782e5d1489360730d9">llvm::BranchProbability::getCompl</a></div><div class="ttdeci">BranchProbability getCompl() const</div><div class="ttdef"><b>Definition:</b> <a href="BranchProbability_8h_source.html#l00069">BranchProbability.h:69</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantRange_html"><div class="ttname"><a href="classllvm_1_1ConstantRange.html">llvm::ConstantRange</a></div><div class="ttdoc">This class represents a range of values.</div><div class="ttdef"><b>Definition:</b> <a href="ConstantRange_8h_source.html#l00047">ConstantRange.h:47</a></div></div>
<div class="ttc" id="aAnalysis_2GuardUtils_8h_html"><div class="ttname"><a href="Analysis_2GuardUtils_8h.html">GuardUtils.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1MDBuilder_html"><div class="ttname"><a href="classllvm_1_1MDBuilder.html">llvm::MDBuilder</a></div><div class="ttdef"><b>Definition:</b> <a href="MDBuilder_8h_source.html#l00036">MDBuilder.h:36</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ac26154a24f393f523c87cc5f8239f36c"><div class="ttname"><a href="classllvm_1_1Instruction.html#ac26154a24f393f523c87cc5f8239f36c">llvm::Instruction::BinaryOps</a></div><div class="ttdeci">BinaryOps</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00809">Instruction.h:809</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7e108932dc3da5294aed99a353aac9c4"><div class="ttname"><a href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">llvm::pred_begin</a></div><div class="ttdeci">Interval::pred_iterator pred_begin(Interval *I)</div><div class="ttdoc">pred_begin/pred_end - define methods so that Intervals may be used just like BasicBlocks can with the...</div><div class="ttdef"><b>Definition:</b> <a href="Interval_8h_source.html#l00109">Interval.h:109</a></div></div>
<div class="ttc" id="astructllvm_1_1SimplifyCFGOptions_html"><div class="ttname"><a href="structllvm_1_1SimplifyCFGOptions.html">llvm::SimplifyCFGOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFGOptions_8h_source.html#l00023">SimplifyCFGOptions.h:23</a></div></div>
<div class="ttc" id="anamespacellvm_html_a57d2f9ee99e9e68cff564d0d579c8163"><div class="ttname"><a href="namespacellvm.html#a57d2f9ee99e9e68cff564d0d579c8163">llvm::countr_zero</a></div><div class="ttdeci">int countr_zero(T Val)</div><div class="ttdoc">Count number of 0's from the least significant bit to the most stopping at the first 1.</div><div class="ttdef"><b>Definition:</b> <a href="bit_8h_source.html#l00179">bit.h:179</a></div></div>
<div class="ttc" id="aMemorySSA_8h_html"><div class="ttname"><a href="MemorySSA_8h.html">MemorySSA.h</a></div></div>
<div class="ttc" id="aRustDemangle_8cpp_html_a103d8cfe62c1651cd70e181746f8a840"><div class="ttname"><a href="RustDemangle_8cpp.html#a103d8cfe62c1651cd70e181746f8a840">isValid</a></div><div class="ttdeci">static bool isValid(const char C)</div><div class="ttdoc">Returns true if C is a valid mangled character: &lt;0-9a-zA-Z_&gt;.</div><div class="ttdef"><b>Definition:</b> <a href="RustDemangle_8cpp_source.html#l00184">RustDemangle.cpp:184</a></div></div>
<div class="ttc" id="aInstructions_8h_html"><div class="ttname"><a href="Instructions_8h.html">Instructions.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_addec638786f763d967811b45cb662f1f"><div class="ttname"><a href="classllvm_1_1User.html#addec638786f763d967811b45cb662f1f">llvm::User::getNumOperands</a></div><div class="ttdeci">unsigned getNumOperands() const</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00191">User.h:191</a></div></div>
<div class="ttc" id="anamespacellvm_html_a15055c7e3a33b44c293df24e4ba7bc5e"><div class="ttname"><a href="namespacellvm.html#a15055c7e3a33b44c293df24e4ba7bc5e">llvm::IsBlockFollowedByDeoptOrUnreachable</a></div><div class="ttdeci">bool IsBlockFollowedByDeoptOrUnreachable(const BasicBlock *BB)</div><div class="ttdoc">Check if we can prove that all paths starting from this block converge to a block that either has a @...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l00596">BasicBlockUtils.cpp:596</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a1955ef05e08a44c7e45ea15eedf7a33e"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a1955ef05e08a44c7e45ea15eedf7a33e">llvm::PatternMatch::m_AnyIntegralConstant</a></div><div class="ttdeci">cst_pred_ty&lt; is_any_apint &gt; m_AnyIntegralConstant()</div><div class="ttdoc">Match an integer or vector with any integral constant.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00444">PatternMatch.h:444</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_a2a8c8be274f3bd351e083ab3828c14c7"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a2a8c8be274f3bd351e083ab3828c14c7">llvm::ConstantInt::isNegative</a></div><div class="ttdeci">bool isNegative() const</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00188">Constants.h:188</a></div></div>
<div class="ttc" id="aSmallVector_8h_html"><div class="ttname"><a href="SmallVector_8h.html">SmallVector.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ab4f3bf98b5054831b608852e33427814"><div class="ttname"><a href="classllvm_1_1Instruction.html#ab4f3bf98b5054831b608852e33427814">llvm::Instruction::getDebugLoc</a></div><div class="ttdeci">const DebugLoc &amp; getDebugLoc() const</div><div class="ttdoc">Return the debug location for this node as a DebugLoc.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00358">Instruction.h:358</a></div></div>
<div class="ttc" id="aUser_8h_html"><div class="ttname"><a href="User_8h.html">User.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1StoreInst_html_ac03c1c093059ea000216af8dd6f2dbf4"><div class="ttname"><a href="classllvm_1_1StoreInst.html#ac03c1c093059ea000216af8dd6f2dbf4">llvm::StoreInst::getPointerOperand</a></div><div class="ttdeci">Value * getPointerOperand()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00393">Instructions.h:393</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_ad65ca7ae85d9efe841f0c2f71cf5ee59"><div class="ttname"><a href="SimplifyCFG_8cpp.html#ad65ca7ae85d9efe841f0c2f71cf5ee59">ShouldUseSwitchConditionAsTableIndex</a></div><div class="ttdeci">static bool ShouldUseSwitchConditionAsTableIndex(ConstantInt &amp;MinCaseVal, const ConstantInt &amp;MaxCaseVal, bool HasDefaultResults, const SmallDenseMap&lt; PHINode *, Type * &gt; &amp;ResultTypes, const DataLayout &amp;DL, const TargetTransformInfo &amp;TTI)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l06283">SimplifyCFG.cpp:6283</a></div></div>
<div class="ttc" id="anamespacellvm_html_a2edb650de7b28add81349f5abf7ed7aa"><div class="ttname"><a href="namespacellvm.html#a2edb650de7b28add81349f5abf7ed7aa">llvm::zip</a></div><div class="ttdeci">detail::zippy&lt; detail::zip_shortest, T, U, Args... &gt; zip(T &amp;&amp;t, U &amp;&amp;u, Args &amp;&amp;...args)</div><div class="ttdoc">zip iterator for two or more iteratable types.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00882">STLExtras.h:882</a></div></div>
<div class="ttc" id="aregcomp_8c_html_a0240ac851181b84ac374872dc5434ee4"><div class="ttname"><a href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a></div><div class="ttdeci">#define N</div></div>
<div class="ttc" id="aclassllvm_1_1InvokeInst_html_a2d3bf0d61fe883d8ceb95c68e03db669"><div class="ttname"><a href="classllvm_1_1InvokeInst.html#a2d3bf0d61fe883d8ceb95c68e03db669">llvm::InvokeInst::setNormalDest</a></div><div class="ttdeci">void setNormalDest(BasicBlock *B)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03952">Instructions.h:3952</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a1a7f07aaef6a3bee130bf0e0f0536802"><div class="ttname"><a href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">llvm::Instruction::getParent</a></div><div class="ttdeci">const BasicBlock * getParent() const</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00090">Instruction.h:90</a></div></div>
<div class="ttc" id="aInstructionSimplify_8h_html"><div class="ttname"><a href="InstructionSimplify_8h.html">InstructionSimplify.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a0c8ffe664a36e30d49c84d0aded2fe08"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a0c8ffe664a36e30d49c84d0aded2fe08">llvm::SmallVectorImpl::pop_back_val</a></div><div class="ttdeci">T pop_back_val()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00677">SmallVector.h:677</a></div></div>
<div class="ttc" id="aInstructionSimplify_8cpp_html_a565dd825f238fa0a8c4bbfe562635f7c"><div class="ttname"><a href="InstructionSimplify_8cpp.html#a565dd825f238fa0a8c4bbfe562635f7c">getTrue</a></div><div class="ttdeci">static Constant * getTrue(Type *Ty)</div><div class="ttdoc">For a boolean type or a vector of boolean type, return true or a vector with every element true.</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8cpp_source.html#l00126">InstructionSimplify.cpp:126</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_aa7414ba9f658ff1287d22a4b8fe81bcb"><div class="ttname"><a href="classllvm_1_1CmpInst.html#aa7414ba9f658ff1287d22a4b8fe81bcb">llvm::CmpInst::getPredicate</a></div><div class="ttdeci">Predicate getPredicate() const</div><div class="ttdoc">Return the predicate for this instruction.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00808">InstrTypes.h:808</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_ae97521436759fc2489301a34e621bbcd"><div class="ttname"><a href="SimplifyCFG_8cpp.html#ae97521436759fc2489301a34e621bbcd">isLifeTimeMarker</a></div><div class="ttdeci">static bool isLifeTimeMarker(const Instruction *I)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01765">SimplifyCFG.cpp:1765</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_a8ce0c4746a1ec805e66409d20ae93922"><div class="ttname"><a href="classllvm_1_1PHINode.html#a8ce0c4746a1ec805e66409d20ae93922">llvm::PHINode::getIncomingBlock</a></div><div class="ttdeci">BasicBlock * getIncomingBlock(unsigned i) const</div><div class="ttdoc">Return incoming basic block number i.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02814">Instructions.h:2814</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_a85ffb6531d4cda988ea81f18d4e56fb7"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">llvm::ArrayRef::size</a></div><div class="ttdeci">size_t size() const</div><div class="ttdoc">size - Get the array size.</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00163">ArrayRef.h:163</a></div></div>
<div class="ttc" id="aTargetTransformInfo_8h_html"><div class="ttname"><a href="TargetTransformInfo_8h.html">TargetTransformInfo.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1iterator__range_html"><div class="ttname"><a href="classllvm_1_1iterator__range.html">llvm::iterator_range</a></div><div class="ttdoc">A range adaptor for a pair of iterators.</div><div class="ttdef"><b>Definition:</b> <a href="iterator__range_8h_source.html#l00030">iterator_range.h:30</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_aaba6ba9e89bea12994fa7a7a6ade4d38"><div class="ttname"><a href="SimplifyCFG_8cpp.html#aaba6ba9e89bea12994fa7a7a6ade4d38">ValuesOverlap</a></div><div class="ttdeci">static bool ValuesOverlap(std::vector&lt; ValueEqualityComparisonCase &gt; &amp;C1, std::vector&lt; ValueEqualityComparisonCase &gt; &amp;C2)</div><div class="ttdoc">Return true if there are any keys in C1 that exist in C2 as well.</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00828">SimplifyCFG.cpp:828</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a94c9bd7b123be808934be99e1bcedd24"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a94c9bd7b123be808934be99e1bcedd24">llvm::BasicBlock::getFirstNonPHIOrDbg</a></div><div class="ttdeci">const Instruction * getFirstNonPHIOrDbg(bool SkipPseudoOp=true) const</div><div class="ttdoc">Returns a pointer to the first instruction in this block that is not a PHINode or a debug intrinsic,...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00215">BasicBlock.cpp:215</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html"><div class="ttname"><a href="classllvm_1_1PHINode.html">llvm::PHINode</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02708">Instructions.h:2708</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a8de021e28a3c04c9216ad8decf104f02"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">llvm::BasicBlock::getTerminator</a></div><div class="ttdeci">const Instruction * getTerminator() const LLVM_READONLY</div><div class="ttdoc">Returns the terminator instruction if the block is well formed or null if the block is not well forme...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00127">BasicBlock.h:127</a></div></div>
<div class="ttc" id="aScopeExit_8h_html"><div class="ttname"><a href="ScopeExit_8h.html">ScopeExit.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_afe7af0c3ec2ef1f525173acd2ea4ba60"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#afe7af0c3ec2ef1f525173acd2ea4ba60">llvm::BasicBlock::removePredecessor</a></div><div class="ttdeci">void removePredecessor(BasicBlock *Pred, bool KeepOneInputPHIs=false)</div><div class="ttdoc">Update PHI nodes in this BasicBlock before removal of predecessor Pred.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00341">BasicBlock.cpp:341</a></div></div>
<div class="ttc" id="anamespacellvm_html_a2162d123f222998300d308bdefdb38b9"><div class="ttname"><a href="namespacellvm.html#a2162d123f222998300d308bdefdb38b9">llvm::set_intersect</a></div><div class="ttdeci">void set_intersect(S1Ty &amp;S1, const S2Ty &amp;S2)</div><div class="ttdoc">set_intersect(A, B) - Compute A := A ^ B Identical to set_intersection, except that it works on set&lt;&gt;...</div><div class="ttdef"><b>Definition:</b> <a href="SetOperations_8h_source.html#l00040">SetOperations.h:40</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html">llvm::SmallVectorImpl&lt; uint64_t &gt;</a></div></div>
<div class="ttc" id="anamespacellvm_html_a6b0ac1fa4f05de76413c5e0ca6334035"><div class="ttname"><a href="namespacellvm.html#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a></div><div class="ttdeci">auto reverse(ContainerTy &amp;&amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00484">STLExtras.h:484</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantRange_html_aa89e9cec92a0b38d2f47a077bf12cc98"><div class="ttname"><a href="classllvm_1_1ConstantRange.html#aa89e9cec92a0b38d2f47a077bf12cc98">llvm::ConstantRange::makeExactICmpRegion</a></div><div class="ttdeci">static ConstantRange makeExactICmpRegion(CmpInst::Predicate Pred, const APInt &amp;Other)</div><div class="ttdoc">Produce the exact range such that all values in the returned range satisfy the given predicate with a...</div><div class="ttdef"><b>Definition:</b> <a href="ConstantRange_8cpp_source.html#l00157">ConstantRange.cpp:157</a></div></div>
<div class="ttc" id="aclassllvm_1_1IRBuilderBase_html_a4b2c1cc89c04d885ab3036597446f0cd"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html#a4b2c1cc89c04d885ab3036597446f0cd">llvm::IRBuilderBase::CreateNot</a></div><div class="ttdeci">Value * CreateNot(Value *V, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l01664">IRBuilder.h:1664</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a3d430216d32f4363e4df154599b98055"><div class="ttname"><a href="classllvm_1_1APInt.html#a3d430216d32f4363e4df154599b98055">llvm::APInt::sgt</a></div><div class="ttdeci">bool sgt(const APInt &amp;RHS) const</div><div class="ttdoc">Signed greater than comparison.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01179">APInt.h:1179</a></div></div>
<div class="ttc" id="anamespacellvm_html_a458b4709ebedccb846a179f1e422265b"><div class="ttname"><a href="namespacellvm.html#a458b4709ebedccb846a179f1e422265b">llvm::DeleteDeadBlock</a></div><div class="ttdeci">void DeleteDeadBlock(BasicBlock *BB, DomTreeUpdater *DTU=nullptr, bool KeepOneInputPHIs=false)</div><div class="ttdoc">Delete the specified block, which must have no predecessors.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l00095">BasicBlockUtils.cpp:95</a></div></div>
<div class="ttc" id="aDerivedTypes_8h_html"><div class="ttname"><a href="DerivedTypes_8h.html">DerivedTypes.h</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a60140c11a583d97cc18631485559f237"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a60140c11a583d97cc18631485559f237">ShouldBuildLookupTable</a></div><div class="ttdeci">static bool ShouldBuildLookupTable(SwitchInst *SI, uint64_t TableSize, const TargetTransformInfo &amp;TTI, const DataLayout &amp;DL, const SmallDenseMap&lt; PHINode *, Type * &gt; &amp;ResultTypes)</div><div class="ttdoc">Determine whether a lookup table should be built for this switch, based on the number of cases,...</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l06246">SimplifyCFG.cpp:6246</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImpl_html"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html">llvm::SmallPtrSetImpl&lt; Value * &gt;</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallSetVector_html"><div class="ttname"><a href="classllvm_1_1SmallSetVector.html">llvm::SmallSetVector</a></div><div class="ttdoc">A SetVector that performs no allocations if smaller than a certain size.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00300">SetVector.h:300</a></div></div>
<div class="ttc" id="aHexagonGenPredicate_8cpp_html_a0de1bf31f56b17312cc34b911d86faa4"><div class="ttname"><a href="HexagonGenPredicate_8cpp.html#a0de1bf31f56b17312cc34b911d86faa4">pred</a></div><div class="ttdeci">hexagon gen pred</div><div class="ttdef"><b>Definition:</b> <a href="HexagonGenPredicate_8cpp_source.html#l00134">HexagonGenPredicate.cpp:134</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantRange_html_a1d29074c7a610816d4f328b7cd9b783d"><div class="ttname"><a href="classllvm_1_1ConstantRange.html#a1d29074c7a610816d4f328b7cd9b783d">llvm::ConstantRange::subtract</a></div><div class="ttdeci">ConstantRange subtract(const APInt &amp;CI) const</div><div class="ttdoc">Subtract the specified constant from the endpoints of this constant range.</div><div class="ttdef"><b>Definition:</b> <a href="ConstantRange_8cpp_source.html#l00488">ConstantRange.cpp:488</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallInst_html"><div class="ttname"><a href="classllvm_1_1CallInst.html">llvm::CallInst</a></div><div class="ttdoc">This class represents a function call, abstracting a target machine's calling convention.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01485">Instructions.h:1485</a></div></div>
<div class="ttc" id="anamespacellvm_html_ac19cbbc4935a23e1d44f65e1eaba6b1d"><div class="ttname"><a href="namespacellvm.html#ac19cbbc4935a23e1d44f65e1eaba6b1d">llvm::extractBranchWeights</a></div><div class="ttdeci">bool extractBranchWeights(const MDNode *ProfileData, SmallVectorImpl&lt; uint32_t &gt; &amp;Weights)</div><div class="ttdoc">Extract branch weights from MD_prof metadata.</div><div class="ttdef"><b>Definition:</b> <a href="ProfDataUtils_8cpp_source.html#l00122">ProfDataUtils.cpp:122</a></div></div>
<div class="ttc" id="alib_2CodeGen_2README_8txt_html_a09776db24cf586ec9f1e18f3bae14099"><div class="ttname"><a href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a></div><div class="ttdeci">Common register allocation spilling lr str ldr sxth r3 ldr mla r4 can lr mov lr str ldr sxth r3 mla r4 and then merge mul and lr str ldr sxth r3 mla r4 It also increase the likelihood the store may become dead bb27 Successors according to LLVM BB</div><div class="ttdef"><b>Definition:</b> <a href="lib_2CodeGen_2README_8txt_source.html#l00039">README.txt:39</a></div></div>
<div class="ttc" id="aHexagonCommonGEP_8cpp_html_ad532e8710e50302e0a376b61c91fa91d"><div class="ttname"><a href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a></div><div class="ttdeci">Hexagon Common GEP</div><div class="ttdef"><b>Definition:</b> <a href="HexagonCommonGEP_8cpp_source.html#l00171">HexagonCommonGEP.cpp:171</a></div></div>
<div class="ttc" id="aclassllvm_1_1UnreachableInst_html"><div class="ttname"><a href="classllvm_1_1UnreachableInst.html">llvm::UnreachableInst</a></div><div class="ttdoc">This function has undefined behavior.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l04773">Instructions.h:4773</a></div></div>
<div class="ttc" id="anamespacellvm_1_1MIPatternMatch_html_abeed97c145aefd8b8974bb1947a19439"><div class="ttname"><a href="namespacellvm_1_1MIPatternMatch.html#abeed97c145aefd8b8974bb1947a19439">llvm::MIPatternMatch::m_Not</a></div><div class="ttdeci">BinaryOp_match&lt; SrcTy, SpecificConstantMatch, TargetOpcode::G_XOR, true &gt; m_Not(const SrcTy &amp;&amp;Src)</div><div class="ttdoc">Matches a register not-ed by a G_XOR.</div><div class="ttdef"><b>Definition:</b> <a href="MIPatternMatch_8h_source.html#l00774">MIPatternMatch.h:774</a></div></div>
<div class="ttc" id="astructllvm_1_1KnownBits_html_a4fdc09049a61f952b5d52788dbd2f69b"><div class="ttname"><a href="structllvm_1_1KnownBits.html#a4fdc09049a61f952b5d52788dbd2f69b">llvm::KnownBits::getBitWidth</a></div><div class="ttdeci">unsigned getBitWidth() const</div><div class="ttdoc">Get the bit width of this value.</div><div class="ttdef"><b>Definition:</b> <a href="KnownBits_8h_source.html#l00040">KnownBits.h:40</a></div></div>
<div class="ttc" id="aLLVMContext_8h_html"><div class="ttname"><a href="LLVMContext_8h.html">LLVMContext.h</a></div></div>
<div class="ttc" id="aBlockVerifier_8cpp_html_ae45c7d73c0ff5d177b59153ffae77f84"><div class="ttname"><a href="BlockVerifier_8cpp.html#ae45c7d73c0ff5d177b59153ffae77f84">From</a></div><div class="ttdeci">BlockVerifier::State From</div><div class="ttdef"><b>Definition:</b> <a href="BlockVerifier_8cpp_source.html#l00055">BlockVerifier.cpp:55</a></div></div>
<div class="ttc" id="aclassllvm_1_1SwitchInst_html"><div class="ttname"><a href="classllvm_1_1SwitchInst.html">llvm::SwitchInst</a></div><div class="ttdoc">Multiway switch.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03283">Instructions.h:3283</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_ae855357b6c5e6e7ed1869272708a3a84"><div class="ttname"><a href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">llvm::Value::takeName</a></div><div class="ttdeci">void takeName(Value *V)</div><div class="ttdoc">Transfer the name from V to this value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00381">Value.cpp:381</a></div></div>
<div class="ttc" id="aclassllvm_1_1DebugLoc_html"><div class="ttname"><a href="classllvm_1_1DebugLoc.html">llvm::DebugLoc</a></div><div class="ttdoc">A debug info location.</div><div class="ttdef"><b>Definition:</b> <a href="DebugLoc_8h_source.html#l00033">DebugLoc.h:33</a></div></div>
<div class="ttc" id="anamespacellvm_html_ae2aea60aed775d05692317bf4855c291"><div class="ttname"><a href="namespacellvm.html#ae2aea60aed775d05692317bf4855c291">llvm::SplitBlockAndInsertIfThen</a></div><div class="ttdeci">Instruction * SplitBlockAndInsertIfThen(Value *Cond, Instruction *SplitBefore, bool Unreachable, MDNode *BranchWeights, DominatorTree *DT, LoopInfo *LI=nullptr, BasicBlock *ThenBlock=nullptr)</div><div class="ttdoc">Split the containing block at the specified instruction - everything before SplitBefore stays in the ...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l01542">BasicBlockUtils.cpp:1542</a></div></div>
<div class="ttc" id="aclassllvm_1_1SwitchInst_html_a7fc7899c254935205ca29b6bd7baa926"><div class="ttname"><a href="classllvm_1_1SwitchInst.html#a7fc7899c254935205ca29b6bd7baa926">llvm::SwitchInst::setSuccessor</a></div><div class="ttdeci">void setSuccessor(unsigned idx, BasicBlock *NewSucc)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03609">Instructions.h:3609</a></div></div>
<div class="ttc" id="aclassllvm_1_1SwitchInst_html_a62abc2475d09c01d583ba24a487898fd"><div class="ttname"><a href="classllvm_1_1SwitchInst.html#a62abc2475d09c01d583ba24a487898fd">llvm::SwitchInst::addCase</a></div><div class="ttdeci">void addCase(ConstantInt *OnVal, BasicBlock *Dest)</div><div class="ttdoc">Add an entry to the switch instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l04532">Instructions.cpp:4532</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_abe1de1520a21f77ac57cc210bf0fb0b4"><div class="ttname"><a href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">llvm::User::getOperand</a></div><div class="ttdeci">Value * getOperand(unsigned i) const</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00169">User.h:169</a></div></div>
<div class="ttc" id="astructllvm_1_1cl_1_1desc_html"><div class="ttname"><a href="structllvm_1_1cl_1_1desc.html">llvm::cl::desc</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00411">CommandLine.h:411</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantRange_html_a5bd6d98b4a7ecc1dcdc571e4352fcc52"><div class="ttname"><a href="classllvm_1_1ConstantRange.html#a5bd6d98b4a7ecc1dcdc571e4352fcc52">llvm::ConstantRange::isEmptySet</a></div><div class="ttdeci">bool isEmptySet() const</div><div class="ttdoc">Return true if this set contains no members.</div><div class="ttdef"><b>Definition:</b> <a href="ConstantRange_8cpp_source.html#l00367">ConstantRange.cpp:367</a></div></div>
<div class="ttc" id="aPassBuilderBindings_8cpp_html_a76adb4549f349676de0a703a497ca5a5"><div class="ttname"><a href="PassBuilderBindings_8cpp.html#a76adb4549f349676de0a703a497ca5a5">Mod</a></div><div class="ttdeci">Module * Mod</div><div class="ttdef"><b>Definition:</b> <a href="PassBuilderBindings_8cpp_source.html#l00054">PassBuilderBindings.cpp:54</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a8ebee7bc3fcddb111c6a2e28918c6fd8"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a8ebee7bc3fcddb111c6a2e28918c6fd8">createUnreachableSwitchDefault</a></div><div class="ttdeci">static void createUnreachableSwitchDefault(SwitchInst *Switch, DomTreeUpdater *DTU)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l05279">SimplifyCFG.cpp:5279</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_aafcbf4e3010950dd8ea0be1c4b0d3281"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#aafcbf4e3010950dd8ea0be1c4b0d3281">llvm::TargetTransformInfo::isProfitableToHoist</a></div><div class="ttdeci">bool isProfitableToHoist(Instruction *I) const</div><div class="ttdoc">Return true if it is profitable to hoist instruction in the then/else to before if.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00492">TargetTransformInfo.cpp:492</a></div></div>
<div class="ttc" id="aclassllvm_1_1BranchInst_html"><div class="ttname"><a href="classllvm_1_1BranchInst.html">llvm::BranchInst</a></div><div class="ttdoc">Conditional or Unconditional Branch instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03139">Instructions.h:3139</a></div></div>
<div class="ttc" id="araw__ostream_8h_html"><div class="ttname"><a href="raw__ostream_8h.html">raw_ostream.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7b03ed78a8e299bde6d26a8793cd4e06"><div class="ttname"><a href="namespacellvm.html#a7b03ed78a8e299bde6d26a8793cd4e06">llvm::NullPointerIsDefined</a></div><div class="ttdeci">bool NullPointerIsDefined(const Function *F, unsigned AS=0)</div><div class="ttdoc">Check whether null pointer dereferencing is considered undefined behavior for a given function or an ...</div><div class="ttdef"><b>Definition:</b> <a href="Function_8cpp_source.html#l02136">Function.cpp:2136</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImpl_html_af74676a3c7447be34bd2c1da76ec0c48"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#af74676a3c7447be34bd2c1da76ec0c48">llvm::SmallPtrSetImpl::contains</a></div><div class="ttdeci">bool contains(ConstPtrType Ptr) const</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00389">SmallPtrSet.h:389</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a499ea32ca1b8d16cedfe01d1e5b08f29"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a499ea32ca1b8d16cedfe01d1e5b08f29">llvm::SmallVectorImpl::reserve</a></div><div class="ttdeci">void reserve(size_type N)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00667">SmallVector.h:667</a></div></div>
<div class="ttc" id="anamespacellvm_1_1MIPatternMatch_html_a5e211e92e7c34390512a7c2ff9dc60be"><div class="ttname"><a href="namespacellvm_1_1MIPatternMatch.html#a5e211e92e7c34390512a7c2ff9dc60be">llvm::MIPatternMatch::m_BinOp</a></div><div class="ttdeci">BinaryOpc_match&lt; LHS, RHS, false &gt; m_BinOp(unsigned Opcode, const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="MIPatternMatch_8h_source.html#l00438">MIPatternMatch.h:438</a></div></div>
<div class="ttc" id="aBasicBlockUtils_8h_html"><div class="ttname"><a href="BasicBlockUtils_8h.html">BasicBlockUtils.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1tgtok_html_abbc5259d649363016626e2529fabe0c5a58b95af1ca96e109f85a0646a05fceb7"><div class="ttname"><a href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a58b95af1ca96e109f85a0646a05fceb7">llvm::tgtok::TrueVal</a></div><div class="ttdeci">@ TrueVal</div><div class="ttdef"><b>Definition:</b> <a href="TGLexer_8h_source.html#l00062">TGLexer.h:62</a></div></div>
<div class="ttc" id="anamespacellvm_html_ad295cb34421c21507bc9cdefe1ba3f16"><div class="ttname"><a href="namespacellvm.html#ad295cb34421c21507bc9cdefe1ba3f16">llvm::SplitBlock</a></div><div class="ttdeci">BasicBlock * SplitBlock(BasicBlock *Old, Instruction *SplitPt, DominatorTree *DT, LoopInfo *LI=nullptr, MemorySSAUpdater *MSSAU=nullptr, const Twine &amp;BBName=&quot;&quot;, bool Before=false)</div><div class="ttdoc">Split the specified block at the specified instruction.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l00935">BasicBlockUtils.cpp:935</a></div></div>
<div class="ttc" id="aValue_8h_html"><div class="ttname"><a href="Value_8h.html">Value.h</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a1a4df60f6ee2e2103d1d4e2752d5192d"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a1a4df60f6ee2e2103d1d4e2752d5192d">CloneInstructionsIntoPredecessorBlockAndUpdateSSAUses</a></div><div class="ttdeci">static void CloneInstructionsIntoPredecessorBlockAndUpdateSSAUses(BasicBlock *BB, BasicBlock *PredBlock, ValueToValueMapTy &amp;VMap)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01095">SimplifyCFG.cpp:1095</a></div></div>
<div class="ttc" id="aclassllvm_1_1InvokeInst_html_a5ba379c3251d99b4c23c8f2e6abe4a6c"><div class="ttname"><a href="classllvm_1_1InvokeInst.html#a5ba379c3251d99b4c23c8f2e6abe4a6c">llvm::InvokeInst::getUnwindDest</a></div><div class="ttdeci">BasicBlock * getUnwindDest() const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03949">Instructions.h:3949</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a15c2db73fd73b04753cd1ffb2126acb6"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a15c2db73fd73b04753cd1ffb2126acb6">shouldFoldCondBranchesToCommonDestination</a></div><div class="ttdeci">static std::optional&lt; std::tuple&lt; BasicBlock *, Instruction::BinaryOps, bool &gt; &gt; shouldFoldCondBranchesToCommonDestination(BranchInst *BI, BranchInst *PBI, const TargetTransformInfo *TTI)</div><div class="ttdoc">Determine if the two branches share a common destination and deduce a glue that joins the branches' c...</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03530">SimplifyCFG.cpp:3530</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantRange_html_a04459fa7cb4eeda3238a0f7d554ad3be"><div class="ttname"><a href="classllvm_1_1ConstantRange.html#a04459fa7cb4eeda3238a0f7d554ad3be">llvm::ConstantRange::getUpper</a></div><div class="ttdeci">const APInt &amp; getUpper() const</div><div class="ttdoc">Return the upper value for this range.</div><div class="ttdef"><b>Definition:</b> <a href="ConstantRange_8h_source.html#l00201">ConstantRange.h:201</a></div></div>
<div class="ttc" id="anamespacellvm_html_abe76d72cda6b2b4562c72accb510040b"><div class="ttname"><a href="namespacellvm.html#abe76d72cda6b2b4562c72accb510040b">llvm::isSafeToSpeculativelyExecute</a></div><div class="ttdeci">bool isSafeToSpeculativelyExecute(const Instruction *I, const Instruction *CtxI=nullptr, AssumptionCache *AC=nullptr, const DominatorTree *DT=nullptr, const TargetLibraryInfo *TLI=nullptr)</div><div class="ttdoc">Return true if the instruction does not have any effects besides calculating the result and does not ...</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l04799">ValueTracking.cpp:4799</a></div></div>
<div class="ttc" id="anamespacellvm_1_1MCID_html_ab357441fcd1ea1f9b0d27c12700f6023af121d798d2c14b32e81d537a1f0cff8d"><div class="ttname"><a href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023af121d798d2c14b32e81d537a1f0cff8d">llvm::MCID::Terminator</a></div><div class="ttdeci">@ Terminator</div><div class="ttdef"><b>Definition:</b> <a href="MCInstrDesc_8h_source.html#l00158">MCInstrDesc.h:158</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html"><div class="ttname"><a href="classllvm_1_1Value.html">llvm::Value</a></div><div class="ttdoc">LLVM Value Representation.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00074">Value.h:74</a></div></div>
<div class="ttc" id="aDebug_8h_html"><div class="ttname"><a href="Debug_8h.html">Debug.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html_a3a8171298a7d19a309d599de01906703"><div class="ttname"><a href="classllvm_1_1MapVector.html#a3a8171298a7d19a309d599de01906703">llvm::MapVector&lt; KeyT, ValueT, SmallDenseMap&lt; KeyT, unsigned, N &gt;, SmallVector&lt; std::pair&lt; KeyT, ValueT &gt;, N &gt; &gt;::erase</a></div><div class="ttdeci">SmallVector&lt; std::pair&lt; KeyT, ValueT &gt;, N &gt; ::iterator erase(typename SmallVector&lt; std::pair&lt; KeyT, ValueT &gt;, N &gt; ::iterator Iterator)</div><div class="ttdoc">Remove the element given by Iterator.</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00174">MapVector.h:174</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a3a785324436b8d2862b09f5fd8d1c061"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a3a785324436b8d2862b09f5fd8d1c061">FindPHIForConditionForwarding</a></div><div class="ttdeci">static PHINode * FindPHIForConditionForwarding(ConstantInt *CaseValue, BasicBlock *BB, int *PhiIndex)</div><div class="ttdoc">If BB would be eligible for simplification by TryToSimplifyUncondBranchFromEmptyBlock (i....</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l05510">SimplifyCFG.cpp:5510</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_ab5a77dae433054cd06665aee83107ab3"><div class="ttname"><a href="SimplifyCFG_8cpp.html#ab5a77dae433054cd06665aee83107ab3">BranchFoldToCommonDestVectorMultiplier</a></div><div class="ttdeci">static cl::opt&lt; unsigned &gt; BranchFoldToCommonDestVectorMultiplier(&quot;simplifycfg-branch-fold-common-dest-vector-multiplier&quot;, cl::Hidden, cl::init(2), cl::desc(&quot;Multiplier to apply to threshold when determining whether or not &quot; &quot;to fold branch to common destination when vector operations are &quot; &quot;present&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1BranchInst_html_a7e4be8b16fbd68c9045a388904044e01"><div class="ttname"><a href="classllvm_1_1BranchInst.html#a7e4be8b16fbd68c9045a388904044e01">llvm::BranchInst::isConditional</a></div><div class="ttdeci">bool isConditional() const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03218">Instructions.h:3218</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a213e6c0ca6e838157373b9a6018c0769"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a213e6c0ca6e838157373b9a6018c0769">llvm::PatternMatch::m_LogicalAnd</a></div><div class="ttdeci">LogicalOp_match&lt; LHS, RHS, Instruction::And &gt; m_LogicalAnd(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdoc">Matches L &amp;&amp; R either in the form of L &amp; R or L ? R : false.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l02556">PatternMatch.h:2556</a></div></div>
<div class="ttc" id="aclassllvm_1_1BranchInst_html_ad97f2e60cf22f15e0cf617af52309031"><div class="ttname"><a href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">llvm::BranchInst::getSuccessor</a></div><div class="ttdeci">BasicBlock * getSuccessor(unsigned i) const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03232">Instructions.h:3232</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a95ec32778f2bb913dc4cc45ac7a66e42"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a95ec32778f2bb913dc4cc45ac7a66e42">FitWeights</a></div><div class="ttdeci">static void FitWeights(MutableArrayRef&lt; uint64_t &gt; Weights)</div><div class="ttdoc">Keep halving the weights until all can fit in uint32_t.</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01086">SimplifyCFG.cpp:1086</a></div></div>
<div class="ttc" id="aSetVector_8h_html"><div class="ttname"><a href="SetVector_8h.html">SetVector.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1DominatorTreeBase_html_a71c91cbbfc1c0ecf9a69e10ccf739bd7"><div class="ttname"><a href="classllvm_1_1DominatorTreeBase.html#a71c91cbbfc1c0ecf9a69e10ccf739bd7">llvm::DominatorTreeBase&lt; BasicBlock, false &gt;::Delete</a></div><div class="ttdeci">static constexpr UpdateKind Delete</div><div class="ttdef"><b>Definition:</b> <a href="GenericDomTree_8h_source.html#l00259">GenericDomTree.h:259</a></div></div>
<div class="ttc" id="anamespacellvm_1_1sampleprof_html_a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41"><div class="ttname"><a href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">llvm::sampleprof::Base</a></div><div class="ttdeci">@ Base</div><div class="ttdef"><b>Definition:</b> <a href="Discriminator_8h_source.html#l00058">Discriminator.h:58</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_af67d1f3a518964d80a109bb3d9d5cf1e"><div class="ttname"><a href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">llvm::Instruction::moveBefore</a></div><div class="ttdeci">void moveBefore(Instruction *MovePos)</div><div class="ttdoc">Unlink this instruction from its current basic block and insert it into the basic block that MovePos ...</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00108">Instruction.cpp:108</a></div></div>
<div class="ttc" id="aclassllvm_1_1Use_html"><div class="ttname"><a href="classllvm_1_1Use.html">llvm::Use</a></div><div class="ttdoc">A Use represents the edge between a Value definition and its users.</div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00043">Use.h:43</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a833daf718a49c5cd637d8c9ddeaebe07"><div class="ttname"><a href="classllvm_1_1Type.html#a833daf718a49c5cd637d8c9ddeaebe07">llvm::Type::getPrimitiveSizeInBits</a></div><div class="ttdeci">TypeSize getPrimitiveSizeInBits() const LLVM_READONLY</div><div class="ttdoc">Return the basic size of this type if it is a primitive type.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00163">Type.cpp:163</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a396fcfee6914c76974b73c3d203da6a5"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">llvm::SmallVectorImpl::emplace_back</a></div><div class="ttdeci">reference emplace_back(ArgTypes &amp;&amp;... Args)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00941">SmallVector.h:941</a></div></div>
<div class="ttc" id="aclassllvm_1_1Function_html_a969eb757b1e43b455d4a8d0f603e695b"><div class="ttname"><a href="classllvm_1_1Function.html#a969eb757b1e43b455d4a8d0f603e695b">llvm::Function::size</a></div><div class="ttdeci">size_t size() const</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00756">Function.h:756</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImpl_html_a6bc6fb89fe2e91c25559a8631f56e27e"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">llvm::SmallPtrSetImpl::insert</a></div><div class="ttdeci">std::pair&lt; iterator, bool &gt; insert(PtrType Ptr)</div><div class="ttdoc">Inserts Ptr if and only if there is no element in the container equal to Ptr.</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00365">SmallPtrSet.h:365</a></div></div>
<div class="ttc" id="anamespacellvm_1_1Intrinsic_html_a80add6b3b1cdaec560907995127adc16"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">llvm::Intrinsic::ID</a></div><div class="ttdeci">unsigned ID</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00039">TargetTransformInfo.h:39</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a94d23373106467003722f7d6c17b1528"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a94d23373106467003722f7d6c17b1528">llvm::SmallVectorImpl::insert</a></div><div class="ttdeci">iterator insert(iterator I, T &amp;&amp;Elt)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00809">SmallVector.h:809</a></div></div>
<div class="ttc" id="aSimplifyCFG_8cpp_html_a5f162160c57fca10cd58c00b439414cb"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a5f162160c57fca10cd58c00b439414cb">createLogicalOp</a></div><div class="ttdeci">static Value * createLogicalOp(IRBuilderBase &amp;Builder, Instruction::BinaryOps Opc, Value *LHS, Value *RHS, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03490">SimplifyCFG.cpp:3490</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 7 2023 10:38:07 for LLVM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
