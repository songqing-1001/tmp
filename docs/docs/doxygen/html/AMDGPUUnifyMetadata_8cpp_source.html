<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/Target/AMDGPU/AMDGPUUnifyMetadata.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">17.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_794e483eb1cc7921d35fd149d9cc325b.html">Target</a></li><li class="navelem"><a class="el" href="dir_447ce995d6e35417de5ec3060e97c93e.html">AMDGPU</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">AMDGPUUnifyMetadata.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="AMDGPUUnifyMetadata_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- AMDGPUUnifyMetadata.cpp - Unify OpenCL metadata --------------------===//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// \file</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// This pass that unifies multiple OpenCL metadata due to linking.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160; </div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AMDGPU_8h.html">AMDGPU.h</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constants_8h.html">llvm/IR/Constants.h</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Module_8h.html">llvm/IR/Module.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="PassManager_8h.html">llvm/IR/PassManager.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Pass_8h.html">llvm/Pass.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160; </div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160; </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160; </div>
<div class="line"><a name="l00024"></a><span class="lineno"><a class="line" href="namespacekOCLMD.html">   24</a></span>&#160;  <span class="keyword">namespace </span><a class="code" href="namespacekOCLMD.html">kOCLMD</a> {</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160; </div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> SpirVer[]            = <span class="stringliteral">&quot;opencl.spir.version&quot;</span>;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> OCLVer[]             = <span class="stringliteral">&quot;opencl.ocl.version&quot;</span>;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> UsedExt[]            = <span class="stringliteral">&quot;opencl.used.extensions&quot;</span>;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> UsedOptCoreFeat[]    = <span class="stringliteral">&quot;opencl.used.optional.core.features&quot;</span>;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> CompilerOptions[]    = <span class="stringliteral">&quot;opencl.compiler.options&quot;</span>;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> LLVMIdent[]          = <span class="stringliteral">&quot;llvm.ident&quot;</span>;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  } <span class="comment">// end namespace kOCLMD</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">  /// Unify multiple OpenCL metadata due to linking.</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"></span>  <span class="keyword">class </span>AMDGPUUnifyMetadata : <span class="keyword">public</span> <a class="code" href="classllvm_1_1ModulePass.html">ModulePass</a> {</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <span class="keyword">public</span>:</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160; </div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keyword">explicit</span> AMDGPUUnifyMetadata() : <a class="code" href="classllvm_1_1ModulePass.html">ModulePass</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>) {}</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; </div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="keyword">private</span>:</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordtype">bool</span> runOnModule(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M) <span class="keyword">override</span>;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  };</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">    /// Unify version metadata.</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">    /// \return true if changes are made.</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">    /// Assume the named metadata has operands each of which is a pair of</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">    /// integer constant, e.g.</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">    /// !Name = {!n1, !n2}</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">    /// !n1 = {i32 1, i32 2}</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">    /// !n2 = {i32 2, i32 0}</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">    /// Keep the largest version as the sole operand if PickFirst is false.</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">    /// Otherwise pick it from the first value, representing kernel module.</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> unifyVersionMD(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M, <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> Name, <span class="keywordtype">bool</span> PickFirst) {</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      <span class="keyword">auto</span> NamedMD = <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.getNamedMetadata(Name);</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      <span class="keywordflow">if</span> (!NamedMD || NamedMD-&gt;getNumOperands() &lt;= 1)</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      <a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *MaxMD = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      <span class="keyword">auto</span> MaxVer = 0U;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *VersionMD : NamedMD-&gt;operands()) {</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VersionMD-&gt;getNumOperands() == 2);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        <span class="keyword">auto</span> CMajor = mdconst::extract&lt;ConstantInt&gt;(VersionMD-&gt;getOperand(0));</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <span class="keyword">auto</span> <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1V3.html#ac4e0e65d7dfff70958660d11303022a0">VersionMajor</a> = CMajor-&gt;getZExtValue();</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        <span class="keyword">auto</span> CMinor = mdconst::extract&lt;ConstantInt&gt;(VersionMD-&gt;getOperand(1));</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        <span class="keyword">auto</span> <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1V3.html#a6ae72fd26391925af85f23b12c294f1d">VersionMinor</a> = CMinor-&gt;getZExtValue();</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="keyword">auto</span> Ver = (<a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1V3.html#ac4e0e65d7dfff70958660d11303022a0">VersionMajor</a> * 100) + (<a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1V3.html#a6ae72fd26391925af85f23b12c294f1d">VersionMinor</a> * 10);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="keywordflow">if</span> (Ver &gt; MaxVer) {</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;          MaxVer = Ver;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;          MaxMD = VersionMD;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        }</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="keywordflow">if</span> (PickFirst)</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      }</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      NamedMD-&gt;eraseFromParent();</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      NamedMD = <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.getOrInsertNamedMetadata(Name);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      NamedMD-&gt;addOperand(MaxMD);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    }</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">  /// Unify version metadata.</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">  /// \return true if changes are made.</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">  /// Assume the named metadata has operands each of which is a list e.g.</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">  /// !Name = {!n1, !n2}</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">  /// !n1 = !{!&quot;cl_khr_fp16&quot;, {!&quot;cl_khr_fp64&quot;}}</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">  /// !n2 = !{!&quot;cl_khr_image&quot;}</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">  /// Combine it into a single list with unique operands.</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> unifyExtensionMD(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M, <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> Name) {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keyword">auto</span> NamedMD = <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.getNamedMetadata(Name);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">if</span> (!NamedMD || NamedMD-&gt;getNumOperands() == 1)</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Metadata *, 4&gt;</a> <a class="code" href="namespacellvm_1_1MachO.html#a11849daa1b55a8c00390b349546112e7a2005c1eb611537027feb90dafcbbb444">All</a>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *MD : NamedMD-&gt;operands())</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> : MD-&gt;operands())</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">llvm::is_contained</a>(All, <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.get()))</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;          <a class="code" href="namespacellvm_1_1MachO.html#a11849daa1b55a8c00390b349546112e7a2005c1eb611537027feb90dafcbbb444">All</a>.push_back(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.get());</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    NamedMD-&gt;eraseFromParent();</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    NamedMD = <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.getOrInsertNamedMetadata(Name);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;MD : All)</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      NamedMD-&gt;addOperand(<a class="code" href="classllvm_1_1MDNode.html#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.getContext(), MD));</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  }</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keywordtype">bool</span> unifyMetadataImpl(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M) {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *Vers[] = {kOCLMD::SpirVer, kOCLMD::OCLVer};</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *Exts[] = {kOCLMD::UsedExt, kOCLMD::UsedOptCoreFeat,</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                          kOCLMD::CompilerOptions, kOCLMD::LLVMIdent};</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160; </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Vers)</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      Changed |= unifyVersionMD(M, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Exts)</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      Changed |= unifyExtensionMD(M, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  }</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160; </div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  } <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">AMDGPUUnifyMetadata::ID</a> = 0;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="namespacellvm.html#a9523e621bdba7d6e2b12fd6682be0712">  127</a></span>&#160;  <span class="keywordtype">char</span> &amp;<a class="code" href="namespacellvm.html#a9523e621bdba7d6e2b12fd6682be0712">llvm::AMDGPUUnifyMetadataID</a> = <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">AMDGPUUnifyMetadata::ID</a>;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160; </div>
<div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="AMDGPUUnifyMetadata_8cpp.html#a379585979dc370b7e1c5616b28f8b845">  129</a></span>&#160;  <a class="code" href="AMDGPUUnifyMetadata_8cpp.html#a379585979dc370b7e1c5616b28f8b845">INITIALIZE_PASS</a>(AMDGPUUnifyMetadata, <span class="stringliteral">&quot;amdgpu-unify-metadata&quot;</span>,</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                  <span class="stringliteral">&quot;Unify multiple OpenCL metadata due to linking&quot;</span>, <span class="keyword">false</span>, <span class="keyword">false</span>)</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160; </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <a class="code" href="classllvm_1_1ModulePass.html">ModulePass</a> *<a class="code" href="namespacellvm.html">llvm</a>::<a class="code" href="namespacellvm.html#a8d9ed62167be5b28632737e1c1eba7fd">createAMDGPUUnifyMetadataPass</a>() {</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> AMDGPUUnifyMetadata();</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  }</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160; </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="keywordtype">bool</span> AMDGPUUnifyMetadata::runOnModule(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M) {</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">return</span> unifyMetadataImpl(M);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno"><a class="line" href="structllvm_1_1AMDGPUUnifyMetadataPass.html#a538284b7129994222827deed13f792cc">  140</a></span>&#160;  <a class="code" href="classllvm_1_1PreservedAnalyses.html">PreservedAnalyses</a> <a class="code" href="structllvm_1_1AMDGPUUnifyMetadataPass.html#a538284b7129994222827deed13f792cc">AMDGPUUnifyMetadataPass::run</a>(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M,</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                                                 <a class="code" href="classllvm_1_1AnalysisManager.html">ModuleAnalysisManager</a> &amp;AM) {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordflow">return</span> unifyMetadataImpl(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>) ? <a class="code" href="classllvm_1_1PreservedAnalyses.html#a03797a73044a81cbc6a3409d6c72ee8f">PreservedAnalyses::none</a>()</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                                : <a class="code" href="classllvm_1_1PreservedAnalyses.html#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  }</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aclassllvm_1_1PreservedAnalyses_html"><div class="ttname"><a href="classllvm_1_1PreservedAnalyses.html">llvm::PreservedAnalyses</a></div><div class="ttdoc">A set of analyses that are preserved following a run of a transformation pass.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00152">PassManager.h:152</a></div></div>
<div class="ttc" id="anamespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">This is an optimization pass for GlobalISel generic memory operations.</div><div class="ttdef"><b>Definition:</b> <a href="AddressRanges_8h_source.html#l00018">AddressRanges.h:18</a></div></div>
<div class="ttc" id="alib_2Target_2X86_2README_8txt_html_ac88fe1d3a61b056a4f64fbbb156a62ff"><div class="ttname"><a href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a></div><div class="ttdeci">We currently emits eax Perhaps this is what we really should generate is Is imull three or four cycles eax eax The current instruction priority is based on pattern complexity The former is more complex because it folds a load so the latter will not be emitted Perhaps we should use AddedComplexity to give LEA32r a higher priority We should always try to match LEA first since the LEA matching code does some estimate to determine whether the match is profitable if we care more about code then imull is better It s two bytes shorter than movl leal On a Pentium M</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2X86_2README_8txt_source.html#l00252">README.txt:252</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AArch64PACKey_html_abf4394f452bde3f544999858d71e4b46"><div class="ttname"><a href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">llvm::AArch64PACKey::ID</a></div><div class="ttdeci">ID</div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00790">AArch64BaseInfo.h:790</a></div></div>
<div class="ttc" id="aclassllvm_1_1ModulePass_html"><div class="ttname"><a href="classllvm_1_1ModulePass.html">llvm::ModulePass</a></div><div class="ttdoc">ModulePass class - This class is used to implement unstructured interprocedural optimizations and ana...</div><div class="ttdef"><b>Definition:</b> <a href="Pass_8h_source.html#l00248">Pass.h:248</a></div></div>
<div class="ttc" id="aPass_8h_html"><div class="ttname"><a href="Pass_8h.html">Pass.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdoc">This is a 'vector' (really, a variable-sized array), optimized for the case when the array is small.</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l01199">SmallVector.h:1199</a></div></div>
<div class="ttc" id="anamespacellvm_html_a9523e621bdba7d6e2b12fd6682be0712"><div class="ttname"><a href="namespacellvm.html#a9523e621bdba7d6e2b12fd6682be0712">llvm::AMDGPUUnifyMetadataID</a></div><div class="ttdeci">char &amp; AMDGPUUnifyMetadataID</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUUnifyMetadata_8cpp_source.html#l00127">AMDGPUUnifyMetadata.cpp:127</a></div></div>
<div class="ttc" id="anamespacekOCLMD_html"><div class="ttname"><a href="namespacekOCLMD.html">kOCLMD</a></div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUUnifyMetadata_8cpp_source.html#l00024">AMDGPUUnifyMetadata.cpp:24</a></div></div>
<div class="ttc" id="aclassllvm_1_1PreservedAnalyses_html_a03797a73044a81cbc6a3409d6c72ee8f"><div class="ttname"><a href="classllvm_1_1PreservedAnalyses.html#a03797a73044a81cbc6a3409d6c72ee8f">llvm::PreservedAnalyses::none</a></div><div class="ttdeci">static PreservedAnalyses none()</div><div class="ttdoc">Convenience factory function for the empty preserved set.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00155">PassManager.h:155</a></div></div>
<div class="ttc" id="aModule_8h_html"><div class="ttname"><a href="Module_8h.html">Module.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_a8d9ed62167be5b28632737e1c1eba7fd"><div class="ttname"><a href="namespacellvm.html#a8d9ed62167be5b28632737e1c1eba7fd">llvm::createAMDGPUUnifyMetadataPass</a></div><div class="ttdeci">ModulePass * createAMDGPUUnifyMetadataPass()</div></div>
<div class="ttc" id="aclassllvm_1_1MDNode_html_a7d10a7b9b7f40b04d27ed97c38ea1950"><div class="ttname"><a href="classllvm_1_1MDNode.html#a7d10a7b9b7f40b04d27ed97c38ea1950">llvm::MDNode::get</a></div><div class="ttdeci">static MDTuple * get(LLVMContext &amp;Context, ArrayRef&lt; Metadata * &gt; MDs)</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8h_source.html#l01399">Metadata.h:1399</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1HSAMD_1_1V3_html_ac4e0e65d7dfff70958660d11303022a0"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1V3.html#ac4e0e65d7dfff70958660d11303022a0">llvm::AMDGPU::HSAMD::V3::VersionMajor</a></div><div class="ttdeci">constexpr uint32_t VersionMajor</div><div class="ttdoc">HSA metadata major version.</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUMetadata_8h_source.html#l00459">AMDGPUMetadata.h:459</a></div></div>
<div class="ttc" id="astructllvm_1_1AMDGPUUnifyMetadataPass_html_a538284b7129994222827deed13f792cc"><div class="ttname"><a href="structllvm_1_1AMDGPUUnifyMetadataPass.html#a538284b7129994222827deed13f792cc">llvm::AMDGPUUnifyMetadataPass::run</a></div><div class="ttdeci">PreservedAnalyses run(Module &amp;M, ModuleAnalysisManager &amp;AM)</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUUnifyMetadata_8cpp_source.html#l00140">AMDGPUUnifyMetadata.cpp:140</a></div></div>
<div class="ttc" id="aConstants_8h_html"><div class="ttname"><a href="Constants_8h.html">Constants.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1CallingConv_html_a188c0836f8c3528401f1c236fd93b977"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">llvm::CallingConv::ID</a></div><div class="ttdeci">unsigned ID</div><div class="ttdoc">LLVM IR allows to use arbitrary numbers as calling convention identifiers.</div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00024">CallingConv.h:24</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1HSAMD_1_1V3_html_a6ae72fd26391925af85f23b12c294f1d"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1V3.html#a6ae72fd26391925af85f23b12c294f1d">llvm::AMDGPU::HSAMD::V3::VersionMinor</a></div><div class="ttdeci">constexpr uint32_t VersionMinor</div><div class="ttdoc">HSA metadata minor version.</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUMetadata_8h_source.html#l00461">AMDGPUMetadata.h:461</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00058">MD5.cpp:58</a></div></div>
<div class="ttc" id="anamespacellvm_html_acd1cd968cb420c82d70926920fcdc7d7"><div class="ttname"><a href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">llvm::is_contained</a></div><div class="ttdeci">bool is_contained(R &amp;&amp;Range, const E &amp;Element)</div><div class="ttdoc">Wrapper function around std::find to detect if an element exists in a container.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01869">STLExtras.h:1869</a></div></div>
<div class="ttc" id="aSILowerControlFlow_8cpp_html_a4868c5d81c5ccc98c47aeab6244346a0"><div class="ttname"><a href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a></div><div class="ttdeci">assert(ImpDefSCC.getReg()==AMDGPU::SCC &amp;&amp;ImpDefSCC.isDef())</div></div>
<div class="ttc" id="aclassllvm_1_1Module_html"><div class="ttname"><a href="classllvm_1_1Module.html">llvm::Module</a></div><div class="ttdoc">A Module instance is used to store all the information related to an LLVM module.</div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00065">Module.h:65</a></div></div>
<div class="ttc" id="aclassllvm_1_1MDNode_html"><div class="ttname"><a href="classllvm_1_1MDNode.html">llvm::MDNode</a></div><div class="ttdoc">Metadata node.</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8h_source.html#l00943">Metadata.h:943</a></div></div>
<div class="ttc" id="aclassllvm_1_1StringRef_html"><div class="ttname"><a href="classllvm_1_1StringRef.html">llvm::StringRef</a></div><div class="ttdoc">StringRef - Represent a constant reference to a string, i.e.</div><div class="ttdef"><b>Definition:</b> <a href="StringRef_8h_source.html#l00050">StringRef.h:50</a></div></div>
<div class="ttc" id="aAMDGPU_8h_html"><div class="ttname"><a href="AMDGPU_8h.html">AMDGPU.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1MachO_html_a11849daa1b55a8c00390b349546112e7a2005c1eb611537027feb90dafcbbb444"><div class="ttname"><a href="namespacellvm_1_1MachO.html#a11849daa1b55a8c00390b349546112e7a2005c1eb611537027feb90dafcbbb444">llvm::MachO::All</a></div><div class="ttdeci">@ All</div><div class="ttdef"><b>Definition:</b> <a href="InterfaceFile_8h_source.html#l00069">InterfaceFile.h:69</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1SendMsg_html_a8594419a4ddfad2c9a79279c490e466d"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">llvm::AMDGPU::SendMsg::Op</a></div><div class="ttdeci">Op</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00357">SIDefines.h:357</a></div></div>
<div class="ttc" id="aclassllvm_1_1PreservedAnalyses_html_a1258a1ff55557c27684010ebd7283712"><div class="ttname"><a href="classllvm_1_1PreservedAnalyses.html#a1258a1ff55557c27684010ebd7283712">llvm::PreservedAnalyses::all</a></div><div class="ttdeci">static PreservedAnalyses all()</div><div class="ttdoc">Construct a special preserved set that preserves all passes.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00158">PassManager.h:158</a></div></div>
<div class="ttc" id="aPassManager_8h_html"><div class="ttname"><a href="PassManager_8h.html">PassManager.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisManager_html"><div class="ttname"><a href="classllvm_1_1AnalysisManager.html">llvm::AnalysisManager</a></div><div class="ttdoc">A container for analyses that lazily runs them and caches their results.</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8h_source.html#l00042">InstructionSimplify.h:42</a></div></div>
<div class="ttc" id="aAMDGPUUnifyMetadata_8cpp_html_a379585979dc370b7e1c5616b28f8b845"><div class="ttname"><a href="AMDGPUUnifyMetadata_8cpp.html#a379585979dc370b7e1c5616b28f8b845">INITIALIZE_PASS</a></div><div class="ttdeci">INITIALIZE_PASS(AMDGPUUnifyMetadata, &quot;amdgpu-unify-metadata&quot;, &quot;Unify multiple OpenCL metadata due to linking&quot;, false, false) ModulePass *llvm</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUUnifyMetadata_8cpp_source.html#l00129">AMDGPUUnifyMetadata.cpp:129</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 7 2023 10:09:40 for LLVM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
