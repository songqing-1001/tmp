<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/Analysis/TFLiteUtils.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">17.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_a25db018342d3ae6c7e6779086c18378.html">Analysis</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">TFLiteUtils.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="TFLiteUtils_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- TFUtils.cpp - tensorflow evaluation utilities ----------------------===//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// This file implements utilities for interfacing with tensorflow C APIs.</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;llvm/Config/config.h&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#if defined(LLVM_HAVE_TFLITE)</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Twine_8h.html">llvm/ADT/Twine.h</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TFUtils_8h.html">llvm/Analysis/Utils/TFUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Base64_8h.html">llvm/Support/Base64.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CommandLine_8h.html">llvm/Support/CommandLine.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Debug_8h.html">llvm/Support/Debug.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="JSON_8h.html">llvm/Support/JSON.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MemoryBuffer_8h.html">llvm/Support/MemoryBuffer.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Path_8h.html">llvm/Support/Path.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="raw__ostream_8h.html">llvm/Support/raw_ostream.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;tensorflow/lite/interpreter.h&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;tensorflow/lite/kernels/register.h&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;tensorflow/lite/model.h&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;tensorflow/lite/model_builder.h&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;tensorflow/lite/op_resolver.h&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;tensorflow/lite/logger.h&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &lt;numeric&gt;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &lt;optional&gt;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160; </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacellvm.html">llvm</a> {</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">class </span>EvaluationResultImpl {</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  EvaluationResultImpl(<span class="keyword">const</span> std::vector&lt;const TfLiteTensor *&gt; &amp;Outputs)</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;      : Outputs(Outputs){};</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="keyword">const</span> TfLiteTensor *getOutput(<span class="keywordtype">size_t</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) { <span class="keywordflow">return</span> Outputs[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]; }</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  EvaluationResultImpl(<span class="keyword">const</span> EvaluationResultImpl &amp;) = <span class="keyword">delete</span>;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  EvaluationResultImpl(EvaluationResultImpl &amp;&amp;Other) = <span class="keyword">delete</span>;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160; </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keyword">const</span> std::vector&lt;const TfLiteTensor *&gt; Outputs;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;};</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; </div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="keyword">class </span>TFModelEvaluatorImpl {</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  TFModelEvaluatorImpl(<a class="code" href="classllvm_1_1StringRef.html">StringRef</a> SavedModelPath,</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                       <span class="keyword">const</span> std::vector&lt;TensorSpec&gt; &amp;InputSpecs,</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                       <span class="keyword">const</span> std::vector&lt;TensorSpec&gt; &amp;OutputSpecs,</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                       <span class="keyword">const</span> <span class="keywordtype">char</span> *Tags);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="RustDemangle_8cpp.html#a103d8cfe62c1651cd70e181746f8a840">isValid</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> IsValid; }</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="keywordtype">size_t</span> outputSize()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> Output.size(); }</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160; </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  std::unique_ptr&lt;EvaluationResultImpl&gt; evaluate() {</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <a class="code" href="classllvm_1_1Interpreter.html">Interpreter</a>-&gt;Invoke();</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordflow">return</span> std::make_unique&lt;EvaluationResultImpl&gt;(Output);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  }</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160; </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keyword">const</span> std::vector&lt;TfLiteTensor *&gt; &amp;getInput()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> Input; }</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160; </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  ~TFModelEvaluatorImpl();</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  std::unique_ptr&lt;tflite::FlatBufferModel&gt; <a class="code" href="namespacellvm_1_1Reloc.html#af59f6dc86e80aaf56f1afd155eebf568">Model</a>;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">  /// The objects necessary for carrying out an evaluation of the SavedModel.</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">  /// They are expensive to set up, and we maintain them accross all the</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">  /// evaluations of the model.</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment"></span>  std::unique_ptr&lt;tflite::Interpreter&gt; <a class="code" href="namespacellvm_1_1EngineKind.html#a9df47239a42cd9621ac26d9ecbd57441acbd7ec5d01190e525d2f938b169b9a81">Interpreter</a>;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">  /// The input tensors. We set up the tensors once and just mutate theirs</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">  /// scalars before each evaluation. The input tensors keep their value after</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">  /// an evaluation.</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment"></span>  std::vector&lt;TfLiteTensor *&gt; Input;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">  /// The output nodes.</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment"></span>  std::vector&lt;const TfLiteTensor *&gt; Output;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160; </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="keywordtype">void</span> invalidate() { IsValid = <span class="keyword">false</span>; }</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="keywordtype">bool</span> IsValid = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">  /// Reusable utility for ensuring we can bind the requested Name to a node in</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">  /// the SavedModel Graph.</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> checkReportAndInvalidate(<span class="keyword">const</span> TfLiteTensor *Tensor,</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                                <span class="keyword">const</span> <a class="code" href="classllvm_1_1TensorSpec.html">TensorSpec</a> &amp;<a class="code" href="structllvm_1_1Spec.html">Spec</a>);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;};</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160; </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;} <span class="comment">// namespace llvm</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;TFModelEvaluatorImpl::TFModelEvaluatorImpl(</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> SavedModelPath, <span class="keyword">const</span> std::vector&lt;TensorSpec&gt; &amp;InputSpecs,</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keyword">const</span> std::vector&lt;TensorSpec&gt; &amp;OutputSpecs, <span class="keyword">const</span> <span class="keywordtype">char</span> *Tags = <span class="stringliteral">&quot;serve&quot;</span>)</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    : Input(InputSpecs.<a class="code" href="namespacellvm.html#a10f3d955592ae2bc745f57e5b48ae115">size</a>()), Output(OutputSpecs.<a class="code" href="namespacellvm.html#a10f3d955592ae2bc745f57e5b48ae115">size</a>()) {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="comment">// INFO and DEBUG messages could be numerous and not particularly interesting</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  tflite::LoggerOptions::SetMinimumLogSeverity(tflite::TFLITE_LOG_WARNING);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="comment">// FIXME: make ErrorReporter a member (may also need subclassing</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="comment">// StatefulErrorReporter) to easily get the latest error status, for</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="comment">// debugging.</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  tflite::StderrReporter ErrorReporter;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;char, 128&gt;</a> TFLitePathBuff;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <a class="code" href="namespacellvm_1_1sys_1_1path.html#acb80894344c78dacf8d5ff8c23be697d">llvm::sys::path::append</a>(TFLitePathBuff, SavedModelPath, <span class="stringliteral">&quot;model.tflite&quot;</span>);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> TFLitePath(TFLitePathBuff.data(), TFLitePathBuff.size());</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <a class="code" href="namespacellvm_1_1Reloc.html#af59f6dc86e80aaf56f1afd155eebf568">Model</a> = tflite::FlatBufferModel::BuildFromFile(TFLitePath.str().c_str(),</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                                                 &amp;ErrorReporter);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1Reloc.html#af59f6dc86e80aaf56f1afd155eebf568">Model</a>) {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    invalidate();</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  tflite::ops::builtin::BuiltinOpResolver <a class="code" href="classllvm_1_1Resolver.html">Resolver</a>;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  tflite::InterpreterBuilder <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(*<a class="code" href="namespacellvm_1_1Reloc.html#af59f6dc86e80aaf56f1afd155eebf568">Model</a>, <a class="code" href="classllvm_1_1Resolver.html">Resolver</a>);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(&amp;<a class="code" href="classllvm_1_1Interpreter.html">Interpreter</a>);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classllvm_1_1Interpreter.html">Interpreter</a>) {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    invalidate();</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  }</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160; </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="comment">// We assume the input buffers are valid for the lifetime of the interpreter.</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="comment">// By default, tflite allocates memory in an arena and will periodically take</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="comment">// away memory and reallocate it in a different location after evaluations in</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="comment">// order to improve utilization of the buffers owned in the arena. So, we</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="comment">// explicitly mark our input buffers as persistent to avoid this behavior.</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="classllvm_1_1Interpreter.html">Interpreter</a>-&gt;inputs().<a class="code" href="namespacellvm.html#a10f3d955592ae2bc745f57e5b48ae115">size</a>(); ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <a class="code" href="classllvm_1_1Interpreter.html">Interpreter</a>-&gt;tensor(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;allocation_type =</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        TfLiteAllocationType::kTfLiteArenaRwPersistent;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160; </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Interpreter.html">Interpreter</a>-&gt;AllocateTensors() != TfLiteStatus::kTfLiteOk) {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    invalidate();</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="comment">// Known inputs and outputs</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <a class="code" href="classllvm_1_1StringMap.html">StringMap&lt;int&gt;</a> InputsMap;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <a class="code" href="classllvm_1_1StringMap.html">StringMap&lt;int&gt;</a> OutputsMap;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="classllvm_1_1Interpreter.html">Interpreter</a>-&gt;inputs().<a class="code" href="namespacellvm.html#a10f3d955592ae2bc745f57e5b48ae115">size</a>(); ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    InputsMap[<a class="code" href="classllvm_1_1Interpreter.html">Interpreter</a>-&gt;GetInputName(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="classllvm_1_1Interpreter.html">Interpreter</a>-&gt;outputs().<a class="code" href="namespacellvm.html#a10f3d955592ae2bc745f57e5b48ae115">size</a>(); ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    OutputsMap[<a class="code" href="classllvm_1_1Interpreter.html">Interpreter</a>-&gt;GetOutputName(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="keywordtype">size_t</span> NumberFeaturesPassed = 0;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; InputSpecs.size(); ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keyword">auto</span> &amp;InputSpec = InputSpecs[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keyword">auto</span> MapI = InputsMap.<a class="code" href="classllvm_1_1StringMap.html#a49e68e4c86fe0b96c633adea0c366d74">find</a>(InputSpec.name() + <span class="stringliteral">&quot;:&quot;</span> +</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                               <a class="code" href="namespacellvm.html#a13c1b5a253da5da49ce33d03dc1efc07">std::to_string</a>(InputSpec.port()));</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">if</span> (MapI == InputsMap.<a class="code" href="classllvm_1_1StringMap.html#a16e5eaf2df56249e87019be23ee07695">end</a>()) {</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      Input[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    Input[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="classllvm_1_1Interpreter.html">Interpreter</a>-&gt;tensor(MapI-&gt;second);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">if</span> (!checkReportAndInvalidate(Input[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>], InputSpec))</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    std::memset(Input[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]-&gt;data.data, 0,</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                InputSpecs[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].getTotalTensorBufferSize());</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    ++NumberFeaturesPassed;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  }</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160; </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordflow">if</span> (NumberFeaturesPassed &lt; Interpreter-&gt;inputs().<a class="code" href="namespacellvm.html#a10f3d955592ae2bc745f57e5b48ae115">size</a>()) {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">// we haven&#39;t passed all the required features to the model, throw an error.</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <a class="code" href="namespacellvm.html#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>() &lt;&lt; <span class="stringliteral">&quot;Required feature(s) have not been passed to the ML model&quot;</span>;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    invalidate();</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  }</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160; </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; OutputSpecs.size(); ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> &amp;OutputSpec = OutputSpecs[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    Output[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="classllvm_1_1Interpreter.html">Interpreter</a>-&gt;output_tensor(</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        OutputsMap[OutputSpec.name() + <span class="stringliteral">&quot;:&quot;</span> +</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                   <a class="code" href="namespacellvm.html#a13c1b5a253da5da49ce33d03dc1efc07">std::to_string</a>(OutputSpec.port())]);</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordflow">if</span> (!checkReportAndInvalidate(Output[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>], OutputSpec))</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  }</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;}</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160; </div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;TFModelEvaluator::TFModelEvaluator(<a class="code" href="classllvm_1_1StringRef.html">StringRef</a> SavedModelPath,</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                                   <span class="keyword">const</span> std::vector&lt;TensorSpec&gt; &amp;InputSpecs,</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                                   <span class="keyword">const</span> std::vector&lt;TensorSpec&gt; &amp;OutputSpecs,</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                                   <span class="keyword">const</span> <span class="keywordtype">char</span> *Tags)</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    : Impl(<a class="code" href="lib_2CodeGen_2README_8txt.html#a3f8966a44f193849a18c573b402472b8">new</a> TFModelEvaluatorImpl(SavedModelPath, InputSpecs, OutputSpecs,</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                                    Tags)) {</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="keywordflow">if</span> (!Impl-&gt;isValid())</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    Impl.reset();</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;}</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160; </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;TFModelEvaluatorImpl::~TFModelEvaluatorImpl() {}</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160; </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="keywordtype">bool</span> TFModelEvaluatorImpl::checkReportAndInvalidate(<span class="keyword">const</span> TfLiteTensor *Tensor,</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                                                    <span class="keyword">const</span> <a class="code" href="classllvm_1_1TensorSpec.html">TensorSpec</a> &amp;<a class="code" href="structllvm_1_1Spec.html">Spec</a>) {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="keywordflow">if</span> (!Tensor) {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <a class="code" href="namespacellvm.html#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>() &lt;&lt; <span class="stringliteral">&quot;Could not find TF_Output named: &quot;</span> + <a class="code" href="structllvm_1_1Spec.html">Spec</a>.name();</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    IsValid = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  }</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="structllvm_1_1Spec.html">Spec</a>.getTotalTensorBufferSize() != Tensor-&gt;bytes)</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    IsValid = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="comment">// If the total sizes match, there could still be a mismatch in the shape.</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="comment">// We ignore that for now.</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="keywordflow">return</span> IsValid;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;}</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;std::optional&lt;TFModelEvaluator::EvaluationResult&gt; TFModelEvaluator::evaluate() {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="RustDemangle_8cpp.html#a103d8cfe62c1651cd70e181746f8a840">isValid</a>())</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="keywordflow">return</span> EvaluationResult(Impl-&gt;evaluate());</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;}</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="keywordtype">void</span> *TFModelEvaluator::getUntypedInput(<span class="keywordtype">size_t</span> <a class="code" href="ELFObjHandler_8cpp.html#aef61945034b9431b804748fc317c5548">Index</a>) {</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  TfLiteTensor *<a class="code" href="classT.html">T</a> = Impl-&gt;getInput()[<a class="code" href="ELFObjHandler_8cpp.html#aef61945034b9431b804748fc317c5548">Index</a>];</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classT.html">T</a>)</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classT.html">T</a>-&gt;data.data;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;}</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;TFModelEvaluator::EvaluationResult::EvaluationResult(</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    std::unique_ptr&lt;EvaluationResultImpl&gt; Impl)</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    : Impl(<a class="code" href="namespacestd.html">std</a>::<a class="code" href="namespacellvm.html#abfc9c7ecf70f66901e439f7c04ef3dbb">move</a>(Impl)) {}</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160; </div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;TFModelEvaluator::EvaluationResult::EvaluationResult(EvaluationResult &amp;&amp;<a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>)</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    : Impl(<a class="code" href="namespacestd.html">std</a>::<a class="code" href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">move</a>(<a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.Impl)) {}</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160; </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;TFModelEvaluator::EvaluationResult &amp;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;TFModelEvaluator::EvaluationResult::operator=(EvaluationResult &amp;&amp;<a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>) {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  Impl = <a class="code" href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">std::move</a>(<a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.Impl);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;}</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="keywordtype">void</span> *TFModelEvaluator::EvaluationResult::getUntypedTensorValue(<span class="keywordtype">size_t</span> <a class="code" href="ELFObjHandler_8cpp.html#aef61945034b9431b804748fc317c5548">Index</a>) {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="keywordflow">return</span> Impl-&gt;getOutput(<a class="code" href="ELFObjHandler_8cpp.html#aef61945034b9431b804748fc317c5548">Index</a>)-&gt;data.data;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;}</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160; </div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="keyword">const</span> <span class="keywordtype">void</span> *</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;TFModelEvaluator::EvaluationResult::getUntypedTensorValue(<span class="keywordtype">size_t</span> <a class="code" href="ELFObjHandler_8cpp.html#aef61945034b9431b804748fc317c5548">Index</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="keywordflow">return</span> Impl-&gt;getOutput(<a class="code" href="ELFObjHandler_8cpp.html#aef61945034b9431b804748fc317c5548">Index</a>)-&gt;data.data;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;}</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160; </div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;TFModelEvaluator::EvaluationResult::~EvaluationResult() {}</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;TFModelEvaluator::~TFModelEvaluator() {}</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="preprocessor">#endif // defined(LLVM_HAVE_TFLITE)</span></div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aMemoryBuffer_8h_html"><div class="ttname"><a href="MemoryBuffer_8h.html">MemoryBuffer.h</a></div></div>
<div class="ttc" id="aTFUtils_8h_html"><div class="ttname"><a href="TFUtils_8h.html">TFUtils.h</a></div></div>
<div class="ttc" id="anamespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">This is an optimization pass for GlobalISel generic memory operations.</div><div class="ttdef"><b>Definition:</b> <a href="AddressRanges_8h_source.html#l00018">AddressRanges.h:18</a></div></div>
<div class="ttc" id="aclassT_html"><div class="ttname"><a href="classT.html">T</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdoc">This is a 'vector' (really, a variable-sized array), optimized for the case when the array is small.</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l01199">SmallVector.h:1199</a></div></div>
<div class="ttc" id="aPath_8h_html"><div class="ttname"><a href="Path_8h.html">Path.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1StringMap_html_a16e5eaf2df56249e87019be23ee07695"><div class="ttname"><a href="classllvm_1_1StringMap.html#a16e5eaf2df56249e87019be23ee07695">llvm::StringMap::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="ADT_2StringMap_8h_source.html#l00204">StringMap.h:204</a></div></div>
<div class="ttc" id="anamespacellvm_html_a9a7b5c68c90f85baaedaa854cc5002cc"><div class="ttname"><a href="namespacellvm.html#a9a7b5c68c90f85baaedaa854cc5002cc">llvm::errs</a></div><div class="ttdeci">raw_fd_ostream &amp; errs()</div><div class="ttdoc">This returns a reference to a raw_ostream for standard error.</div><div class="ttdef"><b>Definition:</b> <a href="raw__ostream_8cpp_source.html#l00899">raw_ostream.cpp:899</a></div></div>
<div class="ttc" id="aclassllvm_1_1StringMap_html_a49e68e4c86fe0b96c633adea0c366d74"><div class="ttname"><a href="classllvm_1_1StringMap.html#a49e68e4c86fe0b96c633adea0c366d74">llvm::StringMap::find</a></div><div class="ttdeci">iterator find(StringRef Key)</div><div class="ttdef"><b>Definition:</b> <a href="ADT_2StringMap_8h_source.html#l00217">StringMap.h:217</a></div></div>
<div class="ttc" id="alib_2CodeGen_2README_8txt_html_a3f8966a44f193849a18c573b402472b8"><div class="ttname"><a href="lib_2CodeGen_2README_8txt.html#a3f8966a44f193849a18c573b402472b8">new</a></div><div class="ttdeci">Common register allocation spilling lr str ldr sxth r3 ldr mla r4 can lr mov lr str ldr sxth r3 mla r4 and then merge mul and lr str ldr sxth r3 mla r4 It also increase the likelihood the store may become dead bb27 Successors according to LLVM ID Predecessors according to mbb&lt; bb27, 0x8b0a7c0 &gt; Note ADDri is not a two address instruction its result reg1037 is an operand of the PHI node in bb76 and its operand reg1039 is the result of the PHI node We should treat it as a two address code and make sure the ADDri is scheduled after any node that reads reg1039 Use info(i.e. register scavenger) to assign it a free register to allow reuse the collector could move the objects and invalidate the derived pointer This is bad enough in the first but safe points can crop up unpredictably **array_addr i32 n y store obj * new</div><div class="ttdef"><b>Definition:</b> <a href="lib_2CodeGen_2README_8txt_source.html#l00125">README.txt:125</a></div></div>
<div class="ttc" id="anamespacellvm_1_1Reloc_html_af59f6dc86e80aaf56f1afd155eebf568"><div class="ttname"><a href="namespacellvm_1_1Reloc.html#af59f6dc86e80aaf56f1afd155eebf568">llvm::Reloc::Model</a></div><div class="ttdeci">Model</div><div class="ttdef"><b>Definition:</b> <a href="CodeGen_8h_source.html#l00025">CodeGen.h:25</a></div></div>
<div class="ttc" id="anamespacellvm_1_1sys_1_1path_html_acb80894344c78dacf8d5ff8c23be697d"><div class="ttname"><a href="namespacellvm_1_1sys_1_1path.html#acb80894344c78dacf8d5ff8c23be697d">llvm::sys::path::append</a></div><div class="ttdeci">void append(SmallVectorImpl&lt; char &gt; &amp;path, const Twine &amp;a, const Twine &amp;b=&quot;&quot;, const Twine &amp;c=&quot;&quot;, const Twine &amp;d=&quot;&quot;)</div><div class="ttdoc">Append to path.</div><div class="ttdef"><b>Definition:</b> <a href="Path_8cpp_source.html#l00456">Path.cpp:456</a></div></div>
<div class="ttc" id="aclassllvm_1_1Resolver_html"><div class="ttname"><a href="classllvm_1_1Resolver.html">llvm::Resolver</a></div><div class="ttdoc">Interface for looking up the initializer for a variable name, used by Init::resolveReferences.</div><div class="ttdef"><b>Definition:</b> <a href="Record_8h_source.html#l02137">Record.h:2137</a></div></div>
<div class="ttc" id="aCommandLine_8h_html"><div class="ttname"><a href="CommandLine_8h.html">CommandLine.h</a></div></div>
<div class="ttc" id="aTwine_8h_html"><div class="ttname"><a href="Twine_8h.html">Twine.h</a></div></div>
<div class="ttc" id="aJSON_8h_html"><div class="ttname"><a href="JSON_8h.html">JSON.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1StringMap_html"><div class="ttname"><a href="classllvm_1_1StringMap.html">llvm::StringMap&lt; int &gt;</a></div></div>
<div class="ttc" id="aELFObjHandler_8cpp_html_aef61945034b9431b804748fc317c5548"><div class="ttname"><a href="ELFObjHandler_8cpp.html#aef61945034b9431b804748fc317c5548">Index</a></div><div class="ttdeci">uint32_t Index</div><div class="ttdef"><b>Definition:</b> <a href="ELFObjHandler_8cpp_source.html#l00083">ELFObjHandler.cpp:83</a></div></div>
<div class="ttc" id="alib_2Target_2ARM_2README_8txt_html_ad3a99906764c35b2694ae90fa57744a5"><div class="ttname"><a href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">move</a></div><div class="ttdeci">compiles ldr LCPI1_0 ldr ldr mov lsr tst moveq r1 ldr LCPI1_1 and r0 bx lr It would be better to do something like to fold the shift into the conditional move</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2ARM_2README_8txt_source.html#l00546">README.txt:546</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00058">MD5.cpp:58</a></div></div>
<div class="ttc" id="aBase64_8h_html"><div class="ttname"><a href="Base64_8h.html">Base64.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_abfc9c7ecf70f66901e439f7c04ef3dbb"><div class="ttname"><a href="namespacellvm.html#abfc9c7ecf70f66901e439f7c04ef3dbb">llvm::move</a></div><div class="ttdeci">OutputIt move(R &amp;&amp;Range, OutputIt Out)</div><div class="ttdoc">Provide wrappers to std::move which take ranges instead of having to pass begin/end explicitly.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01862">STLExtras.h:1862</a></div></div>
<div class="ttc" id="aAssumeBundleBuilder_8cpp_html_afb136e0532bcaed86521b462e6538d62"><div class="ttname"><a href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a></div><div class="ttdeci">assume Assume Builder</div><div class="ttdef"><b>Definition:</b> <a href="AssumeBundleBuilder_8cpp_source.html#l00651">AssumeBundleBuilder.cpp:651</a></div></div>
<div class="ttc" id="anamespacellvm_html_a10f3d955592ae2bc745f57e5b48ae115"><div class="ttname"><a href="namespacellvm.html#a10f3d955592ae2bc745f57e5b48ae115">llvm::size</a></div><div class="ttdeci">auto size(R &amp;&amp;Range, std::enable_if_t&lt; std::is_base_of&lt; std::random_access_iterator_tag, typename std::iterator_traits&lt; decltype(Range.begin())&gt;::iterator_category &gt;::value, void &gt; *=nullptr)</div><div class="ttdoc">Get the size of a range.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01716">STLExtras.h:1716</a></div></div>
<div class="ttc" id="aclassllvm_1_1StringRef_html"><div class="ttname"><a href="classllvm_1_1StringRef.html">llvm::StringRef</a></div><div class="ttdoc">StringRef - Represent a constant reference to a string, i.e.</div><div class="ttdef"><b>Definition:</b> <a href="StringRef_8h_source.html#l00050">StringRef.h:50</a></div></div>
<div class="ttc" id="anamespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div><div class="ttdef"><b>Definition:</b> <a href="BitVector_8h_source.html#l00851">BitVector.h:851</a></div></div>
<div class="ttc" id="astructllvm_1_1Spec_html"><div class="ttname"><a href="structllvm_1_1Spec.html">llvm::Spec</a></div><div class="ttdef"><b>Definition:</b> <a href="FunctionSpecialization_8h_source.html#l00087">FunctionSpecialization.h:87</a></div></div>
<div class="ttc" id="aRustDemangle_8cpp_html_a103d8cfe62c1651cd70e181746f8a840"><div class="ttname"><a href="RustDemangle_8cpp.html#a103d8cfe62c1651cd70e181746f8a840">isValid</a></div><div class="ttdeci">static bool isValid(const char C)</div><div class="ttdoc">Returns true if C is a valid mangled character: &lt;0-9a-zA-Z_&gt;.</div><div class="ttdef"><b>Definition:</b> <a href="RustDemangle_8cpp_source.html#l00184">RustDemangle.cpp:184</a></div></div>
<div class="ttc" id="aELFYAML_8cpp_html_a941c34da9850676ce3380813c636cff2"><div class="ttname"><a href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a></div><div class="ttdeci">std::optional&lt; std::vector&lt; StOtherPiece &gt; &gt; Other</div><div class="ttdef"><b>Definition:</b> <a href="ELFYAML_8cpp_source.html#l01260">ELFYAML.cpp:1260</a></div></div>
<div class="ttc" id="aclassllvm_1_1Interpreter_html"><div class="ttname"><a href="classllvm_1_1Interpreter.html">llvm::Interpreter</a></div><div class="ttdef"><b>Definition:</b> <a href="lib_2ExecutionEngine_2Interpreter_2Interpreter_8h_source.html#l00074">Interpreter.h:74</a></div></div>
<div class="ttc" id="anamespacellvm_html_a13c1b5a253da5da49ce33d03dc1efc07"><div class="ttname"><a href="namespacellvm.html#a13c1b5a253da5da49ce33d03dc1efc07">llvm::to_string</a></div><div class="ttdeci">std::string to_string(const T &amp;Value)</div><div class="ttdef"><b>Definition:</b> <a href="ScopedPrinter_8h_source.html#l00085">ScopedPrinter.h:85</a></div></div>
<div class="ttc" id="anamespacellvm_1_1EngineKind_html_a9df47239a42cd9621ac26d9ecbd57441acbd7ec5d01190e525d2f938b169b9a81"><div class="ttname"><a href="namespacellvm_1_1EngineKind.html#a9df47239a42cd9621ac26d9ecbd57441acbd7ec5d01190e525d2f938b169b9a81">llvm::EngineKind::Interpreter</a></div><div class="ttdeci">@ Interpreter</div><div class="ttdef"><b>Definition:</b> <a href="ExecutionEngine_2ExecutionEngine_8h_source.html#l00525">ExecutionEngine.h:525</a></div></div>
<div class="ttc" id="araw__ostream_8h_html"><div class="ttname"><a href="raw__ostream_8h.html">raw_ostream.h</a></div></div>
<div class="ttc" id="aDebug_8h_html"><div class="ttname"><a href="Debug_8h.html">Debug.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1TensorSpec_html"><div class="ttname"><a href="classllvm_1_1TensorSpec.html">llvm::TensorSpec</a></div><div class="ttdef"><b>Definition:</b> <a href="TensorSpec_8h_source.html#l00054">TensorSpec.h:54</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 7 2023 09:49:47 for LLVM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
