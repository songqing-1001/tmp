<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/Target/CSKY/CSKYConstantIslandPass.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">17.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_794e483eb1cc7921d35fd149d9cc325b.html">Target</a></li><li class="navelem"><a class="el" href="dir_dcd70ce1a510550738c4cebab1067f96.html">CSKY</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">CSKYConstantIslandPass.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="CSKYConstantIslandPass_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- CSKYConstantIslandPass.cpp - Emit PC Relative loads ----------------===//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// Loading constants inline is expensive on CSKY and it&#39;s in general better</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// to place the constant nearby in code space and then it can be loaded with a</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// simple 16/32 bit load instruction like lrw.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// The constants can be not just numbers but addresses of functions and labels.</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">// This can be particularly helpful in static relocation mode for embedded</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">// non-linux targets.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160; </div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CSKY_8h.html">CSKY.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CSKYConstantPoolValue_8h.html">CSKYConstantPoolValue.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CSKYMachineFunctionInfo_8h.html">CSKYMachineFunctionInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CSKYSubtarget_8h.html">CSKYSubtarget.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="STLExtras_8h.html">llvm/ADT/STLExtras.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallSet_8h.html">llvm/ADT/SmallSet.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallVector_8h.html">llvm/ADT/SmallVector.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Statistic_8h.html">llvm/ADT/Statistic.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="StringRef_8h.html">llvm/ADT/StringRef.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineBasicBlock_8h.html">llvm/CodeGen/MachineBasicBlock.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineConstantPool_8h.html">llvm/CodeGen/MachineConstantPool.h</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineDominators_8h.html">llvm/CodeGen/MachineDominators.h</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineFrameInfo_8h.html">llvm/CodeGen/MachineFrameInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineFunction_8h.html">llvm/CodeGen/MachineFunction.h</a>&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineFunctionPass_8h.html">llvm/CodeGen/MachineFunctionPass.h</a>&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineInstr_8h.html">llvm/CodeGen/MachineInstr.h</a>&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineInstrBuilder_8h.html">llvm/CodeGen/MachineInstrBuilder.h</a>&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineOperand_8h.html">llvm/CodeGen/MachineOperand.h</a>&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineRegisterInfo_8h.html">llvm/CodeGen/MachineRegisterInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;llvm/Config/llvm-config.h&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constants_8h.html">llvm/IR/Constants.h</a>&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DataLayout_8h.html">llvm/IR/DataLayout.h</a>&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DebugLoc_8h.html">llvm/IR/DebugLoc.h</a>&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Function_8h.html">llvm/IR/Function.h</a>&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Type_8h.html">llvm/IR/Type.h</a>&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CommandLine_8h.html">llvm/Support/CommandLine.h</a>&quot;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Compiler_8h.html">llvm/Support/Compiler.h</a>&quot;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Debug_8h.html">llvm/Support/Debug.h</a>&quot;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Support_2ErrorHandling_8h.html">llvm/Support/ErrorHandling.h</a>&quot;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Format_8h.html">llvm/Support/Format.h</a>&quot;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MathExtras_8h.html">llvm/Support/MathExtras.h</a>&quot;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="raw__ostream_8h.html">llvm/Support/raw_ostream.h</a>&quot;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &lt;cstdint&gt;</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &lt;iterator&gt;</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="CSKYConstantIslandPass_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">   60</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;CSKY-constant-islands&quot;</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumCPEs, <span class="stringliteral">&quot;Number of constpool entries&quot;</span>);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumSplit, <span class="stringliteral">&quot;Number of uncond branches inserted&quot;</span>);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumCBrFixed, <span class="stringliteral">&quot;Number of cond branches fixed&quot;</span>);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumUBrFixed, <span class="stringliteral">&quot;Number of uncond branches fixed&quot;</span>);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="keyword">using</span> Iter = <a class="code" href="classllvm_1_1MachineBasicBlock.html#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a>;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="keyword">using</span> ReverseIter = <a class="code" href="classllvm_1_1MachineBasicBlock.html#abada92f8cd2854d2b747f14c4a7be0ed">MachineBasicBlock::reverse_iterator</a>;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">/// CSKYConstantIslands - Due to limited PC-relative displacements, CSKY</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">/// requires constant pool entries to be scattered among the instructions</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">/// inside a function.  To do this, it completely ignores the normal LLVM</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">/// constant pool; instead, it places constants wherever it feels like with</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">/// special instructions.</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">/// The terminology used in this pass includes:</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">///   Islands - Clumps of constants placed in the function.</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">///   Water   - Potential places where an island could be formed.</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">///   CPE     - A constant pool entry that has been placed somewhere, which</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">///             tracks a list of users.</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="keyword">class </span>CSKYConstantIslands : <span class="keyword">public</span> <a class="code" href="classllvm_1_1MachineFunctionPass.html">MachineFunctionPass</a> {<span class="comment"></span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">  /// BasicBlockInfo - Information about the offset and size of a single</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">  /// basic block.</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment"></span>  <span class="keyword">struct </span><a class="code" href="structllvm_1_1BasicBlockInfo.html">BasicBlockInfo</a> {<span class="comment"></span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">    /// Offset - Distance from the beginning of the function to the beginning</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">    /// of this basic block.</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">    ///</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">    /// Offsets are computed assuming worst case padding before an aligned</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">    /// block. This means that subtracting basic block offsets always gives a</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">    /// conservative estimate of the real distance which may be smaller.</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">    ///</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">    /// Because worst case padding is used, the computed offset of an aligned</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">    /// block may not actually be aligned.</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm.html#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = 0;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">    /// Size - Size of the basic block in bytes.  If the block contains</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">    /// inline assembly, this is a worst case estimate.</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">    ///</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">    /// The size does not include any alignment padding whether from the</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">    /// beginning of the block, or from an aligned jump table at the end.</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> Size = 0;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <a class="code" href="structllvm_1_1BasicBlockInfo.html">BasicBlockInfo</a>() = <span class="keywordflow">default</span>;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordtype">unsigned</span> postOffset()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> + Size; }</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  };</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  std::vector&lt;BasicBlockInfo&gt; BBInfo;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">  /// WaterList - A sorted list of basic blocks where islands could be placed</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">  /// (i.e. blocks that don&#39;t fall through to the following block, due</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">  /// to a return, unreachable, or unconditional branch).</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment"></span>  std::vector&lt;MachineBasicBlock *&gt; WaterList;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">  /// NewWaterList - The subset of WaterList that was created since the</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">  /// previous iteration by inserting unconditional branches.</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallSet.html">SmallSet&lt;MachineBasicBlock *, 4&gt;</a> NewWaterList;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="keyword">using</span> water_iterator = std::vector&lt;MachineBasicBlock *&gt;::iterator;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">  /// CPUser - One user of a constant pool, keeping the machine instruction</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">  /// pointer, the constant pool being referenced, and the max displacement</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">  /// allowed from the instruction to the CP.  The HighWaterMark records the</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">  /// highest basic block where a new CPEntry can be placed.  To ensure this</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">  /// pass terminates, the CP entries are initially placed at the end of the</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">  /// function and then move monotonically to lower addresses.  The</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">  /// exception to this rule is when the current CP entry for a particular</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">  /// CPUser is out of range, but there is another CP entry for the same</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">  /// constant value in range.  We want to use the existing in-range CP</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">  /// entry, but if it later moves out of range, the search for new water</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">  /// should resume where it left off.  The HighWaterMark is used to record</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">  /// that point.</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment"></span>  <span class="keyword">struct </span>CPUser {</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *HighWaterMark;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="keyword">private</span>:</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordtype">unsigned</span> MaxDisp;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160; </div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="keyword">public</span>:</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordtype">bool</span> NegOk;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    CPUser(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *Mi, <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *Cpemi, <span class="keywordtype">unsigned</span> Maxdisp, <span class="keywordtype">bool</span> Neg)</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        : <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>(Mi), CPEMI(Cpemi), MaxDisp(Maxdisp), NegOk(Neg) {</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      HighWaterMark = CPEMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a002fd916e7206e01d512eeb06d405cf0">getParent</a>();</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    }</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">    /// getMaxDisp - Returns the maximum displacement supported by MI.</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> getMaxDisp()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> MaxDisp - 16; }</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordtype">void</span> setMaxDisp(<span class="keywordtype">unsigned</span> Val) { MaxDisp = Val; }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  };</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">  /// CPUsers - Keep track of all of the machine instructions that use various</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">  /// constant pools and their max displacement.</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment"></span>  std::vector&lt;CPUser&gt; CPUsers;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">  /// CPEntry - One per constant pool entry, keeping the machine instruction</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">  /// pointer, the constpool index, and the number of CPUser&#39;s which</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">  /// reference this entry.</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment"></span>  <span class="keyword">struct </span>CPEntry {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordtype">unsigned</span> CPI;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordtype">unsigned</span> RefCount;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    CPEntry(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *Cpemi, <span class="keywordtype">unsigned</span> Cpi, <span class="keywordtype">unsigned</span> Rc = 0)</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        : CPEMI(Cpemi), CPI(Cpi), RefCount(Rc) {}</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  };</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">  /// CPEntries - Keep track of all of the constant pool entry machine</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">  /// instructions. For each original constpool index (i.e. those that</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">  /// existed upon entry to this pass), it keeps a vector of entries.</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">  /// Original elements are cloned as we go along; the clones are</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">  /// put in the vector of the original element, but have distinct CPIs.</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment"></span>  std::vector&lt;std::vector&lt;CPEntry&gt;&gt; CPEntries;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">  /// ImmBranch - One per immediate branch, keeping the machine instruction</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">  /// pointer, conditional or unconditional, the max displacement,</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">  /// and (if isCond is true) the corresponding unconditional branch</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">  /// opcode.</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment"></span>  <span class="keyword">struct </span>ImmBranch {</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordtype">unsigned</span> MaxDisp : 31;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordtype">bool</span> IsCond : 1;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordtype">int</span> UncondBr;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160; </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    ImmBranch(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *Mi, <span class="keywordtype">unsigned</span> Maxdisp, <span class="keywordtype">bool</span> <a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>, <span class="keywordtype">int</span> Ubr)</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        : <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>(Mi), MaxDisp(Maxdisp), IsCond(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>), UncondBr(Ubr) {}</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  };</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">  /// ImmBranches - Keep track of all the immediate branch instructions.</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">  ///</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment"></span>  std::vector&lt;ImmBranch&gt; ImmBranches;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160; </div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1CSKYSubtarget.html">CSKYSubtarget</a> *STI = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1CSKYInstrInfo.html">CSKYInstrInfo</a> *<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <a class="code" href="classllvm_1_1CSKYMachineFunctionInfo.html">CSKYMachineFunctionInfo</a> *MFI;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> *MF = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <a class="code" href="classllvm_1_1MachineConstantPool.html">MachineConstantPool</a> *MCP = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordtype">unsigned</span> PICLabelUId;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160; </div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordtype">void</span> initPICLabelUId(<span class="keywordtype">unsigned</span> UId) { PICLabelUId = UId; }</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160; </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordtype">unsigned</span> createPICLabelUId() { <span class="keywordflow">return</span> PICLabelUId++; }</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  CSKYConstantIslands() : <a class="code" href="classllvm_1_1MachineFunctionPass.html">MachineFunctionPass</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>) {}</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160; </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> getPassName()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;CSKY Constant Islands&quot;</span>; }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="keywordtype">bool</span> runOnMachineFunction(<a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) <span class="keyword">override</span>;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="keywordtype">void</span> getAnalysisUsage(<a class="code" href="classllvm_1_1AnalysisUsage.html">AnalysisUsage</a> &amp;AU)<span class="keyword"> const override </span>{</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1MachineDominatorTree.html">MachineDominatorTree</a>&gt;();</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <a class="code" href="classllvm_1_1MachineFunctionPass.html#a864fd57b4304ef933b3281d0ef85a88e">MachineFunctionPass::getAnalysisUsage</a>(AU);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  }</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <a class="code" href="classllvm_1_1MachineFunctionProperties.html">MachineFunctionProperties</a> getRequiredProperties()<span class="keyword"> const override </span>{</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1MachineFunctionProperties.html">MachineFunctionProperties</a>().<a class="code" href="classllvm_1_1MachineFunctionProperties.html#aa0f2b6097642894ce79ff3e15c896206">set</a>(</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <a class="code" href="classllvm_1_1MachineFunctionProperties.html#ad85237c6c667e4713efe8921e9c32ac1a72f7d830dd5ddb30f06d8e9639558ac3">MachineFunctionProperties::Property::NoVRegs</a>);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  }</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="keywordtype">void</span> doInitialPlacement(std::vector&lt;MachineInstr *&gt; &amp;CPEMIs);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  CPEntry *findConstPoolEntry(<span class="keywordtype">unsigned</span> CPI, <span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <a class="code" href="structllvm_1_1Align.html">Align</a> getCPEAlign(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;CPEMI);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordtype">void</span> initializeFunctionInfo(<span class="keyword">const</span> std::vector&lt;MachineInstr *&gt; &amp;CPEMIs);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="keywordtype">unsigned</span> getOffsetOf(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keywordtype">unsigned</span> getUserOffset(CPUser &amp;) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="keywordtype">void</span> dumpBBs();</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="keywordtype">bool</span> isOffsetInRange(<span class="keywordtype">unsigned</span> UserOffset, <span class="keywordtype">unsigned</span> TrialOffset, <span class="keywordtype">unsigned</span> Disp,</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                       <span class="keywordtype">bool</span> NegativeOK);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keywordtype">bool</span> isOffsetInRange(<span class="keywordtype">unsigned</span> UserOffset, <span class="keywordtype">unsigned</span> TrialOffset,</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                       <span class="keyword">const</span> CPUser &amp;U);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160; </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="keywordtype">void</span> computeBlockSize(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *splitBlockBeforeInstr(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordtype">void</span> updateForInsertedWaterBlock(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *NewBB);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="keywordtype">void</span> adjustBBOffsetsAfter(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="keywordtype">bool</span> decrementCPEReferenceCount(<span class="keywordtype">unsigned</span> CPI, <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="keywordtype">int</span> findInRangeCPEntry(CPUser &amp;U, <span class="keywordtype">unsigned</span> UserOffset);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keywordtype">bool</span> findAvailableWater(CPUser &amp;U, <span class="keywordtype">unsigned</span> UserOffset,</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                          water_iterator &amp;WaterIter);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <span class="keywordtype">void</span> createNewWater(<span class="keywordtype">unsigned</span> CPUserIndex, <span class="keywordtype">unsigned</span> UserOffset,</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                      <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *&amp;NewMBB);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="keywordtype">bool</span> handleConstantPoolUser(<span class="keywordtype">unsigned</span> CPUserIndex);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keywordtype">void</span> removeDeadCPEMI(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="keywordtype">bool</span> removeUnusedCPEntries();</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="keywordtype">bool</span> isCPEntryInRange(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <span class="keywordtype">unsigned</span> UserOffset,</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                        <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI, <span class="keywordtype">unsigned</span> Disp, <span class="keywordtype">bool</span> NegOk,</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                        <span class="keywordtype">bool</span> DoDump = <span class="keyword">false</span>);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="keywordtype">bool</span> isWaterInRange(<span class="keywordtype">unsigned</span> UserOffset, <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *Water, CPUser &amp;U,</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                      <span class="keywordtype">unsigned</span> &amp;Growth);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="keywordtype">bool</span> isBBInRange(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <span class="keywordtype">unsigned</span> Disp);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keywordtype">bool</span> fixupImmediateBr(ImmBranch &amp;Br);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keywordtype">bool</span> fixupConditionalBr(ImmBranch &amp;Br);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keywordtype">bool</span> fixupUnconditionalBr(ImmBranch &amp;Br);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;};</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">CSKYConstantIslands::ID</a> = 0;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160; </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="keywordtype">bool</span> CSKYConstantIslands::isOffsetInRange(<span class="keywordtype">unsigned</span> UserOffset,</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                                          <span class="keywordtype">unsigned</span> TrialOffset,</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                                          <span class="keyword">const</span> CPUser &amp;U) {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keywordflow">return</span> isOffsetInRange(UserOffset, TrialOffset, U.getMaxDisp(), U.NegOk);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;}</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="preprocessor">#if !defined(NDEBUG) || defined(LLVM_ENABLE_DUMP)</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">/// print block size and offset information - debugging</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment"></span><a class="code" href="Compiler_8h.html#aa863693eef567397d9c292da5bf22d34">LLVM_DUMP_METHOD</a> <span class="keywordtype">void</span> CSKYConstantIslands::dumpBBs() {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> J = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = BBInfo.size(); J != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++J) {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keyword">const</span> <a class="code" href="structllvm_1_1BasicBlockInfo.html">BasicBlockInfo</a> &amp;BBI = BBInfo[J];</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a class="code" href="namespacellvm.html#a66f0c57e04037076030c6a6e48f44f2d">format</a>(<span class="stringliteral">&quot;%08x %bb.%u\t&quot;</span>, BBI.<a class="code" href="structllvm_1_1BasicBlockInfo.html#acadf079e9232969cd61ca5744b10dd16">Offset</a>, J)</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;           &lt;&lt; <a class="code" href="namespacellvm.html#a66f0c57e04037076030c6a6e48f44f2d">format</a>(<span class="stringliteral">&quot; size=%#x\n&quot;</span>, BBInfo[J].Size);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  }</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;}</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="keywordtype">bool</span> CSKYConstantIslands::runOnMachineFunction(<a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;Mf) {</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  MF = &amp;Mf;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  MCP = Mf.<a class="code" href="classllvm_1_1MachineFunction.html#aa460158a4019a4043faf6ea76344cbd5">getConstantPool</a>();</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  STI = &amp;Mf.<a class="code" href="classllvm_1_1MachineFunction.html#a325f6b611ef9ec06798d3b4eb9572093">getSubtarget</a>&lt;<a class="code" href="classllvm_1_1CSKYSubtarget.html">CSKYSubtarget</a>&gt;();</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160; </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;***** CSKYConstantIslands: &quot;</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                    &lt;&lt; MCP-&gt;getConstants().size() &lt;&lt; <span class="stringliteral">&quot; CP entries, aligned to &quot;</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                    &lt;&lt; MCP-&gt;getConstantPoolAlign().value() &lt;&lt; <span class="stringliteral">&quot; bytes *****\n&quot;</span>);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a> = STI-&gt;getInstrInfo();</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  MFI = MF-&gt;getInfo&lt;<a class="code" href="classllvm_1_1CSKYMachineFunctionInfo.html">CSKYMachineFunctionInfo</a>&gt;();</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160; </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="comment">// This pass invalidates liveness information when it splits basic blocks.</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  MF-&gt;getRegInfo().invalidateLiveness();</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="comment">// Renumber all of the machine basic blocks in the function, guaranteeing that</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="comment">// the numbers agree with the position of the block in the function.</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  MF-&gt;RenumberBlocks();</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="comment">// Perform the initial placement of the constant pool entries.  To start with,</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="comment">// we put them all at the end of the function.</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  std::vector&lt;MachineInstr *&gt; CPEMIs;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="keywordflow">if</span> (!MCP-&gt;isEmpty())</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    doInitialPlacement(CPEMIs);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">  /// The next UID to take is the first unused one.</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment"></span>  initPICLabelUId(CPEMIs.size());</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160; </div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="comment">// Do the initial scan of the function, building up information about the</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="comment">// sizes of each block, the location of all the water, and finding all of the</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="comment">// constant pool users.</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  initializeFunctionInfo(CPEMIs);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  CPEMIs.clear();</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(dumpBBs());</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">  /// Remove dead constant pool entries.</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment"></span>  MadeChange |= removeUnusedCPEntries();</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160; </div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="comment">// Iteratively place constant pool entries and fix up branches until there</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="comment">// is no change.</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="keywordtype">unsigned</span> NoCPIters = 0, NoBRIters = 0;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  (void)NoBRIters;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Beginning CP iteration #&quot;</span> &lt;&lt; NoCPIters &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="keywordtype">bool</span> CPChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = CPUsers.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      CPChange |= handleConstantPoolUser(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordflow">if</span> (CPChange &amp;&amp; ++NoCPIters &gt; 30)</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      <a class="code" href="namespacellvm.html#a7f2a3d4dcfee70225988aec53ff1e173">report_fatal_error</a>(<span class="stringliteral">&quot;Constant Island pass failed to converge!&quot;</span>);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(dumpBBs());</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160; </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="comment">// Clear NewWaterList now.  If we split a block for branches, it should</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="comment">// appear as &quot;new water&quot; for the next iteration of constant pool placement.</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    NewWaterList.<a class="code" href="classllvm_1_1SmallSet.html#a76b3fc7c102561fb5210d5151531e409">clear</a>();</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Beginning BR iteration #&quot;</span> &lt;&lt; NoBRIters &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keywordtype">bool</span> BRChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = ImmBranches.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      BRChange |= fixupImmediateBr(ImmBranches[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keywordflow">if</span> (BRChange &amp;&amp; ++NoBRIters &gt; 30)</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      <a class="code" href="namespacellvm.html#a7f2a3d4dcfee70225988aec53ff1e173">report_fatal_error</a>(<span class="stringliteral">&quot;Branch Fix Up pass failed to converge!&quot;</span>);</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(dumpBBs());</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordflow">if</span> (!CPChange &amp;&amp; !BRChange)</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  }</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160; </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>; dumpBBs());</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  BBInfo.clear();</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  WaterList.clear();</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  CPUsers.clear();</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  CPEntries.clear();</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  ImmBranches.clear();</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;}</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">/// doInitialPlacement - Perform the initial placement of the constant pool</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">/// entries.  To start with, we put them all at the end of the function.</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> CSKYConstantIslands::doInitialPlacement(</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    std::vector&lt;MachineInstr *&gt; &amp;CPEMIs) {</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <span class="comment">// Create the basic block to hold the CPE&#39;s.</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = MF-&gt;CreateMachineBasicBlock();</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  MF-&gt;push_back(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160; </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="comment">// MachineConstantPool measures alignment in bytes. We measure in log2(bytes).</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <span class="keyword">const</span> <a class="code" href="structllvm_1_1Align.html">Align</a> MaxAlign = MCP-&gt;getConstantPoolAlign();</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160; </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="comment">// Mark the basic block as required by the const-pool.</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;setAlignment(<a class="code" href="ELFObjHandler_8cpp.html#a043cdaf7b89aaeeb127be5d93411637f">Align</a>(2));</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160; </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="comment">// The function needs to be as aligned as the basic blocks. The linker may</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="comment">// move functions around based on their alignment.</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  MF-&gt;ensureAlignment(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getAlignment());</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160; </div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="comment">// Order the entries in BB by descending alignment.  That ensures correct</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="comment">// alignment of all entries as long as BB is sufficiently aligned.  Keep</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="comment">// track of the insertion point for each alignment.  We are going to bucket</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="comment">// sort the entries as they are created.</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;MachineBasicBlock::iterator, 8&gt;</a> InsPoint(<a class="code" href="namespacellvm.html#ad82de9da62635df78a534de0f16c1129">Log2</a>(MaxAlign) + 1,</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                                                       <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;end());</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160; </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="comment">// Add all of the constants from the constant pool to the end block, use an</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="comment">// identity mapping of CPI&#39;s to CPE&#39;s.</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keyword">const</span> std::vector&lt;MachineConstantPoolEntry&gt; &amp;CPs = MCP-&gt;getConstants();</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160; </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;TD = MF-&gt;getDataLayout();</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = CPs.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">Size</a> = CPs[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].getSizeInBytes(TD);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Size &gt;= 4 &amp;&amp; <span class="stringliteral">&quot;Too small constant pool entry&quot;</span>);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <a class="code" href="structllvm_1_1Align.html">Align</a> Alignment = CPs[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].getAlign();</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="comment">// Verify that all constant pool entries are a multiple of their alignment.</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="comment">// If not, we would have to pad them out so that instructions stay aligned.</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm.html#a25f1d7ccf87af8d87fcb950f7ed758b5">isAligned</a>(Alignment, Size) &amp;&amp; <span class="stringliteral">&quot;CP Entry not multiple of 4 bytes!&quot;</span>);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160; </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="comment">// Insert CONSTPOOL_ENTRY before entries with a smaller alignment.</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keywordtype">unsigned</span> LogAlign = <a class="code" href="namespacellvm.html#ad82de9da62635df78a534de0f16c1129">Log2</a>(Alignment);</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <a class="code" href="classllvm_1_1MachineInstrBundleIterator.html">MachineBasicBlock::iterator</a> InsAt = InsPoint[LogAlign];</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI =</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        <a class="code" href="namespacellvm.html#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(*<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, InsAt, <a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a>(), <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(CSKY::CONSTPOOL_ENTRY))</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            .<a class="code" href="classllvm_1_1MachineInstrBuilder.html#a4f1ceb770fe3446bfb2b3fa26858098f">addImm</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            .<a class="code" href="classllvm_1_1MachineInstrBuilder.html#acaf4466fb8b9a459c596aa5161423715">addConstantPoolIndex</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            .<a class="code" href="classllvm_1_1MachineInstrBuilder.html#a4f1ceb770fe3446bfb2b3fa26858098f">addImm</a>(Size);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160; </div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    CPEMIs.push_back(CPEMI);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160; </div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="comment">// Ensure that future entries with higher alignment get inserted before</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="comment">// CPEMI. This is bucket sort with iterators.</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> A = LogAlign + 1; <a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a> &lt;= <a class="code" href="namespacellvm.html#ad82de9da62635df78a534de0f16c1129">Log2</a>(MaxAlign); ++<a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>)</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;      <span class="keywordflow">if</span> (InsPoint[A] == InsAt)</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        InsPoint[<a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>] = CPEMI;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="comment">// Add a new CPEntry, but no corresponding CPUser yet.</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    CPEntries.emplace_back(1, CPEntry(CPEMI, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    ++NumCPEs;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Moved CPI#&quot;</span> &lt;&lt; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; <span class="stringliteral">&quot; to end of function, size = &quot;</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                      &lt;&lt; Size &lt;&lt; <span class="stringliteral">&quot;, align = &quot;</span> &lt;&lt; Alignment.<a class="code" href="structllvm_1_1Align.html#a80735739b49cf97a491922c8f9af2cc1">value</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  }</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;dump());</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;}</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">/// BBHasFallthrough - Return true if the specified basic block can fallthrough</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">/// into the block immediately after it.</span></div>
<div class="line"><a name="l00432"></a><span class="lineno"><a class="line" href="CSKYConstantIslandPass_8cpp.html#a64267a385738a1aa6a110071d05ff207">  432</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CSKYConstantIslandPass_8cpp.html#a64267a385738a1aa6a110071d05ff207">bbHasFallthrough</a>(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>) {</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="comment">// Get the next machine basic block in the function.</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <a class="code" href="classllvm_1_1ilist__iterator.html">MachineFunction::iterator</a> <a class="code" href="AArch64SLSHardening_8cpp.html#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> = <a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>();</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="comment">// Can&#39;t fall off end of function.</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  <span class="keywordflow">if</span> (std::next(<a class="code" href="AArch64SLSHardening_8cpp.html#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>) == <a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a4e21760f681d6f97f95c8414e7b83ea5">getParent</a>()-&gt;<a class="code" href="classllvm_1_1MachineFunction.html#a9d017af749f76484cb9aec9ff6e4330c">end</a>())</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160; </div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *NextBB = &amp;*std::next(<a class="code" href="AArch64SLSHardening_8cpp.html#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html#a904414f0f44918a06bab99336cf587a7">MachineBasicBlock::succ_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6321b189ea8fd5058663f8a87d6c23e9">succ_begin</a>(),</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                                        <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = <a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3ddd708642d60c1661992ff8ba1b215d">succ_end</a>();</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;       <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">if</span> (*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> == NextBB)</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160; </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;}</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">/// findConstPoolEntry - Given the constpool index and CONSTPOOL_ENTRY MI,</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">/// look up the corresponding CPEntry.</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment"></span>CSKYConstantIslands::CPEntry *</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;CSKYConstantIslands::findConstPoolEntry(<span class="keywordtype">unsigned</span> CPI,</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                                        <span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI) {</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  std::vector&lt;CPEntry&gt; &amp;CPEs = CPEntries[CPI];</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="comment">// Number of entries per constpool index should be small, just do a</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="comment">// linear search.</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = CPEs.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">if</span> (CPEs[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].CPEMI == CPEMI)</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      <span class="keywordflow">return</span> &amp;CPEs[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  }</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;}</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">/// getCPEAlign - Returns the required alignment of the constant pool entry</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">/// represented by CPEMI.  Alignment is measured in log2(bytes) units.</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment"></span><a class="code" href="structllvm_1_1Align.html">Align</a> CSKYConstantIslands::getCPEAlign(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;CPEMI) {</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CPEMI.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>() == CSKY::CONSTPOOL_ENTRY);</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160; </div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="keywordtype">unsigned</span> CPI = CPEMI.<a class="code" href="classllvm_1_1MachineInstr.html#a3f7a45f6e10668a5f702e26bca80d18e">getOperand</a>(1).<a class="code" href="classllvm_1_1MachineOperand.html#aaa68daaf8d7b773d012887c92c2023ce">getIndex</a>();</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CPI &lt; MCP-&gt;getConstants().<a class="code" href="namespacellvm.html#a10f3d955592ae2bc745f57e5b48ae115">size</a>() &amp;&amp; <span class="stringliteral">&quot;Invalid constant pool index.&quot;</span>);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keywordflow">return</span> MCP-&gt;getConstants()[CPI].getAlign();</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;}</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">/// initializeFunctionInfo - Do the initial scan of the function, building up</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">/// information about the sizes of each block, the location of all the water,</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">/// and finding all of the constant pool users.</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> CSKYConstantIslands::initializeFunctionInfo(</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keyword">const</span> std::vector&lt;MachineInstr *&gt; &amp;CPEMIs) {</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  BBInfo.clear();</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  BBInfo.resize(MF-&gt;getNumBlockIDs());</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160; </div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <span class="comment">// First thing, compute the size of all basic blocks, and see if the function</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="comment">// has any inline assembly in it. If so, we have to be conservative about</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="comment">// alignment assumptions, as we don&#39;t know for sure the size of any</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="comment">// instructions in the inline assembly.</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">MachineFunction::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = MF-&gt;begin(), <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = MF-&gt;end(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    computeBlockSize(&amp;*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160; </div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <span class="comment">// Compute block offsets.</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  adjustBBOffsetsAfter(&amp;MF-&gt;front());</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160; </div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <span class="comment">// Now go back through the instructions and build up our data structures.</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a> : *MF) {</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="comment">// If this block doesn&#39;t fall through into the next MBB, then this is</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="comment">// &#39;water&#39; that a constant pool island could be placed.</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="CSKYConstantIslandPass_8cpp.html#a64267a385738a1aa6a110071d05ff207">bbHasFallthrough</a>(&amp;<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>))</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      WaterList.push_back(&amp;<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>);</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : <a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>) {</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isDebugInstr())</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160; </div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      <span class="keywordtype">int</span> Opc = <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode();</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isBranch() &amp;&amp; !<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isIndirectBranch()) {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <span class="keywordtype">bool</span> IsCond = <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isConditionalBranch();</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">Bits</a> = 0;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        <span class="keywordtype">unsigned</span> Scale = 1;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <span class="keywordtype">int</span> UOpc = CSKY::BR32;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160; </div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="keywordflow">switch</span> (<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode()) {</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keywordflow">case</span> CSKY::BR16:</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <span class="keywordflow">case</span> CSKY::BF16:</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="keywordflow">case</span> CSKY::BT16:</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;          <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">Bits</a> = 10;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;          Scale = 2;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;          <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">Bits</a> = 16;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;          Scale = 2;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        }</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <span class="comment">// Record this immediate branch.</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <span class="keywordtype">unsigned</span> MaxOffs = ((1 &lt;&lt; (<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">Bits</a> - 1)) - 1) * Scale;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        ImmBranches.push_back(ImmBranch(&amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, MaxOffs, IsCond, UOpc));</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      }</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160; </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      <span class="keywordflow">if</span> (Opc == CSKY::CONSTPOOL_ENTRY)</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160; </div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      <span class="comment">// Scan the instructions for constant pool operands.</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getNumOperands(); <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>)</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOperand(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>).isCPI()) {</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;          <span class="comment">// We found one.  The addressing mode tells us the max displacement</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;          <span class="comment">// from the PC that this instruction permits.</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160; </div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;          <span class="comment">// Basic size info comes from the TSFlags field.</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;          <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">Bits</a> = 0;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;          <span class="keywordtype">unsigned</span> Scale = 1;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;          <span class="keywordtype">bool</span> NegOk = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;          <span class="keywordflow">switch</span> (Opc) {</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;          <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Unknown addressing mode for CP reference!&quot;</span>);</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;          <span class="keywordflow">case</span> CSKY::MOVIH32:</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;          <span class="keywordflow">case</span> CSKY::ORI32:</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;          <span class="keywordflow">case</span> CSKY::PseudoTLSLA32:</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;          <span class="keywordflow">case</span> CSKY::JSRI32:</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;          <span class="keywordflow">case</span> CSKY::JMPI32:</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;          <span class="keywordflow">case</span> CSKY::LRW32:</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;          <span class="keywordflow">case</span> CSKY::LRW32_Gen:</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">Bits</a> = 16;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            Scale = 4;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;          <span class="keywordflow">case</span> CSKY::f2FLRW_S:</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;          <span class="keywordflow">case</span> CSKY::f2FLRW_D:</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">Bits</a> = 8;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            Scale = 4;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;          <span class="keywordflow">case</span> CSKY::GRS32:</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">Bits</a> = 17;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            Scale = 2;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            NegOk = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;          }</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;          <span class="comment">// Remember that this is a user of a CP entry.</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;          <span class="keywordtype">unsigned</span> CPI = <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOperand(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>).getIndex();</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;          <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI = CPEMIs[CPI];</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;          <span class="keywordtype">unsigned</span> MaxOffs = ((1 &lt;&lt; <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">Bits</a>) - 1) * Scale;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;          CPUsers.push_back(CPUser(&amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, CPEMI, MaxOffs, NegOk));</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160; </div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;          <span class="comment">// Increment corresponding CPEntry reference count.</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;          CPEntry *CPE = findConstPoolEntry(CPI, CPEMI);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CPE &amp;&amp; <span class="stringliteral">&quot;Cannot find a corresponding CPEntry!&quot;</span>);</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;          CPE-&gt;RefCount++;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        }</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    }</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  }</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;}</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">/// computeBlockSize - Compute the size and some alignment information for MBB.</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">/// This function updates BBInfo directly.</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> CSKYConstantIslands::computeBlockSize(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>) {</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  <a class="code" href="structllvm_1_1BasicBlockInfo.html">BasicBlockInfo</a> &amp;BBI = BBInfo[<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>()];</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  BBI.<a class="code" href="structllvm_1_1BasicBlockInfo.html#a1b26f2a8fbde15592af8af3fb950d8fc">Size</a> = 0;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160; </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : *<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>)</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    BBI.<a class="code" href="structllvm_1_1BasicBlockInfo.html#a1b26f2a8fbde15592af8af3fb950d8fc">Size</a> += <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getInstSizeInBytes(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;}</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">/// getOffsetOf - Return the current offset of the specified machine instruction</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">/// from the start of the function.  This offset changes as stuff is moved</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">/// around inside the function.</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment"></span><span class="keywordtype">unsigned</span> CSKYConstantIslands::getOffsetOf(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a> = <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getParent();</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160; </div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  <span class="comment">// The offset is composed of two things: the sum of the sizes of all MBB&#39;s</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <span class="comment">// before this instruction&#39;s block, and the offset from the start of the block</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  <span class="comment">// it is in.</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm.html#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = BBInfo[<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>()].Offset;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160; </div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  <span class="comment">// Sum instructions before MI in MBB.</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineInstrBundleIterator.html">MachineBasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ab2d91e7bec944efcbc39d8e30644f111">begin</a>(); &amp;*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">end</a>() &amp;&amp; <span class="stringliteral">&quot;Didn&#39;t find MI in its own basic block?&quot;</span>);</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <a class="code" href="namespacellvm.html#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> += <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getInstSizeInBytes(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  }</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;}</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">/// CompareMBBNumbers - Little predicate function to sort the WaterList by MBB</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment">/// ID.</span></div>
<div class="line"><a name="l00612"></a><span class="lineno"><a class="line" href="CSKYConstantIslandPass_8cpp.html#ad11e5fb888cddb54cbf9f2ab1d513653">  612</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CSKYConstantIslandPass_8cpp.html#ad11e5fb888cddb54cbf9f2ab1d513653">compareMbbNumbers</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>,</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                              <span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) {</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;getNumber() &lt; <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getNumber();</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;}</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment">/// updateForInsertedWaterBlock - When a block is newly inserted into the</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="comment">/// machine function, it upsets all of the block numbers.  Renumber the blocks</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment">/// and update the arrays that parallel this numbering.</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> CSKYConstantIslands::updateForInsertedWaterBlock(</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *NewBB) {</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  <span class="comment">// Renumber the MBB&#39;s to keep them consecutive.</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  NewBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a4e21760f681d6f97f95c8414e7b83ea5">getParent</a>()-&gt;<a class="code" href="classllvm_1_1MachineFunction.html#ac85349aab432e6b7d8b2e8926048a6de">RenumberBlocks</a>(NewBB);</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160; </div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="comment">// Insert an entry into BBInfo to align it properly with the (newly</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <span class="comment">// renumbered) block numbers.</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  BBInfo.insert(BBInfo.begin() + NewBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>(), <a class="code" href="structllvm_1_1BasicBlockInfo.html">BasicBlockInfo</a>());</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160; </div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <span class="comment">// Next, update WaterList.  Specifically, we need to add NewMBB as having</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="comment">// available water after it.</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  water_iterator IP = <a class="code" href="namespacellvm.html#aa81eb67f09ee4944eaeeddbc54c0c0de">llvm::lower_bound</a>(WaterList, NewBB, <a class="code" href="CSKYConstantIslandPass_8cpp.html#ad11e5fb888cddb54cbf9f2ab1d513653">compareMbbNumbers</a>);</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  WaterList.insert(IP, NewBB);</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;}</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160; </div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="keywordtype">unsigned</span> CSKYConstantIslands::getUserOffset(CPUser &amp;U)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  <span class="keywordtype">unsigned</span> UserOffset = getOffsetOf(U.MI);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160; </div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  UserOffset &amp;= ~3u;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160; </div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  <span class="keywordflow">return</span> UserOffset;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;}</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment">/// Split the basic block containing MI into two blocks, which are joined by</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment">/// an unconditional branch.  Update data structures and renumber blocks to</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment">/// account for this change and returns the newly created block.</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;CSKYConstantIslands::splitBlockBeforeInstr(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) {</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *OrigBB = <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getParent();</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160; </div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  <span class="comment">// Create a new MBB for the code after the OrigBB.</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *NewBB =</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      MF-&gt;CreateMachineBasicBlock(OrigBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a856266240556bbae90bc5ba75c156eef">getBasicBlock</a>());</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <a class="code" href="classllvm_1_1ilist__iterator.html">MachineFunction::iterator</a> <a class="code" href="AArch64SLSHardening_8cpp.html#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> = ++OrigBB-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>();</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  MF-&gt;insert(<a class="code" href="AArch64SLSHardening_8cpp.html#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, NewBB);</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160; </div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <span class="comment">// Splice the instructions starting with MI over to NewBB.</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  NewBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#adf0023bdc4f05a7849c35b1c859580d8">splice</a>(NewBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">end</a>(), OrigBB, <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, OrigBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">end</a>());</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160; </div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  <span class="comment">// Add an unconditional branch from OrigBB to NewBB.</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  <span class="comment">// Note the new unconditional branch is not being recorded.</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  <span class="comment">// There doesn&#39;t seem to be meaningful DebugInfo available; this doesn&#39;t</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  <span class="comment">// correspond to anything in the source.</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160; </div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  <span class="comment">// TODO: Add support for 16bit instr.</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  <a class="code" href="namespacellvm.html#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(OrigBB, <a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a>(), <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(CSKY::BR32)).<a class="code" href="classllvm_1_1MachineInstrBuilder.html#af8571e8dfb010fd8ae76cc4f87aafaac">addMBB</a>(NewBB);</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  ++NumSplit;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160; </div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <span class="comment">// Update the CFG.  All succs of OrigBB are now succs of NewBB.</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  NewBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a31e57b158a17c459f0dc34b0e602ecc6">transferSuccessors</a>(OrigBB);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160; </div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  <span class="comment">// OrigBB branches to NewBB.</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  OrigBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(NewBB);</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160; </div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <span class="comment">// Update internal data structures to account for the newly inserted MBB.</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="comment">// This is almost the same as updateForInsertedWaterBlock, except that</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  <span class="comment">// the Water goes after OrigBB, not NewBB.</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  MF-&gt;RenumberBlocks(NewBB);</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160; </div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  <span class="comment">// Insert an entry into BBInfo to align it properly with the (newly</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <span class="comment">// renumbered) block numbers.</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  BBInfo.insert(BBInfo.begin() + NewBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>(), <a class="code" href="structllvm_1_1BasicBlockInfo.html">BasicBlockInfo</a>());</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160; </div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  <span class="comment">// Next, update WaterList.  Specifically, we need to add OrigMBB as having</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <span class="comment">// available water after it (but not if it&#39;s already there, which happens</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  <span class="comment">// when splitting before a conditional branch that is followed by an</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <span class="comment">// unconditional branch - in that case we want to insert NewBB).</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  water_iterator IP = <a class="code" href="namespacellvm.html#aa81eb67f09ee4944eaeeddbc54c0c0de">llvm::lower_bound</a>(WaterList, OrigBB, <a class="code" href="CSKYConstantIslandPass_8cpp.html#ad11e5fb888cddb54cbf9f2ab1d513653">compareMbbNumbers</a>);</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *WaterBB = *IP;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <span class="keywordflow">if</span> (WaterBB == OrigBB)</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    WaterList.<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3435a2381e60e842e915f85c931b7dde">insert</a>(std::next(IP), NewBB);</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    WaterList.insert(IP, OrigBB);</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  NewWaterList.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(OrigBB);</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160; </div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  <span class="comment">// Figure out how large the OrigBB is.  As the first half of the original</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  <span class="comment">// block, it cannot contain a tablejump.  The size includes</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  <span class="comment">// the new jump we added.  (It should be possible to do this without</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  <span class="comment">// recounting everything, but it&#39;s very confusing, and this is rarely</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <span class="comment">// executed.)</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  computeBlockSize(OrigBB);</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160; </div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  <span class="comment">// Figure out how large the NewMBB is.  As the second half of the original</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  <span class="comment">// block, it may contain a tablejump.</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  computeBlockSize(NewBB);</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160; </div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <span class="comment">// All BBOffsets following these blocks must be modified.</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  adjustBBOffsetsAfter(OrigBB);</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160; </div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  <span class="keywordflow">return</span> NewBB;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;}</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="comment">/// isOffsetInRange - Checks whether UserOffset (the location of a constant pool</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="comment">/// reference) is within MaxDisp of TrialOffset (a proposed location of a</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="comment">/// constant pool entry).</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CSKYConstantIslands::isOffsetInRange(<span class="keywordtype">unsigned</span> UserOffset,</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                                          <span class="keywordtype">unsigned</span> TrialOffset,</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                                          <span class="keywordtype">unsigned</span> MaxDisp, <span class="keywordtype">bool</span> NegativeOK) {</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  <span class="keywordflow">if</span> (UserOffset &lt;= TrialOffset) {</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="comment">// User before the Trial.</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <span class="keywordflow">if</span> (TrialOffset - UserOffset &lt;= MaxDisp)</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NegativeOK) {</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="keywordflow">if</span> (UserOffset - TrialOffset &lt;= MaxDisp)</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  }</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;}</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment">/// isWaterInRange - Returns true if a CPE placed after the specified</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="comment">/// Water (a basic block) will be in range for the specific MI.</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="comment">/// Compute how much the function will grow by inserting a CPE after Water.</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CSKYConstantIslands::isWaterInRange(<span class="keywordtype">unsigned</span> UserOffset,</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                                         <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *Water, CPUser &amp;U,</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                                         <span class="keywordtype">unsigned</span> &amp;Growth) {</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  <span class="keywordtype">unsigned</span> CPEOffset = BBInfo[Water-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>()].postOffset();</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  <span class="keywordtype">unsigned</span> NextBlockOffset;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  <a class="code" href="structllvm_1_1Align.html">Align</a> NextBlockAlignment;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  <a class="code" href="classllvm_1_1ilist__iterator.html">MachineFunction::const_iterator</a> NextBlock = ++Water-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>();</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  <span class="keywordflow">if</span> (NextBlock == MF-&gt;end()) {</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    NextBlockOffset = BBInfo[Water-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>()].postOffset();</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    NextBlockAlignment = <a class="code" href="ELFObjHandler_8cpp.html#a043cdaf7b89aaeeb127be5d93411637f">Align</a>(4);</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    NextBlockOffset = BBInfo[NextBlock-&gt;getNumber()].Offset;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    NextBlockAlignment = NextBlock-&gt;getAlignment();</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  }</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">Size</a> = U.CPEMI-&gt;getOperand(2).getImm();</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  <span class="keywordtype">unsigned</span> CPEEnd = CPEOffset + <a class="code" href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">Size</a>;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160; </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  <span class="comment">// The CPE may be able to hide in the alignment padding before the next</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  <span class="comment">// block. It may also cause more padding to be required if it is more aligned</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  <span class="comment">// that the next block.</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <span class="keywordflow">if</span> (CPEEnd &gt; NextBlockOffset) {</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    Growth = CPEEnd - NextBlockOffset;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="comment">// Compute the padding that would go at the end of the CPE to align the next</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="comment">// block.</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    Growth += <a class="code" href="namespacellvm.html#a99cdcecbadc13087f087c61809bb44f1">offsetToAlignment</a>(CPEEnd, NextBlockAlignment);</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; </div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="comment">// If the CPE is to be inserted before the instruction, that will raise</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="comment">// the offset of the instruction. Also account for unknown alignment padding</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="comment">// in blocks between CPE and the user.</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="keywordflow">if</span> (CPEOffset &lt; UserOffset)</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      UserOffset += Growth;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  } <span class="keywordflow">else</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="comment">// CPE fits in existing padding.</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    Growth = 0;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160; </div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  <span class="keywordflow">return</span> isOffsetInRange(UserOffset, CPEOffset, U);</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;}</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="comment">/// isCPEntryInRange - Returns true if the distance between specific MI and</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="comment">/// specific ConstPool entry instruction can fit in MI&#39;s displacement field.</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CSKYConstantIslands::isCPEntryInRange(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>,</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                                           <span class="keywordtype">unsigned</span> UserOffset,</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                                           <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI,</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                                           <span class="keywordtype">unsigned</span> MaxDisp, <span class="keywordtype">bool</span> NegOk,</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                                           <span class="keywordtype">bool</span> DoDump) {</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  <span class="keywordtype">unsigned</span> CPEOffset = getOffsetOf(CPEMI);</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160; </div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  <span class="keywordflow">if</span> (DoDump) {</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>({</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> = <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getParent()-&gt;getNumber();</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      <span class="keyword">const</span> <a class="code" href="structllvm_1_1BasicBlockInfo.html">BasicBlockInfo</a> &amp;BBI = BBInfo[<a class="code" href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>];</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;User of CPE#&quot;</span> &lt;&lt; CPEMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a3f7a45f6e10668a5f702e26bca80d18e">getOperand</a>(0).<a class="code" href="classllvm_1_1MachineOperand.html#a38b28a85f818b49d8806c150b8a5b4f7">getImm</a>()</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;             &lt;&lt; <span class="stringliteral">&quot; max delta=&quot;</span> &lt;&lt; MaxDisp</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;             &lt;&lt; <a class="code" href="namespacellvm.html#a66f0c57e04037076030c6a6e48f44f2d">format</a>(<span class="stringliteral">&quot; insn address=%#x&quot;</span>, UserOffset) &lt;&lt; <span class="stringliteral">&quot; in &quot;</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;             &lt;&lt; <a class="code" href="namespacellvm.html#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(*<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getParent()) &lt;&lt; <span class="stringliteral">&quot;: &quot;</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;             &lt;&lt; <a class="code" href="namespacellvm.html#a66f0c57e04037076030c6a6e48f44f2d">format</a>(<span class="stringliteral">&quot;%#x-%x\t&quot;</span>, BBI.<a class="code" href="structllvm_1_1BasicBlockInfo.html#acadf079e9232969cd61ca5744b10dd16">Offset</a>, BBI.<a class="code" href="structllvm_1_1BasicBlockInfo.html#a96d35759d0115509c273fbdfd8fe011a">postOffset</a>()) &lt;&lt; *<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;             &lt;&lt; <a class="code" href="namespacellvm.html#a66f0c57e04037076030c6a6e48f44f2d">format</a>(<span class="stringliteral">&quot;CPE address=%#x offset=%+d: &quot;</span>, CPEOffset,</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                       <span class="keywordtype">int</span>(CPEOffset - UserOffset));</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    });</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  }</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160; </div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  <span class="keywordflow">return</span> isOffsetInRange(UserOffset, CPEOffset, MaxDisp, NegOk);</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;}</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160; </div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment">/// BBIsJumpedOver - Return true of the specified basic block&#39;s only predecessor</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment"></span><span class="comment">/// unconditionally branches to its only successor.</span></div>
<div class="line"><a name="l00800"></a><span class="lineno"><a class="line" href="CSKYConstantIslandPass_8cpp.html#a69f0bf266f1e42f9d65ec549a6481ba6">  800</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CSKYConstantIslandPass_8cpp.html#a69f0bf266f1e42f9d65ec549a6481ba6">bbIsJumpedOver</a>(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>) {</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a03936a9b37da541420049422204ab206">pred_size</a>() != 1 || <a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a81626de817a0cb021ff8e915cf1942ed">succ_size</a>() != 1)</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *Succ = *<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6321b189ea8fd5058663f8a87d6c23e9">succ_begin</a>();</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *Pred = *<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ab644fcf07a4c2708333cf66276282357">pred_begin</a>();</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *PredMI = &amp;Pred-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ace3ed0412f841777b7de55d47883890e">back</a>();</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <span class="keywordflow">if</span> (PredMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>() == CSKY::BR32 <span class="comment">/*TODO: change to 16bit instr. */</span>)</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keywordflow">return</span> PredMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a3f7a45f6e10668a5f702e26bca80d18e">getOperand</a>(0).<a class="code" href="classllvm_1_1MachineOperand.html#a9b48cb80ee1534c2b51d789b673137c1">getMBB</a>() == Succ;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;}</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160; </div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;<span class="keywordtype">void</span> CSKYConstantIslands::adjustBBOffsetsAfter(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  <span class="keywordtype">unsigned</span> BBNum = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getNumber();</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BBNum + 1, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = MF-&gt;getNumBlockIDs(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <span class="comment">// Get the offset and known bits at the end of the layout predecessor.</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="comment">// Include the alignment of the current block.</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm.html#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = BBInfo[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> - 1].Offset + BBInfo[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> - 1].Size;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    BBInfo[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].Offset = <a class="code" href="namespacellvm.html#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  }</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;}</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="comment">/// decrementCPEReferenceCount - find the constant pool entry with index CPI</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="comment">/// and instruction CPEMI, and decrement its refcount.  If the refcount</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="comment">/// becomes 0 remove the entry and instruction.  Returns true if we removed</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="comment">/// the entry, false if we didn&#39;t.</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CSKYConstantIslands::decrementCPEReferenceCount(<span class="keywordtype">unsigned</span> CPI,</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                                                     <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI) {</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  <span class="comment">// Find the old entry. Eliminate it if it is no longer used.</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  CPEntry *CPE = findConstPoolEntry(CPI, CPEMI);</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CPE &amp;&amp; <span class="stringliteral">&quot;Unexpected!&quot;</span>);</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <span class="keywordflow">if</span> (--CPE-&gt;RefCount == 0) {</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    removeDeadCPEMI(CPEMI);</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    CPE-&gt;CPEMI = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    --NumCPEs;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  }</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;}</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="comment">/// LookForCPEntryInRange - see if the currently referenced CPE is in range;</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment">/// if not, see if an in-range clone of the CPE is in range, and if so,</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="comment">/// change the data structures so the user references the clone.  Returns:</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="comment">/// 0 = no existing entry found</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="comment">/// 1 = entry found, and there were no code insertions or deletions</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="comment">/// 2 = entry found, and there were code insertions or deletions</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="comment"></span><span class="keywordtype">int</span> CSKYConstantIslands::findInRangeCPEntry(CPUser &amp;U, <span class="keywordtype">unsigned</span> UserOffset) {</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *UserMI = U.MI;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI = U.CPEMI;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160; </div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  <span class="comment">// Check to see if the CPE is already in-range.</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  <span class="keywordflow">if</span> (isCPEntryInRange(UserMI, UserOffset, CPEMI, U.getMaxDisp(), U.NegOk,</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;                       <span class="keyword">true</span>)) {</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;In range\n&quot;</span>);</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  }</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160; </div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  <span class="comment">// No.  Look for previously created clones of the CPE that are in range.</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  <span class="keywordtype">unsigned</span> CPI = CPEMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a3f7a45f6e10668a5f702e26bca80d18e">getOperand</a>(1).<a class="code" href="classllvm_1_1MachineOperand.html#aaa68daaf8d7b773d012887c92c2023ce">getIndex</a>();</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  std::vector&lt;CPEntry&gt; &amp;CPEs = CPEntries[CPI];</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = CPEs.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="comment">// We already tried this one</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="keywordflow">if</span> (CPEs[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].CPEMI == CPEMI)</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="comment">// Removing CPEs can leave empty entries, skip</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="keywordflow">if</span> (CPEs[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].CPEMI == <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    <span class="keywordflow">if</span> (isCPEntryInRange(UserMI, UserOffset, CPEs[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].CPEMI, U.getMaxDisp(),</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                         U.NegOk)) {</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Replacing CPE#&quot;</span> &lt;&lt; CPI &lt;&lt; <span class="stringliteral">&quot; with CPE#&quot;</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                        &lt;&lt; CPEs[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].CPI &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;      <span class="comment">// Point the CPUser node to the replacement</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      U.CPEMI = CPEs[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].CPEMI;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;      <span class="comment">// Change the CPI in the instruction operand to refer to the clone.</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> J = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = UserMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a432824f0975bb863478bf4ef3a5df258">getNumOperands</a>(); J != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++J)</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        <span class="keywordflow">if</span> (UserMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a3f7a45f6e10668a5f702e26bca80d18e">getOperand</a>(J).<a class="code" href="classllvm_1_1MachineOperand.html#a5b401e780c5eed0aca1cfbf44d36a545">isCPI</a>()) {</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;          UserMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a3f7a45f6e10668a5f702e26bca80d18e">getOperand</a>(J).<a class="code" href="classllvm_1_1MachineOperand.html#aebc99c3c37896879abad49e7254a2fb8">setIndex</a>(CPEs[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].CPI);</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        }</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;      <span class="comment">// Adjust the refcount of the clone...</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;      CPEs[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].RefCount++;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;      <span class="comment">// ...and the original.  If we didn&#39;t remove the old entry, none of the</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      <span class="comment">// addresses changed, so we don&#39;t need another pass.</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;      <span class="keywordflow">return</span> decrementCPEReferenceCount(CPI, CPEMI) ? 2 : 1;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    }</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  }</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;}</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="comment">/// getUnconditionalBrDisp - Returns the maximum displacement that can fit in</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="comment">/// the specific unconditional branch instruction.</span></div>
<div class="line"><a name="l00891"></a><span class="lineno"><a class="line" href="CSKYConstantIslandPass_8cpp.html#a2e62a3c07e3b7d0f0591b2d80bd20967">  891</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <a class="code" href="CSKYConstantIslandPass_8cpp.html#a2e62a3c07e3b7d0f0591b2d80bd20967">getUnconditionalBrDisp</a>(<span class="keywordtype">int</span> Opc) {</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">Bits</a>, Scale;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160; </div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  <span class="keywordflow">switch</span> (Opc) {</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  <span class="keywordflow">case</span> CSKY::BR16:</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">Bits</a> = 10;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    Scale = 2;</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  <span class="keywordflow">case</span> CSKY::BR32:</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">Bits</a> = 16;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    Scale = 2;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  }</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160; </div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  <span class="keywordtype">unsigned</span> MaxOffs = ((1 &lt;&lt; (<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">Bits</a> - 1)) - 1) * Scale;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  <span class="keywordflow">return</span> MaxOffs;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;}</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="comment">/// findAvailableWater - Look for an existing entry in the WaterList in which</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="comment">/// we can place the CPE referenced from U so it&#39;s within range of U&#39;s MI.</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="comment">/// Returns true if found, false if not.  If it returns true, WaterIter</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="comment">/// is set to the WaterList entry.</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="comment">/// To ensure that this pass</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="comment">/// terminates, the CPE location for a particular CPUser is only allowed to</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="comment">/// move to a lower address, so search backward from the end of the list and</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="comment">/// prefer the first water that is in range.</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CSKYConstantIslands::findAvailableWater(CPUser &amp;U, <span class="keywordtype">unsigned</span> UserOffset,</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                                             water_iterator &amp;WaterIter) {</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  <span class="keywordflow">if</span> (WaterList.empty())</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160; </div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  <span class="keywordtype">unsigned</span> BestGrowth = ~0u;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  <span class="keywordflow">for</span> (water_iterator IP = std::prev(WaterList.end()), <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a> = WaterList.begin();;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;       --IP) {</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *WaterBB = *IP;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <span class="comment">// Check if water is in range and is either at a lower address than the</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    <span class="comment">// current &quot;high water mark&quot; or a new water block that was created since</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    <span class="comment">// the previous iteration by inserting an unconditional branch.  In the</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="comment">// latter case, we want to allow resetting the high water mark back to</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="comment">// this new water since we haven&#39;t seen it before.  Inserting branches</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    <span class="comment">// should be relatively uncommon and when it does happen, we want to be</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="comment">// sure to take advantage of it for all the CPEs near that block, so that</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="comment">// we don&#39;t insert more branches than necessary.</span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="keywordtype">unsigned</span> Growth;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="keywordflow">if</span> (isWaterInRange(UserOffset, WaterBB, U, Growth) &amp;&amp;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        (WaterBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>() &lt; U.HighWaterMark-&gt;getNumber() ||</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;         NewWaterList.<a class="code" href="classllvm_1_1SmallSet.html#a2a98f19750ba941ce791b75ca6d77e48">count</a>(WaterBB)) &amp;&amp;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        Growth &lt; BestGrowth) {</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;      <span class="comment">// This is the least amount of required padding seen so far.</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;      BestGrowth = Growth;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      WaterIter = IP;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Found water after &quot;</span> &lt;&lt; <a class="code" href="namespacellvm.html#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(*WaterBB)</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot; Growth=&quot;</span> &lt;&lt; Growth &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160; </div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;      <span class="comment">// Keep looking unless it is perfect.</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;      <span class="keywordflow">if</span> (BestGrowth == 0)</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    }</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    <span class="keywordflow">if</span> (IP == <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>)</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  }</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  <span class="keywordflow">return</span> BestGrowth != ~0u;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;}</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="comment">/// createNewWater - No existing WaterList entry will work for</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="comment">/// CPUsers[CPUserIndex], so create a place to put the CPE.  The end of the</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="comment">/// block is used if in range, and the conditional branch munged so control</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="comment">/// flow is correct.  Otherwise the block is split to create a hole with an</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="comment">/// unconditional branch around it.  In either case NewMBB is set to a</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="comment">/// block following which the new island can be inserted (the WaterList</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="comment">/// is not adjusted).</span></div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> CSKYConstantIslands::createNewWater(<span class="keywordtype">unsigned</span> CPUserIndex,</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                                         <span class="keywordtype">unsigned</span> UserOffset,</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                                         <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *&amp;NewMBB) {</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  CPUser &amp;U = CPUsers[CPUserIndex];</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *UserMI = U.MI;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI = U.CPEMI;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *UserMBB = UserMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a002fd916e7206e01d512eeb06d405cf0">getParent</a>();</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="keyword">const</span> <a class="code" href="structllvm_1_1BasicBlockInfo.html">BasicBlockInfo</a> &amp;UserBBI = BBInfo[UserMBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>()];</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160; </div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <span class="comment">// If the block does not end in an unconditional branch already, and if the</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  <span class="comment">// end of the block is within range, make new water there.</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="CSKYConstantIslandPass_8cpp.html#a64267a385738a1aa6a110071d05ff207">bbHasFallthrough</a>(UserMBB)) {</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <span class="comment">// Size of branch to insert.</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="keywordtype">unsigned</span> Delta = 4;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="comment">// Compute the offset where the CPE will begin.</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="keywordtype">unsigned</span> CPEOffset = UserBBI.<a class="code" href="structllvm_1_1BasicBlockInfo.html#a96d35759d0115509c273fbdfd8fe011a">postOffset</a>() + Delta;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160; </div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <span class="keywordflow">if</span> (isOffsetInRange(UserOffset, CPEOffset, U)) {</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Split at end of &quot;</span> &lt;&lt; <a class="code" href="namespacellvm.html#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(*UserMBB)</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;                        &lt;&lt; <a class="code" href="namespacellvm.html#a66f0c57e04037076030c6a6e48f44f2d">format</a>(<span class="stringliteral">&quot;, expected CPE offset %#x\n&quot;</span>, CPEOffset));</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;      NewMBB = &amp;*++UserMBB-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>();</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;      <span class="comment">// Add an unconditional branch from UserMBB to fallthrough block.  Record</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;      <span class="comment">// it for branch lengthening; this new branch will not get out of range,</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;      <span class="comment">// but if the preceding conditional branch is out of range, the targets</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;      <span class="comment">// will be exchanged, and the altered branch may be out of range, so the</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      <span class="comment">// machinery has to know about it.</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160; </div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;      <span class="comment">// TODO: Add support for 16bit instr.</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;      <span class="keywordtype">int</span> UncondBr = CSKY::BR32;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;      <span class="keyword">auto</span> *NewMI = <a class="code" href="namespacellvm.html#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(UserMBB, <a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a>(), <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(UncondBr))</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                        .<a class="code" href="classllvm_1_1MachineInstrBuilder.html#af8571e8dfb010fd8ae76cc4f87aafaac">addMBB</a>(NewMBB)</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;                        .<a class="code" href="classllvm_1_1MachineInstrBuilder.html#a54ce61c9315f4d35304a86cb34388921">getInstr</a>();</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      <span class="keywordtype">unsigned</span> MaxDisp = <a class="code" href="CSKYConstantIslandPass_8cpp.html#a2e62a3c07e3b7d0f0591b2d80bd20967">getUnconditionalBrDisp</a>(UncondBr);</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      ImmBranches.push_back(</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;          ImmBranch(&amp;UserMBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ace3ed0412f841777b7de55d47883890e">back</a>(), MaxDisp, <span class="keyword">false</span>, UncondBr));</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      BBInfo[UserMBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>()].Size += <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getInstSizeInBytes(*NewMI);</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;      adjustBBOffsetsAfter(UserMBB);</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    }</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  }</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160; </div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  <span class="comment">// What a big block.  Find a place within the block to split it.</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160; </div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <span class="comment">// Try to split the block so it&#39;s fully aligned.  Compute the latest split</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  <span class="comment">// point where we can add a 4-byte branch instruction, and then align to</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  <span class="comment">// Align which is the largest possible alignment in the function.</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  <span class="keyword">const</span> <a class="code" href="structllvm_1_1Align.html">Align</a> <a class="code" href="structllvm_1_1Align.html">Align</a> = MF-&gt;getAlignment();</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <span class="keywordtype">unsigned</span> BaseInsertOffset = UserOffset + U.getMaxDisp();</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a class="code" href="namespacellvm.html#a66f0c57e04037076030c6a6e48f44f2d">format</a>(<span class="stringliteral">&quot;Split in middle of big block before %#x&quot;</span>,</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;                              BaseInsertOffset));</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160; </div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  <span class="comment">// The 4 in the following is for the unconditional branch we&#39;ll be inserting</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;  <span class="comment">// Alignment of the island is handled</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;  <span class="comment">// inside isOffsetInRange.</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;  BaseInsertOffset -= 4;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160; </div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a class="code" href="namespacellvm.html#a66f0c57e04037076030c6a6e48f44f2d">format</a>(<span class="stringliteral">&quot;, adjusted to %#x&quot;</span>, BaseInsertOffset)</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; la=&quot;</span> &lt;&lt; <a class="code" href="namespacellvm.html#ad82de9da62635df78a534de0f16c1129">Log2</a>(<a class="code" href="structllvm_1_1Align.html">Align</a>) &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160; </div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  <span class="comment">// This could point off the end of the block if we&#39;ve already got constant</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;  <span class="comment">// pool entries following this block; only the last one is in the water list.</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  <span class="comment">// Back past any possible branches (allow for a conditional and a maximally</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;  <span class="comment">// long unconditional).</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  <span class="keywordflow">if</span> (BaseInsertOffset + 8 &gt;= UserBBI.<a class="code" href="structllvm_1_1BasicBlockInfo.html#a96d35759d0115509c273fbdfd8fe011a">postOffset</a>()) {</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    BaseInsertOffset = UserBBI.<a class="code" href="structllvm_1_1BasicBlockInfo.html#a96d35759d0115509c273fbdfd8fe011a">postOffset</a>() - 8;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a class="code" href="namespacellvm.html#a66f0c57e04037076030c6a6e48f44f2d">format</a>(<span class="stringliteral">&quot;Move inside block: %#x\n&quot;</span>, BaseInsertOffset));</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  }</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  <span class="keywordtype">unsigned</span> EndInsertOffset =</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      BaseInsertOffset + 4 + CPEMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a3f7a45f6e10668a5f702e26bca80d18e">getOperand</a>(2).<a class="code" href="classllvm_1_1MachineOperand.html#a38b28a85f818b49d8806c150b8a5b4f7">getImm</a>();</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  <a class="code" href="classllvm_1_1MachineInstrBundleIterator.html">MachineBasicBlock::iterator</a> <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = UserMI;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  ++<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  <span class="keywordtype">unsigned</span> CPUIndex = CPUserIndex + 1;</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  <span class="keywordtype">unsigned</span> NumCPUsers = CPUsers.size();</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm.html#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = UserOffset + <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getInstSizeInBytes(*UserMI);</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;       <a class="code" href="namespacellvm.html#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &lt; BaseInsertOffset;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;       <a class="code" href="namespacellvm.html#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> += <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getInstSizeInBytes(*<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>), <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = std::next(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>)) {</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> != UserMBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">end</a>() &amp;&amp; <span class="stringliteral">&quot;Fell off end of block&quot;</span>);</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    <span class="keywordflow">if</span> (CPUIndex &lt; NumCPUsers &amp;&amp; CPUsers[CPUIndex].<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> == <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) {</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      CPUser &amp;U = CPUsers[CPUIndex];</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;      <span class="keywordflow">if</span> (!isOffsetInRange(<a class="code" href="namespacellvm.html#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, EndInsertOffset, U)) {</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        <span class="comment">// Shift intertion point by one unit of alignment so it is within reach.</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        BaseInsertOffset -= <a class="code" href="structllvm_1_1Align.html">Align</a>.<a class="code" href="structllvm_1_1Align.html#a80735739b49cf97a491922c8f9af2cc1">value</a>();</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;        EndInsertOffset -= <a class="code" href="structllvm_1_1Align.html">Align</a>.<a class="code" href="structllvm_1_1Align.html#a80735739b49cf97a491922c8f9af2cc1">value</a>();</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;      }</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;      <span class="comment">// This is overly conservative, as we don&#39;t account for CPEMIs being</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;      <span class="comment">// reused within the block, but it doesn&#39;t matter much.  Also assume CPEs</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;      <span class="comment">// are added in order with alignment padding.  We may eventually be able</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;      <span class="comment">// to pack the aligned CPEs better.</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;      EndInsertOffset += U.CPEMI-&gt;getOperand(2).getImm();</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;      CPUIndex++;</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    }</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;  }</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160; </div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  NewMBB = splitBlockBeforeInstr(*--<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;}</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="comment">/// handleConstantPoolUser - Analyze the specified user, checking to see if it</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment">/// is out-of-range.  If so, pick up the constant pool value and move it some</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="comment">/// place in-range.  Return true if we changed any addresses (thus must run</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment">/// another pass of branch lengthening), false otherwise.</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CSKYConstantIslands::handleConstantPoolUser(<span class="keywordtype">unsigned</span> CPUserIndex) {</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  CPUser &amp;U = CPUsers[CPUserIndex];</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *UserMI = U.MI;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI = U.CPEMI;</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  <span class="keywordtype">unsigned</span> CPI = CPEMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a3f7a45f6e10668a5f702e26bca80d18e">getOperand</a>(1).<a class="code" href="classllvm_1_1MachineOperand.html#aaa68daaf8d7b773d012887c92c2023ce">getIndex</a>();</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">Size</a> = CPEMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a3f7a45f6e10668a5f702e26bca80d18e">getOperand</a>(2).<a class="code" href="classllvm_1_1MachineOperand.html#a38b28a85f818b49d8806c150b8a5b4f7">getImm</a>();</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;  <span class="comment">// Compute this only once, it&#39;s expensive.</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;  <span class="keywordtype">unsigned</span> UserOffset = getUserOffset(U);</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160; </div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  <span class="comment">// See if the current entry is within range, or there is a clone of it</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  <span class="comment">// in range.</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="README__P9_8txt.html#ae070adaf1b4bf0e7c12fcae2b9c5ae67">result</a> = findInRangeCPEntry(U, UserOffset);</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="README__P9_8txt.html#ae070adaf1b4bf0e7c12fcae2b9c5ae67">result</a> == 1)</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="README__P9_8txt.html#ae070adaf1b4bf0e7c12fcae2b9c5ae67">result</a> == 2)</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160; </div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  <span class="comment">// Look for water where we can place this CPE.</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *NewIsland = MF-&gt;CreateMachineBasicBlock();</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *NewMBB;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  water_iterator IP;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;  <span class="keywordflow">if</span> (findAvailableWater(U, UserOffset, IP)) {</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Found water in range\n&quot;</span>);</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *WaterBB = *IP;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160; </div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="comment">// If the original WaterList entry was &quot;new water&quot; on this iteration,</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <span class="comment">// propagate that to the new island.  This is just keeping NewWaterList</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    <span class="comment">// updated to match the WaterList, which will be updated below.</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <span class="keywordflow">if</span> (NewWaterList.<a class="code" href="classllvm_1_1SmallSet.html#a75a2d2ad3b3dce6702750d570ee8f343">erase</a>(WaterBB))</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;      NewWaterList.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(NewIsland);</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160; </div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <span class="comment">// The new CPE goes before the following block (NewMBB).</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    NewMBB = &amp;*++WaterBB-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>();</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;No water found\n&quot;</span>);</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    createNewWater(CPUserIndex, UserOffset, NewMBB);</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160; </div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    <span class="comment">// splitBlockBeforeInstr adds to WaterList, which is important when it is</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <span class="comment">// called while handling branches so that the water will be seen on the</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <span class="comment">// next iteration for constant pools, but in this context, we don&#39;t want</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <span class="comment">// it.  Check for this so it will be removed from the WaterList.</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <span class="comment">// Also remove any entry from NewWaterList.</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *WaterBB = &amp;*--NewMBB-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>();</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    IP = <a class="code" href="namespacellvm.html#a086e9fbdb06276db7753101a08a63adf">llvm::find</a>(WaterList, WaterBB);</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="keywordflow">if</span> (IP != WaterList.end())</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      NewWaterList.<a class="code" href="classllvm_1_1SmallSet.html#a75a2d2ad3b3dce6702750d570ee8f343">erase</a>(WaterBB);</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160; </div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    <span class="comment">// We are adding new water.  Update NewWaterList.</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    NewWaterList.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(NewIsland);</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;  }</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160; </div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;  <span class="comment">// Remove the original WaterList entry; we want subsequent insertions in</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;  <span class="comment">// this vicinity to go after the one we&#39;re about to insert.  This</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;  <span class="comment">// considerably reduces the number of times we have to move the same CPE</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  <span class="comment">// more than once and is also important to ensure the algorithm terminates.</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;  <span class="keywordflow">if</span> (IP != WaterList.end())</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    WaterList.erase(IP);</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160; </div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;  <span class="comment">// Okay, we know we can put an island before NewMBB now, do it!</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;  MF-&gt;insert(NewMBB-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>(), NewIsland);</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160; </div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;  <span class="comment">// Update internal data structures to account for the newly inserted MBB.</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  updateForInsertedWaterBlock(NewIsland);</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160; </div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;  <span class="comment">// Decrement the old entry, and remove it if refcount becomes 0.</span></div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;  decrementCPEReferenceCount(CPI, CPEMI);</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160; </div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;  <span class="comment">// No existing clone of this CPE is within range.</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  <span class="comment">// We will be generating a new clone.  Get a UID for it.</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a> = createPICLabelUId();</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160; </div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;  <span class="comment">// Now that we have an island to add the CPE to, clone the original CPE and</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  <span class="comment">// add it to the island.</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;  U.HighWaterMark = NewIsland;</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;  U.CPEMI = <a class="code" href="namespacellvm.html#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(NewIsland, <a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a>(), <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(CSKY::CONSTPOOL_ENTRY))</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;                .<a class="code" href="classllvm_1_1MachineInstrBuilder.html#a4f1ceb770fe3446bfb2b3fa26858098f">addImm</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>)</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                .<a class="code" href="classllvm_1_1MachineInstrBuilder.html#acaf4466fb8b9a459c596aa5161423715">addConstantPoolIndex</a>(CPI)</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;                .<a class="code" href="classllvm_1_1MachineInstrBuilder.html#a4f1ceb770fe3446bfb2b3fa26858098f">addImm</a>(Size);</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;  CPEntries[CPI].push_back(CPEntry(U.CPEMI, <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>, 1));</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;  ++NumCPEs;</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160; </div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;  <span class="comment">// Mark the basic block as aligned as required by the const-pool entry.</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;  NewIsland-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a8cb665c210dc8e43f537cf4c9b84e2c7">setAlignment</a>(getCPEAlign(*U.CPEMI));</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160; </div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  <span class="comment">// Increase the size of the island block to account for the new entry.</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  BBInfo[NewIsland-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>()].Size += <a class="code" href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">Size</a>;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  adjustBBOffsetsAfter(&amp;*--NewIsland-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>());</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160; </div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  <span class="comment">// Finally, change the CPI in the instruction operand to be ID.</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = UserMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a432824f0975bb863478bf4ef3a5df258">getNumOperands</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    <span class="keywordflow">if</span> (UserMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a3f7a45f6e10668a5f702e26bca80d18e">getOperand</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>).<a class="code" href="classllvm_1_1MachineOperand.html#a5b401e780c5eed0aca1cfbf44d36a545">isCPI</a>()) {</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      UserMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a3f7a45f6e10668a5f702e26bca80d18e">getOperand</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>).<a class="code" href="classllvm_1_1MachineOperand.html#aebc99c3c37896879abad49e7254a2fb8">setIndex</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>);</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    }</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160; </div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;      <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  Moved CPE to #&quot;</span> &lt;&lt; <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a> &lt;&lt; <span class="stringliteral">&quot; CPI=&quot;</span> &lt;&lt; CPI</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;             &lt;&lt; <a class="code" href="namespacellvm.html#a66f0c57e04037076030c6a6e48f44f2d">format</a>(<span class="stringliteral">&quot; offset=%#x\n&quot;</span>, BBInfo[NewIsland-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>()].Offset));</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160; </div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;}</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="comment">/// removeDeadCPEMI - Remove a dead constant pool entry instruction. Update</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="comment">/// sizes and offsets of impacted basic blocks.</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> CSKYConstantIslands::removeDeadCPEMI(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI) {</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *CPEBB = CPEMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a002fd916e7206e01d512eeb06d405cf0">getParent</a>();</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">Size</a> = CPEMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a3f7a45f6e10668a5f702e26bca80d18e">getOperand</a>(2).<a class="code" href="classllvm_1_1MachineOperand.html#a38b28a85f818b49d8806c150b8a5b4f7">getImm</a>();</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  CPEMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#ac2421adbb9996e1b15f03a8abb6c70a8">eraseFromParent</a>();</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  BBInfo[CPEBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>()].Size -= <a class="code" href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">Size</a>;</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  <span class="comment">// All succeeding offsets have the current size value added in, fix this.</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  <span class="keywordflow">if</span> (CPEBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a095ce2d870dadf620a4c887ecc0efef8">empty</a>()) {</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    BBInfo[CPEBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>()].Size = 0;</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160; </div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    <span class="comment">// This block no longer needs to be aligned.</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    CPEBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a8cb665c210dc8e43f537cf4c9b84e2c7">setAlignment</a>(<a class="code" href="ELFObjHandler_8cpp.html#a043cdaf7b89aaeeb127be5d93411637f">Align</a>(4));</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="comment">// Entries are sorted by descending alignment, so realign from the front.</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    CPEBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a8cb665c210dc8e43f537cf4c9b84e2c7">setAlignment</a>(getCPEAlign(*CPEBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ab2d91e7bec944efcbc39d8e30644f111">begin</a>()));</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  }</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160; </div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;  adjustBBOffsetsAfter(CPEBB);</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;  <span class="comment">// An island has only one predecessor BB and one successor BB. Check if</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;  <span class="comment">// this BB&#39;s predecessor jumps directly to this BB&#39;s successor. This</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  <span class="comment">// shouldn&#39;t happen currently.</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a class="code" href="CSKYConstantIslandPass_8cpp.html#a69f0bf266f1e42f9d65ec549a6481ba6">bbIsJumpedOver</a>(CPEBB) &amp;&amp; <span class="stringliteral">&quot;How did this happen?&quot;</span>);</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;  <span class="comment">// FIXME: remove the empty blocks after all the work is done?</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;}</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="comment">/// removeUnusedCPEntries - Remove constant pool entries whose refcounts</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="comment">/// are zero.</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CSKYConstantIslands::removeUnusedCPEntries() {</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  <span class="keywordtype">unsigned</span> MadeChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = CPEntries.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    std::vector&lt;CPEntry&gt; &amp;CPEs = CPEntries[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> J = 0, Ee = CPEs.size(); J != Ee; ++J) {</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;      <span class="keywordflow">if</span> (CPEs[J].RefCount == 0 &amp;&amp; CPEs[J].CPEMI) {</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;        removeDeadCPEMI(CPEs[J].CPEMI);</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;        CPEs[J].CPEMI = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;        MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;      }</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    }</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;  }</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;}</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;<span class="comment">/// isBBInRange - Returns true if the distance between specific MI and</span></div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="comment">/// specific BB can fit in MI&#39;s displacement field.</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CSKYConstantIslands::isBBInRange(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>,</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;                                      <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *DestBB,</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;                                      <span class="keywordtype">unsigned</span> MaxDisp) {</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  <span class="keywordtype">unsigned</span> BrOffset = getOffsetOf(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  <span class="keywordtype">unsigned</span> DestOffset = BBInfo[DestBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>()].Offset;</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160; </div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Branch of destination &quot;</span> &lt;&lt; <a class="code" href="namespacellvm.html#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(*DestBB)</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; from &quot;</span> &lt;&lt; <a class="code" href="namespacellvm.html#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(*<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getParent())</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; max delta=&quot;</span> &lt;&lt; MaxDisp &lt;&lt; <span class="stringliteral">&quot; from &quot;</span> &lt;&lt; getOffsetOf(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>)</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; DestOffset &lt;&lt; <span class="stringliteral">&quot; offset &quot;</span></div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;                    &lt;&lt; <span class="keywordtype">int</span>(DestOffset - BrOffset) &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; *<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160; </div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;  <span class="keywordflow">if</span> (BrOffset &lt;= DestOffset) {</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="comment">// Branch before the Dest.</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    <span class="keywordflow">if</span> (DestOffset - BrOffset &lt;= MaxDisp)</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    <span class="keywordflow">if</span> (BrOffset - DestOffset &lt;= MaxDisp)</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  }</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;}</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="comment">/// fixupImmediateBr - Fix up an immediate branch whose destination is too far</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="comment">/// away to fit in its displacement field.</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CSKYConstantIslands::fixupImmediateBr(ImmBranch &amp;Br) {</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = Br.MI;</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *DestBB = <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getBranchDestBlock(*<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160; </div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  <span class="comment">// Check to see if the DestBB is already in-range.</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;  <span class="keywordflow">if</span> (isBBInRange(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, DestBB, Br.MaxDisp))</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160; </div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  <span class="keywordflow">if</span> (!Br.IsCond)</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <span class="keywordflow">return</span> fixupUnconditionalBr(Br);</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  <span class="keywordflow">return</span> fixupConditionalBr(Br);</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;}</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="comment">/// fixupUnconditionalBr - Fix up an unconditional branch whose destination is</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="comment">/// too far away to fit in its displacement field. If the LR register has been</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="comment">/// spilled in the epilogue, then we can use BSR to implement a far jump.</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="comment">/// Otherwise, add an intermediate branch instruction to a branch.</span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CSKYConstantIslands::fixupUnconditionalBr(ImmBranch &amp;Br) {</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = Br.MI;</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a> = <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getParent();</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160; </div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;  <span class="keywordflow">if</span> (!MFI-&gt;isLRSpilled())</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    <a class="code" href="namespacellvm.html#a7f2a3d4dcfee70225988aec53ff1e173">report_fatal_error</a>(<span class="stringliteral">&quot;underestimated function size&quot;</span>);</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160; </div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;  <span class="comment">// Use BSR to implement far jump.</span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;  Br.MaxDisp = ((1 &lt;&lt; (26 - 1)) - 1) * 2;</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;  <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;setDesc(<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(CSKY::BSR32_BR));</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;  BBInfo[<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>()].Size += 4;</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  adjustBBOffsetsAfter(<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>);</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  ++NumUBrFixed;</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160; </div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  Changed B to long jump &quot;</span> &lt;&lt; *<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160; </div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;}</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="comment">/// fixupConditionalBr - Fix up a conditional branch whose destination is too</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="comment">/// far away to fit in its displacement field. It is converted to an inverse</span></div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="comment">/// conditional branch + an unconditional branch to the destination.</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CSKYConstantIslands::fixupConditionalBr(ImmBranch &amp;Br) {</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = Br.MI;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *DestBB = <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getBranchDestBlock(*<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160; </div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;MachineOperand, 4&gt;</a> <a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>;</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  <a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>.push_back(<a class="code" href="classllvm_1_1MachineOperand.html#ab09679b541a6ba1219b3602569847364">MachineOperand::CreateImm</a>(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOpcode()));</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;  <a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>.push_back(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOperand(0));</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;  <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;<a class="code" href="classllvm_1_1HexagonInstrInfo.html#a5d95586ea588b8d6938a3e7679766688">reverseBranchCondition</a>(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>);</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160; </div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  <span class="comment">// Add an unconditional branch to the destination and invert the branch</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  <span class="comment">// condition to jump over it:</span></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  <span class="comment">// bteqz L1</span></div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  <span class="comment">// =&gt;</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  <span class="comment">// bnez L2</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  <span class="comment">// b   L1</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;  <span class="comment">// L2:</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160; </div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;  <span class="comment">// If the branch is at the end of its MBB and that has a fall-through block,</span></div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;  <span class="comment">// direct the updated conditional branch to the fall-through block. Otherwise,</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;  <span class="comment">// split the MBB before the next instruction.</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a> = <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getParent();</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *BMI = &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ace3ed0412f841777b7de55d47883890e">back</a>();</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;  <span class="keywordtype">bool</span> NeedSplit = (BMI != <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) || !<a class="code" href="CSKYConstantIslandPass_8cpp.html#a64267a385738a1aa6a110071d05ff207">bbHasFallthrough</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>);</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160; </div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;  ++NumCBrFixed;</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;  <span class="keywordflow">if</span> (BMI != <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) {</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    <span class="keywordflow">if</span> (std::next(<a class="code" href="classllvm_1_1MachineInstrBundleIterator.html">MachineBasicBlock::iterator</a>(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>)) == std::prev(<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">end</a>()) &amp;&amp;</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;        BMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a91c590e8191655a6739eb4df9c443896">isUnconditionalBranch</a>()) {</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;      <span class="comment">// Last MI in the BB is an unconditional branch. Can we simply invert the</span></div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;      <span class="comment">// condition and swap destinations:</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;      <span class="comment">// beqz L1</span></div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;      <span class="comment">// b   L2</span></div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;      <span class="comment">// =&gt;</span></div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;      <span class="comment">// bnez L2</span></div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;      <span class="comment">// b   L1</span></div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;      <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *NewDest = <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getBranchDestBlock(*BMI);</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;      <span class="keywordflow">if</span> (isBBInRange(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, NewDest, Br.MaxDisp)) {</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;            <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  Invert Bcc condition and swap its destination with &quot;</span></div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;                   &lt;&lt; *BMI);</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        BMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a3f7a45f6e10668a5f702e26bca80d18e">getOperand</a>(BMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a56b7fed94faeb5bc67ee2b71608d2665">getNumExplicitOperands</a>() - 1).<a class="code" href="classllvm_1_1MachineOperand.html#a98e9c9e8ef7cbb6c4aa89a38f21decfa">setMBB</a>(DestBB);</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;        <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOperand(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getNumExplicitOperands() - 1).setMBB(NewDest);</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160; </div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;        <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;setDesc(<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>[0].getImm()));</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;      }</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    }</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;  }</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160; </div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;  <span class="keywordflow">if</span> (NeedSplit) {</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    splitBlockBeforeInstr(*<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    <span class="comment">// No need for the branch to the next block. We&#39;re adding an unconditional</span></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    <span class="comment">// branch to the destination.</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    <span class="keywordtype">int</span> Delta = <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getInstSizeInBytes(<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ace3ed0412f841777b7de55d47883890e">back</a>());</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    BBInfo[<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>()].Size -= Delta;</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    <a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ace3ed0412f841777b7de55d47883890e">back</a>().<a class="code" href="classllvm_1_1MachineInstr.html#ac2421adbb9996e1b15f03a8abb6c70a8">eraseFromParent</a>();</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    <span class="comment">// BBInfo[SplitBB].Offset is wrong temporarily, fixed below</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160; </div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    <span class="comment">// The conditional successor will be swapped between the BBs after this, so</span></div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    <span class="comment">// update CFG.</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    <a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(DestBB);</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    std::next(<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>())-&gt;removeSuccessor(DestBB);</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  }</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *NextBB = &amp;*++<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>();</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160; </div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  Insert B to &quot;</span> &lt;&lt; <a class="code" href="namespacellvm.html#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(*DestBB)</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; also invert condition and change dest. to &quot;</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;                    &lt;&lt; <a class="code" href="namespacellvm.html#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(*NextBB) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160; </div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;  <span class="comment">// Insert a new conditional branch and a new unconditional branch.</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  <span class="comment">// Also update the ImmBranch as well as adding a new entry for the new branch.</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160; </div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;  <a class="code" href="namespacellvm.html#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>, <a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a>(), <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>[0].getImm()))</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;      .<a class="code" href="classllvm_1_1MachineInstrBuilder.html#ad08ed580345a51c50d9477dec1e65818">addReg</a>(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOperand(0).getReg())</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;      .<a class="code" href="classllvm_1_1MachineInstrBuilder.html#af8571e8dfb010fd8ae76cc4f87aafaac">addMBB</a>(NextBB);</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160; </div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;  Br.MI = &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ace3ed0412f841777b7de55d47883890e">back</a>();</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;  BBInfo[<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>()].Size += <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getInstSizeInBytes(<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ace3ed0412f841777b7de55d47883890e">back</a>());</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;  <a class="code" href="namespacellvm.html#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>, <a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a>(), <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Br.UncondBr)).<a class="code" href="classllvm_1_1MachineInstrBuilder.html#af8571e8dfb010fd8ae76cc4f87aafaac">addMBB</a>(DestBB);</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;  BBInfo[<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>()].Size += <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getInstSizeInBytes(<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ace3ed0412f841777b7de55d47883890e">back</a>());</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;  <span class="keywordtype">unsigned</span> MaxDisp = <a class="code" href="CSKYConstantIslandPass_8cpp.html#a2e62a3c07e3b7d0f0591b2d80bd20967">getUnconditionalBrDisp</a>(Br.UncondBr);</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;  ImmBranches.push_back(ImmBranch(&amp;<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ace3ed0412f841777b7de55d47883890e">back</a>(), MaxDisp, <span class="keyword">false</span>, Br.UncondBr));</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160; </div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;  <span class="comment">// Remove the old conditional branch.  It may or may not still be in MBB.</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;  BBInfo[<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getParent()-&gt;getNumber()].Size -= <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getInstSizeInBytes(*<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;  <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;  adjustBBOffsetsAfter(<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>);</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;}</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="comment">/// Returns a pass that converts branches to long branches.</span></div>
<div class="line"><a name="l01366"></a><span class="lineno"><a class="line" href="namespacellvm.html#ab3048fe42c5af7707fe9d438d8c527c5"> 1366</a></span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a> *<a class="code" href="namespacellvm.html#ab3048fe42c5af7707fe9d438d8c527c5">llvm::createCSKYConstantIslandPass</a>() {</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> CSKYConstantIslands();</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;}</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160; </div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<a class="code" href="PassSupport_8h.html#af807c9595d50b45c0008924c4679c85c">INITIALIZE_PASS</a>(CSKYConstantIslands, <a class="code" href="CSKYConstantIslandPass_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a>,</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;                <span class="stringliteral">&quot;CSKY constant island placement and branch shortening pass&quot;</span>,</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;                <span class="keyword">false</span>, <span class="keyword">false</span>)</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="anamespacellvm_1_1Check_html_a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396"><div class="ttname"><a href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">llvm::Check::Size</a></div><div class="ttdeci">@ Size</div><div class="ttdef"><b>Definition:</b> <a href="FileCheck_8h_source.html#l00077">FileCheck.h:77</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_a81626de817a0cb021ff8e915cf1942ed"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a81626de817a0cb021ff8e915cf1942ed">llvm::MachineBasicBlock::succ_size</a></div><div class="ttdeci">unsigned succ_size() const</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00385">MachineBasicBlock.h:385</a></div></div>
<div class="ttc" id="anamespacellvm_html_a25f1d7ccf87af8d87fcb950f7ed758b5"><div class="ttname"><a href="namespacellvm.html#a25f1d7ccf87af8d87fcb950f7ed758b5">llvm::isAligned</a></div><div class="ttdeci">bool isAligned(Align Lhs, uint64_t SizeInBytes)</div><div class="ttdoc">Checks that SizeInBytes is a multiple of the alignment.</div><div class="ttdef"><b>Definition:</b> <a href="Alignment_8h_source.html#l00145">Alignment.h:145</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_ab644fcf07a4c2708333cf66276282357"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#ab644fcf07a4c2708333cf66276282357">llvm::MachineBasicBlock::pred_begin</a></div><div class="ttdeci">pred_iterator pred_begin()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00357">MachineBasicBlock.h:357</a></div></div>
<div class="ttc" id="aIRTranslator_8cpp_html_abe44dfdea65b4f7e11e0a608ab708b76"><div class="ttname"><a href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a></div><div class="ttdeci">IRTranslator LLVM IR MI</div><div class="ttdef"><b>Definition:</b> <a href="IRTranslator_8cpp_source.html#l00109">IRTranslator.cpp:109</a></div></div>
<div class="ttc" id="aMachineInstr_8h_html"><div class="ttname"><a href="MachineInstr_8h.html">MachineInstr.h</a></div></div>
<div class="ttc" id="aCompiler_8h_html_aa863693eef567397d9c292da5bf22d34"><div class="ttname"><a href="Compiler_8h.html#aa863693eef567397d9c292da5bf22d34">LLVM_DUMP_METHOD</a></div><div class="ttdeci">#define LLVM_DUMP_METHOD</div><div class="ttdoc">Mark debug helper function definitions like dump() that should not be stripped from debug builds.</div><div class="ttdef"><b>Definition:</b> <a href="Compiler_8h_source.html#l00492">Compiler.h:492</a></div></div>
<div class="ttc" id="aMathExtras_8h_html"><div class="ttname"><a href="MathExtras_8h.html">MathExtras.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstrBuilder_html_a4f1ceb770fe3446bfb2b3fa26858098f"><div class="ttname"><a href="classllvm_1_1MachineInstrBuilder.html#a4f1ceb770fe3446bfb2b3fa26858098f">llvm::MachineInstrBuilder::addImm</a></div><div class="ttdeci">const MachineInstrBuilder &amp; addImm(int64_t Val) const</div><div class="ttdoc">Add a new immediate operand.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstrBuilder_8h_source.html#l00131">MachineInstrBuilder.h:131</a></div></div>
<div class="ttc" id="anamespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">This is an optimization pass for GlobalISel generic memory operations.</div><div class="ttdef"><b>Definition:</b> <a href="AddressRanges_8h_source.html#l00018">AddressRanges.h:18</a></div></div>
<div class="ttc" id="aCSKYConstantPoolValue_8h_html"><div class="ttname"><a href="CSKYConstantPoolValue_8h.html">CSKYConstantPoolValue.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1DataLayout_html"><div class="ttname"><a href="classllvm_1_1DataLayout.html">llvm::DataLayout</a></div><div class="ttdoc">A parsed version of the target data layout string in and methods for querying it.</div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00110">DataLayout.h:110</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AArch64PACKey_html_abf4394f452bde3f544999858d71e4b46"><div class="ttname"><a href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">llvm::AArch64PACKey::ID</a></div><div class="ttdeci">ID</div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00790">AArch64BaseInfo.h:790</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_a856266240556bbae90bc5ba75c156eef"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a856266240556bbae90bc5ba75c156eef">llvm::MachineBasicBlock::getBasicBlock</a></div><div class="ttdeci">const BasicBlock * getBasicBlock() const</div><div class="ttdoc">Return the LLVM basic block that this instance corresponded to originally.</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00213">MachineBasicBlock.h:213</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstr_html_a56b7fed94faeb5bc67ee2b71608d2665"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a56b7fed94faeb5bc67ee2b71608d2665">llvm::MachineInstr::getNumExplicitOperands</a></div><div class="ttdeci">unsigned getNumExplicitOperands() const</div><div class="ttdoc">Returns the number of non-implicit operands.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8cpp_source.html#l00734">MachineInstr.cpp:734</a></div></div>
<div class="ttc" id="anamespacellvm_html_aa81eb67f09ee4944eaeeddbc54c0c0de"><div class="ttname"><a href="namespacellvm.html#aa81eb67f09ee4944eaeeddbc54c0c0de">llvm::lower_bound</a></div><div class="ttdeci">auto lower_bound(R &amp;&amp;Range, T &amp;&amp;Value)</div><div class="ttdoc">Provide wrappers to std::lower_bound which take ranges instead of having to pass begin/end explicitly...</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01923">STLExtras.h:1923</a></div></div>
<div class="ttc" id="aStringRef_8h_html"><div class="ttname"><a href="StringRef_8h.html">StringRef.h</a></div></div>
<div class="ttc" id="astructllvm_1_1BasicBlockInfo_html_acadf079e9232969cd61ca5744b10dd16"><div class="ttname"><a href="structllvm_1_1BasicBlockInfo.html#acadf079e9232969cd61ca5744b10dd16">llvm::BasicBlockInfo::Offset</a></div><div class="ttdeci">unsigned Offset</div><div class="ttdoc">Offset - Distance from the beginning of the function to the beginning of this basic block.</div><div class="ttdef"><b>Definition:</b> <a href="ARMBasicBlockInfo_8h_source.html#l00051">ARMBasicBlockInfo.h:51</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdoc">This is a 'vector' (really, a variable-sized array), optimized for the case when the array is small.</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l01199">SmallVector.h:1199</a></div></div>
<div class="ttc" id="aStatistic_8h_html"><div class="ttname"><a href="Statistic_8h.html">Statistic.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineFunction_html_a9d017af749f76484cb9aec9ff6e4330c"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#a9d017af749f76484cb9aec9ff6e4330c">llvm::MachineFunction::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00872">MachineFunction.h:872</a></div></div>
<div class="ttc" id="anamespacellvm_html_af7881286e3ea4d7f1c4a63c87c132dac"><div class="ttname"><a href="namespacellvm.html#af7881286e3ea4d7f1c4a63c87c132dac">llvm::printMBBReference</a></div><div class="ttdeci">Printable printMBBReference(const MachineBasicBlock &amp;MBB)</div><div class="ttdoc">Prints a machine basic block reference.</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8cpp_source.html#l00118">MachineBasicBlock.cpp:118</a></div></div>
<div class="ttc" id="aSupport_2ErrorHandling_8h_html"><div class="ttname"><a href="Support_2ErrorHandling_8h.html">ErrorHandling.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1CSKYInstrInfo_html"><div class="ttname"><a href="classllvm_1_1CSKYInstrInfo.html">llvm::CSKYInstrInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="CSKYInstrInfo_8h_source.html#l00026">CSKYInstrInfo.h:26</a></div></div>
<div class="ttc" id="aclassllvm_1_1CSKYMachineFunctionInfo_html"><div class="ttname"><a href="classllvm_1_1CSKYMachineFunctionInfo.html">llvm::CSKYMachineFunctionInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="CSKYMachineFunctionInfo_8h_source.html#l00020">CSKYMachineFunctionInfo.h:20</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineFunctionPass_html"><div class="ttname"><a href="classllvm_1_1MachineFunctionPass.html">llvm::MachineFunctionPass</a></div><div class="ttdoc">MachineFunctionPass - This class adapts the FunctionPass interface to allow convenient creation of pa...</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunctionPass_8h_source.html#l00030">MachineFunctionPass.h:30</a></div></div>
<div class="ttc" id="aMachineBasicBlock_8h_html"><div class="ttname"><a href="MachineBasicBlock_8h.html">MachineBasicBlock.h</a></div></div>
<div class="ttc" id="aCSKY_8h_html"><div class="ttname"><a href="CSKY_8h.html">CSKY.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1tgtok_html_abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95"><div class="ttname"><a href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">llvm::tgtok::Bits</a></div><div class="ttdeci">@ Bits</div><div class="ttdef"><b>Definition:</b> <a href="TGLexer_8h_source.html#l00050">TGLexer.h:50</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallSet_html"><div class="ttname"><a href="classllvm_1_1SmallSet.html">llvm::SmallSet</a></div><div class="ttdoc">SmallSet - This maintains a set of unique values, optimizing for the case when the set is small (less...</div><div class="ttdef"><b>Definition:</b> <a href="SmallSet_8h_source.html#l00135">SmallSet.h:135</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineFunctionProperties_html"><div class="ttname"><a href="classllvm_1_1MachineFunctionProperties.html">llvm::MachineFunctionProperties</a></div><div class="ttdoc">Properties which a MachineFunction may have at a given point in time.</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00128">MachineFunction.h:128</a></div></div>
<div class="ttc" id="aSTLExtras_8h_html"><div class="ttname"><a href="STLExtras_8h.html">STLExtras.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_ace3ed0412f841777b7de55d47883890e"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#ace3ed0412f841777b7de55d47883890e">llvm::MachineBasicBlock::back</a></div><div class="ttdeci">MachineInstr &amp; back()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00289">MachineBasicBlock.h:289</a></div></div>
<div class="ttc" id="aX86PartialReduction_8cpp_html_a87b8bfbbe9d8f7146d7f20a5fb42efd0"><div class="ttname"><a href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a></div><div class="ttdeci">Value * RHS</div><div class="ttdef"><b>Definition:</b> <a href="X86PartialReduction_8cpp_source.html#l00076">X86PartialReduction.cpp:76</a></div></div>
<div class="ttc" id="aFormat_8h_html"><div class="ttname"><a href="Format_8h.html">Format.h</a></div></div>
<div class="ttc" id="aCSKYConstantIslandPass_8cpp_html_a2e62a3c07e3b7d0f0591b2d80bd20967"><div class="ttname"><a href="CSKYConstantIslandPass_8cpp.html#a2e62a3c07e3b7d0f0591b2d80bd20967">getUnconditionalBrDisp</a></div><div class="ttdeci">static unsigned getUnconditionalBrDisp(int Opc)</div><div class="ttdoc">getUnconditionalBrDisp - Returns the maximum displacement that can fit in the specific unconditional ...</div><div class="ttdef"><b>Definition:</b> <a href="CSKYConstantIslandPass_8cpp_source.html#l00891">CSKYConstantIslandPass.cpp:891</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineFunctionPass_html_a864fd57b4304ef933b3281d0ef85a88e"><div class="ttname"><a href="classllvm_1_1MachineFunctionPass.html#a864fd57b4304ef933b3281d0ef85a88e">llvm::MachineFunctionPass::getAnalysisUsage</a></div><div class="ttdeci">void getAnalysisUsage(AnalysisUsage &amp;AU) const override</div><div class="ttdoc">getAnalysisUsage - Subclasses that override getAnalysisUsage must call this.</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunctionPass_8cpp_source.html#l00167">MachineFunctionPass.cpp:167</a></div></div>
<div class="ttc" id="aDebug_8h_html_a08efc68d15935eb8889400a46c3749ba"><div class="ttname"><a href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a></div><div class="ttdeci">#define LLVM_DEBUG(X)</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8h_source.html#l00101">Debug.h:101</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_a96d73bbd7af15cb1fc38c3f4a3bd82e9"><div class="ttname"><a href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div><div class="ttdeci">#define F(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00055">MD5.cpp:55</a></div></div>
<div class="ttc" id="aMachineRegisterInfo_8h_html"><div class="ttname"><a href="MachineRegisterInfo_8h.html">MachineRegisterInfo.h</a></div></div>
<div class="ttc" id="astructllvm_1_1BasicBlockInfo_html_a96d35759d0115509c273fbdfd8fe011a"><div class="ttname"><a href="structllvm_1_1BasicBlockInfo.html#a96d35759d0115509c273fbdfd8fe011a">llvm::BasicBlockInfo::postOffset</a></div><div class="ttdeci">unsigned postOffset(Align Alignment=Align(1)) const</div><div class="ttdoc">Compute the offset immediately following this block.</div><div class="ttdef"><b>Definition:</b> <a href="ARMBasicBlockInfo_8h_source.html#l00090">ARMBasicBlockInfo.h:90</a></div></div>
<div class="ttc" id="aREADME__P9_8txt_html_ae070adaf1b4bf0e7c12fcae2b9c5ae67"><div class="ttname"><a href="README__P9_8txt.html#ae070adaf1b4bf0e7c12fcae2b9c5ae67">result</a></div><div class="ttdeci">It looks like we only need to define PPCfmarto for these because according to these instructions perform RTO on fma s result</div><div class="ttdef"><b>Definition:</b> <a href="README__P9_8txt_source.html#l00256">README_P9.txt:256</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7c46c742c31be54870e2038048e6b391"><div class="ttname"><a href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">llvm::dbgs</a></div><div class="ttdeci">raw_ostream &amp; dbgs()</div><div class="ttdoc">dbgs() - This returns a reference to a raw_ostream for debugging messages.</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8cpp_source.html#l00163">Debug.cpp:163</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_a935e2a8884592189d8f261634a0b24c5"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a935e2a8884592189d8f261634a0b24c5">llvm::MachineBasicBlock::addSuccessor</a></div><div class="ttdeci">void addSuccessor(MachineBasicBlock *Succ, BranchProbability Prob=BranchProbability::getUnknown())</div><div class="ttdoc">Add Succ as a successor of this MachineBasicBlock.</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8cpp_source.html#l00772">MachineBasicBlock.cpp:772</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstr_html_a91c590e8191655a6739eb4df9c443896"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a91c590e8191655a6739eb4df9c443896">llvm::MachineInstr::isUnconditionalBranch</a></div><div class="ttdeci">bool isUnconditionalBranch(QueryType Type=AnyInBundle) const</div><div class="ttdoc">Return true if this is a branch which always transfers control flow to some other block.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00926">MachineInstr.h:926</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_abada92f8cd2854d2b747f14c4a7be0ed"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#abada92f8cd2854d2b747f14c4a7be0ed">llvm::MachineBasicBlock::reverse_iterator</a></div><div class="ttdeci">MachineInstrBundleIterator&lt; MachineInstr, true &gt; reverse_iterator</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00275">MachineBasicBlock.h:275</a></div></div>
<div class="ttc" id="aCommandLine_8h_html"><div class="ttname"><a href="CommandLine_8h.html">CommandLine.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_a03936a9b37da541420049422204ab206"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a03936a9b37da541420049422204ab206">llvm::MachineBasicBlock::pred_size</a></div><div class="ttdeci">unsigned pred_size() const</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00369">MachineBasicBlock.h:369</a></div></div>
<div class="ttc" id="aX86PartialReduction_8cpp_html_a9e1483f7215664a2315c53c3558d9a8d"><div class="ttname"><a href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a></div><div class="ttdeci">Value * LHS</div><div class="ttdef"><b>Definition:</b> <a href="X86PartialReduction_8cpp_source.html#l00075">X86PartialReduction.cpp:75</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstrBuilder_html_af8571e8dfb010fd8ae76cc4f87aafaac"><div class="ttname"><a href="classllvm_1_1MachineInstrBuilder.html#af8571e8dfb010fd8ae76cc4f87aafaac">llvm::MachineInstrBuilder::addMBB</a></div><div class="ttdeci">const MachineInstrBuilder &amp; addMBB(MachineBasicBlock *MBB, unsigned TargetFlags=0) const</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstrBuilder_8h_source.html#l00146">MachineInstrBuilder.h:146</a></div></div>
<div class="ttc" id="aConstants_8h_html"><div class="ttname"><a href="Constants_8h.html">Constants.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineOperand_html_ab09679b541a6ba1219b3602569847364"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#ab09679b541a6ba1219b3602569847364">llvm::MachineOperand::CreateImm</a></div><div class="ttdeci">static MachineOperand CreateImm(int64_t Val)</div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00815">MachineOperand.h:815</a></div></div>
<div class="ttc" id="aCSKYSubtarget_8h_html"><div class="ttname"><a href="CSKYSubtarget_8h.html">CSKYSubtarget.h</a></div></div>
<div class="ttc" id="aBuiltinGCs_8cpp_html_a6742d2e0a668baf1196ec69e158d5f15"><div class="ttname"><a href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a></div><div class="ttdeci">static GCRegistry::Add&lt; CoreCLRGC &gt; E(&quot;coreclr&quot;, &quot;CoreCLR-compatible GC&quot;)</div></div>
<div class="ttc" id="aclassllvm_1_1MachineOperand_html_a38b28a85f818b49d8806c150b8a5b4f7"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#a38b28a85f818b49d8806c150b8a5b4f7">llvm::MachineOperand::getImm</a></div><div class="ttdeci">int64_t getImm() const</div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00556">MachineOperand.h:556</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_a3ddd708642d60c1661992ff8ba1b215d"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a3ddd708642d60c1661992ff8ba1b215d">llvm::MachineBasicBlock::succ_end</a></div><div class="ttdeci">succ_iterator succ_end()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00375">MachineBasicBlock.h:375</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstr_html_a3f7a45f6e10668a5f702e26bca80d18e"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a3f7a45f6e10668a5f702e26bca80d18e">llvm::MachineInstr::getOperand</a></div><div class="ttdeci">const MachineOperand &amp; getOperand(unsigned i) const</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00526">MachineInstr.h:526</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ARM__PROC_html_aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5"><div class="ttname"><a href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">llvm::ARM_PROC::A</a></div><div class="ttdeci">@ A</div><div class="ttdef"><b>Definition:</b> <a href="MCTargetDesc_2ARMBaseInfo_8h_source.html#l00034">ARMBaseInfo.h:34</a></div></div>
<div class="ttc" id="anamespacellvm_html_ad82de9da62635df78a534de0f16c1129"><div class="ttname"><a href="namespacellvm.html#ad82de9da62635df78a534de0f16c1129">llvm::Log2</a></div><div class="ttdeci">unsigned Log2(Align A)</div><div class="ttdoc">Returns the log2 of the alignment.</div><div class="ttdef"><b>Definition:</b> <a href="Alignment_8h_source.html#l00208">Alignment.h:208</a></div></div>
<div class="ttc" id="astructllvm_1_1BasicBlockInfo_html"><div class="ttname"><a href="structllvm_1_1BasicBlockInfo.html">llvm::BasicBlockInfo</a></div><div class="ttdoc">BasicBlockInfo - Information about the offset and size of a single basic block.</div><div class="ttdef"><b>Definition:</b> <a href="ARMBasicBlockInfo_8h_source.html#l00041">ARMBasicBlockInfo.h:41</a></div></div>
<div class="ttc" id="aPassSupport_8h_html_af807c9595d50b45c0008924c4679c85c"><div class="ttname"><a href="PassSupport_8h.html#af807c9595d50b45c0008924c4679c85c">INITIALIZE_PASS</a></div><div class="ttdeci">#define INITIALIZE_PASS(passName, arg, name, cfg, analysis)</div><div class="ttdef"><b>Definition:</b> <a href="PassSupport_8h_source.html#l00038">PassSupport.h:38</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisUsage_html"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html">llvm::AnalysisUsage</a></div><div class="ttdoc">Represent the analysis usage information of a pass.</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00047">PassAnalysisSupport.h:47</a></div></div>
<div class="ttc" id="aHexagonCopyToCombine_8cpp_html_a1d40004718218dbdf06b496766299101"><div class="ttname"><a href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a></div><div class="ttdeci">const HexagonInstrInfo * TII</div><div class="ttdef"><b>Definition:</b> <a href="HexagonCopyToCombine_8cpp_source.html#l00125">HexagonCopyToCombine.cpp:125</a></div></div>
<div class="ttc" id="aBuiltinGCs_8cpp_html_a7abf5fb4071cb25dbce06dfb5ee3c937"><div class="ttname"><a href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a></div><div class="ttdeci">static GCRegistry::Add&lt; OcamlGC &gt; B(&quot;ocaml&quot;, &quot;ocaml 3.10-compatible GC&quot;)</div></div>
<div class="ttc" id="aclassllvm_1_1MachineFunctionProperties_html_aa0f2b6097642894ce79ff3e15c896206"><div class="ttname"><a href="classllvm_1_1MachineFunctionProperties.html#aa0f2b6097642894ce79ff3e15c896206">llvm::MachineFunctionProperties::set</a></div><div class="ttdeci">MachineFunctionProperties &amp; set(Property P)</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00197">MachineFunction.h:197</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7f2a3d4dcfee70225988aec53ff1e173"><div class="ttname"><a href="namespacellvm.html#a7f2a3d4dcfee70225988aec53ff1e173">llvm::report_fatal_error</a></div><div class="ttdeci">void report_fatal_error(Error Err, bool gen_crash_diag=true)</div><div class="ttdoc">Report a serious error, calling any installed error handler.</div><div class="ttdef"><b>Definition:</b> <a href="Testing_2Support_2Error_8cpp_source.html#l00145">Error.cpp:145</a></div></div>
<div class="ttc" id="anamespacellvm_html_a0bf75467957937ad23ad7be19f489934"><div class="ttname"><a href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">llvm::STATISTIC</a></div><div class="ttdeci">STATISTIC(NumFunctions, &quot;Total number of functions&quot;)</div></div>
<div class="ttc" id="aDebugLoc_8h_html"><div class="ttname"><a href="DebugLoc_8h.html">DebugLoc.h</a></div></div>
<div class="ttc" id="aELFObjHandler_8cpp_html_a043cdaf7b89aaeeb127be5d93411637f"><div class="ttname"><a href="ELFObjHandler_8cpp.html#a043cdaf7b89aaeeb127be5d93411637f">Align</a></div><div class="ttdeci">uint64_t Align</div><div class="ttdef"><b>Definition:</b> <a href="ELFObjHandler_8cpp_source.html#l00082">ELFObjHandler.cpp:82</a></div></div>
<div class="ttc" id="astructllvm_1_1Align_html"><div class="ttname"><a href="structllvm_1_1Align.html">llvm::Align</a></div><div class="ttdoc">This struct is a compact representation of a valid (non-zero power of two) alignment.</div><div class="ttdef"><b>Definition:</b> <a href="Alignment_8h_source.html#l00039">Alignment.h:39</a></div></div>
<div class="ttc" id="aclassllvm_1_1CSKYSubtarget_html"><div class="ttname"><a href="classllvm_1_1CSKYSubtarget.html">llvm::CSKYSubtarget</a></div><div class="ttdef"><b>Definition:</b> <a href="CSKYSubtarget_8h_source.html#l00030">CSKYSubtarget.h:30</a></div></div>
<div class="ttc" id="anamespacellvm_1_1CallingConv_html_a188c0836f8c3528401f1c236fd93b977"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">llvm::CallingConv::ID</a></div><div class="ttdeci">unsigned ID</div><div class="ttdoc">LLVM IR allows to use arbitrary numbers as calling convention identifiers.</div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00024">CallingConv.h:24</a></div></div>
<div class="ttc" id="aType_8h_html"><div class="ttname"><a href="Type_8h.html">Type.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html">llvm::MachineBasicBlock</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00094">MachineBasicBlock.h:94</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_a8cb665c210dc8e43f537cf4c9b84e2c7"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a8cb665c210dc8e43f537cf4c9b84e2c7">llvm::MachineBasicBlock::setAlignment</a></div><div class="ttdeci">void setAlignment(Align A)</div><div class="ttdoc">Set alignment of the basic block.</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00563">MachineBasicBlock.h:563</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineFunctionProperties_html_ad85237c6c667e4713efe8921e9c32ac1a72f7d830dd5ddb30f06d8e9639558ac3"><div class="ttname"><a href="classllvm_1_1MachineFunctionProperties.html#ad85237c6c667e4713efe8921e9c32ac1a72f7d830dd5ddb30f06d8e9639558ac3">llvm::MachineFunctionProperties::Property::NoVRegs</a></div><div class="ttdeci">@ NoVRegs</div></div>
<div class="ttc" id="aCSKYConstantIslandPass_8cpp_html_a69f0bf266f1e42f9d65ec549a6481ba6"><div class="ttname"><a href="CSKYConstantIslandPass_8cpp.html#a69f0bf266f1e42f9d65ec549a6481ba6">bbIsJumpedOver</a></div><div class="ttdeci">static bool bbIsJumpedOver(MachineBasicBlock *MBB)</div><div class="ttdoc">BBIsJumpedOver - Return true of the specified basic block's only predecessor unconditionally branches...</div><div class="ttdef"><b>Definition:</b> <a href="CSKYConstantIslandPass_8cpp_source.html#l00800">CSKYConstantIslandPass.cpp:800</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_a904414f0f44918a06bab99336cf587a7"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a904414f0f44918a06bab99336cf587a7">llvm::MachineBasicBlock::succ_iterator</a></div><div class="ttdeci">std::vector&lt; MachineBasicBlock * &gt;::iterator succ_iterator</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00347">MachineBasicBlock.h:347</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineFunction_html_a325f6b611ef9ec06798d3b4eb9572093"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#a325f6b611ef9ec06798d3b4eb9572093">llvm::MachineFunction::getSubtarget</a></div><div class="ttdeci">const TargetSubtargetInfo &amp; getSubtarget() const</div><div class="ttdoc">getSubtarget - Return the subtarget for which this machine code is being compiled.</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00672">MachineFunction.h:672</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallSet_html_a2a98f19750ba941ce791b75ca6d77e48"><div class="ttname"><a href="classllvm_1_1SmallSet.html#a2a98f19750ba941ce791b75ca6d77e48">llvm::SmallSet::count</a></div><div class="ttdeci">size_type count(const T &amp;V) const</div><div class="ttdoc">count - Return 1 if the element is in the set, 0 otherwise.</div><div class="ttdef"><b>Definition:</b> <a href="SmallSet_8h_source.html#l00164">SmallSet.h:164</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstr_html"><div class="ttname"><a href="classllvm_1_1MachineInstr.html">llvm::MachineInstr</a></div><div class="ttdoc">Representation of each machine instruction.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00066">MachineInstr.h:66</a></div></div>
<div class="ttc" id="anamespacellvm_html_a086e9fbdb06276db7753101a08a63adf"><div class="ttname"><a href="namespacellvm.html#a086e9fbdb06276db7753101a08a63adf">llvm::find</a></div><div class="ttdeci">auto find(R &amp;&amp;Range, const T &amp;Val)</div><div class="ttdoc">Provide wrappers to std::find which take ranges instead of having to pass begin/end explicitly.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01755">STLExtras.h:1755</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineConstantPool_html"><div class="ttname"><a href="classllvm_1_1MachineConstantPool.html">llvm::MachineConstantPool</a></div><div class="ttdoc">The MachineConstantPool class keeps track of constants referenced by a function which must be spilled...</div><div class="ttdef"><b>Definition:</b> <a href="MachineConstantPool_8h_source.html#l00117">MachineConstantPool.h:117</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00058">MD5.cpp:58</a></div></div>
<div class="ttc" id="aMachineConstantPool_8h_html"><div class="ttname"><a href="MachineConstantPool_8h.html">MachineConstantPool.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineOperand_html_a5b401e780c5eed0aca1cfbf44d36a545"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#a5b401e780c5eed0aca1cfbf44d36a545">llvm::MachineOperand::isCPI</a></div><div class="ttdeci">bool isCPI() const</div><div class="ttdoc">isCPI - Tests if this is a MO_ConstantPoolIndex operand.</div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00341">MachineOperand.h:341</a></div></div>
<div class="ttc" id="anamespacellvm_html_ab3048fe42c5af7707fe9d438d8c527c5"><div class="ttname"><a href="namespacellvm.html#ab3048fe42c5af7707fe9d438d8c527c5">llvm::createCSKYConstantIslandPass</a></div><div class="ttdeci">FunctionPass * createCSKYConstantIslandPass()</div><div class="ttdoc">Returns a pass that converts branches to long branches.</div><div class="ttdef"><b>Definition:</b> <a href="CSKYConstantIslandPass_8cpp_source.html#l01366">CSKYConstantIslandPass.cpp:1366</a></div></div>
<div class="ttc" id="aMachineFunctionPass_8h_html"><div class="ttname"><a href="MachineFunctionPass_8h.html">MachineFunctionPass.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineFunction_html_aa460158a4019a4043faf6ea76344cbd5"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#aa460158a4019a4043faf6ea76344cbd5">llvm::MachineFunction::getConstantPool</a></div><div class="ttdeci">MachineConstantPool * getConstantPool()</div><div class="ttdoc">getConstantPool - Return the constant pool object for the current function.</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00704">MachineFunction.h:704</a></div></div>
<div class="ttc" id="aSILowerControlFlow_8cpp_html_a4868c5d81c5ccc98c47aeab6244346a0"><div class="ttname"><a href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a></div><div class="ttdeci">assert(ImpDefSCC.getReg()==AMDGPU::SCC &amp;&amp;ImpDefSCC.isDef())</div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_a6321b189ea8fd5058663f8a87d6c23e9"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a6321b189ea8fd5058663f8a87d6c23e9">llvm::MachineBasicBlock::succ_begin</a></div><div class="ttdeci">succ_iterator succ_begin()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00373">MachineBasicBlock.h:373</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_a4e21760f681d6f97f95c8414e7b83ea5"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a4e21760f681d6f97f95c8414e7b83ea5">llvm::MachineBasicBlock::getParent</a></div><div class="ttdeci">const MachineFunction * getParent() const</div><div class="ttdoc">Return the MachineFunction containing this basic block.</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00265">MachineBasicBlock.h:265</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstrBuilder_html_ad08ed580345a51c50d9477dec1e65818"><div class="ttname"><a href="classllvm_1_1MachineInstrBuilder.html#ad08ed580345a51c50d9477dec1e65818">llvm::MachineInstrBuilder::addReg</a></div><div class="ttdeci">const MachineInstrBuilder &amp; addReg(Register RegNo, unsigned flags=0, unsigned SubReg=0) const</div><div class="ttdoc">Add a new virtual register operand.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstrBuilder_8h_source.html#l00097">MachineInstrBuilder.h:97</a></div></div>
<div class="ttc" id="aCSKYConstantIslandPass_8cpp_html_ad78e062f62e0d6e453941fb4ca843e4d"><div class="ttname"><a href="CSKYConstantIslandPass_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a></div><div class="ttdeci">#define DEBUG_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="CSKYConstantIslandPass_8cpp_source.html#l00060">CSKYConstantIslandPass.cpp:60</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallSet_html_a75a2d2ad3b3dce6702750d570ee8f343"><div class="ttname"><a href="classllvm_1_1SmallSet.html#a75a2d2ad3b3dce6702750d570ee8f343">llvm::SmallSet::erase</a></div><div class="ttdeci">bool erase(const T &amp;V)</div><div class="ttdef"><b>Definition:</b> <a href="SmallSet_8h_source.html#l00205">SmallSet.h:205</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineFunction_html"><div class="ttname"><a href="classllvm_1_1MachineFunction.html">llvm::MachineFunction</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00258">MachineFunction.h:258</a></div></div>
<div class="ttc" id="anamespacellvm_html_a10f3d955592ae2bc745f57e5b48ae115"><div class="ttname"><a href="namespacellvm.html#a10f3d955592ae2bc745f57e5b48ae115">llvm::size</a></div><div class="ttdeci">auto size(R &amp;&amp;Range, std::enable_if_t&lt; std::is_base_of&lt; std::random_access_iterator_tag, typename std::iterator_traits&lt; decltype(Range.begin())&gt;::iterator_category &gt;::value, void &gt; *=nullptr)</div><div class="ttdoc">Get the size of a range.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01716">STLExtras.h:1716</a></div></div>
<div class="ttc" id="astructllvm_1_1BasicBlockInfo_html_a1b26f2a8fbde15592af8af3fb950d8fc"><div class="ttname"><a href="structllvm_1_1BasicBlockInfo.html#a1b26f2a8fbde15592af8af3fb950d8fc">llvm::BasicBlockInfo::Size</a></div><div class="ttdeci">unsigned Size</div><div class="ttdoc">Size - Size of the basic block in bytes.</div><div class="ttdef"><b>Definition:</b> <a href="ARMBasicBlockInfo_8h_source.html#l00058">ARMBasicBlockInfo.h:58</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_ae34c996b58df9b9ce6695a0c8b70c533"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#ae34c996b58df9b9ce6695a0c8b70c533">llvm::MachineBasicBlock::iterator</a></div><div class="ttdeci">MachineInstrBundleIterator&lt; MachineInstr &gt; iterator</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00273">MachineBasicBlock.h:273</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineOperand_html_a9b48cb80ee1534c2b51d789b673137c1"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#a9b48cb80ee1534c2b51d789b673137c1">llvm::MachineOperand::getMBB</a></div><div class="ttdeci">MachineBasicBlock * getMBB() const</div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00571">MachineOperand.h:571</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_a3aa22d521bd6a7e6b9f35545dc7b0f1e"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a3aa22d521bd6a7e6b9f35545dc7b0f1e">llvm::MachineBasicBlock::getNumber</a></div><div class="ttdeci">int getNumber() const</div><div class="ttdoc">MachineBasicBlocks are uniquely numbered at the function level, unless they're not in a MachineFuncti...</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l01143">MachineBasicBlock.h:1143</a></div></div>
<div class="ttc" id="aDataLayout_8h_html"><div class="ttname"><a href="DataLayout_8h.html">DataLayout.h</a></div></div>
<div class="ttc" id="aBasicBlockSections_8cpp_html_a5fd0741d696f28faf65b33f6c6af8fda"><div class="ttname"><a href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a></div><div class="ttdeci">SmallVector&lt; MachineOperand, 4 &gt; Cond</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockSections_8cpp_source.html#l00137">BasicBlockSections.cpp:137</a></div></div>
<div class="ttc" id="aclassllvm_1_1StringRef_html"><div class="ttname"><a href="classllvm_1_1StringRef.html">llvm::StringRef</a></div><div class="ttdoc">StringRef - Represent a constant reference to a string, i.e.</div><div class="ttdef"><b>Definition:</b> <a href="StringRef_8h_source.html#l00050">StringRef.h:50</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_adf0023bdc4f05a7849c35b1c859580d8"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#adf0023bdc4f05a7849c35b1c859580d8">llvm::MachineBasicBlock::splice</a></div><div class="ttdeci">void splice(iterator Where, MachineBasicBlock *Other, iterator From)</div><div class="ttdoc">Take an instruction from MBB 'Other' at the position From, and insert it into this MBB right before '...</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l01037">MachineBasicBlock.h:1037</a></div></div>
<div class="ttc" id="aAArch64SLSHardening_8cpp_html_ad5f691fdc1a09aaf6df5fef958b35a3d"><div class="ttname"><a href="AArch64SLSHardening_8cpp.html#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a></div><div class="ttdeci">MachineBasicBlock MachineBasicBlock::iterator MBBI</div><div class="ttdef"><b>Definition:</b> <a href="AArch64SLSHardening_8cpp_source.html#l00075">AArch64SLSHardening.cpp:75</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstr_html_a0363204b5fbab08a46f5a7cd7f376f78"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">llvm::MachineInstr::getOpcode</a></div><div class="ttdeci">unsigned getOpcode() const</div><div class="ttdoc">Returns the opcode of this MachineInstr.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00516">MachineInstr.h:516</a></div></div>
<div class="ttc" id="anamespacellvm_html_a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4"><div class="ttname"><a href="namespacellvm.html#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">llvm::Offset</a></div><div class="ttdeci">@ Offset</div><div class="ttdef"><b>Definition:</b> <a href="DWP_8cpp_source.html#l00406">DWP.cpp:406</a></div></div>
<div class="ttc" id="aSupport_2ErrorHandling_8h_html_ace243f5c25697a1107cce46626b3dc94"><div class="ttname"><a href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a></div><div class="ttdeci">#define llvm_unreachable(msg)</div><div class="ttdoc">Marks that the current location is not supposed to be reachable.</div><div class="ttdef"><b>Definition:</b> <a href="Support_2ErrorHandling_8h_source.html#l00143">ErrorHandling.h:143</a></div></div>
<div class="ttc" id="aCompiler_8h_html"><div class="ttname"><a href="Compiler_8h.html">Compiler.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1ilist__node__impl_html_af719fc783be6589465137d997701a432"><div class="ttname"><a href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">llvm::ilist_node_impl::getIterator</a></div><div class="ttdeci">self_iterator getIterator()</div><div class="ttdef"><b>Definition:</b> <a href="ilist__node_8h_source.html#l00082">ilist_node.h:82</a></div></div>
<div class="ttc" id="anamespacellvm_html_a66f0c57e04037076030c6a6e48f44f2d"><div class="ttname"><a href="namespacellvm.html#a66f0c57e04037076030c6a6e48f44f2d">llvm::format</a></div><div class="ttdeci">format_object&lt; Ts... &gt; format(const char *Fmt, const Ts &amp;... Vals)</div><div class="ttdoc">These are helper functions used to produce formatted output.</div><div class="ttdef"><b>Definition:</b> <a href="Format_8h_source.html#l00124">Format.h:124</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstr_html_a002fd916e7206e01d512eeb06d405cf0"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a002fd916e7206e01d512eeb06d405cf0">llvm::MachineInstr::getParent</a></div><div class="ttdeci">const MachineBasicBlock * getParent() const</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00313">MachineInstr.h:313</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineOperand_html_aebc99c3c37896879abad49e7254a2fb8"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#aebc99c3c37896879abad49e7254a2fb8">llvm::MachineOperand::setIndex</a></div><div class="ttdeci">void setIndex(int Idx)</div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00707">MachineOperand.h:707</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_a31e57b158a17c459f0dc34b0e602ecc6"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a31e57b158a17c459f0dc34b0e602ecc6">llvm::MachineBasicBlock::transferSuccessors</a></div><div class="ttdeci">void transferSuccessors(MachineBasicBlock *FromMBB)</div><div class="ttdoc">Transfers all the successors from MBB to this machine basic block (i.e., copies all the successors Fr...</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8cpp_source.html#l00891">MachineBasicBlock.cpp:891</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstrBuilder_html_a54ce61c9315f4d35304a86cb34388921"><div class="ttname"><a href="classllvm_1_1MachineInstrBuilder.html#a54ce61c9315f4d35304a86cb34388921">llvm::MachineInstrBuilder::getInstr</a></div><div class="ttdeci">MachineInstr * getInstr() const</div><div class="ttdoc">If conversion operators fail, use this method to get the MachineInstr explicitly.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstrBuilder_8h_source.html#l00089">MachineInstrBuilder.h:89</a></div></div>
<div class="ttc" id="aAArch64SLSHardening_8cpp_html_a5958512eae2979bd2eb383977996a600"><div class="ttname"><a href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a></div><div class="ttdeci">MachineBasicBlock &amp; MBB</div><div class="ttdef"><b>Definition:</b> <a href="AArch64SLSHardening_8cpp_source.html#l00074">AArch64SLSHardening.cpp:74</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1SendMsg_html_a8594419a4ddfad2c9a79279c490e466d"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">llvm::AMDGPU::SendMsg::Op</a></div><div class="ttdeci">Op</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00357">SIDefines.h:357</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_a3435a2381e60e842e915f85c931b7dde"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a3435a2381e60e842e915f85c931b7dde">llvm::MachineBasicBlock::insert</a></div><div class="ttdeci">instr_iterator insert(instr_iterator I, MachineInstr *M)</div><div class="ttdoc">Insert MI into the instruction list before I, possibly inside a bundle.</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8cpp_source.html#l01336">MachineBasicBlock.cpp:1336</a></div></div>
<div class="ttc" id="aclassllvm_1_1ilist__iterator_html"><div class="ttname"><a href="classllvm_1_1ilist__iterator.html">llvm::ilist_iterator</a></div><div class="ttdoc">Iterator for intrusive lists based on ilist_node.</div><div class="ttdef"><b>Definition:</b> <a href="ilist__iterator_8h_source.html#l00057">ilist_iterator.h:57</a></div></div>
<div class="ttc" id="aMachineFrameInfo_8h_html"><div class="ttname"><a href="MachineFrameInfo_8h.html">MachineFrameInfo.h</a></div></div>
<div class="ttc" id="astructllvm_1_1Align_html_a80735739b49cf97a491922c8f9af2cc1"><div class="ttname"><a href="structllvm_1_1Align.html#a80735739b49cf97a491922c8f9af2cc1">llvm::Align::value</a></div><div class="ttdeci">uint64_t value() const</div><div class="ttdoc">This is a hole in the type system and should not be abused.</div><div class="ttdef"><b>Definition:</b> <a href="Alignment_8h_source.html#l00085">Alignment.h:85</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineOperand_html_aaa68daaf8d7b773d012887c92c2023ce"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#aaa68daaf8d7b773d012887c92c2023ce">llvm::MachineOperand::getIndex</a></div><div class="ttdeci">int getIndex() const</div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00576">MachineOperand.h:576</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstrBuilder_html_acaf4466fb8b9a459c596aa5161423715"><div class="ttname"><a href="classllvm_1_1MachineInstrBuilder.html#acaf4466fb8b9a459c596aa5161423715">llvm::MachineInstrBuilder::addConstantPoolIndex</a></div><div class="ttdeci">const MachineInstrBuilder &amp; addConstantPoolIndex(unsigned Idx, int Offset=0, unsigned TargetFlags=0) const</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstrBuilder_8h_source.html#l00158">MachineInstrBuilder.h:158</a></div></div>
<div class="ttc" id="aFunction_8h_html"><div class="ttname"><a href="Function_8h.html">Function.h</a></div></div>
<div class="ttc" id="aCSKYMachineFunctionInfo_8h_html"><div class="ttname"><a href="CSKYMachineFunctionInfo_8h.html">CSKYMachineFunctionInfo.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallSet_html_a1679469af9bb8ccfbe98441fb8228c79"><div class="ttname"><a href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">llvm::SmallSet::insert</a></div><div class="ttdeci">std::pair&lt; const_iterator, bool &gt; insert(const T &amp;V)</div><div class="ttdoc">insert - Insert an element into the set if it isn't already there.</div><div class="ttdef"><b>Definition:</b> <a href="SmallSet_8h_source.html#l00177">SmallSet.h:177</a></div></div>
<div class="ttc" id="aclassllvm_1_1HexagonInstrInfo_html_a5d95586ea588b8d6938a3e7679766688"><div class="ttname"><a href="classllvm_1_1HexagonInstrInfo.html#a5d95586ea588b8d6938a3e7679766688">llvm::HexagonInstrInfo::reverseBranchCondition</a></div><div class="ttdeci">bool reverseBranchCondition(SmallVectorImpl&lt; MachineOperand &gt; &amp;Cond) const override</div><div class="ttdoc">Reverses the branch condition of the specified condition list, returning false on success and true if...</div><div class="ttdef"><b>Definition:</b> <a href="HexagonInstrInfo_8cpp_source.html#l01632">HexagonInstrInfo.cpp:1632</a></div></div>
<div class="ttc" id="anamespacellvm_html_a17e04afcf0c5efeb0eb6a9a45287b5e4"><div class="ttname"><a href="namespacellvm.html#a17e04afcf0c5efeb0eb6a9a45287b5e4">llvm::BuildMI</a></div><div class="ttdeci">MachineInstrBuilder BuildMI(MachineFunction &amp;MF, const MIMetadata &amp;MIMD, const MCInstrDesc &amp;MCID)</div><div class="ttdoc">Builder interface. Specify how to create the initial instruction itself.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstrBuilder_8h_source.html#l00357">MachineInstrBuilder.h:357</a></div></div>
<div class="ttc" id="aSmallVector_8h_html"><div class="ttname"><a href="SmallVector_8h.html">SmallVector.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_ab2d91e7bec944efcbc39d8e30644f111"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#ab2d91e7bec944efcbc39d8e30644f111">llvm::MachineBasicBlock::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00309">MachineBasicBlock.h:309</a></div></div>
<div class="ttc" id="aMachineInstrBuilder_8h_html"><div class="ttname"><a href="MachineInstrBuilder_8h.html">MachineInstrBuilder.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstr_html_a432824f0975bb863478bf4ef3a5df258"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a432824f0975bb863478bf4ef3a5df258">llvm::MachineInstr::getNumOperands</a></div><div class="ttdeci">unsigned getNumOperands() const</div><div class="ttdoc">Retuns the total number of operands.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00519">MachineInstr.h:519</a></div></div>
<div class="ttc" id="aCSKYConstantIslandPass_8cpp_html_ad11e5fb888cddb54cbf9f2ab1d513653"><div class="ttname"><a href="CSKYConstantIslandPass_8cpp.html#ad11e5fb888cddb54cbf9f2ab1d513653">compareMbbNumbers</a></div><div class="ttdeci">static bool compareMbbNumbers(const MachineBasicBlock *LHS, const MachineBasicBlock *RHS)</div><div class="ttdoc">CompareMBBNumbers - Little predicate function to sort the WaterList by MBB ID.</div><div class="ttdef"><b>Definition:</b> <a href="CSKYConstantIslandPass_8cpp_source.html#l00612">CSKYConstantIslandPass.cpp:612</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineOperand_html_a98e9c9e8ef7cbb6c4aa89a38f21decfa"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#a98e9c9e8ef7cbb6c4aa89a38f21decfa">llvm::MachineOperand::setMBB</a></div><div class="ttdeci">void setMBB(MachineBasicBlock *MBB)</div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00727">MachineOperand.h:727</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_a095ce2d870dadf620a4c887ecc0efef8"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a095ce2d870dadf620a4c887ecc0efef8">llvm::MachineBasicBlock::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00281">MachineBasicBlock.h:281</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallSet_html_a76b3fc7c102561fb5210d5151531e409"><div class="ttname"><a href="classllvm_1_1SmallSet.html#a76b3fc7c102561fb5210d5151531e409">llvm::SmallSet::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="SmallSet_8h_source.html#l00216">SmallSet.h:216</a></div></div>
<div class="ttc" id="aMachineOperand_8h_html"><div class="ttname"><a href="MachineOperand_8h.html">MachineOperand.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1FunctionPass_html"><div class="ttname"><a href="classllvm_1_1FunctionPass.html">llvm::FunctionPass</a></div><div class="ttdoc">FunctionPass class - This class is used to implement most global optimizations.</div><div class="ttdef"><b>Definition:</b> <a href="Pass_8h_source.html#l00308">Pass.h:308</a></div></div>
<div class="ttc" id="alib_2CodeGen_2README_8txt_html_a09776db24cf586ec9f1e18f3bae14099"><div class="ttname"><a href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a></div><div class="ttdeci">Common register allocation spilling lr str ldr sxth r3 ldr mla r4 can lr mov lr str ldr sxth r3 mla r4 and then merge mul and lr str ldr sxth r3 mla r4 It also increase the likelihood the store may become dead bb27 Successors according to LLVM BB</div><div class="ttdef"><b>Definition:</b> <a href="lib_2CodeGen_2README_8txt_source.html#l00039">README.txt:39</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisUsage_html_ae5c60fd282ee894c87ea02c3f0fcb6d0"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">llvm::AnalysisUsage::addRequired</a></div><div class="ttdeci">AnalysisUsage &amp; addRequired()</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00075">PassAnalysisSupport.h:75</a></div></div>
<div class="ttc" id="aclassllvm_1_1DebugLoc_html"><div class="ttname"><a href="classllvm_1_1DebugLoc.html">llvm::DebugLoc</a></div><div class="ttdoc">A debug info location.</div><div class="ttdef"><b>Definition:</b> <a href="DebugLoc_8h_source.html#l00033">DebugLoc.h:33</a></div></div>
<div class="ttc" id="araw__ostream_8h_html"><div class="ttname"><a href="raw__ostream_8h.html">raw_ostream.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineDominatorTree_html"><div class="ttname"><a href="classllvm_1_1MachineDominatorTree.html">llvm::MachineDominatorTree</a></div><div class="ttdoc">DominatorTree Class - Concrete subclass of DominatorTreeBase that is used to compute a normal dominat...</div><div class="ttdef"><b>Definition:</b> <a href="MachineDominators_8h_source.html#l00051">MachineDominators.h:51</a></div></div>
<div class="ttc" id="aMachineFunction_8h_html"><div class="ttname"><a href="MachineFunction_8h.html">MachineFunction.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstr_html_ac2421adbb9996e1b15f03a8abb6c70a8"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#ac2421adbb9996e1b15f03a8abb6c70a8">llvm::MachineInstr::eraseFromParent</a></div><div class="ttdeci">void eraseFromParent()</div><div class="ttdoc">Unlink 'this' from the containing basic block and delete it.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8cpp_source.html#l00705">MachineInstr.cpp:705</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstrBundleIterator_html"><div class="ttname"><a href="classllvm_1_1MachineInstrBundleIterator.html">llvm::MachineInstrBundleIterator&lt; MachineInstr &gt;</a></div></div>
<div class="ttc" id="anamespacellvm_1_1pdb_html_a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2"><div class="ttname"><a href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2">llvm::pdb::PDB_SymType::Block</a></div><div class="ttdeci">@ Block</div></div>
<div class="ttc" id="anamespacellvm_html_a99cdcecbadc13087f087c61809bb44f1"><div class="ttname"><a href="namespacellvm.html#a99cdcecbadc13087f087c61809bb44f1">llvm::offsetToAlignment</a></div><div class="ttdeci">uint64_t offsetToAlignment(uint64_t Value, Align Alignment)</div><div class="ttdoc">Returns the offset to the next integer (mod 2**64) that is greater than or equal to Value and is a mu...</div><div class="ttdef"><b>Definition:</b> <a href="Alignment_8h_source.html#l00197">Alignment.h:197</a></div></div>
<div class="ttc" id="aDebug_8h_html"><div class="ttname"><a href="Debug_8h.html">Debug.h</a></div></div>
<div class="ttc" id="aCSKYConstantIslandPass_8cpp_html_a64267a385738a1aa6a110071d05ff207"><div class="ttname"><a href="CSKYConstantIslandPass_8cpp.html#a64267a385738a1aa6a110071d05ff207">bbHasFallthrough</a></div><div class="ttdeci">static bool bbHasFallthrough(MachineBasicBlock *MBB)</div><div class="ttdoc">BBHasFallthrough - Return true if the specified basic block can fallthrough into the block immediatel...</div><div class="ttdef"><b>Definition:</b> <a href="CSKYConstantIslandPass_8cpp_source.html#l00432">CSKYConstantIslandPass.cpp:432</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_acbc921830578e2741be6549db716c0ce"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">llvm::MachineBasicBlock::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00311">MachineBasicBlock.h:311</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineFunction_html_ac85349aab432e6b7d8b2e8926048a6de"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#ac85349aab432e6b7d8b2e8926048a6de">llvm::MachineFunction::RenumberBlocks</a></div><div class="ttdeci">void RenumberBlocks(MachineBasicBlock *MBBFrom=nullptr)</div><div class="ttdoc">RenumberBlocks - This discards all of the MachineBasicBlock numbers and recomputes them.</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8cpp_source.html#l00326">MachineFunction.cpp:326</a></div></div>
<div class="ttc" id="aMachineDominators_8h_html"><div class="ttname"><a href="MachineDominators_8h.html">MachineDominators.h</a></div></div>
<div class="ttc" id="aSmallSet_8h_html"><div class="ttname"><a href="SmallSet_8h.html">SmallSet.h</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 7 2023 10:11:36 for LLVM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
