<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/Target/WebAssembly/WebAssemblyFixFunctionBitcasts.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">17.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_794e483eb1cc7921d35fd149d9cc325b.html">Target</a></li><li class="navelem"><a class="el" href="dir_96ba75976c22f2500bfbc06f8c4c2b70.html">WebAssembly</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">WebAssemblyFixFunctionBitcasts.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="WebAssembly_8h_source.html">WebAssembly.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="Constants_8h_source.html">llvm/IR/Constants.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="Instructions_8h_source.html">llvm/IR/Instructions.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="Module_8h_source.html">llvm/IR/Module.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="Operator_8h_source.html">llvm/IR/Operator.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="Pass_8h_source.html">llvm/Pass.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="Debug_8h_source.html">llvm/Support/Debug.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="raw__ostream_8h_source.html">llvm/Support/raw_ostream.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for WebAssemblyFixFunctionBitcasts.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="WebAssemblyFixFunctionBitcasts_8cpp__incl.png" border="0" usemap="#lib_2Target_2WebAssembly_2WebAssemblyFixFunctionBitcasts_8cpp" alt=""/></div>
</div>
</div>
<p><a href="WebAssemblyFixFunctionBitcasts_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ad78e062f62e0d6e453941fb4ca843e4d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="WebAssemblyFixFunctionBitcasts_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a>&#160;&#160;&#160;&quot;wasm-<a class="el" href="X86TargetMachine_8cpp.html#aefaa2d340e705d4394e6219ad8b76c70">fix</a>-<a class="el" href="RegionPrinter_8cpp.html#aa37fbbce2360106772fd97ed06455d55">function</a>-bitcasts&quot;</td></tr>
<tr class="separator:ad78e062f62e0d6e453941fb4ca843e4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a01ffc29e5604616bbfef1469ae15b90d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="WebAssemblyFixFunctionBitcasts_8cpp.html#a01ffc29e5604616bbfef1469ae15b90d">INITIALIZE_PASS</a> (FixFunctionBitcasts, <a class="el" href="InjectTLIMappings_8cpp.html#a030569d5a541b6110f2ae1b6a3413a58">DEBUG_TYPE</a>, &quot;Fix mismatching bitcasts <a class="el" href="lib_2Target_2README_8txt.html#aba63e41fa7091edb4329e384aa3f086d">for</a> WebAssembly&quot;, false, <a class="el" href="UnifyLoopExits_8cpp.html#a889d7f30f6c65b4b325c18f14f4272c3">false</a>) <a class="el" href="classllvm_1_1ModulePass.html">ModulePass</a> *<a class="el" href="lib_2Target_2X86_2README_8txt.html#a40fd04ade65fadaaac0dabc049ae46c8">llvm</a></td></tr>
<tr class="separator:a01ffc29e5604616bbfef1469ae15b90d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ef7c353d7682d208776aafe1b7a8883"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="WebAssemblyFixFunctionBitcasts_8cpp.html#a8ef7c353d7682d208776aafe1b7a8883">findUses</a> (<a class="el" href="classllvm_1_1Value.html">Value</a> *V, <a class="el" href="classllvm_1_1Function.html">Function</a> &amp;<a class="el" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a class="el" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl</a>&lt; std::pair&lt; <a class="el" href="classllvm_1_1CallBase.html">CallBase</a> *, <a class="el" href="classllvm_1_1Function.html">Function</a> * &gt;&gt; &amp;<a class="el" href="ARMLowOverheadLoops_8cpp.html#a0a0971d62011c35b29ff4a2325d45e93">Uses</a>)</td></tr>
<tr class="separator:a8ef7c353d7682d208776aafe1b7a8883"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8736cb97f0d7ebc845da13a3f5a8dcd6"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classllvm_1_1Function.html">Function</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="WebAssemblyFixFunctionBitcasts_8cpp.html#a8736cb97f0d7ebc845da13a3f5a8dcd6">createWrapper</a> (<a class="el" href="classllvm_1_1Function.html">Function</a> *<a class="el" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a class="el" href="classllvm_1_1FunctionType.html">FunctionType</a> *Ty)</td></tr>
<tr class="separator:a8736cb97f0d7ebc845da13a3f5a8dcd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a67f1f2b4ec605efc77e9bdab4ed7a82a"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="WebAssemblyFixFunctionBitcasts_8cpp.html#a67f1f2b4ec605efc77e9bdab4ed7a82a">shouldFixMainFunction</a> (<a class="el" href="classllvm_1_1FunctionType.html">FunctionType</a> *FuncTy, <a class="el" href="classllvm_1_1FunctionType.html">FunctionType</a> *MainTy)</td></tr>
<tr class="separator:a67f1f2b4ec605efc77e9bdab4ed7a82a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Fix bitcasted functions.</p>
<p>WebAssembly requires caller and callee signatures to match, however in LLVM, some amount of slop is vaguely permitted. Detect mismatch by looking for bitcasts of functions and rewrite them to use wrapper functions instead.</p>
<p>This doesn't catch all cases, such as when a function's address is taken in one place and casted in another, but it works for many common cases.</p>
<p>Note that LLVM already optimizes away function bitcasts in common cases by dropping arguments as needed, so this pass only ends up getting used in less common cases. </p>

<p class="definition">Definition in file <a class="el" href="WebAssemblyFixFunctionBitcasts_8cpp_source.html">WebAssemblyFixFunctionBitcasts.cpp</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ad78e062f62e0d6e453941fb4ca843e4d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad78e062f62e0d6e453941fb4ca843e4d">&#9670;&nbsp;</a></span>DEBUG_TYPE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_TYPE&#160;&#160;&#160;&quot;wasm-<a class="el" href="X86TargetMachine_8cpp.html#aefaa2d340e705d4394e6219ad8b76c70">fix</a>-<a class="el" href="RegionPrinter_8cpp.html#aa37fbbce2360106772fd97ed06455d55">function</a>-bitcasts&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="WebAssemblyFixFunctionBitcasts_8cpp_source.html#l00035">35</a> of file <a class="el" href="WebAssemblyFixFunctionBitcasts_8cpp_source.html">WebAssemblyFixFunctionBitcasts.cpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a8736cb97f0d7ebc845da13a3f5a8dcd6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8736cb97f0d7ebc845da13a3f5a8dcd6">&#9670;&nbsp;</a></span>createWrapper()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classllvm_1_1Function.html">Function</a>* createWrapper </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classllvm_1_1Function.html">Function</a> *&#160;</td>
          <td class="paramname"><em>F</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classllvm_1_1FunctionType.html">FunctionType</a> *&#160;</td>
          <td class="paramname"><em>Ty</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="WebAssemblyFixFunctionBitcasts_8cpp_source.html#l00109">109</a> of file <a class="el" href="WebAssemblyFixFunctionBitcasts_8cpp_source.html">WebAssemblyFixFunctionBitcasts.cpp</a>.</p>

<p class="reference">References <a class="el" href="AMDGPUMetadata_8h_source.html#l00394">llvm::AMDGPU::HSAMD::Kernel::Key::Args</a>, <a class="el" href="lib_2CodeGen_2README_8txt_source.html#l00039">BB</a>, <a class="el" href="BasicBlock_8h_source.html#l00105">llvm::BasicBlock::Create()</a>, <a class="el" href="Function_8h_source.html#l00136">llvm::Function::Create()</a>, <a class="el" href="Instructions_8h_source.html#l01528">llvm::CallInst::Create()</a>, <a class="el" href="Instructions_8h_source.html#l03084">llvm::ReturnInst::Create()</a>, <a class="el" href="Instructions_8cpp_source.html#l03509">llvm::CastInst::CreateBitOrPointerCast()</a>, <a class="el" href="Debug_8cpp_source.html#l00163">llvm::dbgs()</a>, <a class="el" href="AArch64SLSHardening_8cpp_source.html#l00076">DL</a>, <a class="el" href="MD5_8cpp_source.html#l00055">F</a>, <a class="el" href="Constants_8cpp_source.html#l01740">llvm::UndefValue::get()</a>, <a class="el" href="DerivedTypes_8h_source.html#l00139">llvm::FunctionType::getNumParams()</a>, <a class="el" href="DerivedTypes_8h_source.html#l00124">llvm::FunctionType::getReturnType()</a>, <a class="el" href="Value_8h_source.html#l00255">llvm::Value::getType()</a>, <a class="el" href="IR_2Instruction_8cpp_source.html#l00098">llvm::Instruction::insertInto()</a>, <a class="el" href="Instructions_8cpp_source.html#l03614">llvm::CastInst::isBitOrNoopPointerCastable()</a>, <a class="el" href="Type_8h_source.html#l00243">llvm::Type::isStructTy()</a>, <a class="el" href="DerivedTypes_8h_source.html#l00123">llvm::FunctionType::isVarArg()</a>, <a class="el" href="Type_8h_source.html#l00140">llvm::Type::isVoidTy()</a>, <a class="el" href="Debug_8h_source.html#l00101">LLVM_DEBUG</a>, <a class="el" href="lib_2Target_2X86_2README_8txt_source.html#l00252">M</a>, <a class="el" href="GlobalValue_8h_source.html#l00056">llvm::GlobalValue::PrivateLinkage</a>, and <a class="el" href="AMDGPUAliasAnalysis_8cpp_source.html#l00031">Wrapper</a>.</p>

</div>
</div>
<a id="a8ef7c353d7682d208776aafe1b7a8883"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ef7c353d7682d208776aafe1b7a8883">&#9670;&nbsp;</a></span>findUses()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void findUses </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classllvm_1_1Value.html">Value</a> *&#160;</td>
          <td class="paramname"><em>V</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classllvm_1_1Function.html">Function</a> &amp;&#160;</td>
          <td class="paramname"><em>F</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl</a>&lt; std::pair&lt; <a class="el" href="classllvm_1_1CallBase.html">CallBase</a> *, <a class="el" href="classllvm_1_1Function.html">Function</a> * &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>Uses</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="WebAssemblyFixFunctionBitcasts_8cpp_source.html#l00066">66</a> of file <a class="el" href="WebAssemblyFixFunctionBitcasts_8cpp_source.html">WebAssemblyFixFunctionBitcasts.cpp</a>.</p>

<p class="reference">References <a class="el" href="AMDGPULibCalls_8cpp_source.html#l00187">Callee</a>, <a class="el" href="MD5_8cpp_source.html#l00055">F</a>, <a class="el" href="Value_8h_source.html#l00421">llvm::Value::users()</a>, and <a class="el" href="ARMLowOverheadLoops_8cpp_source.html#l00590">Uses</a>.</p>

</div>
</div>
<a id="a01ffc29e5604616bbfef1469ae15b90d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01ffc29e5604616bbfef1469ae15b90d">&#9670;&nbsp;</a></span>INITIALIZE_PASS()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INITIALIZE_PASS </td>
          <td>(</td>
          <td class="paramtype">FixFunctionBitcasts&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="InjectTLIMappings_8cpp.html#a030569d5a541b6110f2ae1b6a3413a58">DEBUG_TYPE</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;Fix mismatching bitcasts <a class="el" href="lib_2Target_2README_8txt.html#aba63e41fa7091edb4329e384aa3f086d">for</a> WebAssembly&quot;&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="UnifyLoopExits_8cpp.html#a889d7f30f6c65b4b325c18f14f4272c3">false</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="UnifyLoopExits_8cpp.html#a889d7f30f6c65b4b325c18f14f4272c3">false</a>&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="WebAssemblyFixFunctionBitcasts_8cpp_source.html#l00057">57</a> of file <a class="el" href="WebAssemblyFixFunctionBitcasts_8cpp_source.html">WebAssemblyFixFunctionBitcasts.cpp</a>.</p>

</div>
</div>
<a id="a67f1f2b4ec605efc77e9bdab4ed7a82a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a67f1f2b4ec605efc77e9bdab4ed7a82a">&#9670;&nbsp;</a></span>shouldFixMainFunction()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool shouldFixMainFunction </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classllvm_1_1FunctionType.html">FunctionType</a> *&#160;</td>
          <td class="paramname"><em>FuncTy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classllvm_1_1FunctionType.html">FunctionType</a> *&#160;</td>
          <td class="paramname"><em>MainTy</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="WebAssemblyFixFunctionBitcasts_8cpp_source.html#l00219">219</a> of file <a class="el" href="WebAssemblyFixFunctionBitcasts_8cpp_source.html">WebAssemblyFixFunctionBitcasts.cpp</a>.</p>

<p class="reference">References <a class="el" href="DerivedTypes_8h_source.html#l00139">llvm::FunctionType::getNumParams()</a>, <a class="el" href="DerivedTypes_8h_source.html#l00124">llvm::FunctionType::getReturnType()</a>, and <a class="el" href="DerivedTypes_8h_source.html#l00123">llvm::FunctionType::isVarArg()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 7 2023 10:40:57 for LLVM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
