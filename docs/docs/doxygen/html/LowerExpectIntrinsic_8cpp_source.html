<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/Transforms/Scalar/LowerExpectIntrinsic.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">17.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_a72932e0778af28115095468f6286ff8.html">Transforms</a></li><li class="navelem"><a class="el" href="dir_e6e1f1f37d351595fa984b942927b205.html">Scalar</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">LowerExpectIntrinsic.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="LowerExpectIntrinsic_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- LowerExpectIntrinsic.cpp - Lower expect intrinsic ------------------===//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// This pass lowers the &#39;expect&#39; intrinsic to LLVM metadata.</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; </div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="LowerExpectIntrinsic_8h.html">llvm/Transforms/Scalar/LowerExpectIntrinsic.h</a>&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallVector_8h.html">llvm/ADT/SmallVector.h</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Statistic_8h.html">llvm/ADT/Statistic.h</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="iterator__range_8h.html">llvm/ADT/iterator_range.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BasicBlock_8h.html">llvm/IR/BasicBlock.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constants_8h.html">llvm/IR/Constants.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Function_8h.html">llvm/IR/Function.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Instructions_8h.html">llvm/IR/Instructions.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Intrinsics_8h.html">llvm/IR/Intrinsics.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="LLVMContext_8h.html">llvm/IR/LLVMContext.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MDBuilder_8h.html">llvm/IR/MDBuilder.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InitializePasses_8h.html">llvm/InitializePasses.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Pass_8h.html">llvm/Pass.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CommandLine_8h.html">llvm/Support/CommandLine.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Transforms_2Scalar_8h.html">llvm/Transforms/Scalar.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MisExpect_8h.html">llvm/Transforms/Utils/MisExpect.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160; </div>
<div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="LowerExpectIntrinsic_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">   34</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;lower-expect-intrinsic&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160; </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(ExpectIntrinsicsHandled,</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;          <span class="stringliteral">&quot;Number of &#39;expect&#39; intrinsic instructions handled&quot;</span>);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">// These default values are chosen to represent an extremely skewed outcome for</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">// a condition, but they leave some room for interpretation by later passes.</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">// If the documentation for __builtin_expect() was made explicit that it should</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">// only be used in extreme cases, we could make this ratio higher. As it stands,</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">// programmers may be using __builtin_expect() / llvm.expect to annotate that a</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">// branch is likely or unlikely to be taken.</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">// WARNING: these values are internal implementation detail of the pass.</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">// They should not be exposed to the outside of the pass, front-end codegen</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">// should emit @llvm.expect intrinsics instead of using these weights directly.</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">// Transforms should use TargetTransformInfo&#39;s getPredictableBranchThreshold().</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;uint32_t&gt;</a> <a class="code" href="LowerExpectIntrinsic_8cpp.html#ad49597ea9df30b48ee0bae5eae846648">LikelyBranchWeight</a>(</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="stringliteral">&quot;likely-branch-weight&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(2000),</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Weight of the branch likely to be taken (default = 2000)&quot;</span>));</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;uint32_t&gt;</a> <a class="code" href="LowerExpectIntrinsic_8cpp.html#a6d8dd0fde9d96e02f04db1523ab644df">UnlikelyBranchWeight</a>(</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="stringliteral">&quot;unlikely-branch-weight&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(1),</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Weight of the branch unlikely to be taken (default = 1)&quot;</span>));</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="keyword">static</span> std::tuple&lt;uint32_t, uint32_t&gt;</div>
<div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="LowerExpectIntrinsic_8cpp.html#a8dc30a73b67684ced1d3f3d71a79a805">   59</a></span>&#160;<a class="code" href="LowerExpectIntrinsic_8cpp.html#a8dc30a73b67684ced1d3f3d71a79a805">getBranchWeight</a>(<a class="code" href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IntrinsicID, <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI, <span class="keywordtype">int</span> BranchCount) {</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keywordflow">if</span> (IntrinsicID == Intrinsic::expect) {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">// __builtin_expect</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordflow">return</span> std::make_tuple(<a class="code" href="LowerExpectIntrinsic_8cpp.html#ad49597ea9df30b48ee0bae5eae846648">LikelyBranchWeight</a>.getValue(),</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                           <a class="code" href="LowerExpectIntrinsic_8cpp.html#a6d8dd0fde9d96e02f04db1523ab644df">UnlikelyBranchWeight</a>.getValue());</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment">// __builtin_expect_with_probability</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CI-&gt;<a class="code" href="classllvm_1_1User.html#addec638786f763d967811b45cb662f1f">getNumOperands</a>() &gt;= 3 &amp;&amp;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;           <span class="stringliteral">&quot;expect with probability must have 3 arguments&quot;</span>);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keyword">auto</span> *Confidence = cast&lt;ConstantFP&gt;(CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(2));</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordtype">double</span> TrueProb = Confidence-&gt;getValueAPF().convertToDouble();</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((TrueProb &gt;= 0.0 &amp;&amp; TrueProb &lt;= 1.0) &amp;&amp;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;           <span class="stringliteral">&quot;probability value must be in the range [0.0, 1.0]&quot;</span>);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordtype">double</span> FalseProb = (1.0 - TrueProb) / (BranchCount - 1);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <a class="code" href="classuint32__t.html">uint32_t</a> LikelyBW = <a class="code" href="README-FPStack_8txt.html#a9209b9930d4d7750a6b8b38b3b4ddd6a">ceil</a>((TrueProb * (<span class="keywordtype">double</span>)(INT32_MAX - 1)) + 1.0);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <a class="code" href="classuint32__t.html">uint32_t</a> UnlikelyBW = <a class="code" href="README-FPStack_8txt.html#a9209b9930d4d7750a6b8b38b3b4ddd6a">ceil</a>((FalseProb * (<span class="keywordtype">double</span>)(INT32_MAX - 1)) + 1.0);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordflow">return</span> std::make_tuple(LikelyBW, UnlikelyBW);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  }</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;}</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="LowerExpectIntrinsic_8cpp.html#ab61a60817533b84f369d2623e0593ec7">   79</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="LowerExpectIntrinsic_8cpp.html#ab61a60817533b84f369d2623e0593ec7">handleSwitchExpect</a>(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> &amp;<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>) {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI = dyn_cast&lt;CallInst&gt;(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>.getCondition());</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keywordflow">if</span> (!CI)</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <a class="code" href="classllvm_1_1Function.html">Function</a> *Fn = CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#a83b8c9e572130f403445c0b0f69b837c">getCalledFunction</a>();</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordflow">if</span> (!Fn || (Fn-&gt;<a class="code" href="classllvm_1_1Function.html#a4d0a7baab8d078065b2de10e3460892a">getIntrinsicID</a>() != Intrinsic::expect &amp;&amp;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;              Fn-&gt;<a class="code" href="classllvm_1_1Function.html#a4d0a7baab8d078065b2de10e3460892a">getIntrinsicID</a>() != Intrinsic::expect_with_probability))</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ArgValue = CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(0);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *ExpectedValue = dyn_cast&lt;ConstantInt&gt;(CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(1));</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="keywordflow">if</span> (!ExpectedValue)</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160; </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <a class="code" href="classllvm_1_1SwitchInst_1_1CaseHandle.html">SwitchInst::CaseHandle</a> Case = *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>.findCaseValue(ExpectedValue);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a> = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>.getNumCases(); <span class="comment">// +1 for default case.</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <a class="code" href="classuint32__t.html">uint32_t</a> LikelyBranchWeightVal, UnlikelyBranchWeightVal;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  std::tie(LikelyBranchWeightVal, UnlikelyBranchWeightVal) =</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      <a class="code" href="LowerExpectIntrinsic_8cpp.html#a8dc30a73b67684ced1d3f3d71a79a805">getBranchWeight</a>(Fn-&gt;<a class="code" href="classllvm_1_1Function.html#a4d0a7baab8d078065b2de10e3460892a">getIntrinsicID</a>(), CI, <a class="code" href="lib_2Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a> + 1);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint32_t, 16&gt;</a> Weights(<a class="code" href="lib_2Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a> + 1, UnlikelyBranchWeightVal);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a> = (Case == *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>.case_default()) ? 0 : Case.<a class="code" href="classllvm_1_1SwitchInst_1_1CaseHandleImpl.html#a49fb99a80264b770a56f2b3c2934fb02">getCaseIndex</a>() + 1;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  Weights[<a class="code" href="ELFObjHandler_8cpp.html#aef61945034b9431b804748fc317c5548">Index</a>] = LikelyBranchWeightVal;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <a class="code" href="namespacellvm_1_1misexpect.html#a4c52059f91406714507309d168ff95b8">misexpect::checkExpectAnnotations</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, Weights, <span class="comment">/*IsFrontend=*/</span><span class="keyword">true</span>);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>.setCondition(ArgValue);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>.setMetadata(LLVMContext::MD_prof,</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                 <a class="code" href="classllvm_1_1MDBuilder.html">MDBuilder</a>(CI-&gt;<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>()).<a class="code" href="classllvm_1_1MDBuilder.html#ad910125a9cfd76aaad7f69469df22f66">createBranchWeights</a>(Weights));</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160; </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;}</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">/// Handler for PHINodes that define the value argument to an</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">/// @llvm.expect call.</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">/// If the operand of the phi has a constant value and it &#39;contradicts&#39;</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">/// with the expected value of phi def, then the corresponding incoming</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">/// edge of the phi is unlikely to be taken. Using that information,</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">/// the branch probability info for the originating branch can be inferred.</span></div>
<div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="LowerExpectIntrinsic_8cpp.html#aea5dd05a61257355d99f96d8d6dc9f94">  122</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="LowerExpectIntrinsic_8cpp.html#aea5dd05a61257355d99f96d8d6dc9f94">handlePhiDef</a>(<a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *Expect) {</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> &amp;<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a> = *Expect-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(0);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *ExpectedValue = dyn_cast&lt;ConstantInt&gt;(Expect-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(1));</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="keywordflow">if</span> (!ExpectedValue)</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;ExpectedPhiValue = ExpectedValue-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>();</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="keywordtype">bool</span> ExpectedValueIsLikely = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <a class="code" href="classllvm_1_1Function.html">Function</a> *Fn = Expect-&gt;<a class="code" href="classllvm_1_1CallBase.html#a83b8c9e572130f403445c0b0f69b837c">getCalledFunction</a>();</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="comment">// If the function is expect_with_probability, then we need to take the</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="comment">// probability into consideration. For example, in</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="comment">// expect.with.probability.i64(i64 %a, i64 1, double 0.0), the</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="comment">// &quot;ExpectedValue&quot; 1 is unlikely. This affects probability propagation later.</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="keywordflow">if</span> (Fn-&gt;<a class="code" href="classllvm_1_1Function.html#a4d0a7baab8d078065b2de10e3460892a">getIntrinsicID</a>() == Intrinsic::expect_with_probability) {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keyword">auto</span> *Confidence = cast&lt;ConstantFP&gt;(Expect-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(2));</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordtype">double</span> TrueProb = Confidence-&gt;getValueAPF().convertToDouble();</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    ExpectedValueIsLikely = (TrueProb &gt; 0.5);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="comment">// Walk up in backward a list of instructions that</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="comment">// have &#39;copy&#39; semantics by &#39;stripping&#39; the copies</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="comment">// until a PHI node or an instruction of unknown kind</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="comment">// is reached. Negation via xor is also handled.</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="comment">//       C = PHI(...);</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <span class="comment">//       B = C;</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="comment">//       A = B;</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="comment">//       D = __builtin_expect(A, 0);</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *V = &amp;<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a>;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 4&gt;</a> Operations;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="keywordflow">while</span> (!isa&lt;PHINode&gt;(V)) {</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ZExtInst.html">ZExtInst</a> *ZExt = dyn_cast&lt;ZExtInst&gt;(V)) {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      V = ZExt-&gt;getOperand(0);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      Operations.push_back(ZExt);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160; </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SExtInst.html">SExtInst</a> *SExt = dyn_cast&lt;SExtInst&gt;(V)) {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      V = SExt-&gt;getOperand(0);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      Operations.push_back(SExt);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    }</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BinOp = dyn_cast&lt;BinaryOperator&gt;(V);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">if</span> (!BinOp || BinOp-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() != Instruction::Xor)</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CInt = dyn_cast&lt;ConstantInt&gt;(BinOp-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1));</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">if</span> (!CInt)</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    V = BinOp-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    Operations.push_back(BinOp);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  }</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160; </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="comment">// Executes the recorded operations on input &#39;Value&#39;.</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="keyword">auto</span> ApplyOperations = [&amp;](<span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;<a class="code" href="namespacellvm_1_1TargetStackID.html#a71392100eb15ba746b1f898986f5d8a5">Value</a>) {</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <a class="code" href="classllvm_1_1APInt.html">APInt</a> Result = <a class="code" href="namespacellvm_1_1TargetStackID.html#a71392100eb15ba746b1f898986f5d8a5">Value</a>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> : <a class="code" href="namespacellvm.html#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a>(Operations)) {</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      <span class="keywordflow">switch</span> (<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>-&gt;getOpcode()) {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="keywordflow">case</span> Instruction::Xor:</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        Result ^= cast&lt;ConstantInt&gt;(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>-&gt;getOperand(1))-&gt;getValue();</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      <span class="keywordflow">case</span> Instruction::ZExt:</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        Result = Result.zext(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>-&gt;getType()-&gt;getIntegerBitWidth());</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      <span class="keywordflow">case</span> Instruction::SExt:</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        Result = Result.sext(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>-&gt;getType()-&gt;getIntegerBitWidth());</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Unexpected operation&quot;</span>);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      }</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    }</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">return</span> Result;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  };</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="keyword">auto</span> *PhiDef = cast&lt;PHINode&gt;(V);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="comment">// Get the first dominating conditional branch of the operand</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="comment">// i&#39;s incoming block.</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <span class="keyword">auto</span> GetDomConditional = [&amp;](<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) -&gt; <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> * {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = PhiDef-&gt;getIncomingBlock(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = dyn_cast&lt;BranchInst&gt;(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getTerminator());</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordflow">if</span> (BI &amp;&amp; BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>())</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      <span class="keywordflow">return</span> BI;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getSinglePredecessor();</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    BI = dyn_cast&lt;BranchInst&gt;(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getTerminator());</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">if</span> (!BI || BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad56f6a9b5cd05940017c4544df48bc30">isUnconditional</a>())</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordflow">return</span> BI;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  };</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160; </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="comment">// Now walk through all Phi operands to find phi oprerands with values</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="comment">// conflicting with the expected phi output value. Any such operand</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="comment">// indicates the incoming edge to that operand is unlikely.</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = PhiDef-&gt;getNumIncomingValues(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160; </div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *PhiOpnd = PhiDef-&gt;getIncomingValue(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CI = dyn_cast&lt;ConstantInt&gt;(PhiOpnd);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keywordflow">if</span> (!CI)</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160; </div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment">// Not an interesting case when IsUnlikely is false -- we can not infer</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">// anything useful when:</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">// (1) We expect some phi output and the operand value matches it, or</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="comment">// (2) We don&#39;t expect some phi output (i.e. the &quot;ExpectedValue&quot; has low</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="comment">//     probability) and the operand value doesn&#39;t match that.</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;CurrentPhiValue = ApplyOperations(CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>());</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordflow">if</span> (ExpectedValueIsLikely == (ExpectedPhiValue == CurrentPhiValue))</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160; </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = GetDomConditional(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">if</span> (!BI)</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <a class="code" href="classllvm_1_1MDBuilder.html">MDBuilder</a> MDB(PhiDef-&gt;getContext());</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160; </div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="comment">// There are two situations in which an operand of the PhiDef comes</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="comment">// from a given successor of a branch instruction BI.</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="comment">// 1) When the incoming block of the operand is the successor block;</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="comment">// 2) When the incoming block is BI&#39;s enclosing block and the</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="comment">// successor is the PhiDef&#39;s enclosing block.</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="comment">// Returns true if the operand which comes from OpndIncomingBB</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="comment">// comes from outgoing edge of BI that leads to Succ block.</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keyword">auto</span> *OpndIncomingBB = PhiDef-&gt;getIncomingBlock(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keyword">auto</span> IsOpndComingFromSuccessor = [&amp;](<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ) {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="keywordflow">if</span> (OpndIncomingBB == Succ)</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="comment">// If this successor is the incoming block for this</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="comment">// Phi operand, then this successor does lead to the Phi.</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keywordflow">if</span> (OpndIncomingBB == BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() &amp;&amp; Succ == PhiDef-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">getParent</a>())</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <span class="comment">// Otherwise, if the edge is directly from the branch</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="comment">// to the Phi, this successor is the one feeding this</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="comment">// Phi operand.</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    };</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <a class="code" href="classuint32__t.html">uint32_t</a> LikelyBranchWeightVal, UnlikelyBranchWeightVal;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    std::tie(LikelyBranchWeightVal, UnlikelyBranchWeightVal) = <a class="code" href="LowerExpectIntrinsic_8cpp.html#a8dc30a73b67684ced1d3f3d71a79a805">getBranchWeight</a>(</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        Expect-&gt;<a class="code" href="classllvm_1_1CallBase.html#a83b8c9e572130f403445c0b0f69b837c">getCalledFunction</a>()-&gt;<a class="code" href="classllvm_1_1Function.html#a4d0a7baab8d078065b2de10e3460892a">getIntrinsicID</a>(), Expect, 2);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">if</span> (!ExpectedValueIsLikely)</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(LikelyBranchWeightVal, UnlikelyBranchWeightVal);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">if</span> (IsOpndComingFromSuccessor(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(1)))</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(LLVMContext::MD_prof,</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                      MDB.<a class="code" href="classllvm_1_1MDBuilder.html#ad910125a9cfd76aaad7f69469df22f66">createBranchWeights</a>(LikelyBranchWeightVal,</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                                              UnlikelyBranchWeightVal));</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (IsOpndComingFromSuccessor(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0)))</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(LLVMContext::MD_prof,</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                      MDB.<a class="code" href="classllvm_1_1MDBuilder.html#ad910125a9cfd76aaad7f69469df22f66">createBranchWeights</a>(UnlikelyBranchWeightVal,</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                                              LikelyBranchWeightVal));</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  }</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;}</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160; </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">// Handle both BranchInst and SelectInst.</span></div>
<div class="line"><a name="l00280"></a><span class="lineno"><a class="line" href="LowerExpectIntrinsic_8cpp.html#a6ac9067dc7c125cd83855df3e480e04c">  280</a></span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class</span> BrSelInst&gt; <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="LowerExpectIntrinsic_8cpp.html#a6ac9067dc7c125cd83855df3e480e04c">handleBrSelExpect</a>(BrSelInst &amp;BSI) {</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="comment">// Handle non-optimized IR code like:</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="comment">//   %expval = call i64 @llvm.expect.i64(i64 %conv1, i64 1)</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="comment">//   %tobool = icmp ne i64 %expval, 0</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="comment">//   br i1 %tobool, label %if.then, label %if.end</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="comment">// Or the following simpler case:</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="comment">//   %expval = call i1 @llvm.expect.i1(i1 %cmp, i1 1)</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="comment">//   br i1 %expval, label %if.then, label %if.end</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *CmpI = dyn_cast&lt;ICmpInst&gt;(BSI.getCondition());</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> <a class="code" href="namespacellvm_1_1PPC.html#a14028f7fe73a11dabc6583510cc0a355">Predicate</a>;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CmpConstOperand = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keywordflow">if</span> (!CmpI) {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    CI = dyn_cast&lt;CallInst&gt;(BSI.getCondition());</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <a class="code" href="namespacellvm_1_1PPC.html#a14028f7fe73a11dabc6583510cc0a355">Predicate</a> = <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">CmpInst::ICMP_NE</a>;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <a class="code" href="namespacellvm_1_1PPC.html#a14028f7fe73a11dabc6583510cc0a355">Predicate</a> = CmpI-&gt;<a class="code" href="classllvm_1_1CmpInst.html#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>();</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PPC.html#a14028f7fe73a11dabc6583510cc0a355">Predicate</a> != <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">CmpInst::ICMP_NE</a> &amp;&amp; <a class="code" href="namespacellvm_1_1PPC.html#a14028f7fe73a11dabc6583510cc0a355">Predicate</a> != <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">CmpInst::ICMP_EQ</a>)</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160; </div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    CmpConstOperand = dyn_cast&lt;ConstantInt&gt;(CmpI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1));</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keywordflow">if</span> (!CmpConstOperand)</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    CI = dyn_cast&lt;CallInst&gt;(CmpI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0));</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  }</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160; </div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="keywordflow">if</span> (!CI)</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> ValueComparedTo = 0;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="keywordflow">if</span> (CmpConstOperand) {</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">if</span> (CmpConstOperand-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#ab240d0d30dfa9b392ef9d813f3f9e4be">getBitWidth</a>() &gt; 64)</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    ValueComparedTo = CmpConstOperand-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#ac09a21c371a9c535cbc13e8f82503aec">getZExtValue</a>();</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  }</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160; </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <a class="code" href="classllvm_1_1Function.html">Function</a> *Fn = CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#a83b8c9e572130f403445c0b0f69b837c">getCalledFunction</a>();</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="keywordflow">if</span> (!Fn || (Fn-&gt;<a class="code" href="classllvm_1_1Function.html#a4d0a7baab8d078065b2de10e3460892a">getIntrinsicID</a>() != Intrinsic::expect &amp;&amp;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;              Fn-&gt;<a class="code" href="classllvm_1_1Function.html#a4d0a7baab8d078065b2de10e3460892a">getIntrinsicID</a>() != Intrinsic::expect_with_probability))</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ArgValue = CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(0);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *ExpectedValue = dyn_cast&lt;ConstantInt&gt;(CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(1));</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="keywordflow">if</span> (!ExpectedValue)</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160; </div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <a class="code" href="classllvm_1_1MDBuilder.html">MDBuilder</a> MDB(CI-&gt;<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *Node;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160; </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <a class="code" href="classuint32__t.html">uint32_t</a> LikelyBranchWeightVal, UnlikelyBranchWeightVal;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  std::tie(LikelyBranchWeightVal, UnlikelyBranchWeightVal) =</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      <a class="code" href="LowerExpectIntrinsic_8cpp.html#a8dc30a73b67684ced1d3f3d71a79a805">getBranchWeight</a>(Fn-&gt;<a class="code" href="classllvm_1_1Function.html#a4d0a7baab8d078065b2de10e3460892a">getIntrinsicID</a>(), CI, 2);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160; </div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint32_t, 4&gt;</a> ExpectedWeights;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="keywordflow">if</span> ((ExpectedValue-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#ac09a21c371a9c535cbc13e8f82503aec">getZExtValue</a>() == ValueComparedTo) ==</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      (<a class="code" href="namespacellvm_1_1PPC.html#a14028f7fe73a11dabc6583510cc0a355">Predicate</a> == <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">CmpInst::ICMP_EQ</a>)) {</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    Node =</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        MDB.<a class="code" href="classllvm_1_1MDBuilder.html#ad910125a9cfd76aaad7f69469df22f66">createBranchWeights</a>(LikelyBranchWeightVal, UnlikelyBranchWeightVal);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    ExpectedWeights = {LikelyBranchWeightVal, UnlikelyBranchWeightVal};</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    Node =</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        MDB.<a class="code" href="classllvm_1_1MDBuilder.html#ad910125a9cfd76aaad7f69469df22f66">createBranchWeights</a>(UnlikelyBranchWeightVal, LikelyBranchWeightVal);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    ExpectedWeights = {UnlikelyBranchWeightVal, LikelyBranchWeightVal};</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  }</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160; </div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="keywordflow">if</span> (CmpI)</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    CmpI-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, ArgValue);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    BSI.setCondition(ArgValue);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <a class="code" href="namespacellvm_1_1misexpect.html#a21de4796e674d8dabcea69242abe5005">misexpect::checkFrontendInstrumentation</a>(BSI, ExpectedWeights);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160; </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  BSI.setMetadata(LLVMContext::MD_prof, Node);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;}</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160; </div>
<div class="line"><a name="l00361"></a><span class="lineno"><a class="line" href="LowerExpectIntrinsic_8cpp.html#a390dfaf67ef6d58f12f5a19ee938c60f">  361</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="LowerExpectIntrinsic_8cpp.html#a390dfaf67ef6d58f12f5a19ee938c60f">handleBranchExpect</a>(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> &amp;BI) {</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="keywordflow">if</span> (BI.<a class="code" href="classllvm_1_1BranchInst.html#ad56f6a9b5cd05940017c4544df48bc30">isUnconditional</a>())</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="keywordflow">return</span> handleBrSelExpect&lt;BranchInst&gt;(BI);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;}</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160; </div>
<div class="line"><a name="l00368"></a><span class="lineno"><a class="line" href="LowerExpectIntrinsic_8cpp.html#ad2fd6546e0f1cc42311962f4ad4b29cd">  368</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="LowerExpectIntrinsic_8cpp.html#ad2fd6546e0f1cc42311962f4ad4b29cd">lowerExpectIntrinsic</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160; </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="comment">// Create &quot;block_weights&quot; metadata.</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = dyn_cast&lt;BranchInst&gt;(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>.getTerminator())) {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="LowerExpectIntrinsic_8cpp.html#a390dfaf67ef6d58f12f5a19ee938c60f">handleBranchExpect</a>(*BI))</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        ExpectIntrinsicsHandled++;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;SwitchInst&gt;(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>.getTerminator())) {</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="LowerExpectIntrinsic_8cpp.html#ab61a60817533b84f369d2623e0593ec7">handleSwitchExpect</a>(*<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>))</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        ExpectIntrinsicsHandled++;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    }</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160; </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="comment">// Remove llvm.expect intrinsics. Iterate backwards in order</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="comment">// to process select instructions before the intrinsic gets</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="comment">// removed.</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;Inst : <a class="code" href="namespacellvm.html#a8154638df88e4eaa568b67b23d463dac">llvm::make_early_inc_range</a>(<a class="code" href="namespacellvm.html#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>))) {</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI = dyn_cast&lt;CallInst&gt;(&amp;Inst);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <span class="keywordflow">if</span> (!CI) {</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;SelectInst&gt;(&amp;Inst)) {</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="LowerExpectIntrinsic_8cpp.html#a6ac9067dc7c125cd83855df3e480e04c">handleBrSelExpect</a>(*<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>))</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            ExpectIntrinsicsHandled++;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        }</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      }</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160; </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      <a class="code" href="classllvm_1_1Function.html">Function</a> *Fn = CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#a83b8c9e572130f403445c0b0f69b837c">getCalledFunction</a>();</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      <span class="keywordflow">if</span> (Fn &amp;&amp; (Fn-&gt;<a class="code" href="classllvm_1_1Function.html#a4d0a7baab8d078065b2de10e3460892a">getIntrinsicID</a>() == Intrinsic::expect ||</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                 Fn-&gt;<a class="code" href="classllvm_1_1Function.html#a4d0a7baab8d078065b2de10e3460892a">getIntrinsicID</a>() == Intrinsic::expect_with_probability)) {</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <span class="comment">// Before erasing the llvm.expect, walk backward to find</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <span class="comment">// phi that define llvm.expect&#39;s first arg, and</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="comment">// infer branch probability:</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <a class="code" href="LowerExpectIntrinsic_8cpp.html#aea5dd05a61257355d99f96d8d6dc9f94">handlePhiDef</a>(CI);</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Exp = CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(0);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        CI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Exp);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    }</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  }</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160; </div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;}</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160; </div>
<div class="line"><a name="l00412"></a><span class="lineno"><a class="line" href="structllvm_1_1LowerExpectIntrinsicPass.html#afb59e74c5181b5a9fa8d58780be0699a">  412</a></span>&#160;<a class="code" href="classllvm_1_1PreservedAnalyses.html">PreservedAnalyses</a> <a class="code" href="structllvm_1_1LowerExpectIntrinsicPass.html#afb59e74c5181b5a9fa8d58780be0699a">LowerExpectIntrinsicPass::run</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                                                <a class="code" href="classllvm_1_1AnalysisManager.html">FunctionAnalysisManager</a> &amp;) {</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="LowerExpectIntrinsic_8cpp.html#ad2fd6546e0f1cc42311962f4ad4b29cd">lowerExpectIntrinsic</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1PreservedAnalyses.html#a03797a73044a81cbc6a3409d6c72ee8f">PreservedAnalyses::none</a>();</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160; </div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1PreservedAnalyses.html#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;}</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160; </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">/// Legacy pass for lowering expect intrinsics out of the IR.</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">/// When this pass is run over a function it uses expect intrinsics which feed</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">/// branches and switches to provide branch weight metadata for those</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">/// terminators. It then removes the expect intrinsics from the IR so the rest</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">/// of the optimizer can ignore them.</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment"></span><span class="keyword">class </span>LowerExpectIntrinsic : <span class="keyword">public</span> <a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a> {</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  LowerExpectIntrinsic() : <a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>) {</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <a class="code" href="namespacellvm.html#a905e81399147702d5f17cf907969989d">initializeLowerExpectIntrinsicPass</a>(*<a class="code" href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  }</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160; </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="EntryExitInstrumenter_8cpp.html#a3985f1f39349428d17f0d2b81ebc6349">runOnFunction</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)<span class="keyword"> override </span>{ <span class="keywordflow">return</span> <a class="code" href="LowerExpectIntrinsic_8cpp.html#ad2fd6546e0f1cc42311962f4ad4b29cd">lowerExpectIntrinsic</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>); }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;};</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;} <span class="comment">// namespace</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160; </div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">LowerExpectIntrinsic::ID</a> = 0;</div>
<div class="line"><a name="l00439"></a><span class="lineno"><a class="line" href="LowerExpectIntrinsic_8cpp.html#a674f7929c2b3901ebf25494b31c97f2d">  439</a></span>&#160;<a class="code" href="LowerExpectIntrinsic_8cpp.html#a674f7929c2b3901ebf25494b31c97f2d">INITIALIZE_PASS</a>(LowerExpectIntrinsic, <span class="stringliteral">&quot;lower-expect&quot;</span>,</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                <span class="stringliteral">&quot;Lower &#39;expect&#39; Intrinsics&quot;</span>, <span class="keyword">false</span>, <span class="keyword">false</span>)</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160; </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a> *<a class="code" href="namespacellvm.html">llvm</a>::<a class="code" href="namespacellvm.html#a7f96751b0dbbb50b5c9d8135ef2cddd6">createLowerExpectIntrinsicPass</a>() {</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> LowerExpectIntrinsic();</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="alib_2Target_2README_8txt_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2README_8txt_source.html#l00029">README.txt:29</a></div></div>
<div class="ttc" id="aclassllvm_1_1PreservedAnalyses_html"><div class="ttname"><a href="classllvm_1_1PreservedAnalyses.html">llvm::PreservedAnalyses</a></div><div class="ttdoc">A set of analyses that are preserved following a run of a transformation pass.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00152">PassManager.h:152</a></div></div>
<div class="ttc" id="anamespacellvm_1_1misexpect_html_a21de4796e674d8dabcea69242abe5005"><div class="ttname"><a href="namespacellvm_1_1misexpect.html#a21de4796e674d8dabcea69242abe5005">llvm::misexpect::checkFrontendInstrumentation</a></div><div class="ttdeci">void checkFrontendInstrumentation(Instruction &amp;I, const ArrayRef&lt; uint32_t &gt; ExpectedWeights)</div><div class="ttdoc">checkFrontendInstrumentation - compares PGO counters to the thresholds used for llvm....</div><div class="ttdef"><b>Definition:</b> <a href="MisExpect_8cpp_source.html#l00194">MisExpect.cpp:194</a></div></div>
<div class="ttc" id="anamespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">This is an optimization pass for GlobalISel generic memory operations.</div><div class="ttdef"><b>Definition:</b> <a href="AddressRanges_8h_source.html#l00018">AddressRanges.h:18</a></div></div>
<div class="ttc" id="astructllvm_1_1LowerExpectIntrinsicPass_html_afb59e74c5181b5a9fa8d58780be0699a"><div class="ttname"><a href="structllvm_1_1LowerExpectIntrinsicPass.html#afb59e74c5181b5a9fa8d58780be0699a">llvm::LowerExpectIntrinsicPass::run</a></div><div class="ttdeci">PreservedAnalyses run(Function &amp;F, FunctionAnalysisManager &amp;)</div><div class="ttdoc">Run the pass over the function.</div><div class="ttdef"><b>Definition:</b> <a href="LowerExpectIntrinsic_8cpp_source.html#l00412">LowerExpectIntrinsic.cpp:412</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">llvm::CmpInst::ICMP_EQ</a></div><div class="ttdeci">@ ICMP_EQ</div><div class="ttdoc">equal</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00739">InstrTypes.h:739</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AArch64PACKey_html_abf4394f452bde3f544999858d71e4b46"><div class="ttname"><a href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">llvm::AArch64PACKey::ID</a></div><div class="ttdeci">ID</div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00790">AArch64BaseInfo.h:790</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78b"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">llvm::CmpInst::Predicate</a></div><div class="ttdeci">Predicate</div><div class="ttdoc">This enumeration lists the possible predicates for CmpInst subclasses.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00718">InstrTypes.h:718</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a38bee869ad41aebfef3de2641b12004c"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">llvm::BasicBlock::getParent</a></div><div class="ttdeci">const Function * getParent() const</div><div class="ttdoc">Return the enclosing method, or null if none.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00112">BasicBlock.h:112</a></div></div>
<div class="ttc" id="aREADME-FPStack_8txt_html_a9209b9930d4d7750a6b8b38b3b4ddd6a"><div class="ttname"><a href="README-FPStack_8txt.html#a9209b9930d4d7750a6b8b38b3b4ddd6a">ceil</a></div><div class="ttdeci">We have fiadd patterns now but the followings have the same cost and complexity We need a way to specify the later is more profitable def def The FP stackifier should handle simple permutates to reduce number of shuffle e g ceil</div><div class="ttdef"><b>Definition:</b> <a href="README-FPStack_8txt_source.html#l00054">README-FPStack.txt:54</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_ab240d0d30dfa9b392ef9d813f3f9e4be"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#ab240d0d30dfa9b392ef9d813f3f9e4be">llvm::ConstantInt::getBitWidth</a></div><div class="ttdeci">unsigned getBitWidth() const</div><div class="ttdoc">getBitWidth - Return the bitwidth of this constant.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00135">Constants.h:135</a></div></div>
<div class="ttc" id="aTransforms_2Scalar_8h_html"><div class="ttname"><a href="Transforms_2Scalar_8h.html">Scalar.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Function_html"><div class="ttname"><a href="classllvm_1_1Function.html">llvm::Function</a></div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00059">Function.h:59</a></div></div>
<div class="ttc" id="aPass_8h_html"><div class="ttname"><a href="Pass_8h.html">Pass.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_a4b001d9b458035fbbfc154d52d354ee9"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">llvm::ConstantInt::getValue</a></div><div class="ttdeci">const APInt &amp; getValue() const</div><div class="ttdoc">Return the constant as an APInt value reference.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00132">Constants.h:132</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector&lt; uint32_t, 16 &gt;</a></div></div>
<div class="ttc" id="aStatistic_8h_html"><div class="ttname"><a href="Statistic_8h.html">Statistic.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_a905e81399147702d5f17cf907969989d"><div class="ttname"><a href="namespacellvm.html#a905e81399147702d5f17cf907969989d">llvm::initializeLowerExpectIntrinsicPass</a></div><div class="ttdeci">void initializeLowerExpectIntrinsicPass(PassRegistry &amp;)</div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">llvm::CmpInst::ICMP_NE</a></div><div class="ttdeci">@ ICMP_NE</div><div class="ttdoc">not equal</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00740">InstrTypes.h:740</a></div></div>
<div class="ttc" id="anamespacellvm_1_1cl_html_a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6"><div class="ttname"><a href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">llvm::cl::Hidden</a></div><div class="ttdeci">@ Hidden</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00138">CommandLine.h:138</a></div></div>
<div class="ttc" id="aclassllvm_1_1PreservedAnalyses_html_a03797a73044a81cbc6a3409d6c72ee8f"><div class="ttname"><a href="classllvm_1_1PreservedAnalyses.html#a03797a73044a81cbc6a3409d6c72ee8f">llvm::PreservedAnalyses::none</a></div><div class="ttdeci">static PreservedAnalyses none()</div><div class="ttdoc">Convenience factory function for the empty preserved set.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00155">PassManager.h:155</a></div></div>
<div class="ttc" id="aLowerExpectIntrinsic_8cpp_html_ab61a60817533b84f369d2623e0593ec7"><div class="ttname"><a href="LowerExpectIntrinsic_8cpp.html#ab61a60817533b84f369d2623e0593ec7">handleSwitchExpect</a></div><div class="ttdeci">static bool handleSwitchExpect(SwitchInst &amp;SI)</div><div class="ttdef"><b>Definition:</b> <a href="LowerExpectIntrinsic_8cpp_source.html#l00079">LowerExpectIntrinsic.cpp:79</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_a96d73bbd7af15cb1fc38c3f4a3bd82e9"><div class="ttname"><a href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div><div class="ttdeci">#define F(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00055">MD5.cpp:55</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a9247a212ea89acc9573fa7e7f557eaba"><div class="ttname"><a href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">llvm::Instruction::setMetadata</a></div><div class="ttdeci">void setMetadata(unsigned KindID, MDNode *Node)</div><div class="ttdoc">Set the metadata of the specified kind to the specified node.</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8cpp_source.html#l01455">Metadata.cpp:1455</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html"><div class="ttname"><a href="classllvm_1_1BasicBlock.html">llvm::BasicBlock</a></div><div class="ttdoc">LLVM Basic Block Representation.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00055">BasicBlock.h:55</a></div></div>
<div class="ttc" id="aLowerExpectIntrinsic_8cpp_html_a6d8dd0fde9d96e02f04db1523ab644df"><div class="ttname"><a href="LowerExpectIntrinsic_8cpp.html#a6d8dd0fde9d96e02f04db1523ab644df">UnlikelyBranchWeight</a></div><div class="ttdeci">static cl::opt&lt; uint32_t &gt; UnlikelyBranchWeight(&quot;unlikely-branch-weight&quot;, cl::Hidden, cl::init(1), cl::desc(&quot;Weight of the branch unlikely to be taken (default = 1)&quot;))</div></div>
<div class="ttc" id="aAMDGPULibCalls_8cpp_html_afecf1cc1292b07f57d343c0f4d682044"><div class="ttname"><a href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a></div><div class="ttdeci">amdgpu Simplify well known AMD library false FunctionCallee Value * Arg</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPULibCalls_8cpp_source.html#l00187">AMDGPULibCalls.cpp:187</a></div></div>
<div class="ttc" id="aCommandLine_8h_html"><div class="ttname"><a href="CommandLine_8h.html">CommandLine.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html"><div class="ttname"><a href="classllvm_1_1ConstantInt.html">llvm::ConstantInt</a></div><div class="ttdoc">This is the shared class of boolean and integer constants.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00078">Constants.h:78</a></div></div>
<div class="ttc" id="aclassllvm_1_1PassRegistry_html_a05a729900b76c89e808c6c3094921b2f"><div class="ttname"><a href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">llvm::PassRegistry::getPassRegistry</a></div><div class="ttdeci">static PassRegistry * getPassRegistry()</div><div class="ttdoc">getPassRegistry - Access the global registry object, which is automatically initialized at applicatio...</div><div class="ttdef"><b>Definition:</b> <a href="PassRegistry_8cpp_source.html#l00024">PassRegistry.cpp:24</a></div></div>
<div class="ttc" id="aConstants_8h_html"><div class="ttname"><a href="Constants_8h.html">Constants.h</a></div></div>
<div class="ttc" id="aIntrinsics_8h_html"><div class="ttname"><a href="Intrinsics_8h.html">Intrinsics.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_a83b8c9e572130f403445c0b0f69b837c"><div class="ttname"><a href="classllvm_1_1CallBase.html#a83b8c9e572130f403445c0b0f69b837c">llvm::CallBase::getCalledFunction</a></div><div class="ttdeci">Function * getCalledFunction() const</div><div class="ttdoc">Returns the function called, or null if this is an indirect function invocation or the function signa...</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01406">InstrTypes.h:1406</a></div></div>
<div class="ttc" id="aclassllvm_1_1MDBuilder_html_ad910125a9cfd76aaad7f69469df22f66"><div class="ttname"><a href="classllvm_1_1MDBuilder.html#ad910125a9cfd76aaad7f69469df22f66">llvm::MDBuilder::createBranchWeights</a></div><div class="ttdeci">MDNode * createBranchWeights(uint32_t TrueWeight, uint32_t FalseWeight)</div><div class="ttdoc">Return metadata containing two branch weights.</div><div class="ttdef"><b>Definition:</b> <a href="MDBuilder_8cpp_source.html#l00037">MDBuilder.cpp:37</a></div></div>
<div class="ttc" id="aSIInstrInfo_8cpp_html_a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791"><div class="ttname"><a href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a></div><div class="ttdeci">@ SI</div><div class="ttdef"><b>Definition:</b> <a href="SIInstrInfo_8cpp_source.html#l07993">SIInstrInfo.cpp:7993</a></div></div>
<div class="ttc" id="anamespacellvm_1_1dwarf_html_a5d3c920b66ea797d6adb243862fdf47a"><div class="ttname"><a href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">llvm::dwarf::Index</a></div><div class="ttdeci">Index</div><div class="ttdef"><b>Definition:</b> <a href="Dwarf_8h_source.html#l00550">Dwarf.h:550</a></div></div>
<div class="ttc" id="aclassllvm_1_1BinaryOperator_html_a31bf07f3f61525486633bc1d0bbaf029"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#a31bf07f3f61525486633bc1d0bbaf029">llvm::BinaryOperator::getOpcode</a></div><div class="ttdeci">BinaryOps getOpcode() const</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00391">InstrTypes.h:391</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html"><div class="ttname"><a href="classllvm_1_1Instruction.html">llvm::Instruction</a></div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00041">Instruction.h:41</a></div></div>
<div class="ttc" id="aMDBuilder_8h_html"><div class="ttname"><a href="MDBuilder_8h.html">MDBuilder.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_a0bf75467957937ad23ad7be19f489934"><div class="ttname"><a href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">llvm::STATISTIC</a></div><div class="ttdeci">STATISTIC(NumFunctions, &quot;Total number of functions&quot;)</div></div>
<div class="ttc" id="aclassllvm_1_1SwitchInst_1_1CaseHandleImpl_html_a49fb99a80264b770a56f2b3c2934fb02"><div class="ttname"><a href="classllvm_1_1SwitchInst_1_1CaseHandleImpl.html#a49fb99a80264b770a56f2b3c2934fb02">llvm::SwitchInst::CaseHandleImpl::getCaseIndex</a></div><div class="ttdeci">unsigned getCaseIndex() const</div><div class="ttdoc">Returns number of current case.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03364">Instructions.h:3364</a></div></div>
<div class="ttc" id="anamespacellvm_1_1CallingConv_html_a188c0836f8c3528401f1c236fd93b977"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">llvm::CallingConv::ID</a></div><div class="ttdeci">unsigned ID</div><div class="ttdoc">LLVM IR allows to use arbitrary numbers as calling convention identifiers.</div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00024">CallingConv.h:24</a></div></div>
<div class="ttc" id="aADT_2tmp_8txt_html_a07ed0bfaa124c15897944fe3eaa971ab"><div class="ttname"><a href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a></div><div class="ttdeci">Class for arbitrary precision integers APInt is a functional replacement for common case unsigned integer type like unsigned long or uint64_t</div><div class="ttdef"><b>Definition:</b> <a href="ADT_2tmp_8txt_source.html#l00001">tmp.txt:1</a></div></div>
<div class="ttc" id="aLowerExpectIntrinsic_8cpp_html_aea5dd05a61257355d99f96d8d6dc9f94"><div class="ttname"><a href="LowerExpectIntrinsic_8cpp.html#aea5dd05a61257355d99f96d8d6dc9f94">handlePhiDef</a></div><div class="ttdeci">static void handlePhiDef(CallInst *Expect)</div><div class="ttdoc">Handler for PHINodes that define the value argument to an @llvm.expect call.</div><div class="ttdef"><b>Definition:</b> <a href="LowerExpectIntrinsic_8cpp_source.html#l00122">LowerExpectIntrinsic.cpp:122</a></div></div>
<div class="ttc" id="aBasicBlock_8h_html"><div class="ttname"><a href="BasicBlock_8h.html">BasicBlock.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1cl_1_1opt_html"><div class="ttname"><a href="classllvm_1_1cl_1_1opt.html">llvm::cl::opt</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l01410">CommandLine.h:1410</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PPC_html_a14028f7fe73a11dabc6583510cc0a355"><div class="ttname"><a href="namespacellvm_1_1PPC.html#a14028f7fe73a11dabc6583510cc0a355">llvm::PPC::Predicate</a></div><div class="ttdeci">Predicate</div><div class="ttdoc">Predicate - These are &quot;(BI &lt;&lt; 5) | BO&quot; for various predicates.</div><div class="ttdef"><b>Definition:</b> <a href="PPCPredicates_8h_source.html#l00026">PPCPredicates.h:26</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ae6b978645b8ac72d1a35e1298ffdd4f0"><div class="ttname"><a href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">llvm::Instruction::eraseFromParent</a></div><div class="ttdeci">SymbolTableList&lt; Instruction &gt;::iterator eraseFromParent()</div><div class="ttdoc">This method unlinks 'this' from the containing basic block and deletes it.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00082">Instruction.cpp:82</a></div></div>
<div class="ttc" id="aLowerExpectIntrinsic_8cpp_html_a390dfaf67ef6d58f12f5a19ee938c60f"><div class="ttname"><a href="LowerExpectIntrinsic_8cpp.html#a390dfaf67ef6d58f12f5a19ee938c60f">handleBranchExpect</a></div><div class="ttdeci">static bool handleBranchExpect(BranchInst &amp;BI)</div><div class="ttdef"><b>Definition:</b> <a href="LowerExpectIntrinsic_8cpp_source.html#l00361">LowerExpectIntrinsic.cpp:361</a></div></div>
<div class="ttc" id="aclassllvm_1_1ICmpInst_html"><div class="ttname"><a href="classllvm_1_1ICmpInst.html">llvm::ICmpInst</a></div><div class="ttdoc">This instruction compares its operands according to the predicate given to the constructor.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01197">Instructions.h:1197</a></div></div>
<div class="ttc" id="aELFObjHandler_8cpp_html_aef61945034b9431b804748fc317c5548"><div class="ttname"><a href="ELFObjHandler_8cpp.html#aef61945034b9431b804748fc317c5548">Index</a></div><div class="ttdeci">uint32_t Index</div><div class="ttdef"><b>Definition:</b> <a href="ELFObjHandler_8cpp_source.html#l00083">ELFObjHandler.cpp:83</a></div></div>
<div class="ttc" id="aMisExpect_8h_html"><div class="ttname"><a href="MisExpect_8h.html">MisExpect.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1numbers_html_a92f4283d4e0e2ea1776894b3ae93640f"><div class="ttname"><a href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">llvm::numbers::e</a></div><div class="ttdeci">constexpr double e</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00031">MathExtras.h:31</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7f96751b0dbbb50b5c9d8135ef2cddd6"><div class="ttname"><a href="namespacellvm.html#a7f96751b0dbbb50b5c9d8135ef2cddd6">llvm::createLowerExpectIntrinsicPass</a></div><div class="ttdeci">FunctionPass * createLowerExpectIntrinsicPass()</div></div>
<div class="ttc" id="aLowerExpectIntrinsic_8cpp_html_a6ac9067dc7c125cd83855df3e480e04c"><div class="ttname"><a href="LowerExpectIntrinsic_8cpp.html#a6ac9067dc7c125cd83855df3e480e04c">handleBrSelExpect</a></div><div class="ttdeci">static bool handleBrSelExpect(BrSelInst &amp;BSI)</div><div class="ttdef"><b>Definition:</b> <a href="LowerExpectIntrinsic_8cpp_source.html#l00280">LowerExpectIntrinsic.cpp:280</a></div></div>
<div class="ttc" id="aLowerExpectIntrinsic_8h_html"><div class="ttname"><a href="LowerExpectIntrinsic_8h.html">LowerExpectIntrinsic.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1cl_html_a10a041239ae1870cfcc064bfaa79fb65"><div class="ttname"><a href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">llvm::cl::init</a></div><div class="ttdeci">initializer&lt; Ty &gt; init(const Ty &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00445">CommandLine.h:445</a></div></div>
<div class="ttc" id="anamespacellvm_html_a8154638df88e4eaa568b67b23d463dac"><div class="ttname"><a href="namespacellvm.html#a8154638df88e4eaa568b67b23d463dac">llvm::make_early_inc_range</a></div><div class="ttdeci">iterator_range&lt; early_inc_iterator_impl&lt; detail::IterOfRange&lt; RangeT &gt; &gt; &gt; make_early_inc_range(RangeT &amp;&amp;Range)</div><div class="ttdoc">Make a range that does early increment to allow mutation of the underlying range without disrupting i...</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00721">STLExtras.h:721</a></div></div>
<div class="ttc" id="aLowerExpectIntrinsic_8cpp_html_ad2fd6546e0f1cc42311962f4ad4b29cd"><div class="ttname"><a href="LowerExpectIntrinsic_8cpp.html#ad2fd6546e0f1cc42311962f4ad4b29cd">lowerExpectIntrinsic</a></div><div class="ttdeci">static bool lowerExpectIntrinsic(Function &amp;F)</div><div class="ttdef"><b>Definition:</b> <a href="LowerExpectIntrinsic_8cpp_source.html#l00368">LowerExpectIntrinsic.cpp:368</a></div></div>
<div class="ttc" id="anamespacellvm_1_1misexpect_html_a4c52059f91406714507309d168ff95b8"><div class="ttname"><a href="namespacellvm_1_1misexpect.html#a4c52059f91406714507309d168ff95b8">llvm::misexpect::checkExpectAnnotations</a></div><div class="ttdeci">void checkExpectAnnotations(Instruction &amp;I, const ArrayRef&lt; uint32_t &gt; ExistingWeights, bool IsFrontend)</div><div class="ttdoc">checkExpectAnnotations - compares PGO counters to the thresholds used for llvm.expect and warns if th...</div><div class="ttdef"><b>Definition:</b> <a href="MisExpect_8cpp_source.html#l00202">MisExpect.cpp:202</a></div></div>
<div class="ttc" id="aSILowerControlFlow_8cpp_html_a4868c5d81c5ccc98c47aeab6244346a0"><div class="ttname"><a href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a></div><div class="ttdeci">assert(ImpDefSCC.getReg()==AMDGPU::SCC &amp;&amp;ImpDefSCC.isDef())</div></div>
<div class="ttc" id="aLowerExpectIntrinsic_8cpp_html_ad49597ea9df30b48ee0bae5eae846648"><div class="ttname"><a href="LowerExpectIntrinsic_8cpp.html#ad49597ea9df30b48ee0bae5eae846648">LikelyBranchWeight</a></div><div class="ttdeci">static cl::opt&lt; uint32_t &gt; LikelyBranchWeight(&quot;likely-branch-weight&quot;, cl::Hidden, cl::init(2000), cl::desc(&quot;Weight of the branch likely to be taken (default = 2000)&quot;))</div></div>
<div class="ttc" id="anamespacestd_html_ab8424022895aee3e366fb9a32f2883cb"><div class="ttname"><a href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a></div><div class="ttdeci">void swap(llvm::BitVector &amp;LHS, llvm::BitVector &amp;RHS)</div><div class="ttdoc">Implement std::swap in terms of BitVector swap.</div><div class="ttdef"><b>Definition:</b> <a href="BitVector_8h_source.html#l00853">BitVector.h:853</a></div></div>
<div class="ttc" id="aclassllvm_1_1SelectInst_html"><div class="ttname"><a href="classllvm_1_1SelectInst.html">llvm::SelectInst</a></div><div class="ttdoc">This class represents the LLVM 'select' instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01746">Instructions.h:1746</a></div></div>
<div class="ttc" id="aiterator__range_8h_html"><div class="ttname"><a href="iterator__range_8h.html">iterator_range.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1MDNode_html"><div class="ttname"><a href="classllvm_1_1MDNode.html">llvm::MDNode</a></div><div class="ttdoc">Metadata node.</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8h_source.html#l00943">Metadata.h:943</a></div></div>
<div class="ttc" id="aclassllvm_1_1BranchInst_html_ad56f6a9b5cd05940017c4544df48bc30"><div class="ttname"><a href="classllvm_1_1BranchInst.html#ad56f6a9b5cd05940017c4544df48bc30">llvm::BranchInst::isUnconditional</a></div><div class="ttdeci">bool isUnconditional() const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03217">Instructions.h:3217</a></div></div>
<div class="ttc" id="aclassllvm_1_1ZExtInst_html"><div class="ttname"><a href="classllvm_1_1ZExtInst.html">llvm::ZExtInst</a></div><div class="ttdoc">This class represents zero extension of integer types.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l04852">Instructions.h:4852</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html"><div class="ttname"><a href="classllvm_1_1APInt.html">llvm::APInt</a></div><div class="ttdoc">Class for arbitrary precision integers.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00075">APInt.h:75</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_a5fa9b8e1842b354f64c1ba6be0a4a17f"><div class="ttname"><a href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">llvm::User::setOperand</a></div><div class="ttdeci">void setOperand(unsigned i, Value *Val)</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00174">User.h:174</a></div></div>
<div class="ttc" id="aclassllvm_1_1Function_html_a4d0a7baab8d078065b2de10e3460892a"><div class="ttname"><a href="classllvm_1_1Function.html#a4d0a7baab8d078065b2de10e3460892a">llvm::Function::getIntrinsicID</a></div><div class="ttdeci">Intrinsic::ID getIntrinsicID() const LLVM_READONLY</div><div class="ttdoc">getIntrinsicID - This method returns the ID number of the specified function, or Intrinsic::not_intri...</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00204">Function.h:204</a></div></div>
<div class="ttc" id="aclassllvm_1_1BinaryOperator_html"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html">llvm::BinaryOperator</a></div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00187">InstrTypes.h:187</a></div></div>
<div class="ttc" id="aSupport_2ErrorHandling_8h_html_ace243f5c25697a1107cce46626b3dc94"><div class="ttname"><a href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a></div><div class="ttdeci">#define llvm_unreachable(msg)</div><div class="ttdoc">Marks that the current location is not supposed to be reachable.</div><div class="ttdef"><b>Definition:</b> <a href="Support_2ErrorHandling_8h_source.html#l00143">ErrorHandling.h:143</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a3ab5fc45117b450e8bb04e564cb6e5f2"><div class="ttname"><a href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">llvm::Value::replaceAllUsesWith</a></div><div class="ttdeci">void replaceAllUsesWith(Value *V)</div><div class="ttdoc">Change all uses of this to point to a new Value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00532">Value.cpp:532</a></div></div>
<div class="ttc" id="aclassuint32__t_html"><div class="ttname"><a href="classuint32__t.html">uint32_t</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_ab3fc0225d8aaf8434026c3573f961f2c"><div class="ttname"><a href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">llvm::Value::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const</div><div class="ttdoc">All values hold a context through their type.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00994">Value.cpp:994</a></div></div>
<div class="ttc" id="aclassllvm_1_1SExtInst_html"><div class="ttname"><a href="classllvm_1_1SExtInst.html">llvm::SExtInst</a></div><div class="ttdoc">This class represents a sign extension of integer types.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l04891">Instructions.h:4891</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_ac09a21c371a9c535cbc13e8f82503aec"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#ac09a21c371a9c535cbc13e8f82503aec">llvm::ConstantInt::getZExtValue</a></div><div class="ttdeci">uint64_t getZExtValue() const</div><div class="ttdoc">Return the constant as a 64-bit unsigned integer value after it has been zero extended as appropriate...</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00141">Constants.h:141</a></div></div>
<div class="ttc" id="aLowerExpectIntrinsic_8cpp_html_a674f7929c2b3901ebf25494b31c97f2d"><div class="ttname"><a href="LowerExpectIntrinsic_8cpp.html#a674f7929c2b3901ebf25494b31c97f2d">INITIALIZE_PASS</a></div><div class="ttdeci">INITIALIZE_PASS(LowerExpectIntrinsic, &quot;lower-expect&quot;, &quot;Lower 'expect' Intrinsics&quot;, false, false) FunctionPass *llvm</div><div class="ttdef"><b>Definition:</b> <a href="LowerExpectIntrinsic_8cpp_source.html#l00439">LowerExpectIntrinsic.cpp:439</a></div></div>
<div class="ttc" id="aEntryExitInstrumenter_8cpp_html_a3985f1f39349428d17f0d2b81ebc6349"><div class="ttname"><a href="EntryExitInstrumenter_8cpp.html#a3985f1f39349428d17f0d2b81ebc6349">runOnFunction</a></div><div class="ttdeci">static bool runOnFunction(Function &amp;F, bool PostInlining)</div><div class="ttdef"><b>Definition:</b> <a href="EntryExitInstrumenter_8cpp_source.html#l00085">EntryExitInstrumenter.cpp:85</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1SendMsg_html_a8594419a4ddfad2c9a79279c490e466d"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">llvm::AMDGPU::SendMsg::Op</a></div><div class="ttdeci">Op</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00357">SIDefines.h:357</a></div></div>
<div class="ttc" id="aclassllvm_1_1PreservedAnalyses_html_a1258a1ff55557c27684010ebd7283712"><div class="ttname"><a href="classllvm_1_1PreservedAnalyses.html#a1258a1ff55557c27684010ebd7283712">llvm::PreservedAnalyses::all</a></div><div class="ttdeci">static PreservedAnalyses all()</div><div class="ttdoc">Construct a special preserved set that preserves all passes.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00158">PassManager.h:158</a></div></div>
<div class="ttc" id="aFunction_8h_html"><div class="ttname"><a href="Function_8h.html">Function.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1TargetStackID_html_a71392100eb15ba746b1f898986f5d8a5"><div class="ttname"><a href="namespacellvm_1_1TargetStackID.html#a71392100eb15ba746b1f898986f5d8a5">llvm::TargetStackID::Value</a></div><div class="ttdeci">Value</div><div class="ttdef"><b>Definition:</b> <a href="TargetFrameLowering_8h_source.html#l00027">TargetFrameLowering.h:27</a></div></div>
<div class="ttc" id="aclassllvm_1_1MDBuilder_html"><div class="ttname"><a href="classllvm_1_1MDBuilder.html">llvm::MDBuilder</a></div><div class="ttdef"><b>Definition:</b> <a href="MDBuilder_8h_source.html#l00036">MDBuilder.h:36</a></div></div>
<div class="ttc" id="aInstructions_8h_html"><div class="ttname"><a href="Instructions_8h.html">Instructions.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_addec638786f763d967811b45cb662f1f"><div class="ttname"><a href="classllvm_1_1User.html#addec638786f763d967811b45cb662f1f">llvm::User::getNumOperands</a></div><div class="ttdeci">unsigned getNumOperands() const</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00191">User.h:191</a></div></div>
<div class="ttc" id="aSmallVector_8h_html"><div class="ttname"><a href="SmallVector_8h.html">SmallVector.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_ab2caa29167597390ab2fc3cf30d70389"><div class="ttname"><a href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">llvm::CallBase::getArgOperand</a></div><div class="ttdeci">Value * getArgOperand(unsigned i) const</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01351">InstrTypes.h:1351</a></div></div>
<div class="ttc" id="aclassllvm_1_1SwitchInst_1_1CaseHandle_html"><div class="ttname"><a href="classllvm_1_1SwitchInst_1_1CaseHandle.html">llvm::SwitchInst::CaseHandle</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03383">Instructions.h:3383</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a1a7f07aaef6a3bee130bf0e0f0536802"><div class="ttname"><a href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">llvm::Instruction::getParent</a></div><div class="ttdeci">const BasicBlock * getParent() const</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00090">Instruction.h:90</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_aa7414ba9f658ff1287d22a4b8fe81bcb"><div class="ttname"><a href="classllvm_1_1CmpInst.html#aa7414ba9f658ff1287d22a4b8fe81bcb">llvm::CmpInst::getPredicate</a></div><div class="ttdeci">Predicate getPredicate() const</div><div class="ttdoc">Return the predicate for this instruction.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00808">InstrTypes.h:808</a></div></div>
<div class="ttc" id="anamespacellvm_html_a6b0ac1fa4f05de76413c5e0ca6334035"><div class="ttname"><a href="namespacellvm.html#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a></div><div class="ttdeci">auto reverse(ContainerTy &amp;&amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00484">STLExtras.h:484</a></div></div>
<div class="ttc" id="aLowerExpectIntrinsic_8cpp_html_a8dc30a73b67684ced1d3f3d71a79a805"><div class="ttname"><a href="LowerExpectIntrinsic_8cpp.html#a8dc30a73b67684ced1d3f3d71a79a805">getBranchWeight</a></div><div class="ttdeci">static std::tuple&lt; uint32_t, uint32_t &gt; getBranchWeight(Intrinsic::ID IntrinsicID, CallInst *CI, int BranchCount)</div><div class="ttdef"><b>Definition:</b> <a href="LowerExpectIntrinsic_8cpp_source.html#l00059">LowerExpectIntrinsic.cpp:59</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisManager_html"><div class="ttname"><a href="classllvm_1_1AnalysisManager.html">llvm::AnalysisManager</a></div><div class="ttdoc">A container for analyses that lazily runs them and caches their results.</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8h_source.html#l00042">InstructionSimplify.h:42</a></div></div>
<div class="ttc" id="aclassllvm_1_1FunctionPass_html"><div class="ttname"><a href="classllvm_1_1FunctionPass.html">llvm::FunctionPass</a></div><div class="ttdoc">FunctionPass class - This class is used to implement most global optimizations.</div><div class="ttdef"><b>Definition:</b> <a href="Pass_8h_source.html#l00308">Pass.h:308</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallInst_html"><div class="ttname"><a href="classllvm_1_1CallInst.html">llvm::CallInst</a></div><div class="ttdoc">This class represents a function call, abstracting a target machine's calling convention.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01485">Instructions.h:1485</a></div></div>
<div class="ttc" id="alib_2CodeGen_2README_8txt_html_a09776db24cf586ec9f1e18f3bae14099"><div class="ttname"><a href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a></div><div class="ttdeci">Common register allocation spilling lr str ldr sxth r3 ldr mla r4 can lr mov lr str ldr sxth r3 mla r4 and then merge mul and lr str ldr sxth r3 mla r4 It also increase the likelihood the store may become dead bb27 Successors according to LLVM BB</div><div class="ttdef"><b>Definition:</b> <a href="lib_2CodeGen_2README_8txt_source.html#l00039">README.txt:39</a></div></div>
<div class="ttc" id="aLLVMContext_8h_html"><div class="ttname"><a href="LLVMContext_8h.html">LLVMContext.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1SwitchInst_html"><div class="ttname"><a href="classllvm_1_1SwitchInst.html">llvm::SwitchInst</a></div><div class="ttdoc">Multiway switch.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03283">Instructions.h:3283</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_abe1de1520a21f77ac57cc210bf0fb0b4"><div class="ttname"><a href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">llvm::User::getOperand</a></div><div class="ttdeci">Value * getOperand(unsigned i) const</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00169">User.h:169</a></div></div>
<div class="ttc" id="astructllvm_1_1cl_1_1desc_html"><div class="ttname"><a href="structllvm_1_1cl_1_1desc.html">llvm::cl::desc</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00411">CommandLine.h:411</a></div></div>
<div class="ttc" id="aclassllvm_1_1BranchInst_html"><div class="ttname"><a href="classllvm_1_1BranchInst.html">llvm::BranchInst</a></div><div class="ttdoc">Conditional or Unconditional Branch instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03139">Instructions.h:3139</a></div></div>
<div class="ttc" id="alib_2Target_2README_8txt_html_ab335e668fd33542ea14a2c7b527e64d3"><div class="ttname"><a href="lib_2Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a></div><div class="ttdeci">The same transformation can work with an even modulo with the addition of a and shrink the compare RHS by the same amount Unless the target supports that transformation probably isn t worthwhile The transformation can also easily be made to work with non zero equality for n</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2README_8txt_source.html#l00685">README.txt:685</a></div></div>
<div class="ttc" id="aInitializePasses_8h_html"><div class="ttname"><a href="InitializePasses_8h.html">InitializePasses.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html"><div class="ttname"><a href="classllvm_1_1Value.html">llvm::Value</a></div><div class="ttdoc">LLVM Value Representation.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00074">Value.h:74</a></div></div>
<div class="ttc" id="aclassllvm_1_1BranchInst_html_a7e4be8b16fbd68c9045a388904044e01"><div class="ttname"><a href="classllvm_1_1BranchInst.html#a7e4be8b16fbd68c9045a388904044e01">llvm::BranchInst::isConditional</a></div><div class="ttdeci">bool isConditional() const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03218">Instructions.h:3218</a></div></div>
<div class="ttc" id="aclassllvm_1_1BranchInst_html_ad97f2e60cf22f15e0cf617af52309031"><div class="ttname"><a href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">llvm::BranchInst::getSuccessor</a></div><div class="ttdeci">BasicBlock * getSuccessor(unsigned i) const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03232">Instructions.h:3232</a></div></div>
<div class="ttc" id="anamespacellvm_1_1Intrinsic_html_a80add6b3b1cdaec560907995127adc16"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">llvm::Intrinsic::ID</a></div><div class="ttdeci">unsigned ID</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00039">TargetTransformInfo.h:39</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 7 2023 10:33:43 for LLVM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
